nohup: ignoring input
10:20:07 [INFO] __main__: === Game Server starting ===
10:20:07 [INFO] __main__: Loading configuration …
10:20:07 [INFO] __main__:   items:        210 loaded from config
10:20:07 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
10:20:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
10:20:07 [INFO] __main__: Initializing persistence …
10:20:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
10:20:07 [INFO] __main__:   database:     connected (gameserver.db)
10:20:07 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T10:20:05, version 1)
10:20:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
10:20:07 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
10:20:07 [INFO] __main__: Creating services …
10:20:07 [INFO] __main__:   upgrade_provider: 210 items registered
10:20:07 [INFO] __main__:   all services created
10:20:07 [INFO] __main__: Wiring event handlers …
10:20:07 [INFO] __main__:   event handlers registered
10:20:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
10:20:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
10:20:07 [INFO] __main__: Restored 2 empires from saved state
10:20:07 [INFO] __main__: Starting network server …
10:20:07 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
10:20:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
10:20:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
10:20:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
10:20:07 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
10:20:07 [INFO] __main__: Starting game loop …
10:20:07 [INFO] __main__:   game loop running (1 s tick)
10:20:08 [INFO] websockets.server: connection open
10:20:08 [INFO] gameserver.network.server: Session registered: uid=-1
10:20:08 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54946)
10:20:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:22:19 [INFO] gameserver.network.server: Session removed: uid=-1
10:22:20 [INFO] websockets.server: connection open
10:22:20 [INFO] gameserver.network.server: Session registered: uid=-2
10:22:20 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60774)
10:22:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:22:32 [INFO] gameserver.network.server: Session removed: uid=-2
10:22:32 [INFO] websockets.server: connection open
10:22:32 [INFO] gameserver.network.server: Session registered: uid=-3
10:22:32 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60781)
10:22:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:22:33 [INFO] gameserver.network.server: Session removed: uid=-3
10:22:33 [INFO] websockets.server: connection open
10:22:33 [INFO] gameserver.network.server: Session registered: uid=-4
10:22:33 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 60783)
10:22:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:22:33 [INFO] gameserver.network.server: Session removed: uid=-4
10:22:33 [INFO] websockets.server: connection open
10:22:33 [INFO] gameserver.network.server: Session registered: uid=-5
10:22:33 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 60788)
10:22:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:23:56 [INFO] gameserver.network.server: Session removed: uid=-5
10:23:56 [INFO] websockets.server: connection open
10:23:56 [INFO] gameserver.network.server: Session registered: uid=-6
10:23:56 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 61681)
10:23:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:25:00 [INFO] gameserver.network.server: Session removed: uid=-6
10:25:00 [INFO] websockets.server: connection open
10:25:00 [INFO] gameserver.network.server: Session registered: uid=-7
10:25:00 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 49843)
10:25:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:32:54 [INFO] gameserver.network.server: Session removed: uid=-7
10:32:54 [INFO] websockets.server: connection open
10:32:54 [INFO] gameserver.network.server: Session registered: uid=-8
10:32:54 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 57852)
10:32:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:35:58 [INFO] gameserver.network.server: Session removed: uid=-8
10:35:58 [INFO] websockets.server: connection open
10:35:58 [INFO] gameserver.network.server: Session registered: uid=-9
10:35:58 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 65249)
10:35:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
10:36:40 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
10:39:33 [INFO] __main__: Shutdown signal received — stopping …
10:39:33 [INFO] __main__: Shutting down …
10:39:33 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
10:39:33 [INFO] websockets.server: server closing
10:39:33 [INFO] gameserver.network.server: Session removed: uid=-9
10:39:33 [INFO] websockets.server: server closed
10:39:33 [INFO] gameserver.network.server: WebSocket server stopped
10:39:33 [INFO] __main__:   WebSocket server stopped
10:39:33 [INFO] __main__:   debug dashboard stopped
10:39:33 [INFO] __main__:   database closed
10:39:33 [INFO] __main__:   goodbye
12:40:09 [INFO] __main__: === Game Server starting ===
12:40:09 [INFO] __main__: Loading configuration …
12:40:10 [INFO] __main__:   items:        210 loaded from config
12:40:10 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
12:40:10 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
12:40:10 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
12:40:10 [INFO] __main__:   game_config:  loaded
12:40:10 [INFO] __main__: Initializing persistence …
12:40:10 [INFO] gameserver.persistence.database: Database connected: gameserver.db
12:40:10 [INFO] __main__:   database:     connected (gameserver.db)
12:40:10 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T12:35:38, version 1)
12:40:10 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
12:40:10 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
12:40:10 [INFO] __main__: Creating services …
12:40:10 [INFO] __main__:   upgrade_provider: 210 items registered
12:40:10 [INFO] __main__:   all services created
12:40:10 [INFO] __main__: Wiring event handlers …
12:40:10 [INFO] __main__:   event handlers registered
12:40:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
12:40:10 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
12:40:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
12:40:10 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.1}
12:40:10 [INFO] __main__: Restored 2 empires from saved state
12:40:10 [INFO] __main__: Starting network server …
12:40:10 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
12:40:10 [INFO] websockets.server: server listening on 0.0.0.0:8765
12:40:10 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
12:40:10 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
12:40:10 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
12:40:10 [INFO] __main__: Starting game loop …
12:40:10 [INFO] __main__:   game loop running (1 s tick)
12:40:31 [INFO] websockets.server: connection open
12:40:31 [INFO] gameserver.network.server: Session registered: uid=-1
12:40:31 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56636)
12:40:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
12:42:17 [INFO] __main__: Shutdown signal received — stopping …
12:42:17 [INFO] __main__: Shutting down …
12:42:17 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
12:42:17 [INFO] websockets.server: server closing
12:42:17 [INFO] gameserver.network.server: Session removed: uid=-1
12:42:17 [INFO] websockets.server: server closed
12:42:17 [INFO] gameserver.network.server: WebSocket server stopped
12:42:17 [INFO] __main__:   WebSocket server stopped
12:42:17 [INFO] __main__:   debug dashboard stopped
12:42:17 [INFO] __main__:   database closed
12:42:17 [INFO] __main__:   goodbye
12:42:19 [INFO] __main__: === Game Server starting ===
12:42:19 [INFO] __main__: Loading configuration …
12:42:20 [INFO] __main__:   items:        210 loaded from config
12:42:20 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
12:42:20 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
12:42:20 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
12:42:20 [INFO] __main__:   game_config:  loaded
12:42:20 [INFO] __main__: Initializing persistence …
12:42:20 [INFO] gameserver.persistence.database: Database connected: gameserver.db
12:42:20 [INFO] __main__:   database:     connected (gameserver.db)
12:42:20 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T12:42:17, version 1)
12:42:20 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
12:42:20 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
12:42:20 [INFO] __main__: Creating services …
12:42:20 [INFO] __main__:   upgrade_provider: 210 items registered
12:42:20 [INFO] __main__:   all services created
12:42:20 [INFO] __main__: Wiring event handlers …
12:42:20 [INFO] __main__:   event handlers registered
12:42:20 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
12:42:20 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
12:42:20 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
12:42:20 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.1}
12:42:20 [INFO] __main__: Restored 2 empires from saved state
12:42:20 [INFO] __main__: Starting network server …
12:42:20 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
12:42:20 [INFO] websockets.server: server listening on 0.0.0.0:8765
12:42:20 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
12:42:20 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
12:42:20 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
12:42:20 [INFO] __main__: Starting game loop …
12:42:20 [INFO] __main__:   game loop running (1 s tick)
12:42:20 [INFO] websockets.server: connection open
12:42:20 [INFO] gameserver.network.server: Session registered: uid=-1
12:42:20 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59611)
12:42:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
12:42:27 [INFO] gameserver.network.server: Session removed: uid=-1
12:42:27 [INFO] websockets.server: connection open
12:42:27 [INFO] gameserver.network.server: Session registered: uid=-2
12:42:27 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59634)
12:42:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
12:42:30 [INFO] gameserver.engine.empire_service: Empire 2: started building MAIN_HOUSE (effort=100.0)
12:42:30 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MAIN_HOUSE
12:44:09 [INFO] gameserver.engine.empire_service: Empire 2: building MAIN_HOUSE completed
12:44:40 [INFO] gameserver.network.server: Session removed: uid=-2
12:44:40 [INFO] websockets.server: connection open
12:44:40 [INFO] gameserver.network.server: Session registered: uid=-3
12:44:40 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60855)
12:44:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:15:01 [INFO] __main__: Shutdown signal received — stopping …
13:15:02 [INFO] __main__: Shutting down …
13:15:02 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
13:15:02 [INFO] websockets.server: server closing
13:15:02 [INFO] gameserver.network.server: Session removed: uid=-3
13:15:02 [INFO] websockets.server: server closed
13:15:02 [INFO] gameserver.network.server: WebSocket server stopped
13:15:02 [INFO] __main__:   WebSocket server stopped
13:15:02 [INFO] __main__:   debug dashboard stopped
13:15:02 [INFO] __main__:   database closed
13:15:02 [INFO] __main__:   goodbye
13:15:03 [INFO] __main__: === Game Server starting ===
13:15:03 [INFO] __main__: Loading configuration …
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 426, in <module>
    main()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 422, in main
    asyncio.run(_start())
  File "/usr/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.9/asyncio/base_events.py", line 642, in run_until_complete
    return future.result()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 370, in _start
    config = load_configuration()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 127, in load_configuration
    items = load_items(items_path)
  File "/home/pi/e3/python_server/src/gameserver/loaders/item_loader.py", line 83, in load_items
    data = yaml.safe_load(f) or {}
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/__init__.py", line 125, in safe_load
    return load(stream, SafeLoader)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/__init__.py", line 81, in load
    return loader.get_single_data()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/constructor.py", line 49, in get_single_data
    node = self.get_single_node()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/composer.py", line 36, in get_single_node
    document = self.compose_document()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/composer.py", line 55, in compose_document
    node = self.compose_node(None, None)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/composer.py", line 84, in compose_node
    node = self.compose_mapping_node(anchor)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/composer.py", line 133, in compose_mapping_node
    item_value = self.compose_node(node, item_key)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/composer.py", line 84, in compose_node
    node = self.compose_mapping_node(anchor)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/composer.py", line 127, in compose_mapping_node
    while not self.check_event(MappingEndEvent):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/parser.py", line 98, in check_event
    self.current_event = self.state()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/parser.py", line 428, in parse_block_mapping_key
    if self.check_token(KeyToken):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/scanner.py", line 115, in check_token
    while self.need_more_tokens():
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/scanner.py", line 152, in need_more_tokens
    self.stale_possible_simple_keys()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/yaml/scanner.py", line 291, in stale_possible_simple_keys
    raise ScannerError("while scanning a simple key", key.mark,
yaml.scanner.ScannerError: while scanning a simple key
  in "config/buildings.yaml", line 286, column 3
could not find expected ':'
  in "config/buildings.yaml", line 288, column 1
13:15:45 [INFO] __main__: === Game Server starting ===
13:15:45 [INFO] __main__: Loading configuration …
13:15:46 [INFO] __main__:   items:        210 loaded from config
13:15:46 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
13:15:46 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
13:15:46 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
13:15:46 [INFO] __main__:   game_config:  loaded
13:15:46 [INFO] __main__: Initializing persistence …
13:15:46 [INFO] gameserver.persistence.database: Database connected: gameserver.db
13:15:46 [INFO] __main__:   database:     connected (gameserver.db)
13:15:46 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T13:15:02, version 1)
13:15:46 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
13:15:46 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
13:15:46 [INFO] __main__: Creating services …
13:15:46 [INFO] __main__:   upgrade_provider: 210 items registered
13:15:46 [INFO] __main__:   all services created
13:15:46 [INFO] __main__: Wiring event handlers …
13:15:46 [INFO] __main__:   event handlers registered
13:15:46 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
13:15:46 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
13:15:46 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
13:15:46 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
13:15:46 [INFO] __main__: Restored 2 empires from saved state
13:15:46 [INFO] __main__: Starting network server …
13:15:46 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
13:15:46 [INFO] websockets.server: server listening on 0.0.0.0:8765
13:15:46 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
13:15:46 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
13:15:46 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
13:15:46 [INFO] __main__: Starting game loop …
13:15:46 [INFO] __main__:   game loop running (1 s tick)
13:15:46 [INFO] websockets.server: connection open
13:15:46 [INFO] gameserver.network.server: Session registered: uid=-1
13:15:46 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57131)
13:15:46 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:16:18 [INFO] gameserver.network.server: Session removed: uid=-1
13:16:18 [INFO] websockets.server: connection open
13:16:18 [INFO] gameserver.network.server: Session registered: uid=-2
13:16:18 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57192)
13:16:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:21:33 [INFO] gameserver.engine.empire_service: Empire 2: started research HUNTING (effort=20.0)
13:21:33 [INFO] gameserver.network.handlers: new_item success uid=2 iid=HUNTING
13:21:53 [INFO] gameserver.engine.empire_service: Empire 2: knowledge HUNTING completed
13:25:51 [INFO] gameserver.network.server: Session removed: uid=-2
13:25:51 [INFO] websockets.server: connection open
13:25:51 [INFO] gameserver.network.server: Session registered: uid=-3
13:25:51 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 56773)
13:25:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:26:23 [INFO] __main__: Shutdown signal received — stopping …
13:26:24 [INFO] __main__: Shutting down …
13:26:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
13:26:24 [INFO] websockets.server: server closing
13:26:24 [INFO] gameserver.network.server: Session removed: uid=-3
13:26:24 [INFO] websockets.server: server closed
13:26:24 [INFO] gameserver.network.server: WebSocket server stopped
13:26:24 [INFO] __main__:   WebSocket server stopped
13:26:24 [INFO] __main__:   debug dashboard stopped
13:26:24 [INFO] __main__:   database closed
13:26:24 [INFO] __main__:   goodbye
13:26:25 [INFO] __main__: === Game Server starting ===
13:26:25 [INFO] __main__: Loading configuration …
13:26:26 [INFO] __main__:   items:        210 loaded from config
13:26:26 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
13:26:26 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
13:26:26 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
13:26:26 [INFO] __main__:   game_config:  loaded
13:26:26 [INFO] __main__: Initializing persistence …
13:26:26 [INFO] gameserver.persistence.database: Database connected: gameserver.db
13:26:26 [INFO] __main__:   database:     connected (gameserver.db)
13:26:26 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T13:26:24, version 1)
13:26:26 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
13:26:26 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
13:26:26 [INFO] __main__: Creating services …
13:26:26 [INFO] __main__:   upgrade_provider: 210 items registered
13:26:26 [INFO] __main__:   all services created
13:26:26 [INFO] __main__: Wiring event handlers …
13:26:26 [INFO] __main__:   event handlers registered
13:26:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
13:26:26 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
13:26:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
13:26:26 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
13:26:26 [INFO] __main__: Restored 2 empires from saved state
13:26:26 [INFO] __main__: Starting network server …
13:26:26 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
13:26:26 [INFO] websockets.server: server listening on 0.0.0.0:8765
13:26:26 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
13:26:26 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
13:26:26 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
13:26:26 [INFO] __main__: Starting game loop …
13:26:26 [INFO] __main__:   game loop running (1 s tick)
13:26:27 [INFO] websockets.server: connection open
13:26:27 [INFO] gameserver.network.server: Session registered: uid=-1
13:26:27 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56819)
13:26:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:26:29 [INFO] gameserver.network.server: Session removed: uid=-1
13:26:29 [INFO] websockets.server: connection open
13:26:29 [INFO] gameserver.network.server: Session registered: uid=-2
13:26:29 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 56842)
13:26:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:26:42 [INFO] gameserver.engine.empire_service: Empire 2: started research MYSTIC (effort=100.0)
13:26:42 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MYSTIC
13:27:03 [INFO] gameserver.network.server: Session removed: uid=-2
13:27:03 [INFO] websockets.server: connection open
13:27:03 [INFO] gameserver.network.server: Session registered: uid=-3
13:27:03 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 52638)
13:27:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:27:04 [INFO] gameserver.network.server: Session removed: uid=-3
13:27:04 [INFO] websockets.server: connection open
13:27:04 [INFO] gameserver.network.server: Session registered: uid=-4
13:27:04 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 52659)
13:27:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:27:55 [INFO] gameserver.network.server: Session removed: uid=-4
13:27:55 [INFO] websockets.server: connection open
13:27:55 [INFO] gameserver.network.server: Session registered: uid=-5
13:27:55 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 54950)
13:27:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:27:57 [INFO] __main__: Shutdown signal received — stopping …
13:27:58 [INFO] __main__: Shutting down …
13:27:58 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
13:27:58 [INFO] websockets.server: server closing
13:27:58 [INFO] gameserver.network.server: Session removed: uid=-5
13:27:58 [INFO] websockets.server: server closed
13:27:58 [INFO] gameserver.network.server: WebSocket server stopped
13:27:58 [INFO] __main__:   WebSocket server stopped
13:27:58 [INFO] __main__:   debug dashboard stopped
13:27:58 [INFO] __main__:   database closed
13:27:58 [INFO] __main__:   goodbye
13:27:59 [INFO] __main__: === Game Server starting ===
13:27:59 [INFO] __main__: Loading configuration …
13:28:00 [INFO] __main__:   items:        210 loaded from config
13:28:00 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
13:28:00 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
13:28:00 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
13:28:00 [INFO] __main__:   game_config:  loaded
13:28:00 [INFO] __main__: Initializing persistence …
13:28:00 [INFO] gameserver.persistence.database: Database connected: gameserver.db
13:28:00 [INFO] __main__:   database:     connected (gameserver.db)
13:28:00 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T13:27:58, version 1)
13:28:00 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
13:28:00 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
13:28:00 [INFO] __main__: Creating services …
13:28:00 [INFO] __main__:   upgrade_provider: 210 items registered
13:28:00 [INFO] __main__:   all services created
13:28:00 [INFO] __main__: Wiring event handlers …
13:28:00 [INFO] __main__:   event handlers registered
13:28:00 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
13:28:00 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
13:28:00 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
13:28:00 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
13:28:00 [INFO] __main__: Restored 2 empires from saved state
13:28:00 [INFO] __main__: Starting network server …
13:28:00 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
13:28:00 [INFO] websockets.server: server listening on 0.0.0.0:8765
13:28:00 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
13:28:00 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
13:28:00 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
13:28:00 [INFO] __main__: Starting game loop …
13:28:00 [INFO] __main__:   game loop running (1 s tick)
13:28:01 [INFO] websockets.server: connection open
13:28:01 [INFO] gameserver.network.server: Session registered: uid=-1
13:28:01 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63715)
13:28:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:28:01 [INFO] gameserver.network.server: Session removed: uid=-1
13:28:02 [INFO] websockets.server: connection open
13:28:02 [INFO] gameserver.network.server: Session registered: uid=-2
13:28:02 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63737)
13:28:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:31:00 [INFO] gameserver.network.server: Session removed: uid=-2
13:31:00 [INFO] websockets.server: connection open
13:31:00 [INFO] gameserver.network.server: Session registered: uid=-3
13:31:00 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 62671)
13:31:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:31:20 [INFO] gameserver.network.server: Session removed: uid=-3
13:31:20 [INFO] websockets.server: connection open
13:31:20 [INFO] gameserver.network.server: Session registered: uid=-4
13:31:20 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 62690)
13:31:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:31:28 [INFO] gameserver.network.server: Session removed: uid=-4
13:31:28 [INFO] websockets.server: connection open
13:31:28 [INFO] gameserver.network.server: Session registered: uid=-5
13:31:28 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 62698)
13:31:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:31:29 [INFO] gameserver.network.server: Session removed: uid=-5
13:31:29 [INFO] websockets.server: connection open
13:31:29 [INFO] gameserver.network.server: Session registered: uid=-6
13:31:29 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 62701)
13:31:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:31:32 [INFO] gameserver.network.server: Session removed: uid=-6
13:31:32 [INFO] websockets.server: connection open
13:31:32 [INFO] gameserver.network.server: Session registered: uid=-7
13:31:32 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 62706)
13:31:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:31:41 [INFO] gameserver.network.server: Session removed: uid=-7
13:31:41 [INFO] websockets.server: connection open
13:31:41 [INFO] gameserver.network.server: Session registered: uid=-8
13:31:41 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 62713)
13:31:41 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:31:58 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=item_request sender=0
13:32:03 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=100
13:32:06 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
13:32:34 [INFO] __main__: Shutdown signal received — stopping …
13:32:35 [INFO] __main__: Shutting down …
13:32:35 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
13:32:35 [INFO] websockets.server: server closing
13:32:35 [INFO] gameserver.network.server: Session removed: uid=-8
13:32:35 [INFO] websockets.server: server closed
13:32:35 [INFO] gameserver.network.server: WebSocket server stopped
13:32:35 [INFO] __main__:   WebSocket server stopped
13:32:35 [INFO] __main__:   debug dashboard stopped
13:32:35 [INFO] __main__:   database closed
13:32:35 [INFO] __main__:   goodbye
13:32:36 [INFO] __main__: === Game Server starting ===
13:32:36 [INFO] __main__: Loading configuration …
13:32:36 [INFO] __main__:   items:        210 loaded from config
13:32:36 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
13:32:36 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
13:32:36 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
13:32:36 [INFO] __main__:   game_config:  loaded
13:32:36 [INFO] __main__: Initializing persistence …
13:32:36 [INFO] gameserver.persistence.database: Database connected: gameserver.db
13:32:36 [INFO] __main__:   database:     connected (gameserver.db)
13:32:36 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T13:32:35, version 1)
13:32:36 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
13:32:36 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
13:32:36 [INFO] __main__: Creating services …
13:32:36 [INFO] __main__:   upgrade_provider: 210 items registered
13:32:36 [INFO] __main__:   all services created
13:32:36 [INFO] __main__: Wiring event handlers …
13:32:36 [INFO] __main__:   event handlers registered
13:32:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
13:32:36 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
13:32:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
13:32:36 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
13:32:36 [INFO] __main__: Restored 2 empires from saved state
13:32:36 [INFO] __main__: Starting network server …
13:32:36 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
13:32:36 [INFO] websockets.server: server listening on 0.0.0.0:8765
13:32:36 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
13:32:36 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
13:32:36 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
13:32:36 [INFO] __main__: Starting game loop …
13:32:36 [INFO] __main__:   game loop running (1 s tick)
13:32:38 [INFO] websockets.server: connection open
13:32:38 [INFO] gameserver.network.server: Session registered: uid=-1
13:32:38 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55671)
13:32:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:33:08 [INFO] gameserver.network.server: Session removed: uid=-1
13:33:09 [INFO] websockets.server: connection open
13:33:09 [INFO] gameserver.network.server: Session registered: uid=-2
13:33:09 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55961)
13:33:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:33:10 [INFO] gameserver.network.server: Session removed: uid=-2
13:33:10 [INFO] websockets.server: connection open
13:33:10 [INFO] gameserver.network.server: Session registered: uid=-3
13:33:10 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 55965)
13:33:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:33:13 [INFO] gameserver.network.server: Session removed: uid=-3
13:33:13 [INFO] websockets.server: connection open
13:33:13 [INFO] gameserver.network.server: Session registered: uid=-4
13:33:13 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 55987)
13:33:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:34:21 [INFO] gameserver.engine.empire_service: Empire 2: started building EARTH_WALL (effort=150.0)
13:34:21 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EARTH_WALL
13:34:28 [INFO] __main__: Shutdown signal received — stopping …
13:34:29 [INFO] __main__: Shutting down …
13:34:29 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
13:34:29 [INFO] websockets.server: server closing
13:34:29 [INFO] gameserver.network.server: Session removed: uid=-4
13:34:29 [INFO] websockets.server: server closed
13:34:29 [INFO] gameserver.network.server: WebSocket server stopped
13:34:29 [INFO] __main__:   WebSocket server stopped
13:34:29 [INFO] __main__:   debug dashboard stopped
13:34:29 [INFO] __main__:   database closed
13:34:29 [INFO] __main__:   goodbye
13:34:31 [INFO] __main__: === Game Server starting ===
13:34:31 [INFO] __main__: Loading configuration …
13:34:31 [INFO] __main__:   items:        210 loaded from config
13:34:31 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
13:34:31 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
13:34:31 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
13:34:31 [INFO] __main__:   game_config:  loaded
13:34:31 [INFO] __main__: Initializing persistence …
13:34:32 [INFO] gameserver.persistence.database: Database connected: gameserver.db
13:34:32 [INFO] __main__:   database:     connected (gameserver.db)
13:34:32 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T13:34:29, version 1)
13:34:32 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
13:34:32 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
13:34:32 [INFO] __main__: Creating services …
13:34:32 [INFO] __main__:   upgrade_provider: 210 items registered
13:34:32 [INFO] __main__:   all services created
13:34:32 [INFO] __main__: Wiring event handlers …
13:34:32 [INFO] __main__:   event handlers registered
13:34:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
13:34:32 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
13:34:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
13:34:32 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
13:34:32 [INFO] __main__: Restored 2 empires from saved state
13:34:32 [INFO] __main__: Starting network server …
13:34:32 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
13:34:32 [INFO] websockets.server: server listening on 0.0.0.0:8765
13:34:32 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
13:34:32 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
13:34:32 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
13:34:32 [INFO] __main__: Starting game loop …
13:34:32 [INFO] __main__:   game loop running (1 s tick)
13:34:32 [INFO] websockets.server: connection open
13:34:32 [INFO] gameserver.network.server: Session registered: uid=-1
13:34:32 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56773)
13:34:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:34:53 [INFO] gameserver.network.server: Session removed: uid=-1
13:34:53 [INFO] websockets.server: connection open
13:34:53 [INFO] gameserver.network.server: Session registered: uid=-2
13:34:53 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60033)
13:34:53 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:34:54 [INFO] gameserver.network.server: Session removed: uid=-2
13:34:54 [INFO] websockets.server: connection open
13:34:54 [INFO] gameserver.network.server: Session registered: uid=-3
13:34:54 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60035)
13:34:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:34:55 [INFO] gameserver.network.server: Session removed: uid=-3
13:34:55 [INFO] websockets.server: connection open
13:34:55 [INFO] gameserver.network.server: Session registered: uid=-4
13:34:55 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 60037)
13:34:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:34:56 [INFO] __main__: Shutdown signal received — stopping …
13:34:57 [INFO] __main__: Shutting down …
13:34:57 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
13:34:57 [INFO] websockets.server: server closing
13:34:57 [INFO] gameserver.network.server: Session removed: uid=-4
13:34:57 [INFO] websockets.server: server closed
13:34:57 [INFO] gameserver.network.server: WebSocket server stopped
13:34:57 [INFO] __main__:   WebSocket server stopped
13:34:57 [INFO] __main__:   debug dashboard stopped
13:34:57 [INFO] __main__:   database closed
13:34:57 [INFO] __main__:   goodbye
13:34:58 [INFO] __main__: === Game Server starting ===
13:34:58 [INFO] __main__: Loading configuration …
13:34:59 [INFO] __main__:   items:        210 loaded from config
13:34:59 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
13:34:59 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
13:34:59 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
13:34:59 [INFO] __main__:   game_config:  loaded
13:34:59 [INFO] __main__: Initializing persistence …
13:34:59 [INFO] gameserver.persistence.database: Database connected: gameserver.db
13:34:59 [INFO] __main__:   database:     connected (gameserver.db)
13:34:59 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T13:34:57, version 1)
13:34:59 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
13:34:59 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
13:34:59 [INFO] __main__: Creating services …
13:34:59 [INFO] __main__:   upgrade_provider: 210 items registered
13:34:59 [INFO] __main__:   all services created
13:34:59 [INFO] __main__: Wiring event handlers …
13:34:59 [INFO] __main__:   event handlers registered
13:34:59 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
13:34:59 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
13:34:59 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
13:34:59 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
13:34:59 [INFO] __main__: Restored 2 empires from saved state
13:34:59 [INFO] __main__: Starting network server …
13:34:59 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
13:34:59 [INFO] websockets.server: server listening on 0.0.0.0:8765
13:34:59 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
13:34:59 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
13:34:59 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
13:34:59 [INFO] __main__: Starting game loop …
13:34:59 [INFO] __main__:   game loop running (1 s tick)
13:35:00 [INFO] websockets.server: connection open
13:35:00 [INFO] gameserver.network.server: Session registered: uid=-1
13:35:00 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60043)
13:35:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:35:01 [INFO] gameserver.network.server: Session removed: uid=-1
13:35:01 [INFO] websockets.server: connection open
13:35:01 [INFO] gameserver.network.server: Session registered: uid=-2
13:35:01 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60047)
13:35:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:35:02 [INFO] gameserver.network.server: Session removed: uid=-2
13:35:02 [INFO] websockets.server: connection open
13:35:02 [INFO] gameserver.network.server: Session registered: uid=-3
13:35:02 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60052)
13:35:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:35:02 [INFO] gameserver.network.server: Session removed: uid=-3
13:35:02 [INFO] websockets.server: connection open
13:35:02 [INFO] gameserver.network.server: Session registered: uid=-4
13:35:02 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 60054)
13:35:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:35:03 [INFO] gameserver.network.server: Session removed: uid=-4
13:35:03 [INFO] websockets.server: connection open
13:35:03 [INFO] gameserver.network.server: Session registered: uid=-5
13:35:03 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 60056)
13:35:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
13:35:04 [INFO] gameserver.network.server: Session removed: uid=-5
13:35:04 [INFO] websockets.server: connection open
13:35:04 [INFO] gameserver.network.server: Session registered: uid=-6
13:35:04 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 60076)
13:35:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:06:51 [INFO] __main__: Shutdown signal received — stopping …
14:06:52 [INFO] __main__: Shutting down …
14:06:52 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:06:52 [INFO] websockets.server: server closing
14:06:52 [INFO] gameserver.network.server: Session removed: uid=-6
14:06:52 [INFO] websockets.server: server closed
14:06:52 [INFO] gameserver.network.server: WebSocket server stopped
14:06:52 [INFO] __main__:   WebSocket server stopped
14:06:52 [INFO] __main__:   debug dashboard stopped
14:06:52 [INFO] __main__:   database closed
14:06:52 [INFO] __main__:   goodbye
14:07:12 [INFO] __main__: === Game Server starting ===
14:07:12 [INFO] __main__: Loading configuration …
14:07:13 [INFO] __main__:   items:        210 loaded from config
14:07:13 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:07:13 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:07:13 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:07:13 [INFO] __main__:   game_config:  loaded
14:07:13 [INFO] __main__: Initializing persistence …
14:07:13 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:07:13 [INFO] __main__:   database:     connected (gameserver.db)
14:07:13 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T13:34:57, version 1)
14:07:13 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:07:13 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:07:13 [INFO] __main__: Creating services …
14:07:13 [INFO] __main__:   upgrade_provider: 210 items registered
14:07:13 [INFO] __main__:   all services created
14:07:13 [INFO] __main__: Wiring event handlers …
14:07:13 [INFO] __main__:   event handlers registered
14:07:13 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:07:13 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:07:13 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:07:13 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
14:07:13 [INFO] __main__: Restored 2 empires from saved state
14:07:13 [INFO] __main__: Starting network server …
14:07:13 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:07:13 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:07:13 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:07:13 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:07:13 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:07:13 [INFO] __main__: Starting game loop …
14:07:13 [INFO] __main__:   game loop running (1 s tick)
14:07:15 [INFO] websockets.server: connection open
14:07:15 [INFO] gameserver.network.server: Session registered: uid=-1
14:07:15 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54946)
14:07:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:07:37 [INFO] gameserver.engine.empire_service: Empire 2: knowledge MYSTIC completed
14:07:45 [INFO] gameserver.network.server: Session removed: uid=-1
14:07:46 [INFO] websockets.server: connection open
14:07:46 [INFO] gameserver.network.server: Session registered: uid=-2
14:07:46 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 58495)
14:07:46 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:08:16 [INFO] gameserver.network.handlers: new_item failed uid=2 iid=STONE_CIRCLE: Build queue is busy
14:09:36 [INFO] gameserver.engine.empire_service: Empire 2: building EARTH_WALL completed
14:10:32 [INFO] __main__: Shutdown signal received — stopping …
14:10:32 [INFO] __main__: Shutting down …
14:10:32 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:10:32 [INFO] websockets.server: server closing
14:10:32 [INFO] gameserver.network.server: Session removed: uid=-2
14:10:32 [INFO] websockets.server: server closed
14:10:32 [INFO] gameserver.network.server: WebSocket server stopped
14:10:32 [INFO] __main__:   WebSocket server stopped
14:10:32 [INFO] __main__:   debug dashboard stopped
14:10:32 [INFO] __main__:   database closed
14:10:32 [INFO] __main__:   goodbye
14:10:33 [INFO] __main__: === Game Server starting ===
14:10:33 [INFO] __main__: Loading configuration …
14:10:34 [INFO] __main__:   items:        210 loaded from config
14:10:34 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:10:34 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:10:34 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:10:34 [INFO] __main__:   game_config:  loaded
14:10:34 [INFO] __main__: Initializing persistence …
14:10:34 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:10:34 [INFO] __main__:   database:     connected (gameserver.db)
14:10:34 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:10:32, version 1)
14:10:34 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:10:34 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:10:34 [INFO] __main__: Creating services …
14:10:34 [INFO] __main__:   upgrade_provider: 210 items registered
14:10:34 [INFO] __main__:   all services created
14:10:34 [INFO] __main__: Wiring event handlers …
14:10:34 [INFO] __main__:   event handlers registered
14:10:34 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:10:34 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:10:34 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:10:34 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
14:10:34 [INFO] __main__: Restored 2 empires from saved state
14:10:34 [INFO] __main__: Starting network server …
14:10:34 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:10:34 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:10:34 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:10:34 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:10:34 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:10:34 [INFO] __main__: Starting game loop …
14:10:34 [INFO] __main__:   game loop running (1 s tick)
14:10:35 [INFO] websockets.server: connection open
14:10:35 [INFO] gameserver.network.server: Session registered: uid=-1
14:10:35 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50876)
14:10:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:10:36 [INFO] gameserver.network.server: Session removed: uid=-1
14:10:36 [INFO] websockets.server: connection open
14:10:36 [INFO] gameserver.network.server: Session registered: uid=-2
14:10:36 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50897)
14:10:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:10:40 [INFO] gameserver.engine.empire_service: Empire 2: started research CRAFTSMANSHIP (effort=200.0)
14:10:40 [INFO] gameserver.network.handlers: new_item success uid=2 iid=CRAFTSMANSHIP
14:10:43 [INFO] gameserver.engine.empire_service: Empire 2: started research DOMESTICATION (effort=150.0)
14:10:43 [INFO] gameserver.network.handlers: new_item success uid=2 iid=DOMESTICATION
14:11:02 [INFO] gameserver.network.server: Session removed: uid=-2
14:11:02 [INFO] websockets.server: connection open
14:11:02 [INFO] gameserver.network.server: Session registered: uid=-3
14:11:02 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 50908)
14:11:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:11:07 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
14:11:18 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
14:11:19 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
14:12:06 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
14:12:07 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
14:12:23 [INFO] __main__: Shutdown signal received — stopping …
14:12:24 [INFO] __main__: Shutting down …
14:12:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:12:24 [INFO] websockets.server: server closing
14:12:24 [INFO] gameserver.network.server: Session removed: uid=-3
14:12:24 [INFO] websockets.server: server closed
14:12:24 [INFO] gameserver.network.server: WebSocket server stopped
14:12:24 [INFO] __main__:   WebSocket server stopped
14:12:24 [INFO] __main__:   debug dashboard stopped
14:12:24 [INFO] __main__:   database closed
14:12:24 [INFO] __main__:   goodbye
14:15:50 [INFO] __main__: === Game Server starting ===
14:15:50 [INFO] __main__: Loading configuration …
14:15:50 [INFO] __main__:   items:        210 loaded from config
14:15:51 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:15:51 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:15:51 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:15:51 [INFO] __main__:   game_config:  loaded
14:15:51 [INFO] __main__: Initializing persistence …
14:15:51 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:15:51 [INFO] __main__:   database:     connected (gameserver.db)
14:15:51 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:12:24, version 1)
14:15:51 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:15:51 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:15:51 [INFO] __main__: Creating services …
14:15:51 [INFO] __main__:   upgrade_provider: 210 items registered
14:15:51 [INFO] __main__:   all services created
14:15:51 [INFO] __main__: Wiring event handlers …
14:15:51 [INFO] __main__:   event handlers registered
14:15:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:15:51 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:15:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:15:51 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
14:15:51 [INFO] __main__: Restored 2 empires from saved state
14:15:51 [INFO] __main__: Starting network server …
14:15:51 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:15:51 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:15:51 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:15:51 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:15:51 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:15:51 [INFO] __main__: Starting game loop …
14:15:51 [INFO] __main__:   game loop running (1 s tick)
14:16:22 [INFO] websockets.server: connection open
14:16:22 [INFO] gameserver.network.server: Session registered: uid=-1
14:16:22 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 61975)
14:16:22 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:16:40 [INFO] gameserver.engine.empire_service: Empire 2: knowledge DOMESTICATION completed
14:16:49 [INFO] gameserver.engine.empire_service: Empire 2: started research HORSEBACK_RIDING (effort=5000.0)
14:16:49 [INFO] gameserver.network.handlers: new_item success uid=2 iid=HORSEBACK_RIDING
14:16:55 [INFO] gameserver.engine.empire_service: Empire 2: started research CRAFTSMANSHIP (effort=200.0)
14:16:55 [INFO] gameserver.network.handlers: new_item success uid=2 iid=CRAFTSMANSHIP
14:17:02 [INFO] gameserver.engine.empire_service: Empire 2: started research HORSEBACK_RIDING (effort=5000.0)
14:17:02 [INFO] gameserver.network.handlers: new_item success uid=2 iid=HORSEBACK_RIDING
14:19:28 [INFO] __main__: Shutdown signal received — stopping …
14:19:29 [INFO] __main__: Shutting down …
14:19:29 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:19:29 [INFO] websockets.server: server closing
14:19:29 [INFO] gameserver.network.server: Session removed: uid=-1
14:19:29 [INFO] websockets.server: server closed
14:19:29 [INFO] gameserver.network.server: WebSocket server stopped
14:19:29 [INFO] __main__:   WebSocket server stopped
14:19:29 [INFO] __main__:   debug dashboard stopped
14:19:29 [INFO] __main__:   database closed
14:19:29 [INFO] __main__:   goodbye
14:19:30 [INFO] __main__: === Game Server starting ===
14:19:30 [INFO] __main__: Loading configuration …
14:19:31 [INFO] __main__:   items:        210 loaded from config
14:19:31 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:19:31 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:19:31 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:19:31 [INFO] __main__:   game_config:  loaded
14:19:31 [INFO] __main__: Initializing persistence …
14:19:31 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:19:31 [INFO] __main__:   database:     connected (gameserver.db)
14:19:31 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:19:29, version 1)
14:19:31 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:19:31 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:19:31 [INFO] __main__: Creating services …
14:19:31 [INFO] __main__:   upgrade_provider: 210 items registered
14:19:31 [INFO] __main__:   all services created
14:19:31 [INFO] __main__: Wiring event handlers …
14:19:31 [INFO] __main__:   event handlers registered
14:19:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:19:31 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:19:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:19:31 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
14:19:31 [INFO] __main__: Restored 2 empires from saved state
14:19:31 [INFO] __main__: Starting network server …
14:19:31 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:19:31 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:19:31 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:19:31 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:19:31 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:19:31 [INFO] __main__: Starting game loop …
14:19:31 [INFO] __main__:   game loop running (1 s tick)
14:19:32 [INFO] websockets.server: connection open
14:19:32 [INFO] gameserver.network.server: Session registered: uid=-1
14:19:32 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63077)
14:19:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:19:33 [INFO] gameserver.network.server: Session removed: uid=-1
14:19:33 [INFO] websockets.server: connection open
14:19:33 [INFO] gameserver.network.server: Session registered: uid=-2
14:19:33 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63097)
14:19:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:19:34 [INFO] gameserver.network.server: Session removed: uid=-2
14:19:34 [INFO] websockets.server: connection open
14:19:34 [INFO] gameserver.network.server: Session registered: uid=-3
14:19:34 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 63117)
14:19:34 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:22:20 [INFO] __main__: Shutdown signal received — stopping …
14:22:21 [INFO] __main__: Shutting down …
14:22:21 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:22:21 [INFO] websockets.server: server closing
14:22:21 [INFO] gameserver.network.server: Session removed: uid=-3
14:22:21 [INFO] websockets.server: server closed
14:22:21 [INFO] gameserver.network.server: WebSocket server stopped
14:22:21 [INFO] __main__:   WebSocket server stopped
14:22:21 [INFO] __main__:   debug dashboard stopped
14:22:21 [INFO] __main__:   database closed
14:22:21 [INFO] __main__:   goodbye
14:22:23 [INFO] __main__: === Game Server starting ===
14:22:23 [INFO] __main__: Loading configuration …
14:22:23 [INFO] __main__:   items:        210 loaded from config
14:22:23 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:22:23 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:22:23 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:22:23 [INFO] __main__:   game_config:  loaded
14:22:23 [INFO] __main__: Initializing persistence …
14:22:23 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:22:23 [INFO] __main__:   database:     connected (gameserver.db)
14:22:23 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:22:21, version 1)
14:22:23 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:22:23 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:22:23 [INFO] __main__: Creating services …
14:22:23 [INFO] __main__:   upgrade_provider: 210 items registered
14:22:23 [INFO] __main__:   all services created
14:22:23 [INFO] __main__: Wiring event handlers …
14:22:23 [INFO] __main__:   event handlers registered
14:22:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:22:23 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:22:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:22:23 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002}
14:22:23 [INFO] __main__: Restored 2 empires from saved state
14:22:23 [INFO] __main__: Starting network server …
14:22:23 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:22:23 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:22:23 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:22:23 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:22:23 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:22:23 [INFO] __main__: Starting game loop …
14:22:23 [INFO] __main__:   game loop running (1 s tick)
14:22:24 [INFO] websockets.server: connection open
14:22:24 [INFO] gameserver.network.server: Session registered: uid=-1
14:22:24 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59348)
14:22:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:22:30 [INFO] gameserver.network.server: Session removed: uid=-1
14:22:31 [INFO] websockets.server: connection open
14:22:31 [INFO] gameserver.network.server: Session registered: uid=-2
14:22:31 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59373)
14:22:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:22:52 [INFO] gameserver.network.server: Session removed: uid=-2
14:22:52 [INFO] websockets.server: connection open
14:22:52 [INFO] gameserver.network.server: Session registered: uid=-3
14:22:52 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60781)
14:22:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:22:54 [INFO] gameserver.engine.empire_service: Empire 2: started building STONE_CIRCLE (effort=50.0)
14:22:54 [INFO] gameserver.network.handlers: new_item success uid=2 iid=STONE_CIRCLE
14:23:44 [INFO] gameserver.engine.empire_service: Empire 2: applied effects for STONE_CIRCLE: {'culture_offset': 0.1}
14:23:44 [INFO] gameserver.engine.empire_service: Empire 2: building STONE_CIRCLE completed
14:25:28 [INFO] __main__: Shutdown signal received — stopping …
14:25:29 [INFO] __main__: Shutting down …
14:25:29 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:25:29 [INFO] websockets.server: server closing
14:25:29 [INFO] gameserver.network.server: Session removed: uid=-3
14:25:29 [INFO] websockets.server: server closed
14:25:29 [INFO] gameserver.network.server: WebSocket server stopped
14:25:29 [INFO] __main__:   WebSocket server stopped
14:25:29 [INFO] __main__:   debug dashboard stopped
14:25:29 [INFO] __main__:   database closed
14:25:29 [INFO] __main__:   goodbye
14:25:30 [INFO] __main__: === Game Server starting ===
14:25:30 [INFO] __main__: Loading configuration …
14:25:31 [INFO] __main__:   items:        210 loaded from config
14:25:31 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:25:31 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:25:31 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:25:31 [INFO] __main__:   game_config:  loaded
14:25:31 [INFO] __main__: Initializing persistence …
14:25:31 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:25:31 [INFO] __main__:   database:     connected (gameserver.db)
14:25:31 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:25:29, version 1)
14:25:31 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:25:31 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:25:31 [INFO] __main__: Creating services …
14:25:31 [INFO] __main__:   upgrade_provider: 210 items registered
14:25:31 [INFO] __main__:   all services created
14:25:31 [INFO] __main__: Wiring event handlers …
14:25:31 [INFO] __main__:   event handlers registered
14:25:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:25:31 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:25:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:25:31 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.1}
14:25:31 [INFO] __main__: Restored 2 empires from saved state
14:25:31 [INFO] __main__: Starting network server …
14:25:31 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:25:31 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:25:31 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:25:31 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:25:31 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:25:31 [INFO] __main__: Starting game loop …
14:25:31 [INFO] __main__:   game loop running (1 s tick)
14:25:32 [INFO] websockets.server: connection open
14:25:32 [INFO] gameserver.network.server: Session registered: uid=-1
14:25:32 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62721)
14:25:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:25:35 [INFO] gameserver.network.server: Session removed: uid=-1
14:25:35 [INFO] websockets.server: connection open
14:25:35 [INFO] gameserver.network.server: Session registered: uid=-2
14:25:35 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62744)
14:25:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:25:46 [INFO] gameserver.engine.empire_service: Empire 2: started building SHRINE (effort=800.0)
14:25:46 [INFO] gameserver.network.handlers: new_item success uid=2 iid=SHRINE
14:25:58 [INFO] gameserver.engine.empire_service: Empire 2: started building EPIC_DRAWINGS (effort=1000.0)
14:25:58 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EPIC_DRAWINGS
14:26:04 [INFO] gameserver.engine.empire_service: Empire 2: started building SHRINE (effort=800.0)
14:26:04 [INFO] gameserver.network.handlers: new_item success uid=2 iid=SHRINE
14:26:11 [INFO] gameserver.engine.empire_service: Empire 2: started building EPIC_DRAWINGS (effort=1000.0)
14:26:11 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EPIC_DRAWINGS
14:26:17 [INFO] gameserver.engine.empire_service: Empire 2: started building SHRINE (effort=800.0)
14:26:17 [INFO] gameserver.network.handlers: new_item success uid=2 iid=SHRINE
14:28:19 [INFO] gameserver.network.server: Session removed: uid=-2
14:28:20 [INFO] websockets.server: connection open
14:28:20 [INFO] gameserver.network.server: Session registered: uid=-3
14:28:20 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 64399)
14:28:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:28:35 [INFO] gameserver.network.server: Session removed: uid=-3
14:28:36 [INFO] websockets.server: connection open
14:28:36 [INFO] gameserver.network.server: Session registered: uid=-4
14:28:36 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 61609)
14:28:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:28:41 [INFO] gameserver.network.server: Session removed: uid=-4
14:28:41 [INFO] websockets.server: connection open
14:28:41 [INFO] gameserver.network.server: Session registered: uid=-5
14:28:41 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 61634)
14:28:41 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:28:47 [INFO] gameserver.network.server: Session removed: uid=-5
14:28:47 [INFO] websockets.server: connection open
14:28:47 [INFO] gameserver.network.server: Session registered: uid=-6
14:28:47 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 61659)
14:28:47 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:29:53 [INFO] gameserver.engine.empire_service: Empire 2: started research CRAFTSMANSHIP (effort=200.0)
14:29:53 [INFO] gameserver.network.handlers: new_item success uid=2 iid=CRAFTSMANSHIP
14:31:50 [INFO] gameserver.network.server: Session removed: uid=-6
14:31:50 [INFO] websockets.server: connection open
14:31:50 [INFO] gameserver.network.server: Session registered: uid=-7
14:31:50 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 65401)
14:31:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:33:13 [INFO] gameserver.engine.empire_service: Empire 2: knowledge CRAFTSMANSHIP completed
14:34:00 [INFO] gameserver.network.server: Session removed: uid=-7
14:34:00 [INFO] websockets.server: connection open
14:34:00 [INFO] gameserver.network.server: Session registered: uid=-8
14:34:00 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 62566)
14:34:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:34:25 [INFO] gameserver.network.server: Session removed: uid=-8
14:34:25 [INFO] websockets.server: connection open
14:34:25 [INFO] gameserver.network.server: Session registered: uid=-9
14:34:25 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 62607)
14:34:25 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:34:41 [INFO] __main__: Shutdown signal received — stopping …
14:34:41 [INFO] __main__: Shutting down …
14:34:41 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:34:41 [INFO] websockets.server: server closing
14:34:42 [INFO] gameserver.network.server: Session removed: uid=-9
14:34:42 [INFO] websockets.server: server closed
14:34:42 [INFO] gameserver.network.server: WebSocket server stopped
14:34:42 [INFO] __main__:   WebSocket server stopped
14:34:42 [INFO] __main__:   debug dashboard stopped
14:34:42 [INFO] __main__:   database closed
14:34:42 [INFO] __main__:   goodbye
14:34:43 [INFO] __main__: === Game Server starting ===
14:34:43 [INFO] __main__: Loading configuration …
14:34:44 [INFO] __main__:   items:        210 loaded from config
14:34:44 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:34:44 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:34:44 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:34:44 [INFO] __main__:   game_config:  loaded
14:34:44 [INFO] __main__: Initializing persistence …
14:34:44 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:34:44 [INFO] __main__:   database:     connected (gameserver.db)
14:34:44 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:34:41, version 1)
14:34:44 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:34:44 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:34:44 [INFO] __main__: Creating services …
14:34:44 [INFO] __main__:   upgrade_provider: 210 items registered
14:34:44 [INFO] __main__:   all services created
14:34:44 [INFO] __main__: Wiring event handlers …
14:34:44 [INFO] __main__:   event handlers registered
14:34:44 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:34:44 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:34:44 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:34:44 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.1}
14:34:44 [INFO] __main__: Restored 2 empires from saved state
14:34:44 [INFO] __main__: Starting network server …
14:34:44 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:34:44 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:34:44 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:34:44 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:34:44 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:34:44 [INFO] __main__: Starting game loop …
14:34:44 [INFO] __main__:   game loop running (1 s tick)
14:34:45 [INFO] websockets.server: connection open
14:34:45 [INFO] gameserver.network.server: Session registered: uid=-1
14:34:45 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59070)
14:34:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:34:46 [INFO] gameserver.network.server: Session removed: uid=-1
14:34:46 [INFO] websockets.server: connection open
14:34:46 [INFO] gameserver.network.server: Session registered: uid=-2
14:34:46 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59092)
14:34:46 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:34:47 [INFO] gameserver.network.server: Session removed: uid=-2
14:34:47 [INFO] websockets.server: connection open
14:34:47 [INFO] gameserver.network.server: Session registered: uid=-3
14:34:47 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 59114)
14:34:47 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:36:09 [INFO] gameserver.network.server: Session removed: uid=-3
14:36:09 [INFO] websockets.server: connection open
14:36:09 [INFO] gameserver.network.server: Session registered: uid=-4
14:36:09 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 59178)
14:36:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:38:06 [INFO] gameserver.network.server: Session removed: uid=-4
14:38:06 [INFO] websockets.server: connection open
14:38:06 [INFO] gameserver.network.server: Session registered: uid=-5
14:38:06 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 56677)
14:38:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:38:12 [INFO] gameserver.network.server: Session removed: uid=-5
14:38:12 [INFO] websockets.server: connection open
14:38:12 [INFO] gameserver.network.server: Session registered: uid=-6
14:38:12 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 56706)
14:38:12 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:39:00 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=citizen_upgrade sender=0
14:39:40 [INFO] gameserver.engine.empire_service: Empire 2: applied effects for SHRINE: {'culture_offset': 0.05}
14:39:40 [INFO] gameserver.engine.empire_service: Empire 2: building SHRINE completed
14:40:54 [INFO] __main__: Shutdown signal received — stopping …
14:40:55 [INFO] __main__: Shutting down …
14:40:55 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:40:55 [INFO] websockets.server: server closing
14:40:55 [INFO] gameserver.network.server: Session removed: uid=-6
14:40:55 [INFO] websockets.server: server closed
14:40:55 [INFO] gameserver.network.server: WebSocket server stopped
14:40:55 [INFO] __main__:   WebSocket server stopped
14:40:55 [INFO] __main__:   debug dashboard stopped
14:40:55 [INFO] __main__:   database closed
14:40:55 [INFO] __main__:   goodbye
14:40:57 [INFO] __main__: === Game Server starting ===
14:40:57 [INFO] __main__: Loading configuration …
14:40:58 [INFO] __main__:   items:        210 loaded from config
14:40:58 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:40:58 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:40:58 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:40:58 [INFO] __main__:   game_config:  loaded
14:40:58 [INFO] __main__: Initializing persistence …
14:40:58 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:40:58 [INFO] __main__:   database:     connected (gameserver.db)
14:40:58 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:40:55, version 1)
14:40:58 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:40:58 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:40:58 [INFO] __main__: Creating services …
14:40:58 [INFO] __main__:   upgrade_provider: 210 items registered
14:40:58 [INFO] __main__:   all services created
14:40:58 [INFO] __main__: Wiring event handlers …
14:40:58 [INFO] __main__:   event handlers registered
14:40:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:40:58 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:40:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:40:58 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:40:58 [INFO] __main__: Restored 2 empires from saved state
14:40:58 [INFO] __main__: Starting network server …
14:40:58 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:40:58 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:40:58 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:40:58 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:40:58 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:40:58 [INFO] __main__: Starting game loop …
14:40:58 [INFO] __main__:   game loop running (1 s tick)
14:41:00 [INFO] websockets.server: connection open
14:41:00 [INFO] gameserver.network.server: Session registered: uid=-1
14:41:00 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62862)
14:41:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:42:29 [INFO] gameserver.network.server: Session removed: uid=-1
14:42:29 [INFO] websockets.server: connection open
14:42:29 [INFO] gameserver.network.server: Session registered: uid=-2
14:42:29 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55078)
14:42:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:42:34 [INFO] __main__: Shutdown signal received — stopping …
14:42:35 [INFO] __main__: Shutting down …
14:42:35 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:42:35 [INFO] websockets.server: server closing
14:42:35 [INFO] gameserver.network.server: Session removed: uid=-2
14:42:35 [INFO] websockets.server: server closed
14:42:35 [INFO] gameserver.network.server: WebSocket server stopped
14:42:35 [INFO] __main__:   WebSocket server stopped
14:42:35 [INFO] __main__:   debug dashboard stopped
14:42:35 [INFO] __main__:   database closed
14:42:35 [INFO] __main__:   goodbye
14:42:36 [INFO] __main__: === Game Server starting ===
14:42:36 [INFO] __main__: Loading configuration …
14:42:37 [INFO] __main__:   items:        210 loaded from config
14:42:37 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:42:37 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:42:37 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:42:37 [INFO] __main__:   game_config:  loaded
14:42:37 [INFO] __main__: Initializing persistence …
14:42:37 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:42:37 [INFO] __main__:   database:     connected (gameserver.db)
14:42:37 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:42:35, version 1)
14:42:37 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:42:37 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:42:37 [INFO] __main__: Creating services …
14:42:37 [INFO] __main__:   upgrade_provider: 210 items registered
14:42:37 [INFO] __main__:   all services created
14:42:37 [INFO] __main__: Wiring event handlers …
14:42:37 [INFO] __main__:   event handlers registered
14:42:37 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:42:37 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:42:37 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:42:37 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:42:37 [INFO] __main__: Restored 2 empires from saved state
14:42:37 [INFO] __main__: Starting network server …
14:42:37 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:42:37 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:42:37 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:42:37 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:42:37 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:42:37 [INFO] __main__: Starting game loop …
14:42:37 [INFO] __main__:   game loop running (1 s tick)
14:42:38 [INFO] websockets.server: connection open
14:42:38 [INFO] gameserver.network.server: Session registered: uid=-1
14:42:38 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52334)
14:42:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:42:39 [INFO] gameserver.network.server: Session removed: uid=-1
14:42:39 [INFO] websockets.server: connection open
14:42:39 [INFO] gameserver.network.server: Session registered: uid=-2
14:42:39 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 52356)
14:42:39 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:42:40 [INFO] gameserver.network.server: Session removed: uid=-2
14:42:40 [INFO] websockets.server: connection open
14:42:40 [INFO] gameserver.network.server: Session registered: uid=-3
14:42:40 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 52377)
14:42:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:42:41 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
14:42:42 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 125.0, have 20.9)
14:42:47 [INFO] gameserver.network.server: Session removed: uid=-3
14:42:47 [INFO] websockets.server: connection open
14:42:47 [INFO] gameserver.network.server: Session registered: uid=-4
14:42:47 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 55625)
14:42:47 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:42:52 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 125.0, have 22.4)
14:42:53 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 125.0, have 22.6)
14:44:15 [INFO] __main__: Shutdown signal received — stopping …
14:44:15 [INFO] __main__: Shutting down …
14:44:15 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:44:15 [INFO] websockets.server: server closing
14:44:15 [INFO] gameserver.network.server: Session removed: uid=-4
14:44:15 [INFO] websockets.server: server closed
14:44:15 [INFO] gameserver.network.server: WebSocket server stopped
14:44:15 [INFO] __main__:   WebSocket server stopped
14:44:15 [INFO] __main__:   debug dashboard stopped
14:44:15 [INFO] __main__:   database closed
14:44:15 [INFO] __main__:   goodbye
14:44:17 [INFO] __main__: === Game Server starting ===
14:44:17 [INFO] __main__: Loading configuration …
14:44:17 [INFO] __main__:   items:        210 loaded from config
14:44:17 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:44:17 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:44:17 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:44:17 [INFO] __main__:   game_config:  loaded
14:44:17 [INFO] __main__: Initializing persistence …
14:44:17 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:44:17 [INFO] __main__:   database:     connected (gameserver.db)
14:44:17 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:44:15, version 1)
14:44:17 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:44:17 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:44:17 [INFO] __main__: Creating services …
14:44:17 [INFO] __main__:   upgrade_provider: 210 items registered
14:44:17 [INFO] __main__:   all services created
14:44:17 [INFO] __main__: Wiring event handlers …
14:44:17 [INFO] __main__:   event handlers registered
14:44:17 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:44:17 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:44:17 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:44:17 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:44:17 [INFO] __main__: Restored 2 empires from saved state
14:44:17 [INFO] __main__: Starting network server …
14:44:17 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:44:17 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:44:17 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:44:17 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:44:17 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:44:17 [INFO] __main__: Starting game loop …
14:44:17 [INFO] __main__:   game loop running (1 s tick)
14:44:18 [INFO] websockets.server: connection open
14:44:18 [INFO] gameserver.network.server: Session registered: uid=-1
14:44:18 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64459)
14:44:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:45:32 [INFO] __main__: Shutdown signal received — stopping …
14:45:33 [INFO] __main__: Shutting down …
14:45:33 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:45:33 [INFO] websockets.server: server closing
14:45:33 [INFO] gameserver.network.server: Session removed: uid=-1
14:45:33 [INFO] websockets.server: server closed
14:45:33 [INFO] gameserver.network.server: WebSocket server stopped
14:45:33 [INFO] __main__:   WebSocket server stopped
14:45:33 [INFO] __main__:   debug dashboard stopped
14:45:33 [INFO] __main__:   database closed
14:45:33 [INFO] __main__:   goodbye
14:45:34 [INFO] __main__: === Game Server starting ===
14:45:34 [INFO] __main__: Loading configuration …
14:45:35 [INFO] __main__:   items:        210 loaded from config
14:45:35 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:45:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:45:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:45:35 [INFO] __main__:   game_config:  loaded
14:45:35 [INFO] __main__: Initializing persistence …
14:45:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:45:35 [INFO] __main__:   database:     connected (gameserver.db)
14:45:35 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:45:33, version 1)
14:45:35 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:45:35 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:45:35 [INFO] __main__: Creating services …
14:45:35 [INFO] __main__:   upgrade_provider: 210 items registered
14:45:35 [INFO] __main__:   all services created
14:45:35 [INFO] __main__: Wiring event handlers …
14:45:35 [INFO] __main__:   event handlers registered
14:45:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:45:35 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:45:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:45:35 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:45:35 [INFO] __main__: Restored 2 empires from saved state
14:45:35 [INFO] __main__: Starting network server …
14:45:35 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:45:35 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:45:35 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:45:35 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:45:35 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:45:35 [INFO] __main__: Starting game loop …
14:45:35 [INFO] __main__:   game loop running (1 s tick)
14:45:36 [INFO] websockets.server: connection open
14:45:36 [INFO] gameserver.network.server: Session registered: uid=-1
14:45:36 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53220)
14:45:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:45:37 [INFO] gameserver.network.server: Session removed: uid=-1
14:45:37 [INFO] websockets.server: connection open
14:45:37 [INFO] gameserver.network.server: Session registered: uid=-2
14:45:37 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 53242)
14:45:37 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:45:38 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=-2
14:45:38 [WARNING] gameserver.network.handlers: citizen_upgrade failed: no empire found for uid=-2
14:46:59 [INFO] __main__: Shutdown signal received — stopping …
14:46:59 [INFO] __main__: Shutting down …
14:46:59 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:46:59 [INFO] websockets.server: server closing
14:46:59 [INFO] gameserver.network.server: Session removed: uid=-2
14:46:59 [INFO] websockets.server: server closed
14:46:59 [INFO] gameserver.network.server: WebSocket server stopped
14:46:59 [INFO] __main__:   WebSocket server stopped
14:46:59 [INFO] __main__:   debug dashboard stopped
14:46:59 [INFO] __main__:   database closed
14:46:59 [INFO] __main__:   goodbye
14:47:01 [INFO] __main__: === Game Server starting ===
14:47:01 [INFO] __main__: Loading configuration …
14:47:01 [INFO] __main__:   items:        210 loaded from config
14:47:01 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:47:01 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:47:02 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:47:02 [INFO] __main__:   game_config:  loaded
14:47:02 [INFO] __main__: Initializing persistence …
14:47:02 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:47:02 [INFO] __main__:   database:     connected (gameserver.db)
14:47:02 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:46:59, version 1)
14:47:02 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:47:02 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:47:02 [INFO] __main__: Creating services …
14:47:02 [INFO] __main__:   upgrade_provider: 210 items registered
14:47:02 [INFO] __main__:   all services created
14:47:02 [INFO] __main__: Wiring event handlers …
14:47:02 [INFO] __main__:   event handlers registered
14:47:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:47:02 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:47:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:47:02 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:47:02 [INFO] __main__: Restored 2 empires from saved state
14:47:02 [INFO] __main__: Starting network server …
14:47:02 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:47:02 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:47:02 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:47:02 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:47:02 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:47:02 [INFO] __main__: Starting game loop …
14:47:02 [INFO] __main__:   game loop running (1 s tick)
14:47:02 [INFO] websockets.server: connection open
14:47:02 [INFO] gameserver.network.server: Session registered: uid=-1
14:47:02 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60324)
14:47:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:47:02 [INFO] gameserver.network.server: Session registered: uid=2
14:47:02 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
14:47:05 [INFO] gameserver.network.server: Session removed: uid=2
14:47:05 [INFO] websockets.server: connection open
14:47:05 [INFO] gameserver.network.server: Session registered: uid=-2
14:47:05 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60346)
14:47:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:47:05 [INFO] gameserver.network.server: Session registered: uid=2
14:47:05 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
14:47:06 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
14:47:06 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 125.0, have 58.9)
14:48:39 [INFO] __main__: Shutdown signal received — stopping …
14:48:40 [INFO] __main__: Shutting down …
14:48:40 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:48:40 [INFO] websockets.server: server closing
14:48:40 [INFO] gameserver.network.server: Session removed: uid=2
14:48:40 [INFO] websockets.server: server closed
14:48:40 [INFO] gameserver.network.server: WebSocket server stopped
14:48:40 [INFO] __main__:   WebSocket server stopped
14:48:40 [INFO] __main__:   debug dashboard stopped
14:48:40 [INFO] __main__:   database closed
14:48:40 [INFO] __main__:   goodbye
14:48:42 [INFO] __main__: === Game Server starting ===
14:48:42 [INFO] __main__: Loading configuration …
14:48:43 [INFO] __main__:   items:        210 loaded from config
14:48:43 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:48:43 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:48:43 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:48:43 [INFO] __main__:   game_config:  loaded
14:48:43 [INFO] __main__: Initializing persistence …
14:48:43 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:48:43 [INFO] __main__:   database:     connected (gameserver.db)
14:48:43 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:48:40, version 1)
14:48:43 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:48:43 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:48:43 [INFO] __main__: Creating services …
14:48:43 [INFO] __main__:   upgrade_provider: 210 items registered
14:48:43 [INFO] __main__:   all services created
14:48:43 [INFO] __main__: Wiring event handlers …
14:48:43 [INFO] __main__:   event handlers registered
14:48:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:48:43 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:48:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:48:43 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:48:43 [INFO] __main__: Restored 2 empires from saved state
14:48:43 [INFO] __main__: Starting network server …
14:48:43 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:48:43 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:48:43 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:48:43 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:48:43 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:48:43 [INFO] __main__: Starting game loop …
14:48:43 [INFO] __main__:   game loop running (1 s tick)
14:48:43 [INFO] websockets.server: connection open
14:48:43 [INFO] gameserver.network.server: Session registered: uid=-1
14:48:43 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64573)
14:48:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:48:43 [INFO] gameserver.network.server: Session registered: uid=2
14:48:43 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
14:48:44 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
14:48:44 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 125.0, have 72.9)
14:50:19 [INFO] gameserver.network.server: Session removed: uid=2
14:50:19 [INFO] websockets.server: connection open
14:50:19 [INFO] gameserver.network.server: Session registered: uid=-2
14:50:19 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55293)
14:50:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:50:19 [INFO] gameserver.network.server: Session registered: uid=2
14:50:19 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
14:50:30 [INFO] __main__: Shutdown signal received — stopping …
14:50:30 [INFO] __main__: Shutting down …
14:50:30 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:50:30 [INFO] websockets.server: server closing
14:50:30 [INFO] gameserver.network.server: Session removed: uid=2
14:50:30 [INFO] websockets.server: server closed
14:50:30 [INFO] gameserver.network.server: WebSocket server stopped
14:50:30 [INFO] __main__:   WebSocket server stopped
14:50:30 [INFO] __main__:   debug dashboard stopped
14:50:30 [INFO] __main__:   database closed
14:50:30 [INFO] __main__:   goodbye
14:52:02 [INFO] __main__: === Game Server starting ===
14:52:02 [INFO] __main__: Loading configuration …
14:52:03 [INFO] __main__:   items:        210 loaded from config
14:52:03 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:52:03 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:52:03 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:52:03 [INFO] __main__:   game_config:  loaded
14:52:03 [INFO] __main__: Initializing persistence …
14:52:03 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:52:03 [INFO] __main__:   database:     connected (gameserver.db)
14:52:03 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:50:30, version 1)
14:52:03 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:52:03 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:52:03 [INFO] __main__: Creating services …
14:52:03 [INFO] __main__:   upgrade_provider: 210 items registered
14:52:03 [INFO] __main__:   all services created
14:52:03 [INFO] __main__: Wiring event handlers …
14:52:03 [INFO] __main__:   event handlers registered
14:52:03 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:52:03 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:52:03 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:52:03 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:52:03 [INFO] __main__: Restored 2 empires from saved state
14:52:03 [INFO] __main__: Starting network server …
14:52:03 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:52:03 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:52:03 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:52:03 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:52:03 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:52:03 [INFO] __main__: Starting game loop …
14:52:03 [INFO] __main__:   game loop running (1 s tick)
14:52:13 [INFO] websockets.server: connection open
14:52:13 [INFO] gameserver.network.server: Session registered: uid=-1
14:52:13 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62539)
14:52:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:52:13 [INFO] gameserver.network.server: Session registered: uid=2
14:52:13 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
14:52:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:52:17 [INFO] gameserver.network.server: Session registered: uid=2
14:52:17 [INFO] gameserver.network.server: Session upgraded: guest=2 → uid=2
14:52:20 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:20 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:52:21 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:21 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 2)
14:52:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:22 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 2)
14:52:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:22 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:52:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:52:28 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:28 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:52:30 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:30 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:52:30 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:30 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:52:30 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:30 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:52:31 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:52:31 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:54:25 [INFO] __main__: Shutdown signal received — stopping …
14:54:25 [INFO] __main__: Shutting down …
14:54:26 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:54:26 [INFO] websockets.server: server closing
14:54:26 [INFO] gameserver.network.server: Session removed: uid=2
14:54:26 [INFO] websockets.server: server closed
14:54:26 [INFO] gameserver.network.server: WebSocket server stopped
14:54:26 [INFO] __main__:   WebSocket server stopped
14:54:26 [INFO] __main__:   debug dashboard stopped
14:54:26 [INFO] __main__:   database closed
14:54:26 [INFO] __main__:   goodbye
14:54:27 [INFO] __main__: === Game Server starting ===
14:54:27 [INFO] __main__: Loading configuration …
14:54:28 [INFO] __main__:   items:        210 loaded from config
14:54:28 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:54:28 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:54:28 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:54:28 [INFO] __main__:   game_config:  loaded
14:54:28 [INFO] __main__: Initializing persistence …
14:54:28 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:54:28 [INFO] __main__:   database:     connected (gameserver.db)
14:54:28 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:54:25, version 1)
14:54:28 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:54:28 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:54:28 [INFO] __main__: Creating services …
14:54:28 [INFO] __main__:   upgrade_provider: 210 items registered
14:54:28 [INFO] __main__:   all services created
14:54:28 [INFO] __main__: Wiring event handlers …
14:54:28 [INFO] __main__:   event handlers registered
14:54:28 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:54:28 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:54:28 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:54:28 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:54:28 [INFO] __main__: Restored 2 empires from saved state
14:54:28 [INFO] __main__: Starting network server …
14:54:28 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:54:28 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:54:28 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:54:28 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:54:28 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:54:28 [INFO] __main__: Starting game loop …
14:54:28 [INFO] __main__:   game loop running (1 s tick)
14:54:29 [INFO] websockets.server: connection open
14:54:29 [INFO] gameserver.network.server: Session registered: uid=-1
14:54:29 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51234)
14:54:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:54:29 [INFO] gameserver.network.server: Session registered: uid=2
14:54:29 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
14:54:31 [INFO] gameserver.network.server: Session removed: uid=2
14:54:31 [INFO] websockets.server: connection open
14:54:31 [INFO] gameserver.network.server: Session registered: uid=-2
14:54:31 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 51256)
14:54:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:54:31 [INFO] gameserver.network.server: Session registered: uid=2
14:54:31 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
14:54:32 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:54:32 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:55:00 [INFO] __main__: Shutdown signal received — stopping …
14:55:01 [INFO] __main__: Shutting down …
14:55:01 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
14:55:01 [INFO] websockets.server: server closing
14:55:01 [INFO] gameserver.network.server: Session removed: uid=2
14:55:01 [INFO] websockets.server: server closed
14:55:01 [INFO] gameserver.network.server: WebSocket server stopped
14:55:01 [INFO] __main__:   WebSocket server stopped
14:55:01 [INFO] __main__:   debug dashboard stopped
14:55:01 [INFO] __main__:   database closed
14:55:01 [INFO] __main__:   goodbye
14:55:04 [INFO] __main__: === Game Server starting ===
14:55:04 [INFO] __main__: Loading configuration …
14:55:05 [INFO] __main__:   items:        210 loaded from config
14:55:05 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
14:55:05 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:55:05 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
14:55:05 [INFO] __main__:   game_config:  loaded
14:55:05 [INFO] __main__: Initializing persistence …
14:55:05 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:55:05 [INFO] __main__:   database:     connected (gameserver.db)
14:55:05 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T14:55:01, version 1)
14:55:05 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
14:55:05 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
14:55:05 [INFO] __main__: Creating services …
14:55:05 [INFO] __main__:   upgrade_provider: 210 items registered
14:55:05 [INFO] __main__:   all services created
14:55:05 [INFO] __main__: Wiring event handlers …
14:55:05 [INFO] __main__:   event handlers registered
14:55:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:55:05 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:55:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:55:05 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
14:55:05 [INFO] __main__: Restored 2 empires from saved state
14:55:05 [INFO] __main__: Starting network server …
14:55:05 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:55:05 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:55:05 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:55:05 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:55:05 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:55:05 [INFO] __main__: Starting game loop …
14:55:05 [INFO] __main__:   game loop running (1 s tick)
14:55:05 [INFO] websockets.server: connection open
14:55:05 [INFO] gameserver.network.server: Session registered: uid=-1
14:55:05 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 65322)
14:55:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:55:05 [INFO] gameserver.network.server: Session registered: uid=2
14:55:05 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
14:55:07 [INFO] gameserver.network.server: Session removed: uid=2
14:55:07 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
14:55:07 [INFO] websockets.server: connection open
14:55:07 [INFO] gameserver.network.server: Session registered: uid=-2
14:55:07 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 65346)
14:55:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:55:07 [INFO] gameserver.network.server: Session registered: uid=2
14:55:07 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
14:55:08 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:55:08 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:55:21 [INFO] gameserver.network.server: Session removed: uid=2
14:55:21 [INFO] websockets.server: connection open
14:55:21 [INFO] gameserver.network.server: Session registered: uid=-3
14:55:21 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 59164)
14:55:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
14:55:21 [INFO] gameserver.network.server: Session registered: uid=2
14:55:21 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
14:55:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:55:24 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
14:55:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
14:55:24 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 2)
15:00:38 [INFO] gameserver.network.server: Session removed: uid=2
15:00:38 [INFO] websockets.server: connection open
15:00:38 [INFO] gameserver.network.server: Session registered: uid=-4
15:00:38 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 65248)
15:00:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:00:38 [INFO] gameserver.network.server: Session registered: uid=2
15:00:38 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
15:00:40 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:00:40 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Total citizens must remain 1 (got 0)
15:02:37 [INFO] __main__: Shutdown signal received — stopping …
15:02:37 [INFO] __main__: Shutting down …
15:02:38 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
15:02:38 [INFO] websockets.server: server closing
15:02:38 [INFO] gameserver.network.server: Session removed: uid=2
15:02:38 [INFO] websockets.server: server closed
15:02:38 [INFO] gameserver.network.server: WebSocket server stopped
15:02:38 [INFO] __main__:   WebSocket server stopped
15:02:38 [INFO] __main__:   debug dashboard stopped
15:02:38 [INFO] __main__:   database closed
15:02:38 [INFO] __main__:   goodbye
15:02:39 [INFO] __main__: === Game Server starting ===
15:02:39 [INFO] __main__: Loading configuration …
15:02:40 [INFO] __main__:   items:        210 loaded from config
15:02:40 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
15:02:40 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
15:02:40 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
15:02:40 [INFO] __main__:   game_config:  loaded
15:02:40 [INFO] __main__: Initializing persistence …
15:02:40 [INFO] gameserver.persistence.database: Database connected: gameserver.db
15:02:40 [INFO] __main__:   database:     connected (gameserver.db)
15:02:40 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T15:02:37, version 1)
15:02:40 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
15:02:40 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
15:02:40 [INFO] __main__: Creating services …
15:02:40 [INFO] __main__:   upgrade_provider: 210 items registered
15:02:40 [INFO] __main__:   all services created
15:02:40 [INFO] __main__: Wiring event handlers …
15:02:40 [INFO] __main__:   event handlers registered
15:02:40 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
15:02:40 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
15:02:40 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
15:02:40 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
15:02:40 [INFO] __main__: Restored 2 empires from saved state
15:02:40 [INFO] __main__: Starting network server …
15:02:40 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
15:02:40 [INFO] websockets.server: server listening on 0.0.0.0:8765
15:02:40 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
15:02:40 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
15:02:40 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
15:02:40 [INFO] __main__: Starting game loop …
15:02:40 [INFO] __main__:   game loop running (1 s tick)
15:02:41 [INFO] websockets.server: connection open
15:02:41 [INFO] gameserver.network.server: Session registered: uid=-1
15:02:41 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50168)
15:02:41 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:02:41 [INFO] gameserver.network.server: Session registered: uid=2
15:02:41 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
15:04:27 [INFO] __main__: Shutdown signal received — stopping …
15:04:27 [INFO] __main__: Shutting down …
15:04:27 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
15:04:27 [INFO] websockets.server: server closing
15:04:27 [INFO] gameserver.network.server: Session removed: uid=2
15:04:27 [INFO] websockets.server: server closed
15:04:27 [INFO] gameserver.network.server: WebSocket server stopped
15:04:27 [INFO] __main__:   WebSocket server stopped
15:04:27 [INFO] __main__:   debug dashboard stopped
15:04:27 [INFO] __main__:   database closed
15:04:27 [INFO] __main__:   goodbye
15:04:29 [INFO] __main__: === Game Server starting ===
15:04:29 [INFO] __main__: Loading configuration …
15:04:29 [INFO] __main__:   items:        210 loaded from config
15:04:29 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
15:04:29 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
15:04:29 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
15:04:29 [INFO] __main__:   game_config:  loaded
15:04:29 [INFO] __main__: Initializing persistence …
15:04:29 [INFO] gameserver.persistence.database: Database connected: gameserver.db
15:04:29 [INFO] __main__:   database:     connected (gameserver.db)
15:04:29 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T15:04:27, version 1)
15:04:29 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
15:04:29 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
15:04:29 [INFO] __main__: Creating services …
15:04:29 [INFO] __main__:   upgrade_provider: 210 items registered
15:04:29 [INFO] __main__:   all services created
15:04:29 [INFO] __main__: Wiring event handlers …
15:04:29 [INFO] __main__:   event handlers registered
15:04:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
15:04:29 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
15:04:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
15:04:29 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
15:04:29 [INFO] __main__: Restored 2 empires from saved state
15:04:29 [INFO] __main__: Starting network server …
15:04:29 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
15:04:29 [INFO] websockets.server: server listening on 0.0.0.0:8765
15:04:29 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
15:04:29 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
15:04:29 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
15:04:29 [INFO] __main__: Starting game loop …
15:04:29 [INFO] __main__:   game loop running (1 s tick)
15:04:30 [INFO] websockets.server: connection open
15:04:30 [INFO] gameserver.network.server: Session registered: uid=-1
15:04:30 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63032)
15:04:30 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:04:30 [INFO] gameserver.network.server: Session registered: uid=2
15:04:30 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
15:04:34 [INFO] gameserver.network.server: Session removed: uid=2
15:04:34 [INFO] websockets.server: connection open
15:04:34 [INFO] gameserver.network.server: Session registered: uid=-2
15:04:34 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63056)
15:04:34 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:04:34 [INFO] gameserver.network.server: Session registered: uid=2
15:04:34 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
15:04:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:35 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 1}
15:04:40 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:40 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 0}
15:04:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 1}
15:04:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 0}
15:04:47 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:47 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 1}
15:04:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 0}
15:04:49 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:49 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 1}
15:04:50 [INFO] gameserver.network.server: Session removed: uid=2
15:04:50 [INFO] websockets.server: connection open
15:04:50 [INFO] gameserver.network.server: Session registered: uid=-3
15:04:50 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 63080)
15:04:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:04:50 [INFO] gameserver.network.server: Session registered: uid=2
15:04:50 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
15:04:52 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:52 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 0}
15:04:52 [INFO] gameserver.network.server: Session removed: uid=2
15:04:52 [INFO] websockets.server: connection open
15:04:52 [INFO] gameserver.network.server: Session registered: uid=-4
15:04:52 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 63101)
15:04:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:04:52 [INFO] gameserver.network.server: Session registered: uid=2
15:04:52 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
15:04:58 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:04:58 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 1, got 2)
15:05:00 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:05:00 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 1, got 2)
15:05:01 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:05:01 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 1}
15:05:04 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:05:04 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 0}
15:06:01 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=100
15:08:03 [INFO] gameserver.network.server: Session removed: uid=2
15:08:03 [INFO] websockets.server: connection open
15:08:03 [INFO] gameserver.network.server: Session registered: uid=-5
15:08:03 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 59208)
15:08:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:08:03 [INFO] gameserver.network.server: Session registered: uid=2
15:08:03 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
15:08:08 [INFO] gameserver.engine.empire_service: Empire 2: started research HORSEBACK_RIDING (effort=5000.0)
15:08:08 [INFO] gameserver.network.handlers: new_item success uid=2 iid=HORSEBACK_RIDING
15:08:55 [INFO] gameserver.engine.empire_service: Empire 2: started research MUSIC (effort=4000.0)
15:08:55 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MUSIC
15:09:01 [INFO] gameserver.engine.empire_service: Empire 2: started research HORSEBACK_RIDING (effort=5000.0)
15:09:01 [INFO] gameserver.network.handlers: new_item success uid=2 iid=HORSEBACK_RIDING
15:09:13 [INFO] gameserver.engine.empire_service: Empire 2: started building EXCHANGE_POST (effort=1500.0)
15:09:13 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EXCHANGE_POST
15:09:19 [INFO] gameserver.engine.empire_service: Empire 2: started building EPIC_DRAWINGS (effort=1000.0)
15:09:19 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EPIC_DRAWINGS
15:10:03 [INFO] __main__: Shutdown signal received — stopping …
15:10:04 [INFO] __main__: Shutting down …
15:10:04 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
15:10:04 [INFO] websockets.server: server closing
15:10:04 [INFO] gameserver.network.server: Session removed: uid=2
15:10:04 [INFO] websockets.server: server closed
15:10:04 [INFO] gameserver.network.server: WebSocket server stopped
15:10:04 [INFO] __main__:   WebSocket server stopped
15:10:04 [INFO] __main__:   debug dashboard stopped
15:10:04 [INFO] __main__:   database closed
15:10:04 [INFO] __main__:   goodbye
15:10:05 [INFO] __main__: === Game Server starting ===
15:10:05 [INFO] __main__: Loading configuration …
15:10:06 [INFO] __main__:   items:        210 loaded from config
15:10:06 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
15:10:06 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
15:10:06 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
15:10:06 [INFO] __main__:   game_config:  loaded
15:10:06 [INFO] __main__: Initializing persistence …
15:10:06 [INFO] gameserver.persistence.database: Database connected: gameserver.db
15:10:06 [INFO] __main__:   database:     connected (gameserver.db)
15:10:06 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T15:10:04, version 1)
15:10:06 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
15:10:06 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
15:10:06 [INFO] __main__: Creating services …
15:10:06 [INFO] __main__:   upgrade_provider: 210 items registered
15:10:06 [INFO] __main__:   all services created
15:10:06 [INFO] __main__: Wiring event handlers …
15:10:06 [INFO] __main__:   event handlers registered
15:10:06 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
15:10:06 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
15:10:06 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
15:10:06 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002}
15:10:06 [INFO] __main__: Restored 2 empires from saved state
15:10:06 [INFO] __main__: Starting network server …
15:10:06 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
15:10:06 [INFO] websockets.server: server listening on 0.0.0.0:8765
15:10:06 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
15:10:06 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
15:10:06 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
15:10:06 [INFO] __main__: Starting game loop …
15:10:06 [INFO] __main__:   game loop running (1 s tick)
15:10:07 [INFO] websockets.server: connection open
15:10:07 [INFO] gameserver.network.server: Session registered: uid=-1
15:10:07 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50718)
15:10:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:10:07 [INFO] gameserver.network.server: Session registered: uid=2
15:10:07 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
15:10:10 [INFO] gameserver.network.server: Session removed: uid=2
15:10:10 [INFO] websockets.server: connection open
15:10:10 [INFO] gameserver.network.server: Session registered: uid=-2
15:10:10 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50743)
15:10:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:10:10 [INFO] gameserver.network.server: Session registered: uid=2
15:10:10 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
15:10:12 [INFO] gameserver.engine.empire_service: Empire 2: started building EXCHANGE_POST (effort=1500.0)
15:10:12 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EXCHANGE_POST
15:10:17 [INFO] gameserver.engine.empire_service: Empire 2: started building EPIC_DRAWINGS (effort=1000.0)
15:10:17 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EPIC_DRAWINGS
15:10:22 [INFO] gameserver.engine.empire_service: Empire 2: started building EXCHANGE_POST (effort=1500.0)
15:10:22 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EXCHANGE_POST
15:10:26 [INFO] gameserver.engine.empire_service: Empire 2: started building EPIC_DRAWINGS (effort=1000.0)
15:10:26 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EPIC_DRAWINGS
15:12:36 [INFO] gameserver.network.server: Session removed: uid=2
15:12:36 [INFO] websockets.server: connection open
15:12:36 [INFO] gameserver.network.server: Session registered: uid=-3
15:12:36 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 57597)
15:12:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:12:36 [INFO] gameserver.network.server: Session registered: uid=2
15:12:36 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
15:12:40 [INFO] gameserver.engine.empire_service: Empire 2: started building EXCHANGE_POST (effort=1500.0)
15:12:40 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EXCHANGE_POST
15:12:45 [INFO] gameserver.engine.empire_service: Empire 2: started building EPIC_DRAWINGS (effort=1000.0)
15:12:45 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EPIC_DRAWINGS
15:12:50 [INFO] gameserver.network.server: Session removed: uid=2
15:12:50 [INFO] websockets.server: connection open
15:12:50 [INFO] gameserver.network.server: Session registered: uid=-4
15:12:50 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 58062)
15:12:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:12:50 [INFO] gameserver.network.server: Session registered: uid=2
15:12:50 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
15:16:41 [INFO] gameserver.network.server: Session removed: uid=2
15:16:41 [INFO] websockets.server: connection open
15:16:41 [INFO] gameserver.network.server: Session registered: uid=-5
15:16:41 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 60455)
15:16:41 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:16:41 [INFO] gameserver.network.server: Session registered: uid=2
15:16:41 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
15:16:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:16:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 1}
15:16:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:16:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 0}
15:16:49 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:16:49 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 1}
15:18:17 [INFO] gameserver.network.server: Session removed: uid=2
15:18:17 [INFO] websockets.server: connection open
15:18:17 [INFO] gameserver.network.server: Session registered: uid=-6
15:18:17 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 56357)
15:18:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:18:17 [INFO] gameserver.network.server: Session registered: uid=2
15:18:17 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
15:18:22 [ERROR] gameserver.network.server: Handler error: type=change_citizen uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 60, in route
    message = parse_message(raw)
  File "/home/pi/e3/python_server/src/gameserver/models/messages.py", line 363, in parse_message
    return model_cls.model_validate(data)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/main.py", line 716, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for ChangeCitizenRequest
citizens.free
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/int_type
15:18:25 [INFO] gameserver.network.server: Session removed: uid=2
15:18:25 [INFO] websockets.server: connection open
15:18:25 [INFO] gameserver.network.server: Session registered: uid=-7
15:18:25 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 52863)
15:18:25 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:18:25 [INFO] gameserver.network.server: Session registered: uid=2
15:18:25 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
15:18:25 [INFO] gameserver.network.server: Session removed: uid=2
15:18:25 [INFO] websockets.server: connection open
15:18:25 [INFO] gameserver.network.server: Session registered: uid=-8
15:18:25 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 52887)
15:18:25 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:18:25 [INFO] gameserver.network.server: Session registered: uid=2
15:18:25 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
15:18:27 [ERROR] gameserver.network.server: Handler error: type=change_citizen uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 60, in route
    message = parse_message(raw)
  File "/home/pi/e3/python_server/src/gameserver/models/messages.py", line 363, in parse_message
    return model_cls.model_validate(data)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/main.py", line 716, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for ChangeCitizenRequest
citizens.free
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/int_type
15:18:27 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:27 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 0}
15:18:29 [ERROR] gameserver.network.server: Handler error: type=change_citizen uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 60, in route
    message = parse_message(raw)
  File "/home/pi/e3/python_server/src/gameserver/models/messages.py", line 363, in parse_message
    return model_cls.model_validate(data)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/main.py", line 716, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for ChangeCitizenRequest
citizens.free
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/int_type
15:18:31 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:31 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 1}
15:18:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:35 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 0}
15:18:37 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:37 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
15:18:39 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:39 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 2}
15:18:43 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:43 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
15:18:44 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:44 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
15:18:45 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:45 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 361.4, have 326.2)
15:18:45 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:45 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 361.4, have 326.3)
15:18:45 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:45 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 361.4, have 326.3)
15:18:45 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:45 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 361.4, have 326.3)
15:18:46 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:46 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 361.4, have 326.3)
15:18:46 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:46 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 361.4, have 326.3)
15:18:46 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:46 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 361.4, have 326.3)
15:18:46 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:18:46 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 361.4, have 326.5)
15:18:57 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:57 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 3}
15:18:57 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:57 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 2}
15:18:57 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:57 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 1}
15:18:57 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:57 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 0}
15:18:57 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:57 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 4, got 5)
15:18:57 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:57 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 4, got 5)
15:18:57 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:18:57 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 4, got 5)
15:20:13 [INFO] gameserver.network.server: Session removed: uid=2
15:20:14 [INFO] websockets.server: connection open
15:20:14 [INFO] gameserver.network.server: Session registered: uid=-9
15:20:14 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 62783)
15:20:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:20:14 [INFO] gameserver.network.server: Session registered: uid=2
15:20:14 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
15:20:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 1}
15:20:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 2}
15:20:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 3}
15:20:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 4}
15:20:27 [INFO] gameserver.network.server: Session removed: uid=2
15:20:27 [INFO] websockets.server: connection open
15:20:27 [INFO] gameserver.network.server: Session registered: uid=-10
15:20:27 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 57482)
15:20:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:20:27 [INFO] gameserver.network.server: Session registered: uid=2
15:20:27 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
15:20:28 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:28 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 3}
15:20:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:29 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 2}
15:20:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:29 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 1}
15:20:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:29 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 0}
15:20:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:29 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 4, got 5)
15:20:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:29 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 4, got 5)
15:20:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:20:29 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 4, got 5)
15:20:30 [INFO] gameserver.network.server: Session removed: uid=2
15:20:30 [INFO] websockets.server: connection open
15:20:30 [INFO] gameserver.network.server: Session registered: uid=-11
15:20:30 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('192.168.178.2', 57506)
15:20:30 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:20:30 [INFO] gameserver.network.server: Session registered: uid=2
15:20:30 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
15:22:06 [INFO] gameserver.network.server: Session removed: uid=2
15:22:06 [INFO] websockets.server: connection open
15:22:06 [INFO] gameserver.network.server: Session registered: uid=-12
15:22:06 [INFO] gameserver.network.server: Client connected: uid=-12 remote=('192.168.178.2', 54939)
15:22:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:22:06 [INFO] gameserver.network.server: Session registered: uid=2
15:22:06 [INFO] gameserver.network.server: Session upgraded: guest=-12 → uid=2
15:24:32 [INFO] gameserver.network.server: Session removed: uid=2
15:24:32 [INFO] websockets.server: connection open
15:24:32 [INFO] gameserver.network.server: Session registered: uid=-13
15:24:32 [INFO] gameserver.network.server: Client connected: uid=-13 remote=('192.168.178.2', 57020)
15:24:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:32 [INFO] gameserver.network.server: Session registered: uid=2
15:24:32 [INFO] gameserver.network.server: Session upgraded: guest=-13 → uid=2
15:24:34 [INFO] gameserver.network.server: Session removed: uid=2
15:24:35 [INFO] websockets.server: connection open
15:24:35 [INFO] gameserver.network.server: Session registered: uid=-14
15:24:35 [INFO] gameserver.network.server: Client connected: uid=-14 remote=('192.168.178.2', 64928)
15:24:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:35 [INFO] gameserver.network.server: Session registered: uid=2
15:24:35 [INFO] gameserver.network.server: Session upgraded: guest=-14 → uid=2
15:24:35 [INFO] gameserver.network.server: Session removed: uid=2
15:24:35 [INFO] websockets.server: connection open
15:24:35 [INFO] gameserver.network.server: Session registered: uid=-15
15:24:35 [INFO] gameserver.network.server: Client connected: uid=-15 remote=('192.168.178.2', 64949)
15:24:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:35 [INFO] gameserver.network.server: Session registered: uid=2
15:24:35 [INFO] gameserver.network.server: Session upgraded: guest=-15 → uid=2
15:24:35 [INFO] gameserver.network.server: Session removed: uid=2
15:24:35 [INFO] websockets.server: connection open
15:24:35 [INFO] gameserver.network.server: Session registered: uid=-16
15:24:35 [INFO] gameserver.network.server: Client connected: uid=-16 remote=('192.168.178.2', 64970)
15:24:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:35 [INFO] gameserver.network.server: Session registered: uid=2
15:24:35 [INFO] gameserver.network.server: Session upgraded: guest=-16 → uid=2
15:24:48 [INFO] gameserver.network.server: Session removed: uid=2
15:24:48 [INFO] websockets.server: connection open
15:24:48 [INFO] gameserver.network.server: Session registered: uid=-17
15:24:48 [INFO] gameserver.network.server: Client connected: uid=-17 remote=('192.168.178.2', 49776)
15:24:48 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:48 [INFO] gameserver.network.server: Session registered: uid=2
15:24:48 [INFO] gameserver.network.server: Session upgraded: guest=-17 → uid=2
15:24:50 [INFO] gameserver.network.server: Session removed: uid=2
15:24:50 [INFO] websockets.server: connection open
15:24:50 [INFO] gameserver.network.server: Session registered: uid=-18
15:24:50 [INFO] gameserver.network.server: Client connected: uid=-18 remote=('192.168.178.2', 49798)
15:24:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:50 [INFO] gameserver.network.server: Session registered: uid=2
15:24:50 [INFO] gameserver.network.server: Session upgraded: guest=-18 → uid=2
15:24:50 [INFO] gameserver.network.server: Session removed: uid=2
15:24:50 [INFO] websockets.server: connection open
15:24:50 [INFO] gameserver.network.server: Session registered: uid=-19
15:24:50 [INFO] gameserver.network.server: Client connected: uid=-19 remote=('192.168.178.2', 49819)
15:24:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:50 [INFO] gameserver.network.server: Session registered: uid=2
15:24:50 [INFO] gameserver.network.server: Session upgraded: guest=-19 → uid=2
15:24:51 [INFO] gameserver.network.server: Session removed: uid=2
15:24:51 [INFO] websockets.server: connection open
15:24:51 [INFO] gameserver.network.server: Session registered: uid=-20
15:24:51 [INFO] gameserver.network.server: Client connected: uid=-20 remote=('192.168.178.2', 49840)
15:24:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:51 [INFO] gameserver.network.server: Session registered: uid=2
15:24:51 [INFO] gameserver.network.server: Session upgraded: guest=-20 → uid=2
15:24:51 [INFO] gameserver.network.server: Session removed: uid=2
15:24:51 [INFO] websockets.server: connection open
15:24:51 [INFO] gameserver.network.server: Session registered: uid=-21
15:24:51 [INFO] gameserver.network.server: Client connected: uid=-21 remote=('192.168.178.2', 49861)
15:24:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:51 [INFO] gameserver.network.server: Session registered: uid=2
15:24:51 [INFO] gameserver.network.server: Session upgraded: guest=-21 → uid=2
15:24:51 [INFO] gameserver.network.server: Session removed: uid=2
15:24:51 [INFO] websockets.server: connection open
15:24:51 [INFO] gameserver.network.server: Session registered: uid=-22
15:24:51 [INFO] gameserver.network.server: Client connected: uid=-22 remote=('192.168.178.2', 49882)
15:24:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:51 [INFO] gameserver.network.server: Session registered: uid=2
15:24:51 [INFO] gameserver.network.server: Session upgraded: guest=-22 → uid=2
15:24:51 [INFO] gameserver.network.server: Session removed: uid=2
15:24:51 [INFO] websockets.server: connection open
15:24:51 [INFO] gameserver.network.server: Session registered: uid=-23
15:24:51 [INFO] gameserver.network.server: Client connected: uid=-23 remote=('192.168.178.2', 49903)
15:24:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:24:51 [INFO] gameserver.network.server: Session registered: uid=2
15:24:51 [INFO] gameserver.network.server: Session upgraded: guest=-23 → uid=2
15:25:10 [INFO] gameserver.network.server: Session removed: uid=2
15:25:10 [INFO] websockets.server: connection open
15:25:10 [INFO] gameserver.network.server: Session registered: uid=-24
15:25:10 [INFO] gameserver.network.server: Client connected: uid=-24 remote=('192.168.178.2', 51327)
15:25:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:25:10 [INFO] gameserver.network.server: Session registered: uid=2
15:25:10 [INFO] gameserver.network.server: Session upgraded: guest=-24 → uid=2
15:26:16 [INFO] gameserver.engine.empire_service: Empire 2: applied effects for EPIC_DRAWINGS: {'culture_modifier': 0.1}
15:26:16 [INFO] gameserver.engine.empire_service: Empire 2: building EPIC_DRAWINGS completed
15:27:09 [INFO] gameserver.network.server: Session removed: uid=2
15:27:10 [INFO] websockets.server: connection open
15:27:10 [INFO] gameserver.network.server: Session registered: uid=-25
15:27:10 [INFO] gameserver.network.server: Client connected: uid=-25 remote=('192.168.178.2', 49775)
15:27:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:27:10 [INFO] gameserver.network.server: Session registered: uid=2
15:27:10 [INFO] gameserver.network.server: Session upgraded: guest=-25 → uid=2
15:28:49 [INFO] gameserver.network.server: Session removed: uid=2
15:28:49 [INFO] websockets.server: connection open
15:28:49 [INFO] gameserver.network.server: Session registered: uid=-26
15:28:49 [INFO] gameserver.network.server: Client connected: uid=-26 remote=('192.168.178.2', 61449)
15:28:49 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:28:49 [INFO] gameserver.network.server: Session registered: uid=2
15:28:49 [INFO] gameserver.network.server: Session upgraded: guest=-26 → uid=2
15:29:01 [INFO] gameserver.network.server: Session removed: uid=2
15:29:01 [INFO] websockets.server: connection open
15:29:01 [INFO] gameserver.network.server: Session registered: uid=-27
15:29:01 [INFO] gameserver.network.server: Client connected: uid=-27 remote=('192.168.178.2', 61478)
15:29:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:29:01 [INFO] gameserver.network.server: Session registered: uid=2
15:29:01 [INFO] gameserver.network.server: Session upgraded: guest=-27 → uid=2
15:29:56 [INFO] gameserver.network.server: Session removed: uid=2
15:29:56 [INFO] websockets.server: connection open
15:29:56 [INFO] gameserver.network.server: Session registered: uid=-28
15:29:56 [INFO] gameserver.network.server: Client connected: uid=-28 remote=('192.168.178.2', 52392)
15:29:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:29:56 [INFO] gameserver.network.server: Session registered: uid=2
15:29:56 [INFO] gameserver.network.server: Session upgraded: guest=-28 → uid=2
15:30:04 [INFO] gameserver.network.server: Session removed: uid=2
15:30:04 [INFO] websockets.server: connection open
15:30:04 [INFO] gameserver.network.server: Session registered: uid=-29
15:30:04 [INFO] gameserver.network.server: Client connected: uid=-29 remote=('192.168.178.2', 50359)
15:30:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:30:04 [INFO] gameserver.network.server: Session registered: uid=2
15:30:04 [INFO] gameserver.network.server: Session upgraded: guest=-29 → uid=2
15:30:04 [INFO] gameserver.network.server: Session removed: uid=2
15:30:04 [INFO] websockets.server: connection open
15:30:04 [INFO] gameserver.network.server: Session registered: uid=-30
15:30:04 [INFO] gameserver.network.server: Client connected: uid=-30 remote=('192.168.178.2', 50380)
15:30:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:30:04 [INFO] gameserver.network.server: Session registered: uid=2
15:30:04 [INFO] gameserver.network.server: Session upgraded: guest=-30 → uid=2
15:30:07 [INFO] gameserver.engine.empire_service: Empire 2: started building TOOL_SHOP (effort=500.0)
15:30:07 [INFO] gameserver.network.handlers: new_item success uid=2 iid=TOOL_SHOP
15:31:22 [INFO] gameserver.network.server: Session removed: uid=2
15:31:22 [INFO] websockets.server: connection open
15:31:22 [INFO] gameserver.network.server: Session registered: uid=-31
15:31:22 [INFO] gameserver.network.server: Client connected: uid=-31 remote=('192.168.178.2', 59974)
15:31:22 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:31:22 [INFO] gameserver.network.server: Session registered: uid=2
15:31:22 [INFO] gameserver.network.server: Session upgraded: guest=-31 → uid=2
15:31:33 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:31:33 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
15:31:34 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:31:34 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 570.4, have 441.5)
15:31:38 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:31:38 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 1, 'free': 0}
15:33:37 [INFO] gameserver.network.server: Session removed: uid=2
15:33:37 [INFO] websockets.server: connection open
15:33:37 [INFO] gameserver.network.server: Session registered: uid=-32
15:33:37 [INFO] gameserver.network.server: Client connected: uid=-32 remote=('192.168.178.2', 62187)
15:33:37 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:33:37 [INFO] gameserver.network.server: Session registered: uid=2
15:33:37 [INFO] gameserver.network.server: Session upgraded: guest=-32 → uid=2
15:33:50 [INFO] gameserver.network.server: Session removed: uid=2
15:33:50 [INFO] websockets.server: connection open
15:33:50 [INFO] gameserver.network.server: Session registered: uid=-33
15:33:50 [INFO] gameserver.network.server: Client connected: uid=-33 remote=('192.168.178.2', 50074)
15:33:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:33:50 [INFO] gameserver.network.server: Session registered: uid=2
15:33:50 [INFO] gameserver.network.server: Session upgraded: guest=-33 → uid=2
15:33:58 [INFO] gameserver.network.server: Session removed: uid=2
15:33:58 [INFO] websockets.server: connection open
15:33:58 [INFO] gameserver.network.server: Session registered: uid=-34
15:33:58 [INFO] gameserver.network.server: Client connected: uid=-34 remote=('192.168.178.2', 51220)
15:33:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:33:58 [INFO] gameserver.network.server: Session registered: uid=2
15:33:58 [INFO] gameserver.network.server: Session upgraded: guest=-34 → uid=2
15:34:06 [INFO] gameserver.network.server: Session removed: uid=2
15:34:07 [INFO] websockets.server: connection open
15:34:07 [INFO] gameserver.network.server: Session registered: uid=-35
15:34:07 [INFO] gameserver.network.server: Client connected: uid=-35 remote=('192.168.178.2', 51243)
15:34:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:34:07 [INFO] gameserver.network.server: Session registered: uid=2
15:34:07 [INFO] gameserver.network.server: Session upgraded: guest=-35 → uid=2
15:34:09 [INFO] gameserver.network.server: Session removed: uid=2
15:34:09 [INFO] websockets.server: connection open
15:34:09 [INFO] gameserver.network.server: Session registered: uid=-36
15:34:09 [INFO] gameserver.network.server: Client connected: uid=-36 remote=('192.168.178.2', 51247)
15:34:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:34:09 [INFO] gameserver.network.server: Session registered: uid=2
15:34:09 [INFO] gameserver.network.server: Session upgraded: guest=-36 → uid=2
15:34:09 [INFO] gameserver.network.server: Session removed: uid=2
15:34:09 [INFO] websockets.server: connection open
15:34:09 [INFO] gameserver.network.server: Session registered: uid=-37
15:34:09 [INFO] gameserver.network.server: Client connected: uid=-37 remote=('192.168.178.2', 51250)
15:34:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:34:09 [INFO] gameserver.network.server: Session registered: uid=2
15:34:09 [INFO] gameserver.network.server: Session upgraded: guest=-37 → uid=2
15:34:10 [INFO] gameserver.network.server: Session removed: uid=2
15:34:10 [INFO] websockets.server: connection open
15:34:10 [INFO] gameserver.network.server: Session registered: uid=-38
15:34:10 [INFO] gameserver.network.server: Client connected: uid=-38 remote=('192.168.178.2', 51253)
15:34:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:34:10 [INFO] gameserver.network.server: Session registered: uid=2
15:34:10 [INFO] gameserver.network.server: Session upgraded: guest=-38 → uid=2
15:34:10 [INFO] gameserver.network.server: Session removed: uid=2
15:34:10 [INFO] websockets.server: connection open
15:34:10 [INFO] gameserver.network.server: Session registered: uid=-39
15:34:10 [INFO] gameserver.network.server: Client connected: uid=-39 remote=('192.168.178.2', 51256)
15:34:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:34:10 [INFO] gameserver.network.server: Session registered: uid=2
15:34:10 [INFO] gameserver.network.server: Session upgraded: guest=-39 → uid=2
15:34:10 [INFO] gameserver.network.server: Session removed: uid=2
15:34:10 [INFO] websockets.server: connection open
15:34:10 [INFO] gameserver.network.server: Session registered: uid=-40
15:34:10 [INFO] gameserver.network.server: Client connected: uid=-40 remote=('192.168.178.2', 51259)
15:34:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:34:10 [INFO] gameserver.network.server: Session registered: uid=2
15:34:10 [INFO] gameserver.network.server: Session upgraded: guest=-40 → uid=2
15:34:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 1}
15:34:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 0, 'artist': 0, 'free': 0}
15:34:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:29 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 1}
15:34:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:29 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 1, 'free': 0}
15:34:30 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:30 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 1}
15:34:32 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:32 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 0, 'artist': 0, 'free': 0}
15:34:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 1}
15:34:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 2}
15:34:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 3}
15:34:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 4}
15:34:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:35 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 5}
15:34:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 4}
15:34:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 3}
15:34:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 2}
15:34:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 1}
15:34:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 0}
15:34:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:37 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 5, got 6)
15:34:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:37 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 5, got 6)
15:34:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:34:37 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 5, got 6)
15:35:18 [INFO] gameserver.network.server: Session removed: uid=2
15:35:18 [INFO] websockets.server: connection open
15:35:18 [INFO] gameserver.network.server: Session registered: uid=-41
15:35:18 [INFO] gameserver.network.server: Client connected: uid=-41 remote=('192.168.178.2', 57310)
15:35:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:35:18 [INFO] gameserver.network.server: Session registered: uid=2
15:35:18 [INFO] gameserver.network.server: Session upgraded: guest=-41 → uid=2
15:35:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:35:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 1}
15:35:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:35:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 2}
15:35:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:35:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 3, 'free': 1}
15:35:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:35:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 3, 'free': 0}
15:37:04 [INFO] __main__: Shutdown signal received — stopping …
15:37:05 [INFO] __main__: Shutting down …
15:37:05 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
15:37:05 [INFO] websockets.server: server closing
15:37:05 [INFO] gameserver.network.server: Session removed: uid=2
15:37:05 [INFO] websockets.server: server closed
15:37:05 [INFO] gameserver.network.server: WebSocket server stopped
15:37:05 [INFO] __main__:   WebSocket server stopped
15:37:05 [INFO] __main__:   debug dashboard stopped
15:37:05 [INFO] __main__:   database closed
15:37:05 [INFO] __main__:   goodbye
15:37:06 [INFO] __main__: === Game Server starting ===
15:37:06 [INFO] __main__: Loading configuration …
15:37:07 [INFO] __main__:   items:        210 loaded from config
15:37:07 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
15:37:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
15:37:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
15:37:07 [INFO] __main__:   game_config:  loaded
15:37:07 [INFO] __main__: Initializing persistence …
15:37:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
15:37:07 [INFO] __main__:   database:     connected (gameserver.db)
15:37:07 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T15:37:05, version 1)
15:37:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
15:37:07 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
15:37:07 [INFO] __main__: Creating services …
15:37:07 [INFO] __main__:   upgrade_provider: 210 items registered
15:37:07 [INFO] __main__:   all services created
15:37:07 [INFO] __main__: Wiring event handlers …
15:37:07 [INFO] __main__:   event handlers registered
15:37:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
15:37:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
15:37:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
15:37:07 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1}
15:37:07 [INFO] __main__: Restored 2 empires from saved state
15:37:07 [INFO] __main__: Starting network server …
15:37:07 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
15:37:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
15:37:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
15:37:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
15:37:07 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
15:37:07 [INFO] __main__: Starting game loop …
15:37:07 [INFO] __main__:   game loop running (1 s tick)
15:37:08 [INFO] websockets.server: connection open
15:37:08 [INFO] gameserver.network.server: Session registered: uid=-1
15:37:08 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55603)
15:37:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:37:08 [INFO] gameserver.network.server: Session registered: uid=2
15:37:08 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
15:37:11 [INFO] gameserver.network.server: Session removed: uid=2
15:37:12 [INFO] websockets.server: connection open
15:37:12 [INFO] gameserver.network.server: Session registered: uid=-2
15:37:12 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55627)
15:37:12 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:37:12 [INFO] gameserver.network.server: Session registered: uid=2
15:37:12 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
15:37:15 [INFO] gameserver.network.server: Session removed: uid=2
15:37:15 [INFO] websockets.server: connection open
15:37:15 [INFO] gameserver.network.server: Session registered: uid=-3
15:37:15 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 55649)
15:37:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:37:15 [INFO] gameserver.network.server: Session registered: uid=2
15:37:15 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
15:38:30 [INFO] gameserver.engine.empire_service: Empire 2: applied effects for TOOL_SHOP: {'build_speed_modifier': 0.1}
15:38:30 [INFO] gameserver.engine.empire_service: Empire 2: building TOOL_SHOP completed
15:39:14 [INFO] gameserver.network.server: Session removed: uid=2
15:39:14 [INFO] websockets.server: connection open
15:39:14 [INFO] gameserver.network.server: Session registered: uid=-4
15:39:14 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 60837)
15:39:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:39:14 [INFO] gameserver.network.server: Session registered: uid=2
15:39:14 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
15:41:34 [INFO] gameserver.network.server: Session removed: uid=2
15:41:34 [INFO] websockets.server: connection open
15:41:34 [INFO] gameserver.network.server: Session registered: uid=-5
15:41:34 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 58533)
15:41:34 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:41:34 [INFO] gameserver.network.server: Session registered: uid=2
15:41:34 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
15:42:03 [INFO] gameserver.network.server: Session removed: uid=2
15:42:03 [INFO] websockets.server: connection open
15:42:03 [INFO] gameserver.network.server: Session registered: uid=-6
15:42:03 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 53040)
15:42:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:42:03 [INFO] gameserver.network.server: Session registered: uid=2
15:42:03 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
15:47:37 [INFO] __main__: Shutdown signal received — stopping …
15:47:37 [INFO] __main__: Shutting down …
15:47:37 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
15:47:37 [INFO] websockets.server: server closing
15:47:37 [INFO] gameserver.network.server: Session removed: uid=2
15:47:37 [INFO] websockets.server: server closed
15:47:37 [INFO] gameserver.network.server: WebSocket server stopped
15:47:37 [INFO] __main__:   WebSocket server stopped
15:47:37 [INFO] __main__:   debug dashboard stopped
15:47:37 [INFO] __main__:   database closed
15:47:37 [INFO] __main__:   goodbye
15:47:39 [INFO] __main__: === Game Server starting ===
15:47:39 [INFO] __main__: Loading configuration …
15:47:39 [INFO] __main__:   items:        210 loaded from config
15:47:39 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
15:47:39 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
15:47:39 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
15:47:39 [INFO] __main__:   game_config:  loaded
15:47:39 [INFO] __main__: Initializing persistence …
15:47:39 [INFO] gameserver.persistence.database: Database connected: gameserver.db
15:47:39 [INFO] __main__:   database:     connected (gameserver.db)
15:47:39 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T15:47:37, version 1)
15:47:39 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
15:47:39 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
15:47:39 [INFO] __main__: Creating services …
15:47:39 [INFO] __main__:   upgrade_provider: 210 items registered
15:47:39 [INFO] __main__:   all services created
15:47:39 [INFO] __main__: Wiring event handlers …
15:47:39 [INFO] __main__:   event handlers registered
15:47:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
15:47:39 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
15:47:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
15:47:39 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
15:47:39 [INFO] __main__: Restored 2 empires from saved state
15:47:39 [INFO] __main__: Starting network server …
15:47:39 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
15:47:39 [INFO] websockets.server: server listening on 0.0.0.0:8765
15:47:39 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
15:47:39 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
15:47:39 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
15:47:39 [INFO] __main__: Starting game loop …
15:47:39 [INFO] __main__:   game loop running (1 s tick)
15:47:40 [INFO] websockets.server: connection open
15:47:40 [INFO] gameserver.network.server: Session registered: uid=-1
15:47:40 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52778)
15:47:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:47:40 [INFO] gameserver.network.server: Session registered: uid=2
15:47:40 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
15:52:01 [INFO] __main__: Shutdown signal received — stopping …
15:52:02 [INFO] __main__: Shutting down …
15:52:02 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
15:52:02 [INFO] websockets.server: server closing
15:52:02 [INFO] gameserver.network.server: Session removed: uid=2
15:52:02 [INFO] websockets.server: server closed
15:52:02 [INFO] gameserver.network.server: WebSocket server stopped
15:52:02 [INFO] __main__:   WebSocket server stopped
15:52:02 [INFO] __main__:   debug dashboard stopped
15:52:02 [INFO] __main__:   database closed
15:52:02 [INFO] __main__:   goodbye
15:52:03 [INFO] __main__: === Game Server starting ===
15:52:03 [INFO] __main__: Loading configuration …
15:52:04 [INFO] __main__:   items:        210 loaded from config
15:52:04 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
15:52:04 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
15:52:04 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
15:52:04 [INFO] __main__:   game_config:  loaded
15:52:04 [INFO] __main__: Initializing persistence …
15:52:04 [INFO] gameserver.persistence.database: Database connected: gameserver.db
15:52:04 [INFO] __main__:   database:     connected (gameserver.db)
15:52:04 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T15:52:02, version 1)
15:52:04 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
15:52:04 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
15:52:04 [INFO] __main__: Creating services …
15:52:04 [INFO] __main__:   upgrade_provider: 210 items registered
15:52:04 [INFO] __main__:   all services created
15:52:04 [INFO] __main__: Wiring event handlers …
15:52:04 [INFO] __main__:   event handlers registered
15:52:04 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
15:52:04 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
15:52:04 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
15:52:04 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
15:52:04 [INFO] __main__: Restored 2 empires from saved state
15:52:04 [INFO] __main__: Starting network server …
15:52:04 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
15:52:04 [INFO] websockets.server: server listening on 0.0.0.0:8765
15:52:04 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
15:52:04 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
15:52:04 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
15:52:04 [INFO] __main__: Starting game loop …
15:52:04 [INFO] __main__:   game loop running (1 s tick)
15:52:05 [INFO] websockets.server: connection open
15:52:05 [INFO] gameserver.network.server: Session registered: uid=-1
15:52:05 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53549)
15:52:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:52:05 [INFO] gameserver.network.server: Session registered: uid=2
15:52:05 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
15:52:07 [INFO] gameserver.network.server: Session removed: uid=2
15:52:07 [INFO] websockets.server: connection open
15:52:07 [INFO] gameserver.network.server: Session registered: uid=-2
15:52:07 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 53563)
15:52:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:52:07 [INFO] gameserver.network.server: Session registered: uid=2
15:52:07 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
15:52:12 [INFO] gameserver.network.server: Session removed: uid=2
15:52:12 [INFO] websockets.server: connection open
15:52:12 [INFO] gameserver.network.server: Session registered: uid=-3
15:52:12 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 53567)
15:52:12 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:52:12 [INFO] gameserver.network.server: Session registered: uid=2
15:52:12 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
15:52:16 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:52:16 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
15:52:19 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
15:52:19 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 925.0, have 634.6)
15:52:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
15:52:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 1, 'artist': 3, 'free': 0}
15:52:55 [INFO] gameserver.engine.empire_service: Empire 2: started building EXCHANGE_POST (effort=1500.0)
15:52:55 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EXCHANGE_POST
15:57:21 [INFO] gameserver.network.server: Session removed: uid=2
15:57:21 [INFO] websockets.server: connection open
15:57:21 [INFO] gameserver.network.server: Session registered: uid=-4
15:57:21 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 58206)
15:57:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
15:57:21 [INFO] gameserver.network.server: Session registered: uid=2
15:57:21 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
16:00:03 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
16:00:03 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 925.0, have 717.6)
16:00:08 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:08 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 3, 'free': 1}
16:00:08 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:08 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 3, 'free': 2}
16:00:09 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:09 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 3}
16:00:09 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:09 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 2}
16:00:09 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:09 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 1}
16:00:09 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:09 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 6, 'free': 0}
16:00:09 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:09 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:00:13 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:13 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 1}
16:00:13 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:13 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 2}
16:00:13 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:13 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 3}
16:00:14 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:14 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 2}
16:00:14 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:14 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 1}
16:00:15 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:15 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 6, 'free': 0}
16:00:15 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:15 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:00:15 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:15 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:00:15 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:15 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:00:15 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:15 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:00:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 1}
16:00:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 2}
16:00:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 3}
16:00:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 4}
16:00:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 5}
16:00:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 6}
16:00:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:26 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 5}
16:00:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:26 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 4}
16:00:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:26 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 3}
16:00:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:26 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 2}
16:00:27 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:27 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 1}
16:00:27 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:27 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 6, 'free': 0}
16:00:27 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:27 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:00:27 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:27 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:00:27 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:27 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:00:27 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:00:27 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 6, got 7)
16:05:13 [INFO] __main__: Shutdown signal received — stopping …
16:05:13 [INFO] __main__: Shutting down …
16:05:13 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:05:13 [INFO] websockets.server: server closing
16:05:13 [INFO] gameserver.network.server: Session removed: uid=2
16:05:13 [INFO] websockets.server: server closed
16:05:13 [INFO] gameserver.network.server: WebSocket server stopped
16:05:13 [INFO] __main__:   WebSocket server stopped
16:05:13 [INFO] __main__:   debug dashboard stopped
16:05:13 [INFO] __main__:   database closed
16:05:13 [INFO] __main__:   goodbye
16:05:14 [INFO] __main__: === Game Server starting ===
16:05:14 [INFO] __main__: Loading configuration …
16:05:15 [INFO] __main__:   items:        210 loaded from config
16:05:15 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:05:15 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:05:15 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:05:15 [INFO] __main__:   game_config:  loaded
16:05:15 [INFO] __main__: Initializing persistence …
16:05:15 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:05:15 [INFO] __main__:   database:     connected (gameserver.db)
16:05:15 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:05:13, version 1)
16:05:15 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:05:15 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:05:15 [INFO] __main__: Creating services …
16:05:15 [INFO] __main__:   upgrade_provider: 210 items registered
16:05:15 [INFO] __main__:   all services created
16:05:15 [INFO] __main__: Wiring event handlers …
16:05:15 [INFO] __main__:   event handlers registered
16:05:15 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:05:15 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:05:15 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:05:15 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:05:15 [INFO] __main__: Restored 2 empires from saved state
16:05:15 [INFO] __main__: Starting network server …
16:05:15 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:05:15 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:05:15 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:05:15 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:05:15 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:05:15 [INFO] __main__: Starting game loop …
16:05:15 [INFO] __main__:   game loop running (1 s tick)
16:05:16 [INFO] websockets.server: connection open
16:05:16 [INFO] gameserver.network.server: Session registered: uid=-1
16:05:16 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 65344)
16:05:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:05:16 [INFO] gameserver.network.server: Session registered: uid=2
16:05:16 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:05:17 [INFO] gameserver.network.server: Session removed: uid=2
16:05:17 [INFO] websockets.server: connection open
16:05:17 [INFO] gameserver.network.server: Session registered: uid=-2
16:05:17 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 65357)
16:05:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:05:17 [INFO] gameserver.network.server: Session registered: uid=2
16:05:17 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
16:08:42 [INFO] gameserver.network.server: Session removed: uid=2
16:08:43 [INFO] websockets.server: connection open
16:08:43 [INFO] gameserver.network.server: Session registered: uid=-3
16:08:43 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 56507)
16:08:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:08:43 [INFO] gameserver.network.server: Session registered: uid=2
16:08:43 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
16:08:58 [INFO] gameserver.engine.empire_service: Empire 2: started building BOW_MAKER (effort=2500.0)
16:08:58 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BOW_MAKER
16:14:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:14:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 1}
16:14:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:14:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 2}
16:14:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:14:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 3}
16:14:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:14:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 4}
16:14:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:14:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 5}
16:14:23 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:14:23 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 6}
16:17:24 [INFO] __main__: Shutdown signal received — stopping …
16:17:25 [INFO] __main__: Shutting down …
16:17:25 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:17:25 [INFO] websockets.server: server closing
16:17:25 [INFO] gameserver.network.server: Session removed: uid=2
16:17:25 [INFO] websockets.server: server closed
16:17:25 [INFO] gameserver.network.server: WebSocket server stopped
16:17:25 [INFO] __main__:   WebSocket server stopped
16:17:25 [INFO] __main__:   debug dashboard stopped
16:17:25 [INFO] __main__:   database closed
16:17:25 [INFO] __main__:   goodbye
16:17:39 [INFO] __main__: === Game Server starting ===
16:17:39 [INFO] __main__: Loading configuration …
16:17:40 [INFO] __main__:   items:        210 loaded from config
16:17:40 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:17:40 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:17:40 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:17:40 [INFO] __main__:   game_config:  loaded
16:17:40 [INFO] __main__: Initializing persistence …
16:17:40 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:17:40 [INFO] __main__:   database:     connected (gameserver.db)
16:17:40 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:17:25, version 1)
16:17:40 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:17:40 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:17:40 [INFO] __main__: Creating services …
16:17:40 [INFO] __main__:   upgrade_provider: 210 items registered
16:17:40 [INFO] __main__:   all services created
16:17:40 [INFO] __main__: Wiring event handlers …
16:17:40 [INFO] __main__:   event handlers registered
16:17:40 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:17:40 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:17:40 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 426, in <module>
    main()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 422, in main
    asyncio.run(_start())
  File "/usr/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.9/asyncio/base_events.py", line 642, in run_until_complete
    return future.result()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 385, in _start
    services.empire_service.recalculate_effects(empire)
  File "/home/pi/e3/python_server/src/gameserver/engine/empire_service.py", line 178, in recalculate_effects
    effects = self._upgrades.get_effects(iid)
  File "/home/pi/e3/python_server/src/gameserver/engine/upgrade_provider.py", line 49, in get_effects
    return dict(item.effects) if item else {}
TypeError: 'NoneType' object is not iterable
16:18:33 [INFO] __main__: === Game Server starting ===
16:18:33 [INFO] __main__: Loading configuration …
16:18:33 [INFO] __main__:   items:        210 loaded from config
16:18:33 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:18:33 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:18:33 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:18:33 [INFO] __main__:   game_config:  loaded
16:18:33 [INFO] __main__: Initializing persistence …
16:18:33 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:18:33 [INFO] __main__:   database:     connected (gameserver.db)
16:18:33 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:17:25, version 1)
16:18:33 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:18:33 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:18:33 [INFO] __main__: Creating services …
16:18:33 [INFO] __main__:   upgrade_provider: 210 items registered
16:18:33 [INFO] __main__:   all services created
16:18:33 [INFO] __main__: Wiring event handlers …
16:18:33 [INFO] __main__:   event handlers registered
16:18:33 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:18:33 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:18:33 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 426, in <module>
    main()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 422, in main
    asyncio.run(_start())
  File "/usr/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.9/asyncio/base_events.py", line 642, in run_until_complete
    return future.result()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 385, in _start
    services.empire_service.recalculate_effects(empire)
  File "/home/pi/e3/python_server/src/gameserver/engine/empire_service.py", line 178, in recalculate_effects
    effects = self._upgrades.get_effects(iid)
  File "/home/pi/e3/python_server/src/gameserver/engine/upgrade_provider.py", line 49, in get_effects
    return dict(item.effects) if item else {}
TypeError: 'NoneType' object is not iterable
16:19:58 [INFO] __main__: === Game Server starting ===
16:19:58 [INFO] __main__: Loading configuration …
16:19:58 [INFO] __main__:   items:        210 loaded from config
16:19:58 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:19:58 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:19:58 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:19:58 [INFO] __main__:   game_config:  loaded
16:19:58 [INFO] __main__: Initializing persistence …
16:19:58 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:19:58 [INFO] __main__:   database:     connected (gameserver.db)
16:19:58 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:17:25, version 1)
16:19:58 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:19:58 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:19:58 [INFO] __main__: Creating services …
16:19:58 [INFO] __main__:   upgrade_provider: 210 items registered
16:19:58 [INFO] __main__:   all services created
16:19:58 [INFO] __main__: Wiring event handlers …
16:19:58 [INFO] __main__:   event handlers registered
16:19:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:19:58 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:19:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:19:58 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.05, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:19:58 [INFO] __main__: Restored 2 empires from saved state
16:19:58 [INFO] __main__: Starting network server …
16:19:58 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:19:58 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:19:58 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:19:58 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:19:58 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:19:58 [INFO] __main__: Starting game loop …
16:19:58 [INFO] __main__:   game loop running (1 s tick)
16:20:14 [INFO] websockets.server: connection open
16:20:14 [INFO] gameserver.network.server: Session registered: uid=-1
16:20:14 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59089)
16:20:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:20:14 [INFO] gameserver.network.server: Session registered: uid=2
16:20:14 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:20:36 [INFO] __main__: Shutdown signal received — stopping …
16:20:36 [INFO] __main__: Shutting down …
16:20:37 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:20:37 [INFO] websockets.server: server closing
16:20:37 [INFO] gameserver.network.server: Session removed: uid=2
16:20:37 [INFO] websockets.server: server closed
16:20:37 [INFO] gameserver.network.server: WebSocket server stopped
16:20:37 [INFO] __main__:   WebSocket server stopped
16:20:37 [INFO] __main__:   debug dashboard stopped
16:20:37 [INFO] __main__:   database closed
16:20:37 [INFO] __main__:   goodbye
16:20:38 [INFO] __main__: === Game Server starting ===
16:20:38 [INFO] __main__: Loading configuration …
16:20:38 [INFO] __main__:   items:        210 loaded from config
16:20:38 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:20:38 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:20:38 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:20:38 [INFO] __main__:   game_config:  loaded
16:20:38 [INFO] __main__: Initializing persistence …
16:20:38 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:20:38 [INFO] __main__:   database:     connected (gameserver.db)
16:20:38 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:20:36, version 1)
16:20:38 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:20:38 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:20:38 [INFO] __main__: Creating services …
16:20:38 [INFO] __main__:   upgrade_provider: 210 items registered
16:20:38 [INFO] __main__:   all services created
16:20:38 [INFO] __main__: Wiring event handlers …
16:20:38 [INFO] __main__:   event handlers registered
16:20:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:20:38 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:20:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:20:38 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.05, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:20:38 [INFO] __main__: Restored 2 empires from saved state
16:20:38 [INFO] __main__: Starting network server …
16:20:38 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:20:38 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:20:38 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:20:38 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:20:38 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:20:38 [INFO] __main__: Starting game loop …
16:20:38 [INFO] __main__:   game loop running (1 s tick)
16:20:40 [INFO] websockets.server: connection open
16:20:40 [INFO] gameserver.network.server: Session registered: uid=-1
16:20:40 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52053)
16:20:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:20:40 [INFO] gameserver.network.server: Session registered: uid=2
16:20:40 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:20:46 [INFO] gameserver.network.server: Session removed: uid=2
16:20:46 [INFO] websockets.server: connection open
16:20:46 [INFO] gameserver.network.server: Session registered: uid=-2
16:20:46 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 52060)
16:20:46 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:20:46 [INFO] gameserver.network.server: Session registered: uid=2
16:20:46 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
16:20:57 [INFO] __main__: Shutdown signal received — stopping …
16:20:57 [INFO] __main__: Shutting down …
16:20:57 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:20:57 [INFO] websockets.server: server closing
16:20:58 [INFO] gameserver.network.server: Session removed: uid=2
16:20:58 [INFO] websockets.server: server closed
16:20:58 [INFO] gameserver.network.server: WebSocket server stopped
16:20:58 [INFO] __main__:   WebSocket server stopped
16:20:58 [INFO] __main__:   debug dashboard stopped
16:20:58 [INFO] __main__:   database closed
16:20:58 [INFO] __main__:   goodbye
16:21:09 [INFO] __main__: === Game Server starting ===
16:21:09 [INFO] __main__: Loading configuration …
16:21:09 [INFO] __main__:   items:        210 loaded from config
16:21:09 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:21:09 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:21:09 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:21:09 [INFO] __main__:   game_config:  loaded
16:21:09 [INFO] __main__: Initializing persistence …
16:21:09 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:21:09 [INFO] __main__:   database:     connected (gameserver.db)
16:21:09 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:20:57, version 1)
16:21:09 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:21:09 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:21:09 [INFO] __main__: Creating services …
16:21:09 [INFO] __main__:   upgrade_provider: 210 items registered
16:21:09 [INFO] __main__:   all services created
16:21:09 [INFO] __main__: Wiring event handlers …
16:21:09 [INFO] __main__:   event handlers registered
16:21:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:21:09 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:21:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:21:10 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.05, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:21:10 [INFO] __main__: Restored 2 empires from saved state
16:21:10 [INFO] __main__: Starting network server …
16:21:10 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:21:10 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:21:10 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:21:10 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:21:10 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:21:10 [INFO] __main__: Starting game loop …
16:21:10 [INFO] __main__:   game loop running (1 s tick)
16:21:11 [INFO] websockets.server: connection open
16:21:11 [INFO] gameserver.network.server: Session registered: uid=-1
16:21:11 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59349)
16:21:11 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:21:11 [INFO] gameserver.network.server: Session registered: uid=2
16:21:11 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:21:16 [INFO] gameserver.engine.empire_service: Empire 2: started building BOW_MAKER (effort=2500.0)
16:21:16 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BOW_MAKER
16:21:55 [INFO] __main__: Shutdown signal received — stopping …
16:21:56 [INFO] __main__: Shutting down …
16:21:56 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:21:56 [INFO] websockets.server: server closing
16:21:56 [INFO] gameserver.network.server: Session removed: uid=2
16:21:56 [INFO] websockets.server: server closed
16:21:56 [INFO] gameserver.network.server: WebSocket server stopped
16:21:56 [INFO] __main__:   WebSocket server stopped
16:21:56 [INFO] __main__:   debug dashboard stopped
16:21:56 [INFO] __main__:   database closed
16:21:56 [INFO] __main__:   goodbye
16:22:56 [INFO] __main__: === Game Server starting ===
16:22:56 [INFO] __main__: Loading configuration …
16:22:57 [INFO] __main__:   items:        210 loaded from config
16:22:57 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:22:57 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:22:57 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:22:57 [INFO] __main__:   game_config:  loaded
16:22:57 [INFO] __main__: Initializing persistence …
16:22:57 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:22:57 [INFO] __main__:   database:     connected (gameserver.db)
16:22:57 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:21:56, version 1)
16:22:57 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:22:57 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:22:57 [INFO] __main__: Creating services …
16:22:57 [INFO] __main__:   upgrade_provider: 210 items registered
16:22:57 [INFO] __main__:   all services created
16:22:57 [INFO] __main__: Wiring event handlers …
16:22:57 [INFO] __main__:   event handlers registered
16:22:57 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:22:57 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:22:57 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:22:57 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.05, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:22:57 [INFO] __main__: Restored 2 empires from saved state
16:22:57 [INFO] __main__: Starting network server …
16:22:57 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:22:57 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:22:57 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:22:57 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:22:57 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:22:57 [INFO] __main__: Starting game loop …
16:22:57 [INFO] __main__:   game loop running (1 s tick)
16:22:58 [INFO] websockets.server: connection open
16:22:58 [INFO] gameserver.network.server: Session registered: uid=-1
16:22:58 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52223)
16:22:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:22:58 [INFO] gameserver.network.server: Session registered: uid=2
16:22:58 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:23:04 [INFO] gameserver.engine.empire_service: Empire 2: started building BOW_MAKER (effort=2500.0)
16:23:04 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BOW_MAKER
16:23:21 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
16:23:21 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
16:23:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 6}
16:23:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 5}
16:23:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 4}
16:23:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 3}
16:23:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 2}
16:23:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 6, 'free': 1}
16:23:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 7, 'free': 0}
16:23:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 6, 'free': 1}
16:23:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 2}
16:23:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 3}
16:23:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 4}
16:23:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:37 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 5}
16:23:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:37 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 6}
16:23:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:37 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
16:23:41 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:41 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 6}
16:23:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:45 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 5}
16:23:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:45 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 4}
16:23:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:45 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 3}
16:23:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:45 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 0, 'artist': 0, 'free': 2}
16:23:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:45 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 6, 'scientist': 0, 'artist': 0, 'free': 1}
16:23:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:45 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 7, 'scientist': 0, 'artist': 0, 'free': 0}
16:23:46 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:46 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:46 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:46 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:46 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:46 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:46 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:46 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:46 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:46 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:23:47 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:47 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 6, 'scientist': 0, 'artist': 0, 'free': 1}
16:23:47 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:47 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 0, 'artist': 0, 'free': 2}
16:23:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 3}
16:23:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 4}
16:23:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 5}
16:23:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 6}
16:23:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:23:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
16:25:11 [INFO] gameserver.network.server: Session removed: uid=2
16:25:11 [INFO] websockets.server: connection open
16:25:11 [INFO] gameserver.network.server: Session registered: uid=-2
16:25:11 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 58510)
16:25:11 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:25:11 [INFO] gameserver.network.server: Session registered: uid=2
16:25:11 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
16:25:12 [INFO] gameserver.network.server: Session removed: uid=2
16:25:12 [INFO] websockets.server: connection open
16:25:12 [INFO] gameserver.network.server: Session registered: uid=-3
16:25:12 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 58513)
16:25:12 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:25:12 [INFO] gameserver.network.server: Session registered: uid=2
16:25:12 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
16:25:13 [INFO] gameserver.network.server: Session removed: uid=2
16:25:13 [INFO] websockets.server: connection open
16:25:13 [INFO] gameserver.network.server: Session registered: uid=-4
16:25:13 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 58516)
16:25:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:25:13 [INFO] gameserver.network.server: Session registered: uid=2
16:25:13 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
16:25:33 [INFO] gameserver.network.server: Session removed: uid=2
16:25:33 [INFO] websockets.server: connection open
16:25:33 [INFO] gameserver.network.server: Session registered: uid=-5
16:25:33 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 60884)
16:25:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:25:33 [INFO] gameserver.network.server: Session registered: uid=2
16:25:33 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
16:25:35 [INFO] gameserver.network.server: Session removed: uid=2
16:25:35 [INFO] websockets.server: connection open
16:25:35 [INFO] gameserver.network.server: Session registered: uid=-6
16:25:35 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 60887)
16:25:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:25:35 [INFO] gameserver.network.server: Session registered: uid=2
16:25:35 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
16:25:35 [INFO] gameserver.network.server: Session removed: uid=2
16:25:35 [INFO] websockets.server: connection open
16:25:35 [INFO] gameserver.network.server: Session registered: uid=-7
16:25:35 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 60890)
16:25:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:25:35 [INFO] gameserver.network.server: Session registered: uid=2
16:25:35 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
16:25:35 [INFO] gameserver.network.server: Session removed: uid=2
16:25:35 [INFO] websockets.server: connection open
16:25:35 [INFO] gameserver.network.server: Session registered: uid=-8
16:25:35 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 60893)
16:25:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:25:35 [INFO] gameserver.network.server: Session registered: uid=2
16:25:35 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
16:26:24 [INFO] gameserver.network.server: Session removed: uid=2
16:26:25 [INFO] websockets.server: connection open
16:26:25 [INFO] gameserver.network.server: Session registered: uid=-9
16:26:25 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 52024)
16:26:25 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:26:25 [INFO] gameserver.network.server: Session registered: uid=2
16:26:25 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
16:27:18 [INFO] gameserver.network.server: Session removed: uid=2
16:27:18 [INFO] websockets.server: connection open
16:27:18 [INFO] gameserver.network.server: Session registered: uid=-10
16:27:18 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 65368)
16:27:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:27:18 [INFO] gameserver.network.server: Session registered: uid=2
16:27:18 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
16:28:06 [INFO] gameserver.network.server: Session removed: uid=2
16:28:06 [INFO] websockets.server: connection open
16:28:06 [INFO] gameserver.network.server: Session registered: uid=-11
16:28:06 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('192.168.178.2', 53404)
16:28:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:28:06 [INFO] gameserver.network.server: Session registered: uid=2
16:28:06 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
16:28:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 6}
16:28:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 5}
16:28:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 4}
16:28:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 3}
16:28:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 2}
16:28:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 6, 'free': 1}
16:28:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 7, 'free': 0}
16:28:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:28:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:28:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:28:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:28:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:28:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:28:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:30:57 [INFO] gameserver.network.server: Session removed: uid=2
16:30:58 [INFO] websockets.server: connection open
16:30:58 [INFO] gameserver.network.server: Session registered: uid=-12
16:30:58 [INFO] gameserver.network.server: Client connected: uid=-12 remote=('192.168.178.2', 58091)
16:30:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:30:58 [INFO] gameserver.network.server: Session registered: uid=2
16:30:58 [INFO] gameserver.network.server: Session upgraded: guest=-12 → uid=2
16:31:09 [INFO] __main__: Shutdown signal received — stopping …
16:31:10 [INFO] __main__: Shutting down …
16:31:10 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:31:10 [INFO] websockets.server: server closing
16:31:10 [INFO] gameserver.network.server: Session removed: uid=2
16:31:10 [INFO] websockets.server: server closed
16:31:10 [INFO] gameserver.network.server: WebSocket server stopped
16:31:10 [INFO] __main__:   WebSocket server stopped
16:31:10 [INFO] __main__:   debug dashboard stopped
16:31:10 [INFO] __main__:   database closed
16:31:10 [INFO] __main__:   goodbye
16:31:12 [INFO] __main__: === Game Server starting ===
16:31:12 [INFO] __main__: Loading configuration …
16:31:13 [INFO] __main__:   items:        210 loaded from config
16:31:13 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:31:13 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:31:13 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:31:13 [INFO] __main__:   game_config:  loaded
16:31:13 [INFO] __main__: Initializing persistence …
16:31:13 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:31:13 [INFO] __main__:   database:     connected (gameserver.db)
16:31:13 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:31:10, version 1)
16:31:13 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:31:13 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:31:13 [INFO] __main__: Creating services …
16:31:13 [INFO] __main__:   upgrade_provider: 210 items registered
16:31:13 [INFO] __main__:   all services created
16:31:13 [INFO] __main__: Wiring event handlers …
16:31:13 [INFO] __main__:   event handlers registered
16:31:13 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:31:13 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:31:13 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:31:13 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.05, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:31:13 [INFO] __main__: Restored 2 empires from saved state
16:31:13 [INFO] __main__: Starting network server …
16:31:13 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:31:13 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:31:13 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:31:13 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:31:13 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:31:13 [INFO] __main__: Starting game loop …
16:31:13 [INFO] __main__:   game loop running (1 s tick)
16:31:13 [INFO] websockets.server: connection open
16:31:13 [INFO] gameserver.network.server: Session registered: uid=-1
16:31:13 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 65342)
16:31:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:31:13 [INFO] gameserver.network.server: Session registered: uid=2
16:31:13 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:31:21 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:21 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 6, 'free': 1}
16:31:21 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:21 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 5, 'free': 2}
16:31:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 4, 'free': 3}
16:31:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 4}
16:31:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 5}
16:31:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 6}
16:31:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
16:31:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 6}
16:31:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 5}
16:31:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 4}
16:31:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 3}
16:31:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 0, 'artist': 0, 'free': 2}
16:31:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 6, 'scientist': 0, 'artist': 0, 'free': 1}
16:31:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 7, 'scientist': 0, 'artist': 0, 'free': 0}
16:31:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:25 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:26 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:28 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:28 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 6, 'scientist': 0, 'artist': 0, 'free': 1}
16:31:28 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:28 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 0, 'artist': 0, 'free': 2}
16:31:28 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:28 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 3}
16:31:28 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:28 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 4}
16:31:28 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:28 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 5}
16:31:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:29 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 6}
16:31:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:29 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
16:31:31 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:31 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 6}
16:31:31 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:31 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 2, 'artist': 0, 'free': 5}
16:31:31 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:31 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 3, 'artist': 0, 'free': 4}
16:31:31 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:31 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 4, 'artist': 0, 'free': 3}
16:31:32 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:32 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 5, 'artist': 0, 'free': 2}
16:31:32 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:32 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 6, 'artist': 0, 'free': 1}
16:31:32 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:32 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 7, 'artist': 0, 'free': 0}
16:31:32 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:32 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:32 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:32 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:31:33 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:33 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 6, 'artist': 0, 'free': 1}
16:31:33 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:33 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 5, 'artist': 0, 'free': 2}
16:31:33 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:33 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 4, 'artist': 0, 'free': 3}
16:31:33 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:33 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 3, 'artist': 0, 'free': 4}
16:31:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 2, 'artist': 0, 'free': 5}
16:31:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 6}
16:31:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:31:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
16:36:05 [INFO] gameserver.engine.empire_service: Empire 2: knowledge HORSEBACK_RIDING completed
16:36:23 [INFO] gameserver.network.server: Session removed: uid=2
16:36:23 [INFO] websockets.server: connection open
16:36:23 [INFO] gameserver.network.server: Session registered: uid=-2
16:36:23 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 65495)
16:36:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:36:23 [INFO] gameserver.network.server: Session registered: uid=2
16:36:23 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
16:37:03 [INFO] gameserver.network.server: Session removed: uid=2
16:37:03 [INFO] websockets.server: connection open
16:37:03 [INFO] gameserver.network.server: Session registered: uid=-3
16:37:03 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 49154)
16:37:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:37:03 [INFO] gameserver.network.server: Session registered: uid=2
16:37:03 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
16:37:37 [INFO] __main__: Shutdown signal received — stopping …
16:37:37 [INFO] __main__: Shutting down …
16:37:37 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:37:37 [INFO] websockets.server: server closing
16:37:37 [INFO] gameserver.network.server: Session removed: uid=2
16:37:37 [INFO] websockets.server: server closed
16:37:37 [INFO] gameserver.network.server: WebSocket server stopped
16:37:37 [INFO] __main__:   WebSocket server stopped
16:37:37 [INFO] __main__:   debug dashboard stopped
16:37:37 [INFO] __main__:   database closed
16:37:37 [INFO] __main__:   goodbye
16:37:39 [INFO] __main__: === Game Server starting ===
16:37:39 [INFO] __main__: Loading configuration …
16:37:39 [INFO] __main__:   items:        210 loaded from config
16:37:40 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:37:40 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:37:40 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:37:40 [INFO] __main__:   game_config:  loaded
16:37:40 [INFO] __main__: Initializing persistence …
16:37:40 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:37:40 [INFO] __main__:   database:     connected (gameserver.db)
16:37:40 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:37:37, version 1)
16:37:40 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:37:40 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:37:40 [INFO] __main__: Creating services …
16:37:40 [INFO] __main__:   upgrade_provider: 210 items registered
16:37:40 [INFO] __main__:   all services created
16:37:40 [INFO] __main__: Wiring event handlers …
16:37:40 [INFO] __main__:   event handlers registered
16:37:40 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:37:40 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:37:40 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:37:40 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:37:40 [INFO] __main__: Restored 2 empires from saved state
16:37:40 [INFO] __main__: Starting network server …
16:37:40 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:37:40 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:37:40 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:37:40 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:37:40 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:37:40 [INFO] __main__: Starting game loop …
16:37:40 [INFO] __main__:   game loop running (1 s tick)
16:37:40 [INFO] websockets.server: connection open
16:37:40 [INFO] gameserver.network.server: Session registered: uid=-1
16:37:40 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55787)
16:37:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:37:40 [INFO] gameserver.network.server: Session registered: uid=2
16:37:40 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:37:45 [INFO] __main__: Shutdown signal received — stopping …
16:37:46 [INFO] __main__: Shutting down …
16:37:46 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:37:46 [INFO] websockets.server: server closing
16:37:46 [INFO] gameserver.network.server: Session removed: uid=2
16:37:46 [INFO] websockets.server: server closed
16:37:46 [INFO] gameserver.network.server: WebSocket server stopped
16:37:46 [INFO] __main__:   WebSocket server stopped
16:37:46 [INFO] __main__:   debug dashboard stopped
16:37:46 [INFO] __main__:   database closed
16:37:46 [INFO] __main__:   goodbye
16:37:48 [INFO] __main__: === Game Server starting ===
16:37:48 [INFO] __main__: Loading configuration …
16:37:48 [INFO] __main__:   items:        210 loaded from config
16:37:48 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:37:49 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:37:49 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:37:49 [INFO] __main__:   game_config:  loaded
16:37:49 [INFO] __main__: Initializing persistence …
16:37:49 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:37:49 [INFO] __main__:   database:     connected (gameserver.db)
16:37:49 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:37:46, version 1)
16:37:49 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:37:49 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:37:49 [INFO] __main__: Creating services …
16:37:49 [INFO] __main__:   upgrade_provider: 210 items registered
16:37:49 [INFO] __main__:   all services created
16:37:49 [INFO] __main__: Wiring event handlers …
16:37:49 [INFO] __main__:   event handlers registered
16:37:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:37:49 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:37:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:37:49 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:37:49 [INFO] __main__: Restored 2 empires from saved state
16:37:49 [INFO] __main__: Starting network server …
16:37:49 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:37:49 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:37:49 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:37:49 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:37:49 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:37:49 [INFO] __main__: Starting game loop …
16:37:49 [INFO] __main__:   game loop running (1 s tick)
16:37:49 [INFO] websockets.server: connection open
16:37:49 [INFO] gameserver.network.server: Session registered: uid=-1
16:37:49 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55795)
16:37:49 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:37:49 [INFO] gameserver.network.server: Session registered: uid=2
16:37:49 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:37:50 [INFO] gameserver.network.server: Session removed: uid=2
16:37:50 [INFO] websockets.server: connection open
16:37:50 [INFO] gameserver.network.server: Session registered: uid=-2
16:37:50 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55798)
16:37:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:37:50 [INFO] gameserver.network.server: Session registered: uid=2
16:37:50 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
16:38:05 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:05 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 6}
16:38:05 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:05 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 5}
16:38:05 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:05 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 4}
16:38:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:06 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 3}
16:38:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:06 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 0, 'artist': 0, 'free': 2}
16:38:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:06 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 6, 'scientist': 0, 'artist': 0, 'free': 1}
16:38:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:06 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 7, 'scientist': 0, 'artist': 0, 'free': 0}
16:38:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:06 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:38:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:06 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:38:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:06 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:38:07 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:07 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:38:07 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:07 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:38:07 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:07 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:38:07 [INFO] gameserver.network.handlers: change_citizen request from uid=2
16:38:07 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
16:45:13 [INFO] gameserver.network.server: Session removed: uid=2
16:45:13 [INFO] websockets.server: connection open
16:45:13 [INFO] gameserver.network.server: Session registered: uid=-3
16:45:13 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60228)
16:45:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:45:13 [INFO] gameserver.network.server: Session registered: uid=2
16:45:13 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
16:47:43 [INFO] gameserver.network.server: Session removed: uid=2
16:47:43 [INFO] websockets.server: connection open
16:47:43 [INFO] gameserver.network.server: Session registered: uid=-4
16:47:43 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 53192)
16:47:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:47:43 [INFO] gameserver.network.server: Session registered: uid=2
16:47:43 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
16:49:52 [INFO] __main__: Shutdown signal received — stopping …
16:49:53 [INFO] __main__: Shutting down …
16:49:53 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:49:53 [INFO] websockets.server: server closing
16:49:53 [INFO] gameserver.network.server: Session removed: uid=2
16:49:53 [INFO] websockets.server: server closed
16:49:53 [INFO] gameserver.network.server: WebSocket server stopped
16:49:53 [INFO] __main__:   WebSocket server stopped
16:49:53 [INFO] __main__:   debug dashboard stopped
16:49:53 [INFO] __main__:   database closed
16:49:53 [INFO] __main__:   goodbye
16:49:55 [INFO] __main__: === Game Server starting ===
16:49:55 [INFO] __main__: Loading configuration …
16:49:55 [INFO] __main__:   items:        210 loaded from config
16:49:56 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
16:49:56 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:49:56 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
16:49:56 [INFO] __main__:   game_config:  loaded
16:49:56 [INFO] __main__: Initializing persistence …
16:49:56 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:49:56 [INFO] __main__:   database:     connected (gameserver.db)
16:49:56 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T16:49:53, version 1)
16:49:56 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:49:56 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:49:56 [INFO] __main__: Creating services …
16:49:56 [INFO] __main__:   upgrade_provider: 210 items registered
16:49:56 [INFO] __main__:   all services created
16:49:56 [INFO] __main__: Wiring event handlers …
16:49:56 [INFO] __main__:   event handlers registered
16:49:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:49:56 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:49:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:49:56 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.01, 'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
16:49:56 [INFO] __main__: Restored 2 empires from saved state
16:49:56 [INFO] __main__: Starting network server …
16:49:56 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:49:56 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:49:56 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:49:56 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:49:56 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:49:56 [INFO] __main__: Starting game loop …
16:49:56 [INFO] __main__:   game loop running (1 s tick)
16:49:56 [INFO] websockets.server: connection open
16:49:56 [INFO] gameserver.network.server: Session registered: uid=-1
16:49:56 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63406)
16:49:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:49:56 [INFO] gameserver.network.server: Session registered: uid=2
16:49:56 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
16:49:57 [INFO] gameserver.network.server: Session removed: uid=2
16:49:57 [INFO] websockets.server: connection open
16:49:57 [INFO] gameserver.network.server: Session registered: uid=-2
16:49:57 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63411)
16:49:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:49:57 [INFO] gameserver.network.server: Session registered: uid=2
16:49:57 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
17:01:13 [INFO] gameserver.engine.empire_service: Empire 2: building BOW_MAKER completed
17:11:46 [INFO] gameserver.network.server: Session removed: uid=2
17:11:46 [INFO] websockets.server: connection open
17:11:46 [INFO] gameserver.network.server: Session registered: uid=-3
17:11:46 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 58824)
17:11:46 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:11:46 [INFO] gameserver.network.server: Session registered: uid=2
17:11:46 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
17:12:13 [INFO] gameserver.network.server: Session removed: uid=2
17:12:13 [INFO] websockets.server: connection open
17:12:13 [INFO] gameserver.network.server: Session registered: uid=-4
17:12:13 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 53561)
17:12:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:12:13 [INFO] gameserver.network.server: Session registered: uid=2
17:12:13 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
17:12:24 [INFO] __main__: Shutdown signal received — stopping …
17:12:25 [INFO] __main__: Shutting down …
17:12:25 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:12:25 [INFO] websockets.server: server closing
17:12:25 [INFO] gameserver.network.server: Session removed: uid=2
17:12:25 [INFO] websockets.server: server closed
17:12:25 [INFO] gameserver.network.server: WebSocket server stopped
17:12:25 [INFO] __main__:   WebSocket server stopped
17:12:25 [INFO] __main__:   debug dashboard stopped
17:12:25 [INFO] __main__:   database closed
17:12:25 [INFO] __main__:   goodbye
17:12:42 [INFO] __main__: === Game Server starting ===
17:12:42 [INFO] __main__: Loading configuration …
17:12:43 [INFO] __main__:   items:        210 loaded from config
17:12:43 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
17:12:43 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:12:43 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
17:12:43 [INFO] __main__:   game_config:  loaded
17:12:43 [INFO] __main__: Initializing persistence …
17:12:43 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:12:43 [INFO] __main__:   database:     connected (gameserver.db)
17:12:43 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T17:12:25, version 1)
17:12:43 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
17:12:43 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
17:12:43 [INFO] __main__: Creating services …
17:12:43 [INFO] __main__:   upgrade_provider: 210 items registered
17:12:43 [INFO] __main__:   all services created
17:12:43 [INFO] __main__: Wiring event handlers …
17:12:43 [INFO] __main__:   event handlers registered
17:12:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:12:43 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:12:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:12:43 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.01, 'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
17:12:43 [INFO] __main__: Restored 2 empires from saved state
17:12:43 [INFO] __main__: Starting network server …
17:12:43 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:12:43 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:12:43 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:12:43 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:12:43 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:12:43 [INFO] __main__: Starting game loop …
17:12:43 [INFO] __main__:   game loop running (1 s tick)
17:12:45 [INFO] websockets.server: connection open
17:12:45 [INFO] gameserver.network.server: Session registered: uid=-1
17:12:45 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53590)
17:12:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:12:45 [INFO] gameserver.network.server: Session registered: uid=2
17:12:45 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
17:13:17 [INFO] __main__: Shutdown signal received — stopping …
17:13:17 [INFO] __main__: Shutting down …
17:13:17 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:13:17 [INFO] websockets.server: server closing
17:13:17 [INFO] gameserver.network.server: Session removed: uid=2
17:13:17 [INFO] websockets.server: server closed
17:13:17 [INFO] gameserver.network.server: WebSocket server stopped
17:13:17 [INFO] __main__:   WebSocket server stopped
17:13:17 [INFO] __main__:   debug dashboard stopped
17:13:17 [INFO] __main__:   database closed
17:13:17 [INFO] __main__:   goodbye
17:13:19 [INFO] __main__: === Game Server starting ===
17:13:19 [INFO] __main__: Loading configuration …
17:13:20 [INFO] __main__:   items:        210 loaded from config
17:13:20 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
17:13:20 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:13:20 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
17:13:20 [INFO] __main__:   game_config:  loaded
17:13:20 [INFO] __main__: Initializing persistence …
17:13:20 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:13:20 [INFO] __main__:   database:     connected (gameserver.db)
17:13:20 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T17:13:17, version 1)
17:13:20 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
17:13:20 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
17:13:20 [INFO] __main__: Creating services …
17:13:20 [INFO] __main__:   upgrade_provider: 210 items registered
17:13:20 [INFO] __main__:   all services created
17:13:20 [INFO] __main__: Wiring event handlers …
17:13:20 [INFO] __main__:   event handlers registered
17:13:20 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:13:20 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:13:20 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:13:20 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.15000000000000002, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'build_speed_modifier': 0.1}
17:13:20 [INFO] __main__: Restored 2 empires from saved state
17:13:20 [INFO] __main__: Starting network server …
17:13:20 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:13:20 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:13:20 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:13:20 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:13:20 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:13:20 [INFO] __main__: Starting game loop …
17:13:20 [INFO] __main__:   game loop running (1 s tick)
17:13:20 [INFO] websockets.server: connection open
17:13:20 [INFO] gameserver.network.server: Session registered: uid=-1
17:13:20 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49435)
17:13:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:13:20 [INFO] gameserver.network.server: Session registered: uid=2
17:13:20 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
17:14:30 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
17:14:30 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 1522.9, have 1438.2)
17:16:09 [INFO] gameserver.network.server: Session removed: uid=2
17:16:09 [INFO] websockets.server: connection open
17:16:09 [INFO] gameserver.network.server: Session registered: uid=-2
17:16:09 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62467)
17:16:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:16:09 [INFO] gameserver.network.server: Session registered: uid=2
17:16:09 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
17:16:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 6, 'scientist': 0, 'artist': 0, 'free': 1}
17:16:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 0, 'artist': 0, 'free': 2}
17:16:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 0, 'artist': 0, 'free': 3}
17:16:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 0, 'artist': 0, 'free': 4}
17:16:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 0, 'artist': 0, 'free': 5}
17:16:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 0, 'artist': 0, 'free': 6}
17:16:42 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:42 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
17:16:43 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:43 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 6}
17:16:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:44 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 2, 'artist': 0, 'free': 5}
17:16:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:44 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 3, 'artist': 0, 'free': 4}
17:16:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:44 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 4, 'artist': 0, 'free': 3}
17:16:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:44 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 5, 'artist': 0, 'free': 2}
17:16:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:44 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 6, 'artist': 0, 'free': 1}
17:16:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:44 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 7, 'artist': 0, 'free': 0}
17:16:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:44 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
17:16:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:16:45 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
17:18:31 [INFO] gameserver.network.server: Session removed: uid=2
17:18:31 [INFO] websockets.server: connection open
17:18:31 [INFO] gameserver.network.server: Session registered: uid=-3
17:18:31 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 56303)
17:18:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:18:31 [INFO] gameserver.network.server: Session registered: uid=2
17:18:31 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
17:18:47 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:47 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 6, 'artist': 0, 'free': 1}
17:18:47 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:47 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 5, 'artist': 0, 'free': 2}
17:18:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 4, 'artist': 0, 'free': 3}
17:18:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 3, 'artist': 0, 'free': 4}
17:18:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 2, 'artist': 0, 'free': 5}
17:18:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 6}
17:18:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
17:18:50 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:50 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 6}
17:18:52 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:52 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
17:18:59 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:18:59 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 6}
17:19:01 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:19:01 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
17:19:18 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:19:18 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 6}
17:20:03 [INFO] gameserver.network.server: Session removed: uid=2
17:20:03 [INFO] websockets.server: connection open
17:20:03 [INFO] gameserver.network.server: Session registered: uid=-4
17:20:03 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 52342)
17:20:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:20:03 [INFO] gameserver.network.server: Session registered: uid=2
17:20:03 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
17:20:07 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:20:07 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
17:20:35 [INFO] gameserver.network.server: Session removed: uid=2
17:20:35 [INFO] websockets.server: connection open
17:20:35 [INFO] gameserver.network.server: Session registered: uid=-5
17:20:35 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 50905)
17:20:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:20:35 [INFO] gameserver.network.server: Session registered: uid=2
17:20:35 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
17:20:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:20:44 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 0, 'free': 6}
17:20:46 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:20:46 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
17:20:47 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:20:47 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 6}
17:20:49 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:20:49 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 0, 'free': 7}
17:36:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 1, 'free': 6}
17:36:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:35 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 2, 'free': 5}
17:36:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:35 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 0, 'artist': 3, 'free': 4}
17:36:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:35 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 1, 'artist': 3, 'free': 3}
17:36:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:35 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 2, 'artist': 3, 'free': 2}
17:36:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:35 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 0, 'scientist': 3, 'artist': 3, 'free': 1}
17:36:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:36 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 1, 'scientist': 3, 'artist': 3, 'free': 0}
17:36:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:36 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
17:36:36 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:36 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 7, got 8)
17:36:39 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
17:36:39 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
17:36:41 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:36:41 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 3, 'free': 0}
17:36:46 [INFO] gameserver.engine.empire_service: Empire 2: started building EXCHANGE_POST (effort=1500.0)
17:36:46 [INFO] gameserver.network.handlers: new_item success uid=2 iid=EXCHANGE_POST
17:39:06 [INFO] gameserver.network.server: Session removed: uid=2
17:39:06 [INFO] websockets.server: connection open
17:39:06 [INFO] gameserver.network.server: Session registered: uid=-6
17:39:06 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 56695)
17:39:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:39:06 [INFO] gameserver.network.server: Session registered: uid=2
17:39:06 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
17:39:48 [INFO] gameserver.network.server: Session removed: uid=2
17:39:48 [INFO] websockets.server: connection open
17:39:48 [INFO] gameserver.network.server: Session registered: uid=-7
17:39:48 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 53061)
17:39:48 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:39:48 [INFO] gameserver.network.server: Session registered: uid=2
17:39:48 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
17:40:19 [INFO] gameserver.network.server: Session removed: uid=2
17:40:19 [INFO] websockets.server: connection open
17:40:19 [INFO] gameserver.network.server: Session registered: uid=-8
17:40:19 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 53097)
17:40:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:40:19 [INFO] gameserver.network.server: Session registered: uid=2
17:40:19 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
17:42:27 [INFO] websockets.server: connection open
17:42:27 [INFO] gameserver.network.server: Session registered: uid=-9
17:42:27 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('127.0.0.1', 48228)
17:42:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:42:31 [INFO] gameserver.network.server: Session registered: uid=2
17:42:31 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
17:42:31 [INFO] gameserver.network.server: Client disconnected: uid=-8 code=1008
17:42:31 [INFO] gameserver.network.server: Session removed: uid=2
17:42:34 [INFO] websockets.server: connection open
17:42:34 [INFO] gameserver.network.server: Session registered: uid=-10
17:42:34 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 64305)
17:42:34 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:42:34 [INFO] gameserver.network.server: Session registered: uid=2
17:42:34 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
17:43:13 [INFO] gameserver.engine.empire_service: Empire 2: applied effects for EXCHANGE_POST: {'gold_modifier': 0.1, 'gold_offset': 0.05}
17:43:13 [INFO] gameserver.engine.empire_service: Empire 2: building EXCHANGE_POST completed
17:43:37 [INFO] gameserver.network.server: Client disconnected: uid=-9 code=CloseCode.ABNORMAL_CLOSURE
17:43:37 [INFO] gameserver.network.server: Session removed: uid=2
17:43:45 [INFO] websockets.server: connection open
17:43:45 [INFO] gameserver.network.server: Session registered: uid=-11
17:43:45 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('127.0.0.1', 48294)
17:43:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:43:45 [INFO] gameserver.network.server: Session registered: uid=2
17:43:45 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
17:50:12 [INFO] __main__: Shutdown signal received — stopping …
17:50:13 [INFO] __main__: Shutting down …
17:50:13 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:50:13 [INFO] websockets.server: server closing
17:50:13 [INFO] gameserver.network.server: Session removed: uid=2
17:50:13 [INFO] gameserver.network.server: Session removed: uid=2
17:50:13 [INFO] websockets.server: server closed
17:50:13 [INFO] gameserver.network.server: WebSocket server stopped
17:50:13 [INFO] __main__:   WebSocket server stopped
17:50:13 [INFO] __main__:   debug dashboard stopped
17:50:13 [INFO] __main__:   database closed
17:50:13 [INFO] __main__:   goodbye
17:53:53 [INFO] __main__: === Game Server starting ===
17:53:53 [INFO] __main__: Loading configuration …
17:53:54 [INFO] __main__:   items:        210 loaded from config
17:53:54 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
17:53:54 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:53:54 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
17:53:54 [INFO] __main__:   game_config:  loaded
17:53:54 [INFO] __main__: Initializing persistence …
17:53:54 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:53:54 [INFO] __main__:   database:     connected (gameserver.db)
17:53:54 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T17:53:52, version 1)
17:53:54 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
17:53:54 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
17:53:54 [INFO] __main__: Creating services …
17:53:54 [INFO] __main__:   upgrade_provider: 210 items registered
17:53:54 [INFO] __main__:   all services created
17:53:54 [INFO] __main__: Wiring event handlers …
17:53:54 [INFO] __main__:   event handlers registered
17:53:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:53:54 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:53:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:53:54 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:53:54 [INFO] __main__: Restored 2 empires from saved state
17:53:54 [INFO] __main__: Starting network server …
17:53:54 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:53:54 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:53:54 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:53:54 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:53:54 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:53:54 [INFO] __main__: Starting game loop …
17:53:54 [INFO] __main__:   game loop running (1 s tick)
17:53:55 [INFO] websockets.server: connection open
17:53:55 [INFO] gameserver.network.server: Session registered: uid=-1
17:53:55 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('127.0.0.1', 48580)
17:53:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:53:55 [INFO] gameserver.network.server: Session registered: uid=2
17:53:55 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
17:56:35 [INFO] gameserver.network.server: Client disconnected: uid=-1 code=CloseCode.ABNORMAL_CLOSURE
17:56:35 [INFO] gameserver.network.server: Session removed: uid=2
17:57:46 [INFO] __main__: Shutdown signal received — stopping …
17:57:46 [INFO] __main__: Shutting down …
17:57:46 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:57:46 [INFO] websockets.server: server closing
17:57:46 [INFO] websockets.server: server closed
17:57:46 [INFO] gameserver.network.server: WebSocket server stopped
17:57:46 [INFO] __main__:   WebSocket server stopped
17:57:46 [INFO] __main__:   debug dashboard stopped
17:57:46 [INFO] __main__:   database closed
17:57:46 [INFO] __main__:   goodbye
17:57:48 [INFO] __main__: === Game Server starting ===
17:57:48 [INFO] __main__: Loading configuration …
17:57:48 [INFO] __main__:   items:        210 loaded from config
17:57:48 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
17:57:48 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:57:49 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
17:57:49 [INFO] __main__:   game_config:  loaded
17:57:49 [INFO] __main__: Initializing persistence …
17:57:49 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:57:49 [INFO] __main__:   database:     connected (gameserver.db)
17:57:49 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T17:57:46, version 1)
17:57:49 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
17:57:49 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
17:57:49 [INFO] __main__: Creating services …
17:57:49 [INFO] __main__:   upgrade_provider: 210 items registered
17:57:49 [INFO] __main__:   all services created
17:57:49 [INFO] __main__: Wiring event handlers …
17:57:49 [INFO] __main__:   event handlers registered
17:57:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:57:49 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:57:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:57:49 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:57:49 [INFO] __main__: Restored 2 empires from saved state
17:57:49 [INFO] __main__: Starting network server …
17:57:49 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:57:49 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:57:49 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:57:49 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:57:49 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:57:49 [INFO] __main__: Starting game loop …
17:57:49 [INFO] __main__:   game loop running (1 s tick)
17:58:53 [INFO] websockets.server: connection open
17:58:53 [INFO] gameserver.network.server: Session registered: uid=-1
17:58:53 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51165)
17:58:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:58:57 [INFO] gameserver.network.server: Session registered: uid=2
17:58:57 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:01:02 [INFO] gameserver.network.server: Session removed: uid=2
18:01:03 [INFO] websockets.server: connection open
18:01:03 [INFO] gameserver.network.server: Session registered: uid=-2
18:01:03 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62795)
18:01:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:01:03 [INFO] gameserver.network.server: Session registered: uid=2
18:01:03 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:01:24 [INFO] websockets.server: connection open
18:01:24 [INFO] gameserver.network.server: Session registered: uid=-3
18:01:24 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('127.0.0.1', 48720)
18:01:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:01:24 [INFO] gameserver.network.server: Session registered: uid=2
18:01:24 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:01:24 [INFO] gameserver.network.server: Client disconnected: uid=-2 code=1008
18:01:24 [INFO] gameserver.network.server: Session removed: uid=2
18:01:27 [INFO] websockets.server: connection open
18:01:27 [INFO] gameserver.network.server: Session registered: uid=-4
18:01:27 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 58121)
18:01:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:01:27 [INFO] gameserver.network.server: Session registered: uid=2
18:01:27 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:03:20 [INFO] gameserver.network.server: Session removed: uid=2
18:04:47 [INFO] websockets.server: connection open
18:04:47 [INFO] gameserver.network.server: Session registered: uid=-5
18:04:47 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 63059)
18:04:47 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:04:47 [INFO] gameserver.network.server: Session registered: uid=2
18:04:47 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
18:05:02 [INFO] gameserver.network.server: Session removed: uid=2
18:05:02 [INFO] websockets.server: connection open
18:05:02 [INFO] gameserver.network.server: Session registered: uid=-6
18:05:02 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 56149)
18:05:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:05:02 [INFO] gameserver.network.server: Session registered: uid=2
18:05:02 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
18:05:38 [INFO] gameserver.network.server: Session removed: uid=2
18:05:39 [INFO] websockets.server: connection open
18:05:39 [INFO] gameserver.network.server: Session registered: uid=-7
18:05:39 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 56169)
18:05:39 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:05:39 [INFO] gameserver.network.server: Session registered: uid=2
18:05:39 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
18:05:41 [INFO] gameserver.network.server: Session removed: uid=2
18:05:41 [INFO] websockets.server: connection open
18:05:41 [INFO] gameserver.network.server: Session registered: uid=-8
18:05:41 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 56172)
18:05:41 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:05:41 [INFO] gameserver.network.server: Session registered: uid=2
18:05:41 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
18:06:18 [INFO] gameserver.network.server: Session removed: uid=2
18:06:18 [INFO] websockets.server: connection open
18:06:18 [INFO] gameserver.network.server: Session registered: uid=-9
18:06:18 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 50348)
18:06:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:06:18 [INFO] gameserver.network.server: Session registered: uid=2
18:06:18 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
18:06:42 [INFO] gameserver.network.server: Session removed: uid=2
18:06:42 [INFO] websockets.server: connection open
18:06:42 [INFO] gameserver.network.server: Session registered: uid=-10
18:06:42 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 52321)
18:06:42 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:06:42 [INFO] gameserver.network.server: Session registered: uid=2
18:06:42 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
18:08:34 [INFO] gameserver.network.server: Client disconnected: uid=-3 code=CloseCode.ABNORMAL_CLOSURE
18:08:34 [INFO] gameserver.network.server: Session removed: uid=2
18:09:11 [INFO] gameserver.network.server: Session removed: uid=2
18:09:11 [INFO] websockets.server: connection open
18:09:11 [INFO] gameserver.network.server: Session registered: uid=-11
18:09:11 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('192.168.178.2', 49437)
18:09:11 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:09:11 [INFO] gameserver.network.server: Session registered: uid=2
18:09:11 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
18:09:23 [INFO] __main__: Shutdown signal received — stopping …
18:09:24 [INFO] __main__: Shutting down …
18:09:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:09:24 [INFO] websockets.server: server closing
18:09:24 [INFO] gameserver.network.server: Session removed: uid=2
18:09:24 [INFO] websockets.server: server closed
18:09:24 [INFO] gameserver.network.server: WebSocket server stopped
18:09:24 [INFO] __main__:   WebSocket server stopped
18:09:24 [INFO] __main__:   debug dashboard stopped
18:09:24 [INFO] __main__:   database closed
18:09:24 [INFO] __main__:   goodbye
18:09:25 [INFO] __main__: === Game Server starting ===
18:09:25 [INFO] __main__: Loading configuration …
18:09:26 [INFO] __main__:   items:        210 loaded from config
18:09:26 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:09:26 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:09:26 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:09:26 [INFO] __main__:   game_config:  loaded
18:09:26 [INFO] __main__: Initializing persistence …
18:09:26 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:09:26 [INFO] __main__:   database:     connected (gameserver.db)
18:09:26 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:09:24, version 1)
18:09:26 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:09:26 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:09:26 [INFO] __main__: Creating services …
18:09:26 [INFO] __main__:   upgrade_provider: 210 items registered
18:09:26 [INFO] __main__:   all services created
18:09:26 [INFO] __main__: Wiring event handlers …
18:09:26 [INFO] __main__:   event handlers registered
18:09:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:09:26 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:09:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:09:26 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:09:26 [INFO] __main__: Restored 2 empires from saved state
18:09:26 [INFO] __main__: Starting network server …
18:09:26 [INFO] gameserver.network.handlers: Registered 29 message handlers: summary_request, item_request, military_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:09:26 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:09:26 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:09:26 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:09:26 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:09:26 [INFO] __main__: Starting game loop …
18:09:26 [INFO] __main__:   game loop running (1 s tick)
18:09:27 [INFO] websockets.server: connection open
18:09:27 [INFO] gameserver.network.server: Session registered: uid=-1
18:09:27 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49441)
18:09:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:09:27 [INFO] gameserver.network.server: Session registered: uid=2
18:09:27 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:09:28 [INFO] gameserver.network.server: Session removed: uid=2
18:09:28 [INFO] websockets.server: connection open
18:09:28 [INFO] gameserver.network.server: Session registered: uid=-2
18:09:28 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 49450)
18:09:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:09:28 [INFO] gameserver.network.server: Session registered: uid=2
18:09:28 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:12:44 [INFO] gameserver.network.server: Session removed: uid=2
18:12:44 [INFO] websockets.server: connection open
18:12:44 [INFO] gameserver.network.server: Session registered: uid=-3
18:12:44 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 64715)
18:12:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:12:44 [INFO] gameserver.network.server: Session registered: uid=2
18:12:44 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:12:49 [INFO] __main__: Shutdown signal received — stopping …
18:12:49 [INFO] __main__: Shutting down …
18:12:49 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:12:49 [INFO] websockets.server: server closing
18:12:49 [INFO] gameserver.network.server: Session removed: uid=2
18:12:49 [INFO] websockets.server: server closed
18:12:49 [INFO] gameserver.network.server: WebSocket server stopped
18:12:49 [INFO] __main__:   WebSocket server stopped
18:12:49 [INFO] __main__:   debug dashboard stopped
18:12:49 [INFO] __main__:   database closed
18:12:49 [INFO] __main__:   goodbye
18:12:51 [INFO] __main__: === Game Server starting ===
18:12:51 [INFO] __main__: Loading configuration …
18:12:52 [INFO] __main__:   items:        210 loaded from config
18:12:52 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:12:52 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:12:52 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:12:52 [INFO] __main__:   game_config:  loaded
18:12:52 [INFO] __main__: Initializing persistence …
18:12:52 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:12:52 [INFO] __main__:   database:     connected (gameserver.db)
18:12:52 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:12:49, version 1)
18:12:52 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:12:52 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:12:52 [INFO] __main__: Creating services …
18:12:52 [INFO] __main__:   upgrade_provider: 210 items registered
18:12:52 [INFO] __main__:   all services created
18:12:52 [INFO] __main__: Wiring event handlers …
18:12:52 [INFO] __main__:   event handlers registered
18:12:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:12:52 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:12:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:12:52 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:12:52 [INFO] __main__: Restored 2 empires from saved state
18:12:52 [INFO] __main__: Starting network server …
18:12:52 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:12:52 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:12:52 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:12:52 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:12:52 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:12:52 [INFO] __main__: Starting game loop …
18:12:52 [INFO] __main__:   game loop running (1 s tick)
18:12:52 [INFO] websockets.server: connection open
18:12:52 [INFO] gameserver.network.server: Session registered: uid=-1
18:12:52 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59608)
18:12:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:12:52 [INFO] gameserver.network.server: Session registered: uid=2
18:12:52 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:12:54 [INFO] gameserver.network.server: Session removed: uid=2
18:12:54 [INFO] websockets.server: connection open
18:12:54 [INFO] gameserver.network.server: Session registered: uid=-2
18:12:54 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 53051)
18:12:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:12:54 [INFO] gameserver.network.server: Session registered: uid=2
18:12:54 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:12:57 [INFO] gameserver.network.server: Session removed: uid=2
18:12:58 [INFO] websockets.server: connection open
18:12:58 [INFO] gameserver.network.server: Session registered: uid=-3
18:12:58 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 53079)
18:12:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:12:58 [INFO] gameserver.network.server: Session registered: uid=2
18:12:58 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:13:13 [ERROR] gameserver.network.server: Handler error: type=map_save_request uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 65, in route
    return await handler(message, sender_uid)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 686, in handle_map_save_request
    svc.persistence.save_state()
AttributeError: 'Services' object has no attribute 'persistence'
18:13:21 [ERROR] gameserver.network.server: Handler error: type=map_save_request uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 65, in route
    return await handler(message, sender_uid)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 686, in handle_map_save_request
    svc.persistence.save_state()
AttributeError: 'Services' object has no attribute 'persistence'
18:16:50 [ERROR] gameserver.network.server: Handler error: type=map_save_request uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 65, in route
    return await handler(message, sender_uid)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 686, in handle_map_save_request
    svc.persistence.save_state()
AttributeError: 'Services' object has no attribute 'persistence'
18:16:54 [ERROR] gameserver.network.server: Handler error: type=map_save_request uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 65, in route
    return await handler(message, sender_uid)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 686, in handle_map_save_request
    svc.persistence.save_state()
AttributeError: 'Services' object has no attribute 'persistence'
18:19:55 [INFO] __main__: Shutdown signal received — stopping …
18:19:55 [INFO] __main__: Shutting down …
18:19:55 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:19:55 [INFO] websockets.server: server closing
18:19:55 [INFO] gameserver.network.server: Session removed: uid=2
18:19:55 [INFO] websockets.server: server closed
18:19:55 [INFO] gameserver.network.server: WebSocket server stopped
18:19:55 [INFO] __main__:   WebSocket server stopped
18:19:55 [INFO] __main__:   debug dashboard stopped
18:19:55 [INFO] __main__:   database closed
18:19:55 [INFO] __main__:   goodbye
18:19:57 [INFO] __main__: === Game Server starting ===
18:19:57 [INFO] __main__: Loading configuration …
18:19:58 [INFO] __main__:   items:        210 loaded from config
18:19:58 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:19:58 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:19:58 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:19:58 [INFO] __main__:   game_config:  loaded
18:19:58 [INFO] __main__: Initializing persistence …
18:19:58 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:19:58 [INFO] __main__:   database:     connected (gameserver.db)
18:19:58 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:19:55, version 1)
18:19:58 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:19:58 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:19:58 [INFO] __main__: Creating services …
18:19:58 [INFO] __main__:   upgrade_provider: 210 items registered
18:19:58 [INFO] __main__:   all services created
18:19:58 [INFO] __main__: Wiring event handlers …
18:19:58 [INFO] __main__:   event handlers registered
18:19:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:19:58 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:19:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:19:58 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:19:58 [INFO] __main__: Restored 2 empires from saved state
18:19:58 [INFO] __main__: Starting network server …
18:19:58 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:19:58 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:19:58 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:19:58 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:19:58 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:19:58 [INFO] __main__: Starting game loop …
18:19:58 [INFO] __main__:   game loop running (1 s tick)
18:19:58 [INFO] websockets.server: connection open
18:19:58 [INFO] gameserver.network.server: Session registered: uid=-1
18:19:58 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50960)
18:19:59 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:19:59 [INFO] gameserver.network.server: Session registered: uid=2
18:19:59 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:20:20 [INFO] gameserver.network.server: Session removed: uid=2
18:20:20 [INFO] websockets.server: connection open
18:20:20 [INFO] gameserver.network.server: Session registered: uid=-2
18:20:20 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 49190)
18:20:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:20:20 [INFO] gameserver.network.server: Session registered: uid=2
18:20:20 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:20:36 [INFO] gameserver.network.server: Session removed: uid=2
18:20:36 [INFO] websockets.server: connection open
18:20:36 [INFO] gameserver.network.server: Session registered: uid=-3
18:20:36 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 56622)
18:20:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:20:36 [INFO] gameserver.network.server: Session registered: uid=2
18:20:36 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:21:50 [ERROR] gameserver.network.server: Handler error: type=map_save_request uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 65, in route
    return await handler(message, sender_uid)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 686, in handle_map_save_request
    svc.persistence.save_state()
AttributeError: 'Services' object has no attribute 'persistence'
18:21:51 [ERROR] gameserver.network.server: Handler error: type=map_save_request uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 65, in route
    return await handler(message, sender_uid)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 686, in handle_map_save_request
    svc.persistence.save_state()
AttributeError: 'Services' object has no attribute 'persistence'
18:23:06 [INFO] __main__: Shutdown signal received — stopping …
18:23:07 [INFO] __main__: Shutting down …
18:23:07 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:23:07 [INFO] websockets.server: server closing
18:23:07 [INFO] gameserver.network.server: Session removed: uid=2
18:23:07 [INFO] websockets.server: server closed
18:23:07 [INFO] gameserver.network.server: WebSocket server stopped
18:23:07 [INFO] __main__:   WebSocket server stopped
18:23:07 [INFO] __main__:   debug dashboard stopped
18:23:07 [INFO] __main__:   database closed
18:23:07 [INFO] __main__:   goodbye
18:23:28 [INFO] __main__: === Game Server starting ===
18:23:28 [INFO] __main__: Loading configuration …
18:23:29 [INFO] __main__:   items:        210 loaded from config
18:23:29 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:23:29 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:23:29 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:23:29 [INFO] __main__:   game_config:  loaded
18:23:29 [INFO] __main__: Initializing persistence …
18:23:29 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:23:29 [INFO] __main__:   database:     connected (gameserver.db)
18:23:29 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:23:27, version 1)
18:23:29 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:23:29 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:23:29 [INFO] __main__: Creating services …
18:23:29 [INFO] __main__:   upgrade_provider: 210 items registered
18:23:29 [INFO] __main__:   all services created
18:23:29 [INFO] __main__: Wiring event handlers …
18:23:29 [INFO] __main__:   event handlers registered
18:23:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:23:29 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:23:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:23:29 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:23:29 [INFO] __main__: Restored 2 empires from saved state
18:23:29 [INFO] __main__: Starting network server …
18:23:29 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:23:29 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:23:29 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:23:29 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:23:29 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:23:29 [INFO] __main__: Starting game loop …
18:23:29 [INFO] __main__:   game loop running (1 s tick)
18:23:30 [INFO] websockets.server: connection open
18:23:30 [INFO] gameserver.network.server: Session registered: uid=-1
18:23:30 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56553)
18:23:30 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:23:30 [INFO] gameserver.network.server: Session registered: uid=2
18:23:30 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:23:58 [INFO] gameserver.network.server: Session removed: uid=2
18:23:58 [INFO] websockets.server: connection open
18:23:58 [INFO] gameserver.network.server: Session registered: uid=-2
18:23:58 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 56568)
18:23:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:23:58 [INFO] gameserver.network.server: Session registered: uid=2
18:23:58 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:24:08 [ERROR] gameserver.network.handlers: [Composer] save error: 'dict' object is not callable
18:24:08 [ERROR] gameserver.network.handlers: [Composer] save error: 'dict' object is not callable
18:24:20 [INFO] __main__: Shutdown signal received — stopping …
18:24:20 [INFO] __main__: Shutting down …
18:24:20 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:24:20 [INFO] websockets.server: server closing
18:24:20 [INFO] gameserver.network.server: Session removed: uid=2
18:24:20 [INFO] websockets.server: server closed
18:24:20 [INFO] gameserver.network.server: WebSocket server stopped
18:24:20 [INFO] __main__:   WebSocket server stopped
18:24:20 [INFO] __main__:   debug dashboard stopped
18:24:20 [INFO] __main__:   database closed
18:24:20 [INFO] __main__:   goodbye
18:24:21 [INFO] __main__: === Game Server starting ===
18:24:21 [INFO] __main__: Loading configuration …
18:24:22 [INFO] __main__:   items:        210 loaded from config
18:24:22 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:24:22 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:24:22 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:24:22 [INFO] __main__:   game_config:  loaded
18:24:22 [INFO] __main__: Initializing persistence …
18:24:22 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:24:22 [INFO] __main__:   database:     connected (gameserver.db)
18:24:22 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:24:20, version 1)
18:24:22 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:24:22 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:24:22 [INFO] __main__: Creating services …
18:24:22 [INFO] __main__:   upgrade_provider: 210 items registered
18:24:22 [INFO] __main__:   all services created
18:24:22 [INFO] __main__: Wiring event handlers …
18:24:22 [INFO] __main__:   event handlers registered
18:24:22 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:24:22 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:24:22 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:24:22 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:24:22 [INFO] __main__: Restored 2 empires from saved state
18:24:22 [INFO] __main__: Starting network server …
18:24:22 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:24:22 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:24:22 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:24:22 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:24:22 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:24:22 [INFO] __main__: Starting game loop …
18:24:22 [INFO] __main__:   game loop running (1 s tick)
18:24:24 [INFO] websockets.server: connection open
18:24:24 [INFO] gameserver.network.server: Session registered: uid=-1
18:24:24 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51204)
18:24:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:24:24 [INFO] gameserver.network.server: Session registered: uid=2
18:24:24 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:26:07 [INFO] __main__: Shutdown signal received — stopping …
18:26:07 [INFO] __main__: Shutting down …
18:26:07 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:26:07 [INFO] websockets.server: server closing
18:26:07 [INFO] gameserver.network.server: Session removed: uid=2
18:26:07 [INFO] websockets.server: server closed
18:26:07 [INFO] gameserver.network.server: WebSocket server stopped
18:26:07 [INFO] __main__:   WebSocket server stopped
18:26:07 [INFO] __main__:   debug dashboard stopped
18:26:07 [INFO] __main__:   database closed
18:26:07 [INFO] __main__:   goodbye
18:26:10 [INFO] __main__: === Game Server starting ===
18:26:10 [INFO] __main__: Loading configuration …
18:26:10 [INFO] __main__:   items:        210 loaded from config
18:26:10 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:26:10 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:26:10 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:26:10 [INFO] __main__:   game_config:  loaded
18:26:10 [INFO] __main__: Initializing persistence …
18:26:10 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:26:10 [INFO] __main__:   database:     connected (gameserver.db)
18:26:10 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:26:07, version 1)
18:26:10 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:26:10 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:26:10 [INFO] __main__: Creating services …
18:26:10 [INFO] __main__:   upgrade_provider: 210 items registered
18:26:10 [INFO] __main__:   all services created
18:26:10 [INFO] __main__: Wiring event handlers …
18:26:10 [INFO] __main__:   event handlers registered
18:26:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:26:10 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:26:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:26:10 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:26:10 [INFO] __main__: Restored 2 empires from saved state
18:26:10 [INFO] __main__: Starting network server …
18:26:10 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:26:10 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:26:10 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:26:10 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:26:10 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:26:10 [INFO] __main__: Starting game loop …
18:26:10 [INFO] __main__:   game loop running (1 s tick)
18:26:10 [INFO] websockets.server: connection open
18:26:10 [INFO] gameserver.network.server: Session registered: uid=-1
18:26:10 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51251)
18:26:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:26:10 [INFO] gameserver.network.server: Session registered: uid=2
18:26:10 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:26:18 [INFO] gameserver.network.server: Session removed: uid=2
18:26:18 [INFO] websockets.server: connection open
18:26:18 [INFO] gameserver.network.server: Session registered: uid=-2
18:26:18 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 51264)
18:26:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:26:18 [INFO] gameserver.network.server: Session registered: uid=2
18:26:18 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:26:26 [INFO] gameserver.network.server: Session removed: uid=2
18:26:26 [INFO] websockets.server: connection open
18:26:26 [INFO] gameserver.network.server: Session registered: uid=-3
18:26:26 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 51267)
18:26:26 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:26:26 [INFO] gameserver.network.server: Session registered: uid=2
18:26:26 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:26:28 [INFO] gameserver.network.server: Session removed: uid=2
18:26:28 [INFO] websockets.server: connection open
18:26:28 [INFO] gameserver.network.server: Session registered: uid=-4
18:26:28 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 51270)
18:26:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:26:28 [INFO] gameserver.network.server: Session registered: uid=2
18:26:28 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:26:28 [INFO] gameserver.network.server: Session removed: uid=2
18:26:28 [INFO] websockets.server: connection open
18:26:28 [INFO] gameserver.network.server: Session registered: uid=-5
18:26:28 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 51272)
18:26:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:26:28 [INFO] gameserver.network.server: Session registered: uid=2
18:26:28 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
18:26:29 [INFO] gameserver.network.server: Session removed: uid=2
18:26:29 [INFO] websockets.server: connection open
18:26:29 [INFO] gameserver.network.server: Session registered: uid=-6
18:26:29 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 51274)
18:26:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:26:29 [INFO] gameserver.network.server: Session registered: uid=2
18:26:29 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
18:27:05 [INFO] gameserver.network.server: Session removed: uid=2
18:27:05 [INFO] websockets.server: connection open
18:27:05 [INFO] gameserver.network.server: Session registered: uid=-7
18:27:05 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 63613)
18:27:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:05 [INFO] gameserver.network.server: Session registered: uid=2
18:27:05 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
18:27:05 [INFO] gameserver.network.server: Session removed: uid=2
18:27:05 [INFO] websockets.server: connection open
18:27:05 [INFO] gameserver.network.server: Session registered: uid=-8
18:27:05 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 63615)
18:27:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:05 [INFO] gameserver.network.server: Session registered: uid=2
18:27:05 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
18:27:06 [INFO] gameserver.network.server: Session removed: uid=2
18:27:06 [INFO] websockets.server: connection open
18:27:06 [INFO] gameserver.network.server: Session registered: uid=-9
18:27:06 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 63617)
18:27:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:06 [INFO] gameserver.network.server: Session registered: uid=2
18:27:06 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
18:27:06 [INFO] gameserver.network.server: Session removed: uid=2
18:27:06 [INFO] websockets.server: connection open
18:27:06 [INFO] gameserver.network.server: Session registered: uid=-10
18:27:06 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 63619)
18:27:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:06 [INFO] gameserver.network.server: Session registered: uid=2
18:27:06 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
18:27:06 [INFO] gameserver.network.server: Session removed: uid=2
18:27:06 [INFO] websockets.server: connection open
18:27:06 [INFO] gameserver.network.server: Session registered: uid=-11
18:27:06 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('192.168.178.2', 63621)
18:27:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:06 [INFO] gameserver.network.server: Session registered: uid=2
18:27:06 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
18:27:06 [INFO] gameserver.network.server: Session removed: uid=2
18:27:06 [INFO] websockets.server: connection open
18:27:06 [INFO] gameserver.network.server: Session registered: uid=-12
18:27:06 [INFO] gameserver.network.server: Client connected: uid=-12 remote=('192.168.178.2', 63623)
18:27:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:06 [INFO] gameserver.network.server: Session registered: uid=2
18:27:06 [INFO] gameserver.network.server: Session upgraded: guest=-12 → uid=2
18:27:18 [INFO] gameserver.network.server: Session removed: uid=2
18:27:19 [INFO] websockets.server: connection open
18:27:19 [INFO] gameserver.network.server: Session registered: uid=-13
18:27:19 [INFO] gameserver.network.server: Client connected: uid=-13 remote=('192.168.178.2', 63628)
18:27:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:19 [INFO] gameserver.network.server: Session registered: uid=2
18:27:19 [INFO] gameserver.network.server: Session upgraded: guest=-13 → uid=2
18:27:19 [INFO] gameserver.network.server: Session removed: uid=2
18:27:19 [INFO] websockets.server: connection open
18:27:19 [INFO] gameserver.network.server: Session registered: uid=-14
18:27:19 [INFO] gameserver.network.server: Client connected: uid=-14 remote=('192.168.178.2', 63630)
18:27:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:19 [INFO] gameserver.network.server: Session registered: uid=2
18:27:19 [INFO] gameserver.network.server: Session upgraded: guest=-14 → uid=2
18:27:19 [INFO] gameserver.network.server: Session removed: uid=2
18:27:19 [INFO] websockets.server: connection open
18:27:19 [INFO] gameserver.network.server: Session registered: uid=-15
18:27:19 [INFO] gameserver.network.server: Client connected: uid=-15 remote=('192.168.178.2', 63632)
18:27:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:19 [INFO] gameserver.network.server: Session registered: uid=2
18:27:19 [INFO] gameserver.network.server: Session upgraded: guest=-15 → uid=2
18:27:19 [INFO] gameserver.network.server: Session removed: uid=2
18:27:19 [INFO] websockets.server: connection open
18:27:19 [INFO] gameserver.network.server: Session registered: uid=-16
18:27:19 [INFO] gameserver.network.server: Client connected: uid=-16 remote=('192.168.178.2', 63634)
18:27:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:27:19 [INFO] gameserver.network.server: Session registered: uid=2
18:27:19 [INFO] gameserver.network.server: Session upgraded: guest=-16 → uid=2
18:28:35 [INFO] gameserver.network.server: Session removed: uid=2
18:28:35 [INFO] websockets.server: connection open
18:28:35 [INFO] gameserver.network.server: Session registered: uid=-17
18:28:35 [INFO] gameserver.network.server: Client connected: uid=-17 remote=('192.168.178.2', 60347)
18:28:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:28:35 [INFO] gameserver.network.server: Session registered: uid=2
18:28:35 [INFO] gameserver.network.server: Session upgraded: guest=-17 → uid=2
18:28:37 [INFO] gameserver.network.server: Session removed: uid=2
18:28:37 [INFO] websockets.server: connection open
18:28:37 [INFO] gameserver.network.server: Session registered: uid=-18
18:28:37 [INFO] gameserver.network.server: Client connected: uid=-18 remote=('192.168.178.2', 60350)
18:28:37 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:28:37 [INFO] gameserver.network.server: Session registered: uid=2
18:28:37 [INFO] gameserver.network.server: Session upgraded: guest=-18 → uid=2
18:28:38 [INFO] gameserver.network.server: Session removed: uid=2
18:28:38 [INFO] websockets.server: connection open
18:28:38 [INFO] gameserver.network.server: Session registered: uid=-19
18:28:38 [INFO] gameserver.network.server: Client connected: uid=-19 remote=('192.168.178.2', 60373)
18:28:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:28:38 [INFO] gameserver.network.server: Session registered: uid=2
18:28:38 [INFO] gameserver.network.server: Session upgraded: guest=-19 → uid=2
18:28:48 [INFO] __main__: Shutdown signal received — stopping …
18:28:49 [INFO] __main__: Shutting down …
18:28:49 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:28:49 [INFO] websockets.server: server closing
18:28:49 [INFO] gameserver.network.server: Session removed: uid=2
18:28:49 [INFO] websockets.server: server closed
18:28:49 [INFO] gameserver.network.server: WebSocket server stopped
18:28:49 [INFO] __main__:   WebSocket server stopped
18:28:49 [INFO] __main__:   debug dashboard stopped
18:28:49 [INFO] __main__:   database closed
18:28:49 [INFO] __main__:   goodbye
18:28:50 [INFO] __main__: === Game Server starting ===
18:28:50 [INFO] __main__: Loading configuration …
18:28:51 [INFO] __main__:   items:        210 loaded from config
18:28:51 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:28:51 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:28:51 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:28:51 [INFO] __main__:   game_config:  loaded
18:28:51 [INFO] __main__: Initializing persistence …
18:28:51 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:28:51 [INFO] __main__:   database:     connected (gameserver.db)
18:28:51 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:28:49, version 1)
18:28:51 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:28:51 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:28:51 [INFO] __main__: Creating services …
18:28:51 [INFO] __main__:   upgrade_provider: 210 items registered
18:28:51 [INFO] __main__:   all services created
18:28:51 [INFO] __main__: Wiring event handlers …
18:28:51 [INFO] __main__:   event handlers registered
18:28:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:28:51 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:28:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:28:51 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:28:51 [INFO] __main__: Restored 2 empires from saved state
18:28:51 [INFO] __main__: Starting network server …
18:28:51 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:28:51 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:28:51 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:28:51 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:28:51 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:28:51 [INFO] __main__: Starting game loop …
18:28:51 [INFO] __main__:   game loop running (1 s tick)
18:28:52 [INFO] websockets.server: connection open
18:28:52 [INFO] gameserver.network.server: Session registered: uid=-1
18:28:52 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60384)
18:28:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:28:52 [INFO] gameserver.network.server: Session registered: uid=2
18:28:52 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:32:04 [INFO] __main__: Shutdown signal received — stopping …
18:32:04 [INFO] __main__: Shutting down …
18:32:04 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:32:04 [INFO] websockets.server: server closing
18:32:04 [INFO] gameserver.network.server: Session removed: uid=2
18:32:04 [INFO] websockets.server: server closed
18:32:04 [INFO] gameserver.network.server: WebSocket server stopped
18:32:04 [INFO] __main__:   WebSocket server stopped
18:32:04 [INFO] __main__:   debug dashboard stopped
18:32:04 [INFO] __main__:   database closed
18:32:04 [INFO] __main__:   goodbye
18:32:06 [INFO] __main__: === Game Server starting ===
18:32:06 [INFO] __main__: Loading configuration …
18:32:06 [INFO] __main__:   items:        210 loaded from config
18:32:07 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:32:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:32:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:32:07 [INFO] __main__:   game_config:  loaded
18:32:07 [INFO] __main__: Initializing persistence …
18:32:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:32:07 [INFO] __main__:   database:     connected (gameserver.db)
18:32:07 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:32:04, version 1)
18:32:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:32:07 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:32:07 [INFO] __main__: Creating services …
18:32:07 [INFO] __main__:   upgrade_provider: 210 items registered
18:32:07 [INFO] __main__:   all services created
18:32:07 [INFO] __main__: Wiring event handlers …
18:32:07 [INFO] __main__:   event handlers registered
18:32:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:32:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:32:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:32:07 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:32:07 [INFO] __main__: Restored 2 empires from saved state
18:32:07 [INFO] __main__: Starting network server …
18:32:07 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:32:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:32:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:32:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:32:07 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:32:07 [INFO] __main__: Starting game loop …
18:32:07 [INFO] __main__:   game loop running (1 s tick)
18:32:07 [INFO] websockets.server: connection open
18:32:07 [INFO] gameserver.network.server: Session registered: uid=-1
18:32:07 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63856)
18:32:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:07 [INFO] gameserver.network.server: Session registered: uid=2
18:32:07 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:32:11 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
18:32:11 [INFO] gameserver.network.server: Session removed: uid=2
18:32:11 [INFO] websockets.server: connection open
18:32:11 [INFO] gameserver.network.server: Session registered: uid=-2
18:32:11 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63881)
18:32:11 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:11 [INFO] gameserver.network.server: Session registered: uid=2
18:32:11 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:32:30 [INFO] gameserver.network.server: Session removed: uid=2
18:32:30 [INFO] websockets.server: connection open
18:32:30 [INFO] gameserver.network.server: Session registered: uid=-3
18:32:30 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 63902)
18:32:30 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:30 [INFO] gameserver.network.server: Session registered: uid=2
18:32:30 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:32:31 [INFO] gameserver.network.server: Session removed: uid=2
18:32:31 [INFO] websockets.server: connection open
18:32:31 [INFO] gameserver.network.server: Session registered: uid=-4
18:32:31 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 63906)
18:32:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:31 [INFO] gameserver.network.server: Session registered: uid=2
18:32:31 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:32:31 [INFO] gameserver.network.server: Session removed: uid=2
18:32:31 [INFO] websockets.server: connection open
18:32:31 [INFO] gameserver.network.server: Session registered: uid=-5
18:32:31 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 63908)
18:32:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:32 [INFO] gameserver.network.server: Session registered: uid=2
18:32:32 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
18:32:32 [INFO] gameserver.network.server: Session removed: uid=2
18:32:32 [INFO] websockets.server: connection open
18:32:32 [INFO] gameserver.network.server: Session registered: uid=-6
18:32:32 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 63910)
18:32:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:32 [INFO] gameserver.network.server: Session registered: uid=2
18:32:32 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
18:32:32 [INFO] gameserver.network.server: Session removed: uid=2
18:32:32 [INFO] websockets.server: connection open
18:32:32 [INFO] gameserver.network.server: Session registered: uid=-7
18:32:32 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 63913)
18:32:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:32 [INFO] gameserver.network.server: Session registered: uid=2
18:32:32 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
18:32:32 [INFO] gameserver.network.server: Session removed: uid=2
18:32:32 [INFO] websockets.server: connection open
18:32:32 [INFO] gameserver.network.server: Session registered: uid=-8
18:32:32 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 63915)
18:32:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:32 [INFO] gameserver.network.server: Session registered: uid=2
18:32:32 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
18:32:33 [INFO] gameserver.network.server: Session removed: uid=2
18:32:33 [INFO] websockets.server: connection open
18:32:33 [INFO] gameserver.network.server: Session registered: uid=-9
18:32:33 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 63938)
18:32:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:33 [INFO] gameserver.network.server: Session registered: uid=2
18:32:33 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
18:32:50 [INFO] websockets.server: connection open
18:32:50 [INFO] gameserver.network.server: Session registered: uid=-10
18:32:50 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 63958)
18:32:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:50 [INFO] gameserver.network.server: Session registered: uid=2
18:32:50 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
18:32:50 [INFO] gameserver.network.server: Client disconnected: uid=-9 code=1008
18:32:50 [INFO] gameserver.network.server: Session removed: uid=2
18:32:51 [INFO] gameserver.network.server: Session removed: uid=2
18:32:53 [INFO] websockets.server: connection open
18:32:53 [INFO] gameserver.network.server: Session registered: uid=-11
18:32:53 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('192.168.178.2', 63959)
18:32:53 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:53 [INFO] gameserver.network.server: Session registered: uid=2
18:32:53 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
18:32:54 [INFO] gameserver.network.server: Session removed: uid=2
18:32:55 [INFO] websockets.server: connection open
18:32:55 [INFO] gameserver.network.server: Session registered: uid=-12
18:32:55 [INFO] gameserver.network.server: Client connected: uid=-12 remote=('192.168.178.2', 65006)
18:32:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:55 [INFO] gameserver.network.server: Session registered: uid=2
18:32:55 [INFO] gameserver.network.server: Session upgraded: guest=-12 → uid=2
18:32:56 [INFO] gameserver.network.server: Session removed: uid=2
18:32:56 [INFO] websockets.server: connection open
18:32:56 [INFO] gameserver.network.server: Session registered: uid=-13
18:32:56 [INFO] gameserver.network.server: Client connected: uid=-13 remote=('192.168.178.2', 65008)
18:32:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:56 [INFO] gameserver.network.server: Session registered: uid=2
18:32:56 [INFO] gameserver.network.server: Session upgraded: guest=-13 → uid=2
18:32:56 [INFO] gameserver.network.server: Session removed: uid=2
18:32:57 [INFO] websockets.server: connection open
18:32:57 [INFO] gameserver.network.server: Session registered: uid=-14
18:32:57 [INFO] gameserver.network.server: Client connected: uid=-14 remote=('192.168.178.2', 65010)
18:32:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:32:57 [INFO] gameserver.network.server: Session registered: uid=2
18:32:57 [INFO] gameserver.network.server: Session upgraded: guest=-14 → uid=2
18:33:45 [INFO] gameserver.network.server: Session removed: uid=2
18:33:45 [INFO] websockets.server: connection open
18:33:45 [INFO] gameserver.network.server: Session registered: uid=-15
18:33:45 [INFO] gameserver.network.server: Client connected: uid=-15 remote=('192.168.178.2', 57059)
18:33:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:33:45 [INFO] gameserver.network.server: Session registered: uid=2
18:33:45 [INFO] gameserver.network.server: Session upgraded: guest=-15 → uid=2
18:33:58 [INFO] __main__: Shutdown signal received — stopping …
18:33:59 [INFO] __main__: Shutting down …
18:33:59 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:33:59 [INFO] websockets.server: server closing
18:33:59 [INFO] gameserver.network.server: Session removed: uid=2
18:33:59 [INFO] websockets.server: server closed
18:33:59 [INFO] gameserver.network.server: WebSocket server stopped
18:33:59 [INFO] __main__:   WebSocket server stopped
18:33:59 [INFO] __main__:   debug dashboard stopped
18:33:59 [INFO] __main__:   database closed
18:33:59 [INFO] __main__:   goodbye
18:34:01 [INFO] __main__: === Game Server starting ===
18:34:01 [INFO] __main__: Loading configuration …
18:34:02 [INFO] __main__:   items:        210 loaded from config
18:34:02 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:34:02 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:34:02 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:34:02 [INFO] __main__:   game_config:  loaded
18:34:02 [INFO] __main__: Initializing persistence …
18:34:02 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:34:02 [INFO] __main__:   database:     connected (gameserver.db)
18:34:02 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:33:59, version 1)
18:34:02 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:34:02 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:34:02 [INFO] __main__: Creating services …
18:34:02 [INFO] __main__:   upgrade_provider: 210 items registered
18:34:02 [INFO] __main__:   all services created
18:34:02 [INFO] __main__: Wiring event handlers …
18:34:02 [INFO] __main__:   event handlers registered
18:34:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:34:02 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:34:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:34:02 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:34:02 [INFO] __main__: Restored 2 empires from saved state
18:34:02 [INFO] __main__: Starting network server …
18:34:02 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:34:02 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:34:02 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:34:02 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:34:02 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:34:02 [INFO] __main__: Starting game loop …
18:34:02 [INFO] __main__:   game loop running (1 s tick)
18:34:02 [INFO] websockets.server: connection open
18:34:02 [INFO] gameserver.network.server: Session registered: uid=-1
18:34:02 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50001)
18:34:02 [INFO] gameserver.network.server: Client disconnected: uid=-1 code=CloseCode.ABNORMAL_CLOSURE
18:34:02 [INFO] gameserver.network.server: Session removed: uid=-1
18:34:02 [INFO] websockets.server: connection open
18:34:02 [INFO] gameserver.network.server: Session registered: uid=-2
18:34:02 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50004)
18:34:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:34:02 [INFO] gameserver.network.server: Session registered: uid=2
18:34:02 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:34:03 [INFO] gameserver.network.server: Session removed: uid=2
18:34:03 [INFO] websockets.server: connection open
18:34:03 [INFO] gameserver.network.server: Session registered: uid=-3
18:34:03 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 50006)
18:34:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:34:03 [INFO] gameserver.network.server: Session registered: uid=2
18:34:03 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:34:07 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
18:34:27 [INFO] gameserver.engine.empire_service: Empire 2: started research HERBOLOGY (effort=800.0)
18:34:27 [INFO] gameserver.network.handlers: new_item success uid=2 iid=HERBOLOGY
18:35:06 [INFO] __main__: Shutdown signal received — stopping …
18:35:07 [INFO] __main__: Shutting down …
18:35:07 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:35:07 [INFO] websockets.server: server closing
18:35:07 [INFO] gameserver.network.server: Session removed: uid=2
18:35:07 [INFO] websockets.server: server closed
18:35:07 [INFO] gameserver.network.server: WebSocket server stopped
18:35:07 [INFO] __main__:   WebSocket server stopped
18:35:07 [INFO] __main__:   debug dashboard stopped
18:35:07 [INFO] __main__:   database closed
18:35:07 [INFO] __main__:   goodbye
18:35:08 [INFO] __main__: === Game Server starting ===
18:35:08 [INFO] __main__: Loading configuration …
18:35:09 [INFO] __main__:   items:        210 loaded from config
18:35:09 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:35:09 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:35:09 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:35:09 [INFO] __main__:   game_config:  loaded
18:35:09 [INFO] __main__: Initializing persistence …
18:35:09 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:35:09 [INFO] __main__:   database:     connected (gameserver.db)
18:35:09 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:35:07, version 1)
18:35:09 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:35:09 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:35:09 [INFO] __main__: Creating services …
18:35:09 [INFO] __main__:   upgrade_provider: 210 items registered
18:35:09 [INFO] __main__:   all services created
18:35:09 [INFO] __main__: Wiring event handlers …
18:35:09 [INFO] __main__:   event handlers registered
18:35:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:35:09 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:35:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:35:09 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:35:09 [INFO] __main__: Restored 2 empires from saved state
18:35:09 [INFO] __main__: Starting network server …
18:35:09 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:35:09 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:35:09 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:35:09 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:35:09 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:35:09 [INFO] __main__: Starting game loop …
18:35:09 [INFO] __main__:   game loop running (1 s tick)
18:35:10 [INFO] websockets.server: connection open
18:35:10 [INFO] gameserver.network.server: Session registered: uid=-1
18:35:10 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 58743)
18:35:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:35:10 [INFO] gameserver.network.server: Session registered: uid=2
18:35:10 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:40:06 [INFO] __main__: Shutdown signal received — stopping …
18:40:07 [INFO] __main__: Shutting down …
18:40:07 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:40:07 [INFO] websockets.server: server closing
18:40:07 [INFO] gameserver.network.server: Session removed: uid=2
18:40:07 [INFO] websockets.server: server closed
18:40:07 [INFO] gameserver.network.server: WebSocket server stopped
18:40:07 [INFO] __main__:   WebSocket server stopped
18:40:07 [INFO] __main__:   debug dashboard stopped
18:40:07 [INFO] __main__:   database closed
18:40:07 [INFO] __main__:   goodbye
18:40:09 [INFO] __main__: === Game Server starting ===
18:40:09 [INFO] __main__: Loading configuration …
18:40:10 [INFO] __main__:   items:        210 loaded from config
18:40:10 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:40:10 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:40:10 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:40:10 [INFO] __main__:   game_config:  loaded
18:40:10 [INFO] __main__: Initializing persistence …
18:40:10 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:40:10 [INFO] __main__:   database:     connected (gameserver.db)
18:40:10 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:40:07, version 1)
18:40:10 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:40:10 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:40:10 [INFO] __main__: Creating services …
18:40:10 [INFO] __main__:   upgrade_provider: 210 items registered
18:40:10 [INFO] __main__:   all services created
18:40:10 [INFO] __main__: Wiring event handlers …
18:40:10 [INFO] __main__:   event handlers registered
18:40:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:40:10 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:40:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:40:10 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:40:10 [INFO] __main__: Restored 2 empires from saved state
18:40:10 [INFO] __main__: Starting network server …
18:40:10 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:40:10 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:40:10 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:40:10 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:40:10 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:40:10 [INFO] __main__: Starting game loop …
18:40:10 [INFO] __main__:   game loop running (1 s tick)
18:40:10 [INFO] websockets.server: connection open
18:40:10 [INFO] gameserver.network.server: Session registered: uid=-1
18:40:10 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49370)
18:40:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:10 [INFO] gameserver.network.server: Session registered: uid=2
18:40:10 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:40:28 [INFO] gameserver.network.server: Session removed: uid=2
18:40:28 [INFO] websockets.server: connection open
18:40:28 [INFO] gameserver.network.server: Session registered: uid=-2
18:40:28 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 49384)
18:40:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:28 [INFO] gameserver.network.server: Session registered: uid=2
18:40:28 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:40:31 [INFO] gameserver.network.server: Session removed: uid=2
18:40:31 [INFO] websockets.server: connection open
18:40:31 [INFO] gameserver.network.server: Session registered: uid=-3
18:40:31 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 49388)
18:40:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:31 [INFO] gameserver.network.server: Session registered: uid=2
18:40:31 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:40:31 [INFO] gameserver.network.server: Session removed: uid=2
18:40:31 [INFO] websockets.server: connection open
18:40:31 [INFO] gameserver.network.server: Session registered: uid=-4
18:40:31 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 49391)
18:40:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:31 [INFO] gameserver.network.server: Session registered: uid=2
18:40:31 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:40:31 [INFO] gameserver.network.server: Session removed: uid=2
18:40:31 [INFO] websockets.server: connection open
18:40:31 [INFO] gameserver.network.server: Session registered: uid=-5
18:40:31 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 49394)
18:40:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:31 [INFO] gameserver.network.server: Session registered: uid=2
18:40:31 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
18:40:31 [INFO] gameserver.network.server: Session removed: uid=2
18:40:31 [INFO] websockets.server: connection open
18:40:31 [INFO] gameserver.network.server: Session registered: uid=-6
18:40:31 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 49397)
18:40:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:31 [INFO] gameserver.network.server: Session registered: uid=2
18:40:31 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
18:40:33 [INFO] gameserver.network.server: Session removed: uid=2
18:40:33 [INFO] websockets.server: connection open
18:40:33 [INFO] gameserver.network.server: Session registered: uid=-7
18:40:33 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 49420)
18:40:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:33 [INFO] gameserver.network.server: Session registered: uid=2
18:40:33 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
18:40:34 [INFO] gameserver.network.server: Session removed: uid=2
18:40:34 [INFO] websockets.server: connection open
18:40:34 [INFO] gameserver.network.server: Session registered: uid=-8
18:40:34 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 49423)
18:40:34 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:34 [INFO] gameserver.network.server: Session registered: uid=2
18:40:34 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
18:40:34 [INFO] gameserver.network.server: Session removed: uid=2
18:40:34 [INFO] websockets.server: connection open
18:40:34 [INFO] gameserver.network.server: Session registered: uid=-9
18:40:34 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 49426)
18:40:34 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:34 [INFO] gameserver.network.server: Session registered: uid=2
18:40:34 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
18:40:34 [INFO] gameserver.network.server: Session removed: uid=2
18:40:35 [INFO] websockets.server: connection open
18:40:35 [INFO] gameserver.network.server: Session registered: uid=-10
18:40:35 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 49429)
18:40:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:35 [INFO] gameserver.network.server: Session registered: uid=2
18:40:35 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
18:40:35 [INFO] gameserver.network.server: Session removed: uid=2
18:40:35 [INFO] websockets.server: connection open
18:40:35 [INFO] gameserver.network.server: Session registered: uid=-11
18:40:35 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('192.168.178.2', 49434)
18:40:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:40:35 [INFO] gameserver.network.server: Session registered: uid=2
18:40:35 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
18:40:38 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
18:41:03 [INFO] __main__: Shutdown signal received — stopping …
18:41:03 [INFO] __main__: Shutting down …
18:41:03 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:41:03 [INFO] websockets.server: server closing
18:41:03 [INFO] gameserver.network.server: Session removed: uid=2
18:41:03 [INFO] websockets.server: server closed
18:41:03 [INFO] gameserver.network.server: WebSocket server stopped
18:41:03 [INFO] __main__:   WebSocket server stopped
18:41:03 [INFO] __main__:   debug dashboard stopped
18:41:03 [INFO] __main__:   database closed
18:41:03 [INFO] __main__:   goodbye
18:41:30 [INFO] __main__: === Game Server starting ===
18:41:30 [INFO] __main__: Loading configuration …
18:41:31 [INFO] __main__:   items:        210 loaded from config
18:41:31 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:41:31 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:41:31 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:41:31 [INFO] __main__:   game_config:  loaded
18:41:31 [INFO] __main__: Initializing persistence …
18:41:31 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:41:31 [INFO] __main__:   database:     connected (gameserver.db)
18:41:31 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:41:03, version 1)
18:41:31 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:41:31 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:41:31 [INFO] __main__: Creating services …
18:41:31 [INFO] __main__:   upgrade_provider: 210 items registered
18:41:31 [INFO] __main__:   all services created
18:41:31 [INFO] __main__: Wiring event handlers …
18:41:31 [INFO] __main__:   event handlers registered
18:41:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:41:31 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:41:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:41:31 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:41:31 [INFO] __main__: Restored 2 empires from saved state
18:41:31 [INFO] __main__: Starting network server …
18:41:31 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:41:31 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:41:31 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:41:31 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:41:31 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:41:31 [INFO] __main__: Starting game loop …
18:41:31 [INFO] __main__:   game loop running (1 s tick)
18:41:32 [INFO] websockets.server: connection open
18:41:32 [INFO] gameserver.network.server: Session registered: uid=-1
18:41:32 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 58532)
18:41:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:41:32 [INFO] gameserver.network.server: Session registered: uid=2
18:41:32 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:41:43 [INFO] gameserver.network.server: Session removed: uid=2
18:41:43 [INFO] websockets.server: connection open
18:41:43 [INFO] gameserver.network.server: Session registered: uid=-2
18:41:43 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 58538)
18:41:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:41:43 [INFO] gameserver.network.server: Session registered: uid=2
18:41:43 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:41:50 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
18:41:51 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
18:41:51 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
18:41:59 [INFO] __main__: Shutdown signal received — stopping …
18:42:00 [INFO] __main__: Shutting down …
18:42:00 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:42:00 [INFO] websockets.server: server closing
18:42:00 [INFO] gameserver.network.server: Session removed: uid=2
18:42:00 [INFO] websockets.server: server closed
18:42:00 [INFO] gameserver.network.server: WebSocket server stopped
18:42:00 [INFO] __main__:   WebSocket server stopped
18:42:00 [INFO] __main__:   debug dashboard stopped
18:42:00 [INFO] __main__:   database closed
18:42:00 [INFO] __main__:   goodbye
18:42:01 [INFO] __main__: === Game Server starting ===
18:42:01 [INFO] __main__: Loading configuration …
18:42:02 [INFO] __main__:   items:        210 loaded from config
18:42:02 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:42:02 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:42:02 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:42:02 [INFO] __main__:   game_config:  loaded
18:42:02 [INFO] __main__: Initializing persistence …
18:42:02 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:42:02 [INFO] __main__:   database:     connected (gameserver.db)
18:42:02 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:42:00, version 1)
18:42:02 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:42:02 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:42:02 [INFO] __main__: Creating services …
18:42:02 [INFO] __main__:   upgrade_provider: 210 items registered
18:42:02 [INFO] __main__:   all services created
18:42:02 [INFO] __main__: Wiring event handlers …
18:42:02 [INFO] __main__:   event handlers registered
18:42:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:42:02 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:42:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:42:02 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:42:02 [INFO] __main__: Restored 2 empires from saved state
18:42:02 [INFO] __main__: Starting network server …
18:42:02 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:42:02 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:42:02 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:42:02 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:42:02 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:42:02 [INFO] __main__: Starting game loop …
18:42:02 [INFO] __main__:   game loop running (1 s tick)
18:42:03 [INFO] websockets.server: connection open
18:42:03 [INFO] gameserver.network.server: Session registered: uid=-1
18:42:03 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57199)
18:42:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:42:03 [INFO] gameserver.network.server: Session registered: uid=2
18:42:03 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:43:14 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
18:45:44 [INFO] __main__: Shutdown signal received — stopping …
18:45:45 [INFO] __main__: Shutting down …
18:45:45 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:45:45 [INFO] websockets.server: server closing
18:45:45 [INFO] gameserver.network.server: Session removed: uid=2
18:45:45 [INFO] websockets.server: server closed
18:45:45 [INFO] gameserver.network.server: WebSocket server stopped
18:45:45 [INFO] __main__:   WebSocket server stopped
18:45:45 [INFO] __main__:   debug dashboard stopped
18:45:45 [INFO] __main__:   database closed
18:45:45 [INFO] __main__:   goodbye
18:45:46 [INFO] __main__: === Game Server starting ===
18:45:46 [INFO] __main__: Loading configuration …
18:45:46 [INFO] __main__:   items:        210 loaded from config
18:45:46 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:45:46 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:45:46 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:45:46 [INFO] __main__:   game_config:  loaded
18:45:46 [INFO] __main__: Initializing persistence …
18:45:46 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:45:46 [INFO] __main__:   database:     connected (gameserver.db)
18:45:47 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:45:44, version 1)
18:45:47 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:45:47 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:45:47 [INFO] __main__: Creating services …
18:45:47 [INFO] __main__:   upgrade_provider: 210 items registered
18:45:47 [INFO] __main__:   all services created
18:45:47 [INFO] __main__: Wiring event handlers …
18:45:47 [INFO] __main__:   event handlers registered
18:45:47 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:45:47 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:45:47 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:45:47 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:45:47 [INFO] __main__: Restored 2 empires from saved state
18:45:47 [INFO] __main__: Starting network server …
18:45:47 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:45:47 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:45:47 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:45:47 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:45:47 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:45:47 [INFO] __main__: Starting game loop …
18:45:47 [INFO] __main__:   game loop running (1 s tick)
18:45:48 [INFO] websockets.server: connection open
18:45:48 [INFO] gameserver.network.server: Session registered: uid=-1
18:45:48 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 61182)
18:45:48 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:45:48 [INFO] gameserver.network.server: Session registered: uid=2
18:45:48 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:46:32 [INFO] __main__: Shutdown signal received — stopping …
18:46:33 [INFO] __main__: Shutting down …
18:46:33 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:46:33 [INFO] websockets.server: server closing
18:46:33 [INFO] gameserver.network.server: Session removed: uid=2
18:46:33 [INFO] websockets.server: server closed
18:46:33 [INFO] gameserver.network.server: WebSocket server stopped
18:46:33 [INFO] __main__:   WebSocket server stopped
18:46:33 [INFO] __main__:   debug dashboard stopped
18:46:33 [INFO] __main__:   database closed
18:46:33 [INFO] __main__:   goodbye
18:46:34 [INFO] __main__: === Game Server starting ===
18:46:34 [INFO] __main__: Loading configuration …
18:46:35 [INFO] __main__:   items:        210 loaded from config
18:46:35 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:46:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:46:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:46:35 [INFO] __main__:   game_config:  loaded
18:46:35 [INFO] __main__: Initializing persistence …
18:46:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:46:35 [INFO] __main__:   database:     connected (gameserver.db)
18:46:35 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:46:33, version 1)
18:46:35 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:46:35 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:46:35 [INFO] __main__: Creating services …
18:46:35 [INFO] __main__:   upgrade_provider: 210 items registered
18:46:35 [INFO] __main__:   all services created
18:46:35 [INFO] __main__: Wiring event handlers …
18:46:35 [INFO] __main__:   event handlers registered
18:46:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:46:35 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:46:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:46:35 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:46:35 [INFO] __main__: Restored 2 empires from saved state
18:46:35 [INFO] __main__: Starting network server …
18:46:35 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:46:35 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:46:35 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:46:35 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:46:35 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:46:35 [INFO] __main__: Starting game loop …
18:46:35 [INFO] __main__:   game loop running (1 s tick)
18:46:36 [INFO] websockets.server: connection open
18:46:36 [INFO] gameserver.network.server: Session registered: uid=-1
18:46:36 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54399)
18:46:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:46:36 [INFO] gameserver.network.server: Session registered: uid=2
18:46:36 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:46:36 [INFO] gameserver.network.server: Session removed: uid=2
18:46:36 [INFO] websockets.server: connection open
18:46:36 [INFO] gameserver.network.server: Session registered: uid=-2
18:46:36 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 54402)
18:46:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:46:36 [INFO] gameserver.network.server: Session registered: uid=2
18:46:36 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:46:37 [INFO] gameserver.network.server: Session removed: uid=2
18:46:37 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
18:46:37 [INFO] websockets.server: connection open
18:46:37 [INFO] gameserver.network.server: Session registered: uid=-3
18:46:37 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 54425)
18:46:37 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:46:37 [INFO] gameserver.network.server: Session registered: uid=2
18:46:37 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:46:38 [INFO] gameserver.network.server: Session removed: uid=2
18:46:38 [INFO] websockets.server: connection open
18:46:38 [INFO] gameserver.network.server: Session registered: uid=-4
18:46:38 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 54449)
18:46:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:46:38 [INFO] gameserver.network.server: Session registered: uid=2
18:46:38 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:46:38 [INFO] gameserver.network.server: Session removed: uid=2
18:46:38 [INFO] websockets.server: connection open
18:46:38 [INFO] gameserver.network.server: Session registered: uid=-5
18:46:38 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 54472)
18:46:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:46:38 [INFO] gameserver.network.server: Session registered: uid=2
18:46:38 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
18:46:38 [INFO] gameserver.network.server: Session removed: uid=2
18:46:38 [INFO] websockets.server: connection open
18:46:38 [INFO] gameserver.network.server: Session registered: uid=-6
18:46:38 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 54495)
18:46:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:46:38 [INFO] gameserver.network.server: Session registered: uid=2
18:46:38 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
18:46:49 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:46:49 [INFO] gameserver.network.server: Session registered: uid=2
18:46:49 [INFO] gameserver.network.server: Session upgraded: guest=2 → uid=2
18:47:26 [INFO] gameserver.engine.empire_service: Empire 2: knowledge HERBOLOGY completed
18:47:45 [INFO] __main__: Shutdown signal received — stopping …
18:47:45 [INFO] __main__: Shutting down …
18:47:45 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:47:45 [INFO] websockets.server: server closing
18:47:45 [INFO] gameserver.network.server: Session removed: uid=2
18:47:45 [INFO] websockets.server: server closed
18:47:45 [INFO] gameserver.network.server: WebSocket server stopped
18:47:45 [INFO] __main__:   WebSocket server stopped
18:47:45 [INFO] __main__:   debug dashboard stopped
18:47:45 [INFO] __main__:   database closed
18:47:45 [INFO] __main__:   goodbye
18:47:47 [INFO] __main__: === Game Server starting ===
18:47:47 [INFO] __main__: Loading configuration …
18:47:48 [INFO] __main__:   items:        210 loaded from config
18:47:48 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:47:48 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:47:48 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:47:48 [INFO] __main__:   game_config:  loaded
18:47:48 [INFO] __main__: Initializing persistence …
18:47:48 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:47:48 [INFO] __main__:   database:     connected (gameserver.db)
18:47:48 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:47:45, version 1)
18:47:48 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:47:48 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:47:48 [INFO] __main__: Creating services …
18:47:48 [INFO] __main__:   upgrade_provider: 210 items registered
18:47:48 [INFO] __main__:   all services created
18:47:48 [INFO] __main__: Wiring event handlers …
18:47:48 [INFO] __main__:   event handlers registered
18:47:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:47:48 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:47:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:47:48 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:47:48 [INFO] __main__: Restored 2 empires from saved state
18:47:48 [INFO] __main__: Starting network server …
18:47:48 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:47:48 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:47:48 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:47:48 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:47:48 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:47:48 [INFO] __main__: Starting game loop …
18:47:48 [INFO] __main__:   game loop running (1 s tick)
18:47:48 [INFO] websockets.server: connection open
18:47:48 [INFO] gameserver.network.server: Session registered: uid=-1
18:47:48 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55140)
18:47:48 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:47:48 [INFO] gameserver.network.server: Session registered: uid=2
18:47:48 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:47:55 [INFO] gameserver.network.server: Session removed: uid=2
18:47:55 [INFO] websockets.server: connection open
18:47:55 [INFO] gameserver.network.server: Session registered: uid=-2
18:47:55 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60394)
18:47:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:47:55 [INFO] gameserver.network.server: Session registered: uid=2
18:47:55 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:47:57 [INFO] gameserver.network.server: Session removed: uid=2
18:47:57 [INFO] websockets.server: connection open
18:47:57 [INFO] gameserver.network.server: Session registered: uid=-3
18:47:57 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60418)
18:47:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:47:57 [INFO] gameserver.network.server: Session registered: uid=2
18:47:57 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:48:05 [INFO] __main__: Shutdown signal received — stopping …
18:48:06 [INFO] __main__: Shutting down …
18:48:06 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:48:06 [INFO] websockets.server: server closing
18:48:06 [INFO] gameserver.network.server: Session removed: uid=2
18:48:06 [INFO] websockets.server: server closed
18:48:06 [INFO] gameserver.network.server: WebSocket server stopped
18:48:06 [INFO] __main__:   WebSocket server stopped
18:48:06 [INFO] __main__:   debug dashboard stopped
18:48:06 [INFO] __main__:   database closed
18:48:06 [INFO] __main__:   goodbye
18:48:21 [INFO] __main__: === Game Server starting ===
18:48:21 [INFO] __main__: Loading configuration …
18:48:22 [INFO] __main__:   items:        210 loaded from config
18:48:22 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:48:22 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:48:22 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:48:22 [INFO] __main__:   game_config:  loaded
18:48:22 [INFO] __main__: Initializing persistence …
18:48:22 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:48:22 [INFO] __main__:   database:     connected (gameserver.db)
18:48:22 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:46:33, version 1)
18:48:22 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:48:22 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:48:22 [INFO] __main__: Creating services …
18:48:22 [INFO] __main__:   upgrade_provider: 210 items registered
18:48:22 [INFO] __main__:   all services created
18:48:22 [INFO] __main__: Wiring event handlers …
18:48:22 [INFO] __main__:   event handlers registered
18:48:22 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:48:22 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:48:22 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:48:22 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:48:22 [INFO] __main__: Restored 2 empires from saved state
18:48:22 [INFO] __main__: Starting network server …
18:48:22 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:48:22 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:48:22 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:48:22 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:48:22 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:48:22 [INFO] __main__: Starting game loop …
18:48:22 [INFO] __main__:   game loop running (1 s tick)
18:48:24 [INFO] websockets.server: connection open
18:48:24 [INFO] gameserver.network.server: Session registered: uid=-1
18:48:24 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60443)
18:48:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:48:24 [INFO] gameserver.network.server: Session registered: uid=2
18:48:24 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:48:24 [INFO] gameserver.network.server: Session removed: uid=2
18:48:24 [INFO] websockets.server: connection open
18:48:24 [INFO] gameserver.network.server: Session registered: uid=-2
18:48:24 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60447)
18:48:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:48:24 [INFO] gameserver.network.server: Session registered: uid=2
18:48:24 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:48:25 [INFO] gameserver.network.server: Session removed: uid=2
18:48:26 [INFO] websockets.server: connection open
18:48:26 [INFO] gameserver.network.server: Session registered: uid=-3
18:48:26 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60472)
18:48:26 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:48:26 [INFO] gameserver.network.server: Session registered: uid=2
18:48:26 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:49:13 [INFO] gameserver.engine.empire_service: Empire 2: knowledge HERBOLOGY completed
18:54:49 [INFO] gameserver.network.server: Session removed: uid=2
18:54:49 [INFO] websockets.server: connection open
18:54:49 [INFO] gameserver.network.server: Session registered: uid=-4
18:54:49 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 64371)
18:54:49 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:54:49 [INFO] gameserver.network.server: Session registered: uid=2
18:54:49 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:54:52 [INFO] gameserver.network.server: Session removed: uid=2
18:54:52 [INFO] websockets.server: connection open
18:54:52 [INFO] gameserver.network.server: Session registered: uid=-5
18:54:52 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 64394)
18:54:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:54:52 [INFO] gameserver.network.server: Session registered: uid=2
18:54:52 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
18:55:35 [INFO] gameserver.network.server: Session removed: uid=2
18:55:35 [INFO] websockets.server: connection open
18:55:35 [INFO] gameserver.network.server: Session registered: uid=-6
18:55:35 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 52752)
18:55:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:55:35 [INFO] gameserver.network.server: Session registered: uid=2
18:55:35 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
18:55:39 [INFO] __main__: Shutdown signal received — stopping …
18:55:40 [INFO] __main__: Shutting down …
18:55:40 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:55:40 [INFO] websockets.server: server closing
18:55:40 [INFO] gameserver.network.server: Session removed: uid=2
18:55:40 [INFO] websockets.server: server closed
18:55:40 [INFO] gameserver.network.server: WebSocket server stopped
18:55:40 [INFO] __main__:   WebSocket server stopped
18:55:40 [INFO] __main__:   debug dashboard stopped
18:55:40 [INFO] __main__:   database closed
18:55:40 [INFO] __main__:   goodbye
18:55:42 [INFO] __main__: === Game Server starting ===
18:55:42 [INFO] __main__: Loading configuration …
18:55:43 [INFO] __main__:   items:        210 loaded from config
18:55:43 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:55:43 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:55:43 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:55:43 [INFO] __main__:   game_config:  loaded
18:55:43 [INFO] __main__: Initializing persistence …
18:55:43 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:55:43 [INFO] __main__:   database:     connected (gameserver.db)
18:55:43 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:55:40, version 1)
18:55:43 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:55:43 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:55:43 [INFO] __main__: Creating services …
18:55:43 [INFO] __main__:   upgrade_provider: 210 items registered
18:55:43 [INFO] __main__:   all services created
18:55:43 [INFO] __main__: Wiring event handlers …
18:55:43 [INFO] __main__:   event handlers registered
18:55:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:55:43 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:55:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:55:43 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:55:43 [INFO] __main__: Restored 2 empires from saved state
18:55:43 [INFO] __main__: Starting network server …
18:55:43 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:55:43 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:55:43 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:55:43 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:55:43 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:55:43 [INFO] __main__: Starting game loop …
18:55:43 [INFO] __main__:   game loop running (1 s tick)
18:55:43 [INFO] websockets.server: connection open
18:55:43 [INFO] gameserver.network.server: Session registered: uid=-1
18:55:43 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49155)
18:55:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:55:43 [INFO] gameserver.network.server: Session registered: uid=2
18:55:43 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:55:51 [INFO] __main__: Shutdown signal received — stopping …
18:55:51 [INFO] __main__: Shutting down …
18:55:51 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:55:51 [INFO] websockets.server: server closing
18:55:51 [INFO] gameserver.network.server: Session removed: uid=2
18:55:51 [INFO] websockets.server: server closed
18:55:51 [INFO] gameserver.network.server: WebSocket server stopped
18:55:51 [INFO] __main__:   WebSocket server stopped
18:55:51 [INFO] __main__:   debug dashboard stopped
18:55:51 [INFO] __main__:   database closed
18:55:51 [INFO] __main__:   goodbye
18:55:53 [INFO] __main__: === Game Server starting ===
18:55:53 [INFO] __main__: Loading configuration …
18:55:54 [INFO] __main__:   items:        210 loaded from config
18:55:54 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:55:54 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:55:54 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:55:54 [INFO] __main__:   game_config:  loaded
18:55:54 [INFO] __main__: Initializing persistence …
18:55:54 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:55:54 [INFO] __main__:   database:     connected (gameserver.db)
18:55:54 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:55:51, version 1)
18:55:54 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:55:54 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:55:54 [INFO] __main__: Creating services …
18:55:54 [INFO] __main__:   upgrade_provider: 210 items registered
18:55:54 [INFO] __main__:   all services created
18:55:54 [INFO] __main__: Wiring event handlers …
18:55:54 [INFO] __main__:   event handlers registered
18:55:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:55:54 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:55:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:55:54 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:55:54 [INFO] __main__: Restored 2 empires from saved state
18:55:54 [INFO] __main__: Starting network server …
18:55:54 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:55:54 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:55:54 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:55:54 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:55:54 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:55:54 [INFO] __main__: Starting game loop …
18:55:54 [INFO] __main__:   game loop running (1 s tick)
18:55:54 [INFO] websockets.server: connection open
18:55:54 [INFO] gameserver.network.server: Session registered: uid=-1
18:55:54 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49159)
18:55:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:55:54 [INFO] gameserver.network.server: Session registered: uid=2
18:55:54 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:55:57 [INFO] gameserver.network.server: Session removed: uid=2
18:55:57 [INFO] websockets.server: connection open
18:55:57 [INFO] gameserver.network.server: Session registered: uid=-2
18:55:57 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 49164)
18:55:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:55:57 [INFO] gameserver.network.server: Session registered: uid=2
18:55:57 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:57:52 [INFO] gameserver.network.server: Session removed: uid=2
18:57:52 [INFO] websockets.server: connection open
18:57:52 [INFO] gameserver.network.server: Session registered: uid=-3
18:57:52 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 56156)
18:57:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:57:52 [INFO] gameserver.network.server: Session registered: uid=2
18:57:52 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:57:54 [INFO] gameserver.network.server: Session removed: uid=2
18:57:54 [INFO] websockets.server: connection open
18:57:54 [INFO] gameserver.network.server: Session registered: uid=-4
18:57:54 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 60752)
18:57:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:57:54 [INFO] gameserver.network.server: Session registered: uid=2
18:57:54 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:57:55 [INFO] gameserver.network.server: Session removed: uid=2
18:57:55 [INFO] websockets.server: connection open
18:57:55 [INFO] gameserver.network.server: Session registered: uid=-5
18:57:55 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 60756)
18:57:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:57:55 [INFO] gameserver.network.server: Session registered: uid=2
18:57:55 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
18:57:55 [INFO] gameserver.network.server: Session removed: uid=2
18:57:55 [INFO] websockets.server: connection open
18:57:55 [INFO] gameserver.network.server: Session registered: uid=-6
18:57:55 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 63885)
18:57:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:57:55 [INFO] gameserver.network.server: Session registered: uid=2
18:57:55 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
18:58:57 [INFO] gameserver.network.server: Session removed: uid=2
18:58:57 [INFO] websockets.server: connection open
18:58:57 [INFO] gameserver.network.server: Session registered: uid=-7
18:58:57 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 61432)
18:58:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:58:57 [INFO] gameserver.network.server: Session registered: uid=2
18:58:57 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
18:59:24 [INFO] gameserver.network.server: Session removed: uid=2
18:59:24 [INFO] websockets.server: connection open
18:59:24 [INFO] gameserver.network.server: Session registered: uid=-8
18:59:24 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 60883)
18:59:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:59:24 [INFO] gameserver.network.server: Session registered: uid=2
18:59:24 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
18:59:28 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
18:59:30 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
18:59:31 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
18:59:36 [INFO] __main__: Shutdown signal received — stopping …
18:59:36 [INFO] __main__: Shutting down …
18:59:36 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:59:36 [INFO] websockets.server: server closing
18:59:36 [INFO] gameserver.network.server: Session removed: uid=2
18:59:36 [INFO] websockets.server: server closed
18:59:36 [INFO] gameserver.network.server: WebSocket server stopped
18:59:36 [INFO] __main__:   WebSocket server stopped
18:59:36 [INFO] __main__:   debug dashboard stopped
18:59:36 [INFO] __main__:   database closed
18:59:36 [INFO] __main__:   goodbye
18:59:38 [INFO] __main__: === Game Server starting ===
18:59:38 [INFO] __main__: Loading configuration …
18:59:38 [INFO] __main__:   items:        210 loaded from config
18:59:38 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:59:38 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:59:38 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:59:38 [INFO] __main__:   game_config:  loaded
18:59:38 [INFO] __main__: Initializing persistence …
18:59:38 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:59:38 [INFO] __main__:   database:     connected (gameserver.db)
18:59:39 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:59:36, version 1)
18:59:39 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:59:39 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:59:39 [INFO] __main__: Creating services …
18:59:39 [INFO] __main__:   upgrade_provider: 210 items registered
18:59:39 [INFO] __main__:   all services created
18:59:39 [INFO] __main__: Wiring event handlers …
18:59:39 [INFO] __main__:   event handlers registered
18:59:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:59:39 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:59:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:59:39 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:59:39 [INFO] __main__: Restored 2 empires from saved state
18:59:39 [INFO] __main__: Starting network server …
18:59:39 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:59:39 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:59:39 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:59:39 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:59:39 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:59:39 [INFO] __main__: Starting game loop …
18:59:39 [INFO] __main__:   game loop running (1 s tick)
18:59:39 [INFO] websockets.server: connection open
18:59:39 [INFO] gameserver.network.server: Session registered: uid=-1
18:59:39 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60890)
18:59:39 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:59:39 [INFO] gameserver.network.server: Session registered: uid=2
18:59:39 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:59:50 [INFO] __main__: Shutdown signal received — stopping …
18:59:51 [INFO] __main__: Shutting down …
18:59:51 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:59:51 [INFO] websockets.server: server closing
18:59:51 [INFO] gameserver.network.server: Session removed: uid=2
18:59:51 [INFO] websockets.server: server closed
18:59:51 [INFO] gameserver.network.server: WebSocket server stopped
18:59:51 [INFO] __main__:   WebSocket server stopped
18:59:51 [INFO] __main__:   debug dashboard stopped
18:59:51 [INFO] __main__:   database closed
18:59:51 [INFO] __main__:   goodbye
18:59:53 [INFO] __main__: === Game Server starting ===
18:59:53 [INFO] __main__: Loading configuration …
18:59:53 [INFO] __main__:   items:        210 loaded from config
18:59:53 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:59:53 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:59:53 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:59:53 [INFO] __main__:   game_config:  loaded
18:59:53 [INFO] __main__: Initializing persistence …
18:59:53 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:59:53 [INFO] __main__:   database:     connected (gameserver.db)
18:59:53 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T18:59:51, version 1)
18:59:53 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:59:53 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:59:53 [INFO] __main__: Creating services …
18:59:53 [INFO] __main__:   upgrade_provider: 210 items registered
18:59:53 [INFO] __main__:   all services created
18:59:53 [INFO] __main__: Wiring event handlers …
18:59:53 [INFO] __main__:   event handlers registered
18:59:53 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:59:53 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:59:53 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:59:53 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:59:53 [INFO] __main__: Restored 2 empires from saved state
18:59:53 [INFO] __main__: Starting network server …
18:59:53 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:59:53 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:59:53 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:59:53 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:59:53 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:59:53 [INFO] __main__: Starting game loop …
18:59:53 [INFO] __main__:   game loop running (1 s tick)
18:59:54 [INFO] websockets.server: connection open
18:59:54 [INFO] gameserver.network.server: Session registered: uid=-1
18:59:54 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60897)
18:59:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:59:54 [INFO] gameserver.network.server: Session registered: uid=2
18:59:54 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:59:54 [INFO] gameserver.network.server: Session removed: uid=2
18:59:55 [INFO] websockets.server: connection open
18:59:55 [INFO] gameserver.network.server: Session registered: uid=-2
18:59:55 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60902)
18:59:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:59:55 [INFO] gameserver.network.server: Session registered: uid=2
18:59:55 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:59:57 [INFO] gameserver.network.server: Session removed: uid=2
18:59:57 [INFO] websockets.server: connection open
18:59:57 [INFO] gameserver.network.server: Session registered: uid=-3
18:59:57 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60906)
18:59:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:59:57 [INFO] gameserver.network.server: Session registered: uid=2
18:59:57 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:01:46 [INFO] __main__: Shutdown signal received — stopping …
19:01:47 [INFO] __main__: Shutting down …
19:01:47 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:01:47 [INFO] websockets.server: server closing
19:01:47 [INFO] gameserver.network.server: Session removed: uid=2
19:01:47 [INFO] websockets.server: server closed
19:01:47 [INFO] gameserver.network.server: WebSocket server stopped
19:01:47 [INFO] __main__:   WebSocket server stopped
19:01:47 [INFO] __main__:   debug dashboard stopped
19:01:47 [INFO] __main__:   database closed
19:01:47 [INFO] __main__:   goodbye
19:01:48 [INFO] __main__: === Game Server starting ===
19:01:48 [INFO] __main__: Loading configuration …
19:01:49 [INFO] __main__:   items:        210 loaded from config
19:01:49 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:01:49 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:01:49 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:01:49 [INFO] __main__:   game_config:  loaded
19:01:49 [INFO] __main__: Initializing persistence …
19:01:49 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:01:49 [INFO] __main__:   database:     connected (gameserver.db)
19:01:49 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:01:46, version 1)
19:01:49 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:01:49 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:01:49 [INFO] __main__: Creating services …
19:01:49 [INFO] __main__:   upgrade_provider: 210 items registered
19:01:49 [INFO] __main__:   all services created
19:01:49 [INFO] __main__: Wiring event handlers …
19:01:49 [INFO] __main__:   event handlers registered
19:01:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:01:49 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:01:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:01:49 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:01:49 [INFO] __main__: Restored 2 empires from saved state
19:01:49 [INFO] __main__: Starting network server …
19:01:49 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:01:49 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:01:49 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:01:49 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:01:49 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:01:49 [INFO] __main__: Starting game loop …
19:01:49 [INFO] __main__:   game loop running (1 s tick)
19:01:50 [INFO] websockets.server: connection open
19:01:50 [INFO] gameserver.network.server: Session registered: uid=-1
19:01:50 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60949)
19:01:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:01:50 [INFO] gameserver.network.server: Session registered: uid=2
19:01:50 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:02:06 [INFO] gameserver.network.server: Session removed: uid=2
19:02:06 [INFO] websockets.server: connection open
19:02:06 [INFO] gameserver.network.server: Session registered: uid=-2
19:02:06 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60959)
19:02:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:02:06 [INFO] gameserver.network.server: Session registered: uid=2
19:02:06 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:02:08 [INFO] gameserver.network.server: Session removed: uid=2
19:02:08 [INFO] websockets.server: connection open
19:02:08 [INFO] gameserver.network.server: Session registered: uid=-3
19:02:08 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60968)
19:02:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:02:08 [INFO] gameserver.network.server: Session registered: uid=2
19:02:08 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:02:10 [INFO] gameserver.network.server: Session removed: uid=2
19:02:10 [INFO] websockets.server: connection open
19:02:10 [INFO] gameserver.network.server: Session registered: uid=-4
19:02:10 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 60991)
19:02:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:02:10 [INFO] gameserver.network.server: Session registered: uid=2
19:02:10 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
19:02:35 [INFO] __main__: Shutdown signal received — stopping …
19:02:36 [INFO] __main__: Shutting down …
19:02:36 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:02:36 [INFO] websockets.server: server closing
19:02:36 [INFO] gameserver.network.server: Session removed: uid=2
19:02:36 [INFO] websockets.server: server closed
19:02:36 [INFO] gameserver.network.server: WebSocket server stopped
19:02:36 [INFO] __main__:   WebSocket server stopped
19:02:36 [INFO] __main__:   debug dashboard stopped
19:02:36 [INFO] __main__:   database closed
19:02:36 [INFO] __main__:   goodbye
19:02:43 [INFO] __main__: === Game Server starting ===
19:02:43 [INFO] __main__: Loading configuration …
19:02:44 [INFO] __main__:   items:        210 loaded from config
19:02:44 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:02:44 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:02:44 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:02:44 [INFO] __main__:   game_config:  loaded
19:02:44 [INFO] __main__: Initializing persistence …
19:02:44 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:02:44 [INFO] __main__:   database:     connected (gameserver.db)
19:02:44 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:02:36, version 1)
19:02:44 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:02:44 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:02:44 [INFO] __main__: Creating services …
19:02:44 [INFO] __main__:   upgrade_provider: 210 items registered
19:02:44 [INFO] __main__:   all services created
19:02:44 [INFO] __main__: Wiring event handlers …
19:02:44 [INFO] __main__:   event handlers registered
19:02:44 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:02:44 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:02:44 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:02:44 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:02:44 [INFO] __main__: Restored 2 empires from saved state
19:02:44 [INFO] __main__: Starting network server …
19:02:44 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:02:44 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:02:44 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:02:44 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:02:44 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:02:44 [INFO] __main__: Starting game loop …
19:02:44 [INFO] __main__:   game loop running (1 s tick)
19:02:44 [INFO] websockets.server: connection open
19:02:44 [INFO] gameserver.network.server: Session registered: uid=-1
19:02:44 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 58629)
19:02:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:02:44 [INFO] gameserver.network.server: Session registered: uid=2
19:02:44 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:02:47 [INFO] __main__: Shutdown signal received — stopping …
19:02:48 [INFO] __main__: Shutting down …
19:02:48 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:02:48 [INFO] websockets.server: server closing
19:02:48 [INFO] gameserver.network.server: Session removed: uid=2
19:02:49 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
19:02:49 [INFO] websockets.server: server closed
19:02:49 [INFO] gameserver.network.server: WebSocket server stopped
19:02:49 [INFO] __main__:   WebSocket server stopped
19:02:49 [INFO] __main__:   debug dashboard stopped
19:02:49 [INFO] __main__:   database closed
19:02:49 [INFO] __main__:   goodbye
19:02:54 [INFO] __main__: === Game Server starting ===
19:02:54 [INFO] __main__: Loading configuration …
19:02:55 [INFO] __main__:   items:        210 loaded from config
19:02:55 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:02:55 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:02:55 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:02:55 [INFO] __main__:   game_config:  loaded
19:02:55 [INFO] __main__: Initializing persistence …
19:02:55 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:02:55 [INFO] __main__:   database:     connected (gameserver.db)
19:02:55 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:02:48, version 1)
19:02:55 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:02:55 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:02:55 [INFO] __main__: Creating services …
19:02:55 [INFO] __main__:   upgrade_provider: 210 items registered
19:02:55 [INFO] __main__:   all services created
19:02:55 [INFO] __main__: Wiring event handlers …
19:02:55 [INFO] __main__:   event handlers registered
19:02:55 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:02:55 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:02:55 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:02:55 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:02:55 [INFO] __main__: Restored 2 empires from saved state
19:02:55 [INFO] __main__: Starting network server …
19:02:55 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:02:55 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:02:55 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:02:55 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:02:55 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:02:55 [INFO] __main__: Starting game loop …
19:02:55 [INFO] __main__:   game loop running (1 s tick)
19:02:55 [INFO] websockets.server: connection open
19:02:55 [INFO] gameserver.network.server: Session registered: uid=-1
19:02:55 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 61614)
19:02:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:02:55 [INFO] gameserver.network.server: Session registered: uid=2
19:02:55 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:02:55 [INFO] gameserver.network.server: Session removed: uid=2
19:02:55 [INFO] websockets.server: connection open
19:02:55 [INFO] gameserver.network.server: Session registered: uid=-2
19:02:55 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 61617)
19:02:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:02:55 [INFO] gameserver.network.server: Session registered: uid=2
19:02:55 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:03:04 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
19:03:05 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
19:03:05 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
19:03:08 [INFO] __main__: Shutdown signal received — stopping …
19:03:09 [INFO] __main__: Shutting down …
19:03:09 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:03:09 [INFO] websockets.server: server closing
19:03:09 [INFO] gameserver.network.server: Session removed: uid=2
19:03:09 [INFO] websockets.server: server closed
19:03:09 [INFO] gameserver.network.server: WebSocket server stopped
19:03:09 [INFO] __main__:   WebSocket server stopped
19:03:09 [INFO] __main__:   debug dashboard stopped
19:03:09 [INFO] __main__:   database closed
19:03:09 [INFO] __main__:   goodbye
19:03:34 [INFO] __main__: === Game Server starting ===
19:03:34 [INFO] __main__: Loading configuration …
19:03:35 [INFO] __main__:   items:        210 loaded from config
19:03:35 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:03:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:03:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:03:35 [INFO] __main__:   game_config:  loaded
19:03:35 [INFO] __main__: Initializing persistence …
19:03:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:03:35 [INFO] __main__:   database:     connected (gameserver.db)
19:03:35 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:03:09, version 1)
19:03:35 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:03:35 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:03:35 [INFO] __main__: Creating services …
19:03:35 [INFO] __main__:   upgrade_provider: 210 items registered
19:03:35 [INFO] __main__:   all services created
19:03:35 [INFO] __main__: Wiring event handlers …
19:03:35 [INFO] __main__:   event handlers registered
19:03:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:03:35 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:03:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:03:35 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:03:35 [INFO] __main__: Restored 2 empires from saved state
19:03:35 [INFO] __main__: Starting network server …
19:03:35 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:03:35 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:03:35 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:03:35 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:03:35 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:03:35 [INFO] __main__: Starting game loop …
19:03:35 [INFO] __main__:   game loop running (1 s tick)
19:03:35 [INFO] websockets.server: connection open
19:03:35 [INFO] gameserver.network.server: Session registered: uid=-1
19:03:35 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 61663)
19:03:35 [INFO] websockets.server: connection open
19:03:35 [INFO] gameserver.network.server: Session registered: uid=-2
19:03:35 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 61657)
19:03:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:03:35 [INFO] gameserver.network.server: Session registered: uid=2
19:03:35 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:03:35 [INFO] gameserver.network.server: Client disconnected: uid=-2 code=CloseCode.ABNORMAL_CLOSURE
19:03:35 [INFO] gameserver.network.server: Session removed: uid=-2
19:03:41 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
19:03:43 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=100
19:04:44 [INFO] __main__: Shutdown signal received — stopping …
19:04:45 [INFO] __main__: Shutting down …
19:04:45 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:04:45 [INFO] websockets.server: server closing
19:04:45 [INFO] gameserver.network.server: Session removed: uid=2
19:04:45 [INFO] websockets.server: server closed
19:04:45 [INFO] gameserver.network.server: WebSocket server stopped
19:04:45 [INFO] __main__:   WebSocket server stopped
19:04:45 [INFO] __main__:   debug dashboard stopped
19:04:45 [INFO] __main__:   database closed
19:04:45 [INFO] __main__:   goodbye
19:04:55 [INFO] __main__: === Game Server starting ===
19:04:55 [INFO] __main__: Loading configuration …
19:04:55 [INFO] __main__:   items:        210 loaded from config
19:04:55 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:04:55 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:04:55 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:04:55 [INFO] __main__:   game_config:  loaded
19:04:55 [INFO] __main__: Initializing persistence …
19:04:55 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:04:55 [INFO] __main__:   database:     connected (gameserver.db)
19:04:55 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:04:45, version 1)
19:04:55 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:04:55 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:04:55 [INFO] __main__: Creating services …
19:04:55 [INFO] __main__:   upgrade_provider: 210 items registered
19:04:55 [INFO] __main__:   all services created
19:04:55 [INFO] __main__: Wiring event handlers …
19:04:55 [INFO] __main__:   event handlers registered
19:04:55 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:04:55 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:04:55 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:04:55 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:04:55 [INFO] __main__: Restored 2 empires from saved state
19:04:55 [INFO] __main__: Starting network server …
19:04:55 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:04:55 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:04:55 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:04:55 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:04:55 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:04:55 [INFO] __main__: Starting game loop …
19:04:55 [INFO] __main__:   game loop running (1 s tick)
19:04:56 [INFO] websockets.server: connection open
19:04:56 [INFO] gameserver.network.server: Session registered: uid=-1
19:04:56 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63894)
19:04:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:04:56 [INFO] gameserver.network.server: Session registered: uid=2
19:04:56 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:04:58 [INFO] gameserver.network.server: Session removed: uid=2
19:04:58 [INFO] websockets.server: connection open
19:04:58 [INFO] gameserver.network.server: Session registered: uid=-2
19:04:58 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63905)
19:04:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:04:58 [INFO] gameserver.network.server: Session registered: uid=2
19:04:58 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:05:02 [INFO] __main__: Shutdown signal received — stopping …
19:05:02 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
19:05:02 [INFO] __main__: Shutting down …
19:05:02 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:05:02 [INFO] websockets.server: server closing
19:05:02 [INFO] gameserver.network.server: Session removed: uid=2
19:05:02 [INFO] websockets.server: server closed
19:05:02 [INFO] gameserver.network.server: WebSocket server stopped
19:05:02 [INFO] __main__:   WebSocket server stopped
19:05:02 [INFO] __main__:   debug dashboard stopped
19:05:02 [INFO] __main__:   database closed
19:05:02 [INFO] __main__:   goodbye
19:05:24 [INFO] __main__: === Game Server starting ===
19:05:24 [INFO] __main__: Loading configuration …
19:05:25 [INFO] __main__:   items:        210 loaded from config
19:05:25 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:05:25 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:05:25 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:05:25 [INFO] __main__:   game_config:  loaded
19:05:25 [INFO] __main__: Initializing persistence …
19:05:25 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:05:25 [INFO] __main__:   database:     connected (gameserver.db)
19:05:25 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:05:02, version 1)
19:05:25 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:05:25 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:05:25 [INFO] __main__: Creating services …
19:05:25 [INFO] __main__:   upgrade_provider: 210 items registered
19:05:25 [INFO] __main__:   all services created
19:05:25 [INFO] __main__: Wiring event handlers …
19:05:25 [INFO] __main__:   event handlers registered
19:05:25 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:05:25 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:05:25 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:05:25 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:05:25 [INFO] __main__: Restored 2 empires from saved state
19:05:25 [INFO] __main__: Starting network server …
19:05:25 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:05:25 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:05:25 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:05:25 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:05:25 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:05:25 [INFO] __main__: Starting game loop …
19:05:25 [INFO] __main__:   game loop running (1 s tick)
19:05:26 [INFO] websockets.server: connection open
19:05:26 [INFO] gameserver.network.server: Session registered: uid=-1
19:05:26 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57857)
19:05:26 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:05:26 [INFO] gameserver.network.server: Session registered: uid=2
19:05:26 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:05:32 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
19:05:32 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 0 tiles
19:05:38 [INFO] __main__: Shutdown signal received — stopping …
19:05:38 [INFO] __main__: Shutting down …
19:05:38 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:05:38 [INFO] websockets.server: server closing
19:05:38 [INFO] gameserver.network.server: Session removed: uid=2
19:05:38 [INFO] websockets.server: server closed
19:05:38 [INFO] gameserver.network.server: WebSocket server stopped
19:05:38 [INFO] __main__:   WebSocket server stopped
19:05:38 [INFO] __main__:   debug dashboard stopped
19:05:38 [INFO] __main__:   database closed
19:05:38 [INFO] __main__:   goodbye
19:06:42 [INFO] __main__: === Game Server starting ===
19:06:42 [INFO] __main__: Loading configuration …
19:06:43 [INFO] __main__:   items:        210 loaded from config
19:06:43 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:06:43 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:06:43 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:06:43 [INFO] __main__:   game_config:  loaded
19:06:43 [INFO] __main__: Initializing persistence …
19:06:43 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:06:43 [INFO] __main__:   database:     connected (gameserver.db)
19:06:43 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:05:38, version 1)
19:06:43 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:06:43 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:06:43 [INFO] __main__: Creating services …
19:06:43 [INFO] __main__:   upgrade_provider: 210 items registered
19:06:43 [INFO] __main__:   all services created
19:06:43 [INFO] __main__: Wiring event handlers …
19:06:43 [INFO] __main__:   event handlers registered
19:06:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:06:43 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:06:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:06:43 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:06:43 [INFO] __main__: Restored 2 empires from saved state
19:06:43 [INFO] __main__: Starting network server …
19:06:43 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:06:43 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:06:43 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:06:43 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:06:43 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:06:43 [INFO] __main__: Starting game loop …
19:06:43 [INFO] __main__:   game loop running (1 s tick)
19:06:43 [INFO] websockets.server: connection open
19:06:43 [INFO] gameserver.network.server: Session registered: uid=-1
19:06:43 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51742)
19:06:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:06:43 [INFO] gameserver.network.server: Session registered: uid=2
19:06:43 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:07:10 [INFO] __main__: Shutdown signal received — stopping …
19:07:10 [INFO] __main__: Shutting down …
19:07:10 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:07:10 [INFO] websockets.server: server closing
19:07:10 [INFO] gameserver.network.server: Session removed: uid=2
19:07:10 [INFO] websockets.server: server closed
19:07:10 [INFO] gameserver.network.server: WebSocket server stopped
19:07:10 [INFO] __main__:   WebSocket server stopped
19:07:10 [INFO] __main__:   debug dashboard stopped
19:07:10 [INFO] __main__:   database closed
19:07:10 [INFO] __main__:   goodbye
19:07:16 [INFO] __main__: === Game Server starting ===
19:07:16 [INFO] __main__: Loading configuration …
19:07:16 [INFO] __main__:   items:        210 loaded from config
19:07:16 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:07:16 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:07:16 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:07:16 [INFO] __main__:   game_config:  loaded
19:07:16 [INFO] __main__: Initializing persistence …
19:07:16 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:07:16 [INFO] __main__:   database:     connected (gameserver.db)
19:07:16 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:07:10, version 1)
19:07:16 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:07:16 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:07:16 [INFO] __main__: Creating services …
19:07:16 [INFO] __main__:   upgrade_provider: 210 items registered
19:07:16 [INFO] __main__:   all services created
19:07:16 [INFO] __main__: Wiring event handlers …
19:07:16 [INFO] __main__:   event handlers registered
19:07:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:07:16 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:07:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:07:16 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:07:16 [INFO] __main__: Restored 2 empires from saved state
19:07:16 [INFO] __main__: Starting network server …
19:07:16 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:07:16 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:07:16 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:07:16 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:07:16 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:07:16 [INFO] __main__: Starting game loop …
19:07:16 [INFO] __main__:   game loop running (1 s tick)
19:07:17 [INFO] websockets.server: connection open
19:07:17 [INFO] gameserver.network.server: Session registered: uid=-1
19:07:17 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51765)
19:07:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:07:17 [INFO] gameserver.network.server: Session registered: uid=2
19:07:17 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:07:17 [INFO] gameserver.network.server: Session removed: uid=2
19:07:17 [INFO] websockets.server: connection open
19:07:17 [INFO] gameserver.network.server: Session registered: uid=-2
19:07:17 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 51772)
19:07:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:07:17 [INFO] gameserver.network.server: Session registered: uid=2
19:07:17 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:07:22 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
19:11:35 [INFO] gameserver.network.server: Session removed: uid=2
19:11:35 [INFO] websockets.server: connection open
19:11:35 [INFO] gameserver.network.server: Session registered: uid=-3
19:11:35 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60175)
19:11:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:11:35 [INFO] gameserver.network.server: Session registered: uid=2
19:11:35 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:11:43 [INFO] __main__: Shutdown signal received — stopping …
19:11:44 [INFO] __main__: Shutting down …
19:11:44 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:11:44 [INFO] websockets.server: server closing
19:11:44 [INFO] gameserver.network.server: Session removed: uid=2
19:11:44 [INFO] websockets.server: server closed
19:11:44 [INFO] gameserver.network.server: WebSocket server stopped
19:11:44 [INFO] __main__:   WebSocket server stopped
19:11:44 [INFO] __main__:   debug dashboard stopped
19:11:44 [INFO] __main__:   database closed
19:11:44 [INFO] __main__:   goodbye
19:11:51 [INFO] __main__: === Game Server starting ===
19:11:51 [INFO] __main__: Loading configuration …
19:11:52 [INFO] __main__:   items:        210 loaded from config
19:11:52 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:11:52 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:11:52 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:11:52 [INFO] __main__:   game_config:  loaded
19:11:52 [INFO] __main__: Initializing persistence …
19:11:52 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:11:52 [INFO] __main__:   database:     connected (gameserver.db)
19:11:52 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:11:44, version 1)
19:11:52 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:11:52 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:11:52 [INFO] __main__: Creating services …
19:11:52 [INFO] __main__:   upgrade_provider: 210 items registered
19:11:52 [INFO] __main__:   all services created
19:11:52 [INFO] __main__: Wiring event handlers …
19:11:52 [INFO] __main__:   event handlers registered
19:11:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:11:52 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:11:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:11:52 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:11:52 [INFO] __main__: Restored 2 empires from saved state
19:11:52 [INFO] __main__: Starting network server …
19:11:52 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:11:52 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:11:52 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:11:52 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:11:52 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:11:52 [INFO] __main__: Starting game loop …
19:11:52 [INFO] __main__:   game loop running (1 s tick)
19:11:52 [INFO] websockets.server: connection open
19:11:52 [INFO] gameserver.network.server: Session registered: uid=-1
19:11:52 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57816)
19:11:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:11:52 [INFO] gameserver.network.server: Session registered: uid=2
19:11:52 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:11:54 [INFO] gameserver.network.server: Session removed: uid=2
19:11:54 [INFO] websockets.server: connection open
19:11:54 [INFO] gameserver.network.server: Session registered: uid=-2
19:11:54 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57820)
19:11:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:11:54 [INFO] gameserver.network.server: Session registered: uid=2
19:11:54 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:11:56 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:11:58 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
19:11:58 [INFO] __main__: Shutdown signal received — stopping …
19:11:59 [INFO] __main__: Shutting down …
19:11:59 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:11:59 [INFO] websockets.server: server closing
19:11:59 [INFO] gameserver.network.server: Client disconnected: uid=-2 code=1001
19:11:59 [INFO] gameserver.network.server: Session removed: uid=2
19:11:59 [INFO] websockets.server: server closed
19:11:59 [INFO] gameserver.network.server: WebSocket server stopped
19:11:59 [INFO] __main__:   WebSocket server stopped
19:11:59 [INFO] __main__:   debug dashboard stopped
19:11:59 [INFO] __main__:   database closed
19:11:59 [INFO] __main__:   goodbye
19:12:04 [INFO] __main__: === Game Server starting ===
19:12:04 [INFO] __main__: Loading configuration …
19:12:05 [INFO] __main__:   items:        210 loaded from config
19:12:05 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:12:05 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:12:05 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:12:05 [INFO] __main__:   game_config:  loaded
19:12:05 [INFO] __main__: Initializing persistence …
19:12:05 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:12:05 [INFO] __main__:   database:     connected (gameserver.db)
19:12:05 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:11:59, version 1)
19:12:05 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:12:05 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:12:05 [INFO] __main__: Creating services …
19:12:05 [INFO] __main__:   upgrade_provider: 210 items registered
19:12:05 [INFO] __main__:   all services created
19:12:05 [INFO] __main__: Wiring event handlers …
19:12:05 [INFO] __main__:   event handlers registered
19:12:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:12:05 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:12:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:12:05 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:12:05 [INFO] __main__: Restored 2 empires from saved state
19:12:05 [INFO] __main__: Starting network server …
19:12:05 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:12:05 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:12:05 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:12:05 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:12:05 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:12:05 [INFO] __main__: Starting game loop …
19:12:05 [INFO] __main__:   game loop running (1 s tick)
19:12:07 [INFO] websockets.server: connection open
19:12:07 [INFO] gameserver.network.server: Session registered: uid=-1
19:12:07 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57830)
19:12:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:12:07 [INFO] gameserver.network.server: Session registered: uid=2
19:12:07 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:12:08 [INFO] gameserver.network.server: Session removed: uid=2
19:12:08 [INFO] websockets.server: connection open
19:12:08 [INFO] gameserver.network.server: Session registered: uid=-2
19:12:08 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57834)
19:12:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:12:08 [INFO] gameserver.network.server: Session registered: uid=2
19:12:08 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:12:12 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:12:18 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:12:21 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:12:21 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:12:25 [INFO] __main__: Shutdown signal received — stopping …
19:12:25 [INFO] __main__: Shutting down …
19:12:25 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:12:25 [INFO] websockets.server: server closing
19:12:25 [INFO] gameserver.network.server: Session removed: uid=2
19:12:25 [INFO] websockets.server: server closed
19:12:25 [INFO] gameserver.network.server: WebSocket server stopped
19:12:25 [INFO] __main__:   WebSocket server stopped
19:12:25 [INFO] __main__:   debug dashboard stopped
19:12:25 [INFO] __main__:   database closed
19:12:25 [INFO] __main__:   goodbye
19:12:27 [INFO] __main__: === Game Server starting ===
19:12:27 [INFO] __main__: Loading configuration …
19:12:27 [INFO] __main__:   items:        210 loaded from config
19:12:28 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:12:28 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:12:28 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:12:28 [INFO] __main__:   game_config:  loaded
19:12:28 [INFO] __main__: Initializing persistence …
19:12:28 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:12:28 [INFO] __main__:   database:     connected (gameserver.db)
19:12:28 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:12:25, version 1)
19:12:28 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:12:28 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:12:28 [INFO] __main__: Creating services …
19:12:28 [INFO] __main__:   upgrade_provider: 210 items registered
19:12:28 [INFO] __main__:   all services created
19:12:28 [INFO] __main__: Wiring event handlers …
19:12:28 [INFO] __main__:   event handlers registered
19:12:28 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:12:28 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:12:28 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:12:28 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:12:28 [INFO] __main__: Restored 2 empires from saved state
19:12:28 [INFO] __main__: Starting network server …
19:12:28 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:12:28 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:12:28 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:12:28 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:12:28 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:12:28 [INFO] __main__: Starting game loop …
19:12:28 [INFO] __main__:   game loop running (1 s tick)
19:12:28 [INFO] websockets.server: connection open
19:12:28 [INFO] gameserver.network.server: Session registered: uid=-1
19:12:28 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57840)
19:12:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:12:28 [INFO] gameserver.network.server: Session registered: uid=2
19:12:28 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:12:29 [INFO] gameserver.network.server: Session removed: uid=2
19:12:29 [INFO] websockets.server: connection open
19:12:29 [INFO] gameserver.network.server: Session registered: uid=-2
19:12:29 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57845)
19:12:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:12:29 [INFO] gameserver.network.server: Session registered: uid=2
19:12:29 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:13:00 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:13:10 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:14:25 [INFO] gameserver.network.server: Session removed: uid=2
19:14:25 [INFO] websockets.server: connection open
19:14:25 [INFO] gameserver.network.server: Session registered: uid=-3
19:14:25 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 63257)
19:14:25 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:14:25 [INFO] gameserver.network.server: Session registered: uid=2
19:14:25 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:14:35 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:14:39 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:14:39 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:16:27 [INFO] gameserver.network.server: Session removed: uid=2
19:16:27 [INFO] websockets.server: connection open
19:16:27 [INFO] gameserver.network.server: Session registered: uid=-4
19:16:27 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 51762)
19:16:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:16:27 [INFO] gameserver.network.server: Session registered: uid=2
19:16:27 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
19:18:24 [INFO] gameserver.network.server: Session removed: uid=2
19:18:24 [INFO] websockets.server: connection open
19:18:24 [INFO] gameserver.network.server: Session registered: uid=-5
19:18:24 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 60595)
19:18:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:18:24 [INFO] gameserver.network.server: Session registered: uid=2
19:18:24 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
19:18:35 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:39:45 [INFO] gameserver.network.server: Session removed: uid=2
19:39:45 [INFO] websockets.server: connection open
19:39:45 [INFO] gameserver.network.server: Session registered: uid=-6
19:39:45 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 58684)
19:39:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:39:45 [INFO] gameserver.network.server: Session registered: uid=2
19:39:45 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
19:39:48 [INFO] __main__: Shutdown signal received — stopping …
19:39:49 [INFO] __main__: Shutting down …
19:39:49 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:39:49 [INFO] websockets.server: server closing
19:39:49 [INFO] gameserver.network.server: Session removed: uid=2
19:39:49 [INFO] websockets.server: server closed
19:39:49 [INFO] gameserver.network.server: WebSocket server stopped
19:39:49 [INFO] __main__:   WebSocket server stopped
19:39:49 [INFO] __main__:   debug dashboard stopped
19:39:49 [INFO] __main__:   database closed
19:39:49 [INFO] __main__:   goodbye
19:39:50 [INFO] __main__: === Game Server starting ===
19:39:50 [INFO] __main__: Loading configuration …
19:39:51 [INFO] __main__:   items:        210 loaded from config
19:39:51 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:39:51 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:39:51 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:39:51 [INFO] __main__:   game_config:  loaded
19:39:51 [INFO] __main__: Initializing persistence …
19:39:51 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:39:51 [INFO] __main__:   database:     connected (gameserver.db)
19:39:51 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:39:49, version 1)
19:39:51 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:39:51 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:39:51 [INFO] __main__: Creating services …
19:39:51 [INFO] __main__:   upgrade_provider: 210 items registered
19:39:51 [INFO] __main__:   all services created
19:39:51 [INFO] __main__: Wiring event handlers …
19:39:51 [INFO] __main__:   event handlers registered
19:39:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:39:51 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:39:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:39:51 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:39:51 [INFO] __main__: Restored 2 empires from saved state
19:39:51 [INFO] __main__: Starting network server …
19:39:51 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:39:51 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:39:51 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:39:51 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:39:51 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:39:51 [INFO] __main__: Starting game loop …
19:39:51 [INFO] __main__:   game loop running (1 s tick)
19:39:51 [INFO] websockets.server: connection open
19:39:51 [INFO] gameserver.network.server: Session registered: uid=-1
19:39:51 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 58689)
19:39:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:39:51 [INFO] gameserver.network.server: Session registered: uid=2
19:39:51 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:39:58 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:39:58 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:40:47 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:40:47 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:40:57 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:41:00 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:41:00 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:41:46 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:41:47 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:41:47 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:41:47 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:41:49 [INFO] gameserver.network.server: Session removed: uid=2
19:41:49 [INFO] websockets.server: connection open
19:41:49 [INFO] gameserver.network.server: Session registered: uid=-2
19:41:49 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 52277)
19:41:49 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:41:49 [INFO] gameserver.network.server: Session registered: uid=2
19:41:49 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:41:51 [INFO] gameserver.network.server: Session removed: uid=2
19:41:51 [INFO] websockets.server: connection open
19:41:51 [INFO] gameserver.network.server: Session registered: uid=-3
19:41:51 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 52280)
19:41:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:41:51 [INFO] gameserver.network.server: Session registered: uid=2
19:41:51 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:41:54 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:41:56 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:41:56 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:42:00 [INFO] gameserver.network.server: Session removed: uid=2
19:42:00 [INFO] websockets.server: connection open
19:42:00 [INFO] gameserver.network.server: Session registered: uid=-4
19:42:00 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 52287)
19:42:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:42:00 [INFO] gameserver.network.server: Session registered: uid=2
19:42:00 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
19:42:01 [INFO] gameserver.network.server: Session removed: uid=2
19:42:01 [INFO] websockets.server: connection open
19:42:01 [INFO] gameserver.network.server: Session registered: uid=-5
19:42:01 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 52311)
19:42:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:42:01 [INFO] gameserver.network.server: Session registered: uid=2
19:42:01 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
19:42:09 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:42:10 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
19:42:16 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:42:16 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:44:02 [INFO] __main__: Shutdown signal received — stopping …
19:44:02 [INFO] __main__: Shutting down …
19:44:02 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:44:02 [INFO] websockets.server: server closing
19:44:02 [INFO] gameserver.network.server: Session removed: uid=2
19:44:02 [INFO] websockets.server: server closed
19:44:02 [INFO] gameserver.network.server: WebSocket server stopped
19:44:02 [INFO] __main__:   WebSocket server stopped
19:44:02 [INFO] __main__:   debug dashboard stopped
19:44:02 [INFO] __main__:   database closed
19:44:02 [INFO] __main__:   goodbye
19:44:12 [INFO] __main__: === Game Server starting ===
19:44:12 [INFO] __main__: Loading configuration …
19:44:12 [INFO] __main__:   items:        210 loaded from config
19:44:12 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:44:12 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:44:12 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:44:12 [INFO] __main__:   game_config:  loaded
19:44:12 [INFO] __main__: Initializing persistence …
19:44:12 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:44:12 [INFO] __main__:   database:     connected (gameserver.db)
19:44:13 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:44:02, version 1)
19:44:13 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:44:13 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:44:13 [INFO] __main__: Creating services …
19:44:13 [INFO] __main__:   upgrade_provider: 210 items registered
19:44:13 [INFO] __main__:   all services created
19:44:13 [INFO] __main__: Wiring event handlers …
19:44:13 [INFO] __main__:   event handlers registered
19:44:13 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:44:13 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:44:13 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:44:13 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:44:13 [INFO] __main__: Restored 2 empires from saved state
19:44:13 [INFO] __main__: Starting network server …
19:44:13 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:44:13 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:44:13 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:44:13 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:44:13 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:44:13 [INFO] __main__: Starting game loop …
19:44:13 [INFO] __main__:   game loop running (1 s tick)
19:44:14 [INFO] websockets.server: connection open
19:44:14 [INFO] gameserver.network.server: Session registered: uid=-1
19:44:14 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55077)
19:44:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:44:14 [INFO] gameserver.network.server: Session registered: uid=2
19:44:14 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:44:18 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
19:46:10 [INFO] gameserver.network.server: Session removed: uid=2
19:46:10 [INFO] websockets.server: connection open
19:46:10 [INFO] gameserver.network.server: Session registered: uid=-2
19:46:10 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 51773)
19:46:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:46:10 [INFO] gameserver.network.server: Session registered: uid=2
19:46:10 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:46:13 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:46:19 [INFO] __main__: Shutdown signal received — stopping …
19:46:20 [INFO] __main__: Shutting down …
19:46:20 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:46:20 [INFO] websockets.server: server closing
19:46:20 [INFO] gameserver.network.server: Session removed: uid=2
19:46:20 [INFO] websockets.server: server closed
19:46:20 [INFO] gameserver.network.server: WebSocket server stopped
19:46:20 [INFO] __main__:   WebSocket server stopped
19:46:20 [INFO] __main__:   debug dashboard stopped
19:46:20 [INFO] __main__:   database closed
19:46:20 [INFO] __main__:   goodbye
19:46:21 [INFO] __main__: === Game Server starting ===
19:46:21 [INFO] __main__: Loading configuration …
19:46:22 [INFO] __main__:   items:        210 loaded from config
19:46:22 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:46:22 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:46:22 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:46:22 [INFO] __main__:   game_config:  loaded
19:46:22 [INFO] __main__: Initializing persistence …
19:46:22 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:46:22 [INFO] __main__:   database:     connected (gameserver.db)
19:46:22 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:46:20, version 1)
19:46:22 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:46:22 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:46:22 [INFO] __main__: Creating services …
19:46:22 [INFO] __main__:   upgrade_provider: 210 items registered
19:46:22 [INFO] __main__:   all services created
19:46:22 [INFO] __main__: Wiring event handlers …
19:46:22 [INFO] __main__:   event handlers registered
19:46:22 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:46:22 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:46:22 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:46:22 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:46:22 [INFO] __main__: Restored 2 empires from saved state
19:46:22 [INFO] __main__: Starting network server …
19:46:22 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:46:22 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:46:22 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:46:22 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:46:22 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:46:22 [INFO] __main__: Starting game loop …
19:46:22 [INFO] __main__:   game loop running (1 s tick)
19:46:23 [INFO] websockets.server: connection open
19:46:23 [INFO] gameserver.network.server: Session registered: uid=-1
19:46:23 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57154)
19:46:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:46:23 [INFO] gameserver.network.server: Session registered: uid=2
19:46:23 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:46:24 [INFO] gameserver.network.server: Session removed: uid=2
19:46:24 [INFO] websockets.server: connection open
19:46:24 [INFO] gameserver.network.server: Session registered: uid=-2
19:46:24 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57178)
19:46:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:46:24 [INFO] gameserver.network.server: Session registered: uid=2
19:46:24 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:46:26 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
19:46:32 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:46:32 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:47:34 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
19:47:36 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 2)
19:47:39 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
19:47:45 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0); Map must contain at least 1 spawnpoint
19:47:50 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0); Map must contain at least 1 spawnpoint
19:47:54 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0); Map must contain at least 1 spawnpoint
19:48:17 [INFO] __main__: Shutdown signal received — stopping …
19:48:17 [INFO] __main__: Shutting down …
19:48:17 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:48:17 [INFO] websockets.server: server closing
19:48:17 [INFO] gameserver.network.server: Session removed: uid=2
19:48:17 [INFO] websockets.server: server closed
19:48:17 [INFO] gameserver.network.server: WebSocket server stopped
19:48:17 [INFO] __main__:   WebSocket server stopped
19:48:17 [INFO] __main__:   debug dashboard stopped
19:48:17 [INFO] __main__:   database closed
19:48:17 [INFO] __main__:   goodbye
19:48:26 [INFO] __main__: === Game Server starting ===
19:48:26 [INFO] __main__: Loading configuration …
19:48:27 [INFO] __main__:   items:        210 loaded from config
19:48:27 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:48:27 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:48:27 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:48:27 [INFO] __main__:   game_config:  loaded
19:48:27 [INFO] __main__: Initializing persistence …
19:48:27 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:48:27 [INFO] __main__:   database:     connected (gameserver.db)
19:48:27 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:48:17, version 1)
19:48:27 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:48:27 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:48:27 [INFO] __main__: Creating services …
19:48:27 [INFO] __main__:   upgrade_provider: 210 items registered
19:48:27 [INFO] __main__:   all services created
19:48:27 [INFO] __main__: Wiring event handlers …
19:48:27 [INFO] __main__:   event handlers registered
19:48:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:48:27 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:48:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:48:27 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:48:27 [INFO] __main__: Restored 2 empires from saved state
19:48:27 [INFO] __main__: Starting network server …
19:48:27 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:48:27 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:48:27 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:48:27 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:48:27 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:48:27 [INFO] __main__: Starting game loop …
19:48:27 [INFO] __main__:   game loop running (1 s tick)
19:48:27 [INFO] websockets.server: connection open
19:48:27 [INFO] gameserver.network.server: Session registered: uid=-1
19:48:27 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60280)
19:48:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:48:27 [INFO] gameserver.network.server: Session registered: uid=2
19:48:27 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:48:28 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
19:48:28 [INFO] gameserver.network.server: Session removed: uid=2
19:48:28 [INFO] websockets.server: connection open
19:48:28 [INFO] gameserver.network.server: Session registered: uid=-2
19:48:28 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60307)
19:48:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:48:28 [INFO] gameserver.network.server: Session registered: uid=2
19:48:28 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:48:43 [INFO] __main__: Shutdown signal received — stopping …
19:48:43 [INFO] __main__: Shutting down …
19:48:43 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:48:43 [INFO] websockets.server: server closing
19:48:43 [INFO] gameserver.network.server: Session removed: uid=2
19:48:43 [INFO] websockets.server: server closed
19:48:43 [INFO] gameserver.network.server: WebSocket server stopped
19:48:43 [INFO] __main__:   WebSocket server stopped
19:48:43 [INFO] __main__:   debug dashboard stopped
19:48:43 [INFO] __main__:   database closed
19:48:43 [INFO] __main__:   goodbye
19:48:48 [INFO] __main__: === Game Server starting ===
19:48:48 [INFO] __main__: Loading configuration …
19:48:49 [INFO] __main__:   items:        210 loaded from config
19:48:49 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:48:49 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:48:49 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:48:49 [INFO] __main__:   game_config:  loaded
19:48:49 [INFO] __main__: Initializing persistence …
19:48:49 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:48:49 [INFO] __main__:   database:     connected (gameserver.db)
19:48:49 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:48:43, version 1)
19:48:49 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:48:49 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:48:49 [INFO] __main__: Creating services …
19:48:49 [INFO] __main__:   upgrade_provider: 210 items registered
19:48:49 [INFO] __main__:   all services created
19:48:49 [INFO] __main__: Wiring event handlers …
19:48:49 [INFO] __main__:   event handlers registered
19:48:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:48:49 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:48:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:48:49 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:48:49 [INFO] __main__: Restored 2 empires from saved state
19:48:49 [INFO] __main__: Starting network server …
19:48:49 [INFO] gameserver.network.handlers: Registered 31 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
19:48:49 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:48:49 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:48:49 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:48:49 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:48:49 [INFO] __main__: Starting game loop …
19:48:49 [INFO] __main__:   game loop running (1 s tick)
19:48:51 [INFO] websockets.server: connection open
19:48:51 [INFO] gameserver.network.server: Session registered: uid=-1
19:48:51 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57549)
19:48:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:48:51 [INFO] gameserver.network.server: Session registered: uid=2
19:48:51 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:48:52 [INFO] gameserver.network.server: Session removed: uid=2
19:48:52 [INFO] websockets.server: connection open
19:48:52 [INFO] gameserver.network.server: Session registered: uid=-2
19:48:52 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57552)
19:48:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:48:52 [INFO] gameserver.network.server: Session registered: uid=2
19:48:52 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:48:58 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:48:58 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 3 tiles
19:52:42 [INFO] gameserver.network.server: Session removed: uid=2
19:52:42 [INFO] websockets.server: connection open
19:52:42 [INFO] gameserver.network.server: Session registered: uid=-3
19:52:42 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 56083)
19:52:42 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:52:42 [INFO] gameserver.network.server: Session registered: uid=2
19:52:42 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:57:15 [INFO] gameserver.network.server: Session removed: uid=2
19:57:16 [INFO] websockets.server: connection open
19:57:16 [INFO] gameserver.network.server: Session registered: uid=-4
19:57:16 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 54140)
19:57:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:57:16 [INFO] gameserver.network.server: Session registered: uid=2
19:57:16 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
20:06:19 [INFO] __main__: === Game Server starting ===
20:06:19 [INFO] __main__: Loading configuration …
20:06:19 [INFO] __main__:   items:        210 loaded from config
20:06:19 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:06:19 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:06:19 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:06:19 [INFO] __main__:   game_config:  loaded
20:06:19 [INFO] __main__: Initializing persistence …
20:06:19 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:06:19 [INFO] __main__:   database:     connected (gameserver.db)
20:06:19 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T19:48:43, version 1)
20:06:19 [ERROR] gameserver.persistence.state_load: Failed to restore empire: 100
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 90, in load_state
    empire = _deserialize_empire(empire_dict)
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 143, in _deserialize_empire
    armies = [_deserialize_army(a) for a in d.get("armies", [])]
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 143, in <listcomp>
    armies = [_deserialize_army(a) for a in d.get("armies", [])]
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 220, in _deserialize_army
    aid=d["aid"],
KeyError: 'aid'
20:06:19 [INFO] gameserver.persistence.state_load: Restored 1 empires, 0 attacks, 0 battles
20:06:19 [INFO] __main__:   state:        restored from disk (1 empires, 0 attacks)
20:06:19 [INFO] __main__: Creating services …
20:06:19 [INFO] __main__:   upgrade_provider: 210 items registered
20:06:19 [INFO] __main__:   all services created
20:06:19 [INFO] __main__: Wiring event handlers …
20:06:19 [INFO] __main__:   event handlers registered
20:06:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:06:19 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:06:19 [INFO] __main__: Restored 1 empires from saved state
20:06:19 [INFO] __main__: Starting network server …
20:06:19 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_test_start
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 426, in <module>
    main()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 422, in main
    asyncio.run(_start())
  File "/usr/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.9/asyncio/base_events.py", line 642, in run_until_complete
    return future.result()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 397, in _start
    await start_network(services)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 288, in start_network
    await services.server.start()
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 57, in start
    self._server = await websockets.serve(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 831, in __await_impl__
    server = await self.create_server
  File "/usr/lib/python3.9/asyncio/base_events.py", line 1494, in create_server
    raise OSError(err.errno, 'error while attempting '
OSError: [Errno 98] error while attempting to bind on address ('0.0.0.0', 8765): address already in use
20:06:23 [INFO] gameserver.network.server: Session removed: uid=2
20:06:23 [INFO] websockets.server: connection open
20:06:23 [INFO] gameserver.network.server: Session registered: uid=-5
20:06:23 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 49618)
20:06:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:06:23 [INFO] gameserver.network.server: Session registered: uid=2
20:06:23 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
20:07:13 [INFO] gameserver.network.server: Session removed: uid=2
20:07:13 [INFO] websockets.server: connection open
20:07:13 [INFO] gameserver.network.server: Session registered: uid=-6
20:07:13 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 49660)
20:07:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:07:13 [INFO] gameserver.network.server: Session registered: uid=2
20:07:13 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
20:10:07 [INFO] gameserver.network.server: Session removed: uid=2
20:10:07 [INFO] websockets.server: connection open
20:10:07 [INFO] gameserver.network.server: Session registered: uid=-7
20:10:07 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 54379)
20:10:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:10:07 [INFO] gameserver.network.server: Session registered: uid=2
20:10:07 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
20:10:53 [INFO] __main__: Shutdown signal received — stopping …
20:10:53 [INFO] __main__: Shutting down …
20:10:53 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
20:10:53 [INFO] websockets.server: server closing
20:10:53 [INFO] gameserver.network.server: Session removed: uid=2
20:10:53 [INFO] websockets.server: server closed
20:10:53 [INFO] gameserver.network.server: WebSocket server stopped
20:10:53 [INFO] __main__:   WebSocket server stopped
20:10:53 [INFO] __main__:   debug dashboard stopped
20:10:53 [INFO] __main__:   database closed
20:10:53 [INFO] __main__:   goodbye
20:12:57 [INFO] __main__: === Game Server starting ===
20:12:57 [INFO] __main__: Loading configuration …
20:12:58 [INFO] __main__:   items:        210 loaded from config
20:12:58 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:12:58 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:12:58 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:12:58 [INFO] __main__:   game_config:  loaded
20:12:58 [INFO] __main__: Initializing persistence …
20:12:58 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:12:58 [INFO] __main__:   database:     connected (gameserver.db)
20:12:58 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T20:12:55, version 1)
20:12:58 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
20:12:58 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
20:12:58 [INFO] __main__: Creating services …
20:12:58 [INFO] __main__:   upgrade_provider: 210 items registered
20:12:58 [INFO] __main__:   all services created
20:12:58 [INFO] __main__: Wiring event handlers …
20:12:58 [INFO] __main__:   event handlers registered
20:12:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:12:58 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:12:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:12:58 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:12:58 [INFO] __main__: Restored 2 empires from saved state
20:12:58 [INFO] __main__: Starting network server …
20:12:58 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_test_start
20:12:58 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:12:58 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:12:58 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:12:58 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:12:58 [INFO] __main__: Starting game loop …
20:12:58 [INFO] __main__:   game loop running (1 s tick)
20:12:59 [INFO] websockets.server: connection open
20:12:59 [INFO] gameserver.network.server: Session registered: uid=-1
20:12:59 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55598)
20:12:59 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:12:59 [INFO] gameserver.network.server: Session registered: uid=2
20:12:59 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:13:02 [INFO] gameserver.network.server: Session removed: uid=2
20:13:02 [INFO] websockets.server: connection open
20:13:02 [INFO] gameserver.network.server: Session registered: uid=-2
20:13:02 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55622)
20:13:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:13:02 [INFO] gameserver.network.server: Session registered: uid=2
20:13:02 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:15:40 [INFO] gameserver.network.server: Session removed: uid=2
20:15:41 [INFO] websockets.server: connection open
20:15:41 [INFO] gameserver.network.server: Session registered: uid=-3
20:15:41 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 63863)
20:15:41 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:15:41 [INFO] gameserver.network.server: Session registered: uid=2
20:15:41 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
20:18:52 [INFO] __main__: Shutdown signal received — stopping …
20:18:52 [INFO] __main__: Shutting down …
20:18:52 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
20:18:52 [INFO] websockets.server: server closing
20:18:52 [INFO] gameserver.network.server: Session removed: uid=2
20:18:52 [INFO] websockets.server: server closed
20:18:52 [INFO] gameserver.network.server: WebSocket server stopped
20:18:52 [INFO] __main__:   WebSocket server stopped
20:18:52 [INFO] __main__:   debug dashboard stopped
20:18:52 [INFO] __main__:   database closed
20:18:52 [INFO] __main__:   goodbye
20:29:12 [INFO] __main__: === Game Server starting ===
20:29:12 [INFO] __main__: Loading configuration …
20:29:13 [INFO] __main__:   items:        210 loaded from config
20:29:13 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:29:13 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:29:13 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:29:13 [INFO] __main__:   game_config:  loaded
20:29:13 [INFO] __main__: Initializing persistence …
20:29:13 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:29:13 [INFO] __main__:   database:     connected (gameserver.db)
20:29:13 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T20:29:11, version 1)
20:29:13 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
20:29:13 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
20:29:13 [INFO] __main__: Creating services …
20:29:13 [INFO] __main__:   upgrade_provider: 210 items registered
20:29:13 [INFO] __main__:   all services created
20:29:13 [INFO] __main__: Wiring event handlers …
20:29:13 [INFO] __main__:   event handlers registered
20:29:13 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:29:13 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:29:13 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:29:13 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:29:13 [INFO] __main__: Restored 2 empires from saved state
20:29:13 [INFO] __main__: Starting network server …
20:29:13 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:29:13 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:29:13 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:29:13 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:29:13 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:29:13 [INFO] __main__: Starting game loop …
20:29:13 [INFO] __main__:   game loop running (1 s tick)
20:29:14 [INFO] websockets.server: connection open
20:29:14 [INFO] gameserver.network.server: Session registered: uid=-1
20:29:14 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53733)
20:29:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:29:14 [INFO] gameserver.network.server: Session registered: uid=2
20:29:14 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:29:15 [INFO] gameserver.network.server: Session removed: uid=2
20:29:16 [INFO] websockets.server: connection open
20:29:16 [INFO] gameserver.network.server: Session registered: uid=-2
20:29:16 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60979)
20:29:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:29:16 [INFO] gameserver.network.server: Session registered: uid=2
20:29:16 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:29:16 [INFO] gameserver.network.server: Session removed: uid=2
20:29:16 [INFO] websockets.server: connection open
20:29:16 [INFO] gameserver.network.server: Session registered: uid=-3
20:29:16 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60983)
20:29:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:29:16 [INFO] gameserver.network.server: Session registered: uid=2
20:29:16 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
20:30:30 [INFO] gameserver.network.server: Session removed: uid=2
20:30:30 [INFO] websockets.server: connection open
20:30:30 [INFO] gameserver.network.server: Session registered: uid=-4
20:30:30 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 49807)
20:30:30 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:30:30 [INFO] gameserver.network.server: Session registered: uid=2
20:30:30 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
20:32:29 [INFO] gameserver.network.server: Session removed: uid=2
20:32:32 [INFO] websockets.server: connection open
20:32:32 [INFO] gameserver.network.server: Session registered: uid=-5
20:32:32 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 51777)
20:32:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:32:32 [INFO] gameserver.network.server: Session registered: uid=2
20:32:32 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
20:32:32 [INFO] gameserver.network.server: Session removed: uid=2
20:32:37 [INFO] __main__: Shutdown signal received — stopping …
20:32:38 [INFO] __main__: Shutting down …
20:32:38 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
20:32:38 [INFO] websockets.server: server closing
20:32:38 [INFO] websockets.server: server closed
20:32:38 [INFO] gameserver.network.server: WebSocket server stopped
20:32:38 [INFO] __main__:   WebSocket server stopped
20:32:38 [INFO] __main__:   debug dashboard stopped
20:32:38 [INFO] __main__:   database closed
20:32:38 [INFO] __main__:   goodbye
20:32:39 [INFO] __main__: === Game Server starting ===
20:32:39 [INFO] __main__: Loading configuration …
20:32:40 [INFO] __main__:   items:        210 loaded from config
20:32:40 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:32:40 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:32:40 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:32:40 [INFO] __main__:   game_config:  loaded
20:32:40 [INFO] __main__: Initializing persistence …
20:32:40 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:32:40 [INFO] __main__:   database:     connected (gameserver.db)
20:32:40 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T20:32:38, version 1)
20:32:40 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
20:32:40 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
20:32:40 [INFO] __main__: Creating services …
20:32:40 [INFO] __main__:   upgrade_provider: 210 items registered
20:32:40 [INFO] __main__:   all services created
20:32:40 [INFO] __main__: Wiring event handlers …
20:32:40 [INFO] __main__:   event handlers registered
20:32:40 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:32:40 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:32:40 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:32:40 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:32:40 [INFO] __main__: Restored 2 empires from saved state
20:32:40 [INFO] __main__: Starting network server …
20:32:40 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:32:40 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:32:40 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:32:40 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:32:40 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:32:40 [INFO] __main__: Starting game loop …
20:32:40 [INFO] __main__:   game loop running (1 s tick)
20:33:04 [INFO] __main__: Shutdown signal received — stopping …
20:33:04 [INFO] __main__: Shutting down …
20:33:04 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
20:33:04 [INFO] websockets.server: server closing
20:33:04 [INFO] websockets.server: server closed
20:33:04 [INFO] gameserver.network.server: WebSocket server stopped
20:33:04 [INFO] __main__:   WebSocket server stopped
20:33:04 [INFO] __main__:   debug dashboard stopped
20:33:04 [INFO] __main__:   database closed
20:33:04 [INFO] __main__:   goodbye
05:34:47 [INFO] __main__: === Game Server starting ===
05:34:47 [INFO] __main__: Loading configuration …
05:34:48 [INFO] __main__:   items:        210 loaded from config
05:34:48 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:34:48 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:34:48 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:34:48 [INFO] __main__:   game_config:  loaded
05:34:48 [INFO] __main__: Initializing persistence …
05:34:48 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:34:48 [INFO] __main__:   database:     connected (gameserver.db)
05:34:48 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-08T20:58:32, version 1)
05:34:48 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
05:34:48 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
05:34:48 [INFO] __main__: Creating services …
05:34:48 [INFO] __main__:   upgrade_provider: 210 items registered
05:34:48 [INFO] __main__:   all services created
05:34:48 [INFO] __main__: Wiring event handlers …
05:34:48 [INFO] __main__:   event handlers registered
05:34:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:34:48 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:34:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:34:48 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:34:48 [INFO] __main__: Restored 2 empires from saved state
05:34:48 [INFO] __main__: Starting network server …
05:34:48 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:34:48 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:34:48 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:34:48 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:34:48 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:34:48 [INFO] __main__: Starting game loop …
05:34:48 [INFO] __main__:   game loop running (1 s tick)
05:34:54 [INFO] websockets.server: connection open
05:34:54 [INFO] gameserver.network.server: Session registered: uid=-1
05:34:54 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63040)
05:34:59 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:34:59 [INFO] gameserver.network.server: Session registered: uid=2
05:34:59 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:36:11 [INFO] gameserver.network.server: Session removed: uid=2
05:36:11 [INFO] websockets.server: connection open
05:36:11 [INFO] gameserver.network.server: Session registered: uid=-2
05:36:11 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 58710)
05:36:11 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:36:11 [INFO] gameserver.network.server: Session registered: uid=2
05:36:11 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:36:18 [INFO] gameserver.network.handlers: new_army from uid=2 (not yet implemented)
05:40:01 [INFO] gameserver.network.server: Session removed: uid=2
05:40:01 [INFO] websockets.server: connection open
05:40:01 [INFO] gameserver.network.server: Session registered: uid=-3
05:40:01 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 63350)
05:40:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:40:01 [INFO] gameserver.network.server: Session registered: uid=2
05:40:01 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
05:40:04 [INFO] gameserver.network.handlers: new_army from uid=2 (not yet implemented)
05:40:10 [INFO] __main__: Shutdown signal received — stopping …
05:40:11 [INFO] __main__: Shutting down …
05:40:11 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
05:40:11 [INFO] websockets.server: server closing
05:40:11 [INFO] gameserver.network.server: Session removed: uid=2
05:40:11 [INFO] websockets.server: server closed
05:40:11 [INFO] gameserver.network.server: WebSocket server stopped
05:40:11 [INFO] __main__:   WebSocket server stopped
05:40:11 [INFO] __main__:   debug dashboard stopped
05:40:11 [INFO] __main__:   database closed
05:40:11 [INFO] __main__:   goodbye
05:40:13 [INFO] __main__: === Game Server starting ===
05:40:13 [INFO] __main__: Loading configuration …
05:40:14 [INFO] __main__:   items:        210 loaded from config
05:40:14 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:40:14 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:40:14 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:40:14 [INFO] __main__:   game_config:  loaded
05:40:14 [INFO] __main__: Initializing persistence …
05:40:14 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:40:14 [INFO] __main__:   database:     connected (gameserver.db)
05:40:14 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T05:40:11, version 1)
05:40:14 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
05:40:14 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
05:40:14 [INFO] __main__: Creating services …
05:40:14 [INFO] __main__:   upgrade_provider: 210 items registered
05:40:14 [INFO] __main__:   all services created
05:40:14 [INFO] __main__: Wiring event handlers …
05:40:14 [INFO] __main__:   event handlers registered
05:40:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:40:14 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:40:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:40:14 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:40:14 [INFO] __main__: Restored 2 empires from saved state
05:40:14 [INFO] __main__: Starting network server …
05:40:14 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:40:14 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:40:14 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:40:14 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:40:14 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:40:14 [INFO] __main__: Starting game loop …
05:40:14 [INFO] __main__:   game loop running (1 s tick)
05:40:14 [INFO] websockets.server: connection open
05:40:14 [INFO] gameserver.network.server: Session registered: uid=-1
05:40:14 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56596)
05:40:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:40:14 [INFO] gameserver.network.server: Session registered: uid=2
05:40:14 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:40:18 [INFO] gameserver.network.server: Session removed: uid=2
05:40:18 [INFO] websockets.server: connection open
05:40:18 [INFO] gameserver.network.server: Session registered: uid=-2
05:40:18 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 61945)
05:40:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:40:18 [INFO] gameserver.network.server: Session registered: uid=2
05:40:18 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:40:19 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
05:40:22 [INFO] gameserver.network.server: Session removed: uid=2
05:40:22 [INFO] websockets.server: connection open
05:40:22 [INFO] gameserver.network.server: Session registered: uid=-3
05:40:22 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 61973)
05:40:22 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:40:22 [INFO] gameserver.network.server: Session registered: uid=2
05:40:22 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
05:40:23 [INFO] gameserver.network.handlers: new_army success uid=2 aid=1 name=dsfgdsfg
05:41:22 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=100
05:41:25 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
05:42:59 [INFO] gameserver.network.server: Session removed: uid=2
05:42:59 [INFO] websockets.server: connection open
05:42:59 [INFO] gameserver.network.server: Session registered: uid=-4
05:42:59 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 58704)
05:42:59 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:42:59 [INFO] gameserver.network.server: Session registered: uid=2
05:42:59 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
05:43:03 [INFO] __main__: Shutdown signal received — stopping …
05:43:03 [INFO] __main__: Shutting down …
05:43:03 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
05:43:03 [INFO] websockets.server: server closing
05:43:03 [INFO] gameserver.network.server: Session removed: uid=2
05:43:03 [INFO] websockets.server: server closed
05:43:03 [INFO] gameserver.network.server: WebSocket server stopped
05:43:03 [INFO] __main__:   WebSocket server stopped
05:43:03 [INFO] __main__:   debug dashboard stopped
05:43:03 [INFO] __main__:   database closed
05:43:03 [INFO] __main__:   goodbye
05:43:06 [INFO] __main__: === Game Server starting ===
05:43:06 [INFO] __main__: Loading configuration …
05:43:06 [INFO] __main__:   items:        210 loaded from config
05:43:06 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:43:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:43:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:43:07 [INFO] __main__:   game_config:  loaded
05:43:07 [INFO] __main__: Initializing persistence …
05:43:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:43:07 [INFO] __main__:   database:     connected (gameserver.db)
05:43:07 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T05:43:03, version 1)
05:43:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
05:43:07 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
05:43:07 [INFO] __main__: Creating services …
05:43:07 [INFO] __main__:   upgrade_provider: 210 items registered
05:43:07 [INFO] __main__:   all services created
05:43:07 [INFO] __main__: Wiring event handlers …
05:43:07 [INFO] __main__:   event handlers registered
05:43:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:43:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:43:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:43:07 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:43:07 [INFO] __main__: Restored 2 empires from saved state
05:43:07 [INFO] __main__: Starting network server …
05:43:07 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:43:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:43:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:43:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:43:07 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:43:07 [INFO] __main__: Starting game loop …
05:43:07 [INFO] __main__:   game loop running (1 s tick)
05:43:07 [INFO] websockets.server: connection open
05:43:07 [INFO] gameserver.network.server: Session registered: uid=-1
05:43:07 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64527)
05:43:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:43:07 [INFO] gameserver.network.server: Session registered: uid=2
05:43:07 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:43:12 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
05:43:27 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
05:44:57 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
05:46:52 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
05:47:00 [INFO] __main__: Shutdown signal received — stopping …
05:47:01 [INFO] __main__: Shutting down …
05:47:01 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
05:47:01 [INFO] websockets.server: server closing
05:47:01 [INFO] gameserver.network.server: Session removed: uid=2
05:47:01 [INFO] websockets.server: server closed
05:47:01 [INFO] gameserver.network.server: WebSocket server stopped
05:47:01 [INFO] __main__:   WebSocket server stopped
05:47:01 [INFO] __main__:   debug dashboard stopped
05:47:01 [INFO] __main__:   database closed
05:47:01 [INFO] __main__:   goodbye
05:47:04 [INFO] __main__: === Game Server starting ===
05:47:04 [INFO] __main__: Loading configuration …
05:47:05 [INFO] __main__:   items:        210 loaded from config
05:47:05 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:47:05 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:47:05 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:47:05 [INFO] __main__:   game_config:  loaded
05:47:05 [INFO] __main__: Initializing persistence …
05:47:05 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:47:05 [INFO] __main__:   database:     connected (gameserver.db)
05:47:05 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T05:47:01, version 1)
05:47:05 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
05:47:05 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
05:47:05 [INFO] __main__: Creating services …
05:47:05 [INFO] __main__:   upgrade_provider: 210 items registered
05:47:05 [INFO] __main__:   all services created
05:47:05 [INFO] __main__: Wiring event handlers …
05:47:05 [INFO] __main__:   event handlers registered
05:47:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:47:05 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:47:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:47:05 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:47:05 [INFO] __main__: Restored 2 empires from saved state
05:47:05 [INFO] __main__: Starting network server …
05:47:05 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:47:05 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:47:05 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:47:05 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:47:05 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:47:05 [INFO] __main__: Starting game loop …
05:47:05 [INFO] __main__:   game loop running (1 s tick)
05:47:05 [INFO] websockets.server: connection open
05:47:05 [INFO] gameserver.network.server: Session registered: uid=-1
05:47:05 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62314)
05:47:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:47:05 [INFO] gameserver.network.server: Session registered: uid=2
05:47:05 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:47:09 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
05:47:13 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
05:47:18 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
05:47:22 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
05:49:10 [INFO] __main__: Shutdown signal received — stopping …
05:49:10 [INFO] __main__: Shutting down …
05:49:10 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
05:49:10 [INFO] websockets.server: server closing
05:49:10 [INFO] gameserver.network.server: Session removed: uid=2
05:49:10 [INFO] websockets.server: server closed
05:49:10 [INFO] gameserver.network.server: WebSocket server stopped
05:49:10 [INFO] __main__:   WebSocket server stopped
05:49:10 [INFO] __main__:   debug dashboard stopped
05:49:10 [INFO] __main__:   database closed
05:49:10 [INFO] __main__:   goodbye
05:49:13 [INFO] __main__: === Game Server starting ===
05:49:13 [INFO] __main__: Loading configuration …
05:49:14 [INFO] __main__:   items:        210 loaded from config
05:49:14 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:49:14 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:49:14 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:49:14 [INFO] __main__:   game_config:  loaded
05:49:14 [INFO] __main__: Initializing persistence …
05:49:14 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:49:14 [INFO] __main__:   database:     connected (gameserver.db)
05:49:14 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T05:49:10, version 1)
05:49:14 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
05:49:14 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
05:49:14 [INFO] __main__: Creating services …
05:49:14 [INFO] __main__:   upgrade_provider: 210 items registered
05:49:14 [INFO] __main__:   all services created
05:49:14 [INFO] __main__: Wiring event handlers …
05:49:14 [INFO] __main__:   event handlers registered
05:49:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:49:14 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:49:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:49:14 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:49:14 [INFO] __main__: Restored 2 empires from saved state
05:49:14 [INFO] __main__: Starting network server …
05:49:14 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:49:14 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:49:14 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:49:14 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:49:14 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:49:14 [INFO] __main__: Starting game loop …
05:49:14 [INFO] __main__:   game loop running (1 s tick)
05:49:14 [INFO] websockets.server: connection open
05:49:14 [INFO] gameserver.network.server: Session registered: uid=-1
05:49:14 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49789)
05:49:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:49:14 [INFO] gameserver.network.server: Session registered: uid=2
05:49:14 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:49:17 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
05:49:22 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
05:50:30 [INFO] __main__: Shutdown signal received — stopping …
05:50:31 [INFO] __main__: Shutting down …
05:50:31 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
05:50:31 [INFO] websockets.server: server closing
05:50:31 [INFO] gameserver.network.server: Session removed: uid=2
05:50:31 [INFO] websockets.server: server closed
05:50:31 [INFO] gameserver.network.server: WebSocket server stopped
05:50:31 [INFO] __main__:   WebSocket server stopped
05:50:31 [INFO] __main__:   debug dashboard stopped
05:50:31 [INFO] __main__:   database closed
05:50:31 [INFO] __main__:   goodbye
05:53:06 [INFO] __main__: === Game Server starting ===
05:53:06 [INFO] __main__: Loading configuration …
05:53:07 [INFO] __main__:   items:        210 loaded from config
05:53:07 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:53:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:53:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:53:07 [INFO] __main__:   game_config:  loaded
05:53:07 [INFO] __main__: Initializing persistence …
05:53:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:53:07 [INFO] __main__:   database:     connected (gameserver.db)
05:53:07 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T05:50:31, version 1)
05:53:07 [ERROR] gameserver.persistence.state_load: Failed to restore empire: 2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 90, in load_state
    empire = _deserialize_empire(empire_dict)
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 143, in _deserialize_empire
    armies = [_deserialize_army(a) for a in d.get("armies", [])]
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 143, in <listcomp>
    armies = [_deserialize_army(a) for a in d.get("armies", [])]
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 222, in _deserialize_army
    direction=Direction(d["direction"]),
KeyError: 'direction'
05:53:07 [INFO] gameserver.persistence.state_load: Restored 1 empires, 0 attacks, 0 battles
05:53:07 [INFO] __main__:   state:        restored from disk (1 empires, 0 attacks)
05:53:07 [INFO] __main__: Creating services …
05:53:07 [INFO] __main__:   upgrade_provider: 210 items registered
05:53:07 [INFO] __main__:   all services created
05:53:07 [INFO] __main__: Wiring event handlers …
05:53:07 [INFO] __main__:   event handlers registered
05:53:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:53:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:53:07 [INFO] __main__: Restored 1 empires from saved state
05:53:07 [INFO] __main__: Starting network server …
05:53:07 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:53:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:53:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:53:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:53:07 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:53:07 [INFO] __main__: Starting game loop …
05:53:07 [INFO] __main__:   game loop running (1 s tick)
05:53:21 [INFO] websockets.server: connection open
05:53:21 [INFO] gameserver.network.server: Session registered: uid=-1
05:53:21 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62508)
05:53:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:53:21 [INFO] gameserver.network.server: Session registered: uid=2
05:53:21 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:54:38 [INFO] gameserver.network.server: Session removed: uid=2
05:54:38 [INFO] websockets.server: connection open
05:54:38 [INFO] gameserver.network.server: Session registered: uid=-2
05:54:38 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60717)
05:54:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:54:38 [INFO] gameserver.network.server: Session registered: uid=2
05:54:38 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:54:48 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
05:55:24 [INFO] __main__: Shutdown signal received — stopping …
05:55:24 [INFO] __main__: Shutting down …
05:55:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (1 empires, 0 attacks, 0 battles)
05:55:24 [INFO] websockets.server: server closing
05:55:24 [INFO] gameserver.network.server: Session removed: uid=2
05:55:24 [INFO] websockets.server: server closed
05:55:24 [INFO] gameserver.network.server: WebSocket server stopped
05:55:24 [INFO] __main__:   WebSocket server stopped
05:55:24 [INFO] __main__:   debug dashboard stopped
05:55:24 [INFO] __main__:   database closed
05:55:24 [INFO] __main__:   goodbye
05:55:25 [INFO] __main__: === Game Server starting ===
05:55:25 [INFO] __main__: Loading configuration …
05:55:26 [INFO] __main__:   items:        210 loaded from config
05:55:26 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:55:26 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:55:26 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:55:26 [INFO] __main__:   game_config:  loaded
05:55:26 [INFO] __main__: Initializing persistence …
05:55:26 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:55:26 [INFO] __main__:   database:     connected (gameserver.db)
05:55:26 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T05:55:24, version 1)
05:55:26 [INFO] gameserver.persistence.state_load: Restored 1 empires, 0 attacks, 0 battles
05:55:26 [INFO] __main__:   state:        restored from disk (1 empires, 0 attacks)
05:55:26 [INFO] __main__: Creating services …
05:55:26 [INFO] __main__:   upgrade_provider: 210 items registered
05:55:26 [INFO] __main__:   all services created
05:55:26 [INFO] __main__: Wiring event handlers …
05:55:26 [INFO] __main__:   event handlers registered
05:55:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:55:26 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:55:26 [INFO] __main__: Restored 1 empires from saved state
05:55:26 [INFO] __main__: Starting network server …
05:55:26 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:55:26 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:55:26 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:55:26 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:55:26 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:55:26 [INFO] __main__: Starting game loop …
05:55:26 [INFO] __main__:   game loop running (1 s tick)
05:55:27 [INFO] websockets.server: connection open
05:55:27 [INFO] gameserver.network.server: Session registered: uid=-1
05:55:27 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64446)
05:55:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:55:27 [INFO] gameserver.network.server: Session registered: uid=2
05:55:27 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:55:44 [INFO] __main__: Shutdown signal received — stopping …
05:55:44 [INFO] __main__: Shutting down …
05:55:44 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (1 empires, 0 attacks, 0 battles)
05:55:44 [INFO] websockets.server: server closing
05:55:44 [INFO] gameserver.network.server: Session removed: uid=2
05:55:44 [INFO] websockets.server: server closed
05:55:44 [INFO] gameserver.network.server: WebSocket server stopped
05:55:44 [INFO] __main__:   WebSocket server stopped
05:55:44 [INFO] __main__:   debug dashboard stopped
05:55:44 [INFO] __main__:   database closed
05:55:44 [INFO] __main__:   goodbye
05:55:56 [INFO] __main__: === Game Server starting ===
05:55:56 [INFO] __main__: Loading configuration …
05:55:57 [INFO] __main__:   items:        210 loaded from config
05:55:57 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:55:57 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:55:57 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:55:57 [INFO] __main__:   game_config:  loaded
05:55:57 [INFO] __main__: Initializing persistence …
05:55:57 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:55:57 [INFO] __main__:   database:     connected (gameserver.db)
05:55:57 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T05:50:31, version 1)
05:55:57 [ERROR] gameserver.persistence.state_load: Failed to restore empire: 2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 90, in load_state
    empire = _deserialize_empire(empire_dict)
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 143, in _deserialize_empire
    armies = [_deserialize_army(a) for a in d.get("armies", [])]
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 143, in <listcomp>
    armies = [_deserialize_army(a) for a in d.get("armies", [])]
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 222, in _deserialize_army
    direction=Direction(d["direction"]),
KeyError: 'direction'
05:55:57 [INFO] gameserver.persistence.state_load: Restored 1 empires, 0 attacks, 0 battles
05:55:57 [INFO] __main__:   state:        restored from disk (1 empires, 0 attacks)
05:55:57 [INFO] __main__: Creating services …
05:55:57 [INFO] __main__:   upgrade_provider: 210 items registered
05:55:57 [INFO] __main__:   all services created
05:55:57 [INFO] __main__: Wiring event handlers …
05:55:57 [INFO] __main__:   event handlers registered
05:55:57 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:55:57 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:55:57 [INFO] __main__: Restored 1 empires from saved state
05:55:57 [INFO] __main__: Starting network server …
05:55:57 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:55:57 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:55:57 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:55:57 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:55:57 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:55:57 [INFO] __main__: Starting game loop …
05:55:57 [INFO] __main__:   game loop running (1 s tick)
05:55:57 [INFO] websockets.server: connection open
05:55:57 [INFO] gameserver.network.server: Session registered: uid=-1
05:55:57 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64453)
05:55:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:55:57 [INFO] gameserver.network.server: Session registered: uid=2
05:55:57 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:56:00 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
05:56:04 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
05:56:09 [INFO] __main__: Shutdown signal received — stopping …
05:56:10 [INFO] __main__: Shutting down …
05:56:10 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (1 empires, 0 attacks, 0 battles)
05:56:10 [INFO] websockets.server: server closing
05:56:10 [INFO] gameserver.network.server: Session removed: uid=2
05:56:10 [INFO] websockets.server: server closed
05:56:10 [INFO] gameserver.network.server: WebSocket server stopped
05:56:10 [INFO] __main__:   WebSocket server stopped
05:56:10 [INFO] __main__:   debug dashboard stopped
05:56:10 [INFO] __main__:   database closed
05:56:10 [INFO] __main__:   goodbye
05:58:53 [INFO] __main__: === Game Server starting ===
05:58:53 [INFO] __main__: Loading configuration …
05:58:54 [INFO] __main__:   items:        210 loaded from config
05:58:54 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:58:54 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:58:54 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:58:54 [INFO] __main__:   game_config:  loaded
05:58:54 [INFO] __main__: Initializing persistence …
05:58:54 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:58:54 [INFO] __main__:   database:     connected (gameserver.db)
05:58:54 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T05:50:31, version 1)
05:58:54 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
05:58:54 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
05:58:54 [INFO] __main__: Creating services …
05:58:54 [INFO] __main__:   upgrade_provider: 210 items registered
05:58:54 [INFO] __main__:   all services created
05:58:54 [INFO] __main__: Wiring event handlers …
05:58:54 [INFO] __main__:   event handlers registered
05:58:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:58:54 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:58:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:58:54 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:58:54 [INFO] __main__: Restored 2 empires from saved state
05:58:54 [INFO] __main__: Starting network server …
05:58:54 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:58:54 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:58:54 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:58:54 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:58:54 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:58:54 [INFO] __main__: Starting game loop …
05:58:54 [INFO] __main__:   game loop running (1 s tick)
05:58:58 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=2
05:59:08 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
05:59:16 [INFO] websockets.server: connection open
05:59:16 [INFO] gameserver.network.server: Session registered: uid=-1
05:59:16 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53280)
05:59:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:59:16 [INFO] gameserver.network.server: Session registered: uid=2
05:59:16 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:59:20 [INFO] gameserver.network.server: Session removed: uid=2
05:59:20 [INFO] websockets.server: connection open
05:59:20 [INFO] gameserver.network.server: Session registered: uid=-2
05:59:20 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 53304)
05:59:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:59:20 [INFO] gameserver.network.server: Session registered: uid=2
05:59:20 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:02:24 [INFO] gameserver.network.server: Session removed: uid=2
06:02:24 [INFO] websockets.server: connection open
06:02:24 [INFO] gameserver.network.server: Session registered: uid=-3
06:02:24 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 57094)
06:02:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:02:24 [INFO] gameserver.network.server: Session registered: uid=2
06:02:24 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
06:02:49 [INFO] gameserver.network.server: Session removed: uid=2
06:02:49 [INFO] websockets.server: connection open
06:02:49 [INFO] gameserver.network.server: Session registered: uid=-4
06:02:49 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 57934)
06:02:49 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:02:49 [INFO] gameserver.network.server: Session registered: uid=2
06:02:49 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
06:06:29 [INFO] __main__: Shutdown signal received — stopping …
06:06:30 [INFO] __main__: Shutting down …
06:06:30 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:06:30 [INFO] websockets.server: server closing
06:06:30 [INFO] gameserver.network.server: Session removed: uid=2
06:06:30 [INFO] websockets.server: server closed
06:06:30 [INFO] gameserver.network.server: WebSocket server stopped
06:06:30 [INFO] __main__:   WebSocket server stopped
06:06:30 [INFO] __main__:   debug dashboard stopped
06:06:30 [INFO] __main__:   database closed
06:06:30 [INFO] __main__:   goodbye
06:06:31 [INFO] __main__: === Game Server starting ===
06:06:31 [INFO] __main__: Loading configuration …
06:06:32 [INFO] __main__:   items:        210 loaded from config
06:06:32 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:06:32 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:06:32 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:06:32 [INFO] __main__:   game_config:  loaded
06:06:32 [INFO] __main__: Initializing persistence …
06:06:32 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:06:32 [INFO] __main__:   database:     connected (gameserver.db)
06:06:32 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:06:30, version 1)
06:06:32 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:06:32 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:06:32 [INFO] __main__: Creating services …
06:06:32 [INFO] __main__:   upgrade_provider: 210 items registered
06:06:32 [INFO] __main__:   all services created
06:06:32 [INFO] __main__: Wiring event handlers …
06:06:32 [INFO] __main__:   event handlers registered
06:06:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:06:32 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:06:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:06:32 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:06:32 [INFO] __main__: Restored 2 empires from saved state
06:06:32 [INFO] __main__: Starting network server …
06:06:32 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:06:32 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:06:32 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:06:32 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:06:32 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:06:32 [INFO] __main__: Starting game loop …
06:06:32 [INFO] __main__:   game loop running (1 s tick)
06:06:33 [INFO] websockets.server: connection open
06:06:33 [INFO] gameserver.network.server: Session registered: uid=-1
06:06:33 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55742)
06:06:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:06:33 [INFO] gameserver.network.server: Session registered: uid=2
06:06:33 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:06:34 [INFO] gameserver.network.server: Session removed: uid=2
06:06:35 [INFO] websockets.server: connection open
06:06:35 [INFO] gameserver.network.server: Session registered: uid=-2
06:06:35 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55765)
06:06:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:06:35 [INFO] gameserver.network.server: Session registered: uid=2
06:06:35 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:06:42 [INFO] gameserver.network.server: Session removed: uid=2
06:06:42 [INFO] websockets.server: connection open
06:06:42 [INFO] gameserver.network.server: Session registered: uid=-3
06:06:42 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 51682)
06:06:42 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:06:42 [INFO] gameserver.network.server: Session registered: uid=2
06:06:42 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
06:07:01 [INFO] gameserver.network.server: Session removed: uid=2
06:07:01 [INFO] websockets.server: connection open
06:07:01 [INFO] gameserver.network.server: Session registered: uid=-4
06:07:01 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 51691)
06:07:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:07:01 [INFO] gameserver.network.server: Session registered: uid=2
06:07:01 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
06:07:01 [INFO] gameserver.network.server: Session removed: uid=2
06:07:01 [INFO] websockets.server: connection open
06:07:01 [INFO] gameserver.network.server: Session registered: uid=-5
06:07:01 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 51696)
06:07:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:07:01 [INFO] gameserver.network.server: Session registered: uid=2
06:07:01 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
06:07:02 [INFO] gameserver.network.server: Session removed: uid=2
06:07:02 [INFO] websockets.server: connection open
06:07:02 [INFO] gameserver.network.server: Session registered: uid=-6
06:07:02 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 51703)
06:07:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:07:02 [INFO] gameserver.network.server: Session registered: uid=2
06:07:02 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
06:07:22 [INFO] gameserver.network.handlers: change_army success uid=2 aid=1: 'hello_army' → 'hello_army2'
06:07:26 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:08:05 [INFO] gameserver.network.server: Session removed: uid=2
06:08:05 [INFO] websockets.server: connection open
06:08:05 [INFO] gameserver.network.server: Session registered: uid=-7
06:08:05 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 51739)
06:08:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:08:05 [INFO] gameserver.network.server: Session registered: uid=2
06:08:05 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
06:08:21 [INFO] gameserver.network.server: Session removed: uid=2
06:08:21 [INFO] websockets.server: connection open
06:08:21 [INFO] gameserver.network.server: Session registered: uid=-8
06:08:21 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 56410)
06:08:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:08:21 [INFO] gameserver.network.server: Session registered: uid=2
06:08:21 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
06:08:29 [INFO] gameserver.network.server: Session removed: uid=2
06:08:29 [INFO] websockets.server: connection open
06:08:29 [INFO] gameserver.network.server: Session registered: uid=-9
06:08:29 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 56420)
06:08:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:08:29 [INFO] gameserver.network.server: Session registered: uid=2
06:08:29 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
06:10:57 [INFO] gameserver.network.server: Session removed: uid=2
06:10:57 [INFO] websockets.server: connection open
06:10:57 [INFO] gameserver.network.server: Session registered: uid=-10
06:10:57 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 61734)
06:10:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:10:57 [INFO] gameserver.network.server: Session registered: uid=2
06:10:57 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
06:13:04 [INFO] gameserver.network.server: Session removed: uid=2
06:13:04 [INFO] websockets.server: connection open
06:13:04 [INFO] gameserver.network.server: Session registered: uid=-11
06:13:04 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('192.168.178.2', 52882)
06:13:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:13:04 [INFO] gameserver.network.server: Session registered: uid=2
06:13:04 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
06:13:06 [INFO] gameserver.network.handlers: new_wave from uid=2 (not yet implemented)
06:13:11 [INFO] __main__: Shutdown signal received — stopping …
06:13:12 [INFO] __main__: Shutting down …
06:13:12 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:13:12 [INFO] websockets.server: server closing
06:13:12 [INFO] gameserver.network.server: Session removed: uid=2
06:13:12 [INFO] websockets.server: server closed
06:13:12 [INFO] gameserver.network.server: WebSocket server stopped
06:13:12 [INFO] __main__:   WebSocket server stopped
06:13:12 [INFO] __main__:   debug dashboard stopped
06:13:12 [INFO] __main__:   database closed
06:13:12 [INFO] __main__:   goodbye
06:13:13 [INFO] __main__: === Game Server starting ===
06:13:13 [INFO] __main__: Loading configuration …
06:13:14 [INFO] __main__:   items:        210 loaded from config
06:13:14 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:13:14 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:13:14 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:13:14 [INFO] __main__:   game_config:  loaded
06:13:14 [INFO] __main__: Initializing persistence …
06:13:14 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:13:14 [INFO] __main__:   database:     connected (gameserver.db)
06:13:14 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:13:12, version 1)
06:13:14 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:13:14 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:13:14 [INFO] __main__: Creating services …
06:13:14 [INFO] __main__:   upgrade_provider: 210 items registered
06:13:14 [INFO] __main__:   all services created
06:13:14 [INFO] __main__: Wiring event handlers …
06:13:14 [INFO] __main__:   event handlers registered
06:13:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:13:14 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:13:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:13:14 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:13:14 [INFO] __main__: Restored 2 empires from saved state
06:13:14 [INFO] __main__: Starting network server …
06:13:14 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:13:14 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:13:14 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:13:14 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:13:14 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:13:14 [INFO] __main__: Starting game loop …
06:13:14 [INFO] __main__:   game loop running (1 s tick)
06:13:15 [INFO] websockets.server: connection open
06:13:15 [INFO] gameserver.network.server: Session registered: uid=-1
06:13:15 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49610)
06:13:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:13:15 [INFO] gameserver.network.server: Session registered: uid=2
06:13:15 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:13:15 [INFO] gameserver.network.server: Session removed: uid=2
06:13:15 [INFO] websockets.server: connection open
06:13:15 [INFO] gameserver.network.server: Session registered: uid=-2
06:13:15 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 49633)
06:13:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:13:15 [INFO] gameserver.network.server: Session registered: uid=2
06:13:15 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:13:16 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 critter=WARRIOR
06:13:22 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:13:29 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 critter=WARRIOR
06:13:31 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:14:19 [INFO] __main__: Shutdown signal received — stopping …
06:14:19 [INFO] __main__: Shutting down …
06:14:19 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:14:19 [INFO] websockets.server: server closing
06:14:19 [INFO] gameserver.network.server: Session removed: uid=2
06:14:19 [INFO] websockets.server: server closed
06:14:19 [INFO] gameserver.network.server: WebSocket server stopped
06:14:19 [INFO] __main__:   WebSocket server stopped
06:14:19 [INFO] __main__:   debug dashboard stopped
06:14:19 [INFO] __main__:   database closed
06:14:19 [INFO] __main__:   goodbye
06:14:54 [INFO] __main__: === Game Server starting ===
06:14:54 [INFO] __main__: Loading configuration …
06:14:54 [INFO] __main__:   items:        210 loaded from config
06:14:55 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:14:55 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:14:55 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:14:55 [INFO] __main__:   game_config:  loaded
06:14:55 [INFO] __main__: Initializing persistence …
06:14:55 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:14:55 [INFO] __main__:   database:     connected (gameserver.db)
06:14:55 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:14:19, version 1)
06:14:55 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:14:55 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:14:55 [INFO] __main__: Creating services …
06:14:55 [INFO] __main__:   upgrade_provider: 210 items registered
06:14:55 [INFO] __main__:   all services created
06:14:55 [INFO] __main__: Wiring event handlers …
06:14:55 [INFO] __main__:   event handlers registered
06:14:55 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:14:55 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:14:55 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:14:55 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:14:55 [INFO] __main__: Restored 2 empires from saved state
06:14:55 [INFO] __main__: Starting network server …
06:14:55 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:14:55 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:14:55 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:14:55 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:14:55 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:14:55 [INFO] __main__: Starting game loop …
06:14:55 [INFO] __main__:   game loop running (1 s tick)
06:14:55 [INFO] websockets.server: connection open
06:14:55 [INFO] gameserver.network.server: Session registered: uid=-1
06:14:55 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 65250)
06:14:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:14:55 [INFO] gameserver.network.server: Session registered: uid=2
06:14:55 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:14:57 [INFO] gameserver.network.server: Session removed: uid=2
06:14:57 [INFO] websockets.server: connection open
06:14:57 [INFO] gameserver.network.server: Session registered: uid=-2
06:14:57 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 65273)
06:14:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:14:57 [INFO] gameserver.network.server: Session registered: uid=2
06:14:57 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:16:21 [INFO] __main__: Shutdown signal received — stopping …
06:16:22 [INFO] __main__: Shutting down …
06:16:22 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:16:22 [INFO] websockets.server: server closing
06:16:22 [INFO] gameserver.network.server: Session removed: uid=2
06:16:22 [INFO] websockets.server: server closed
06:16:22 [INFO] gameserver.network.server: WebSocket server stopped
06:16:22 [INFO] __main__:   WebSocket server stopped
06:16:22 [INFO] __main__:   debug dashboard stopped
06:16:22 [INFO] __main__:   database closed
06:16:22 [INFO] __main__:   goodbye
06:16:24 [INFO] __main__: === Game Server starting ===
06:16:24 [INFO] __main__: Loading configuration …
06:16:25 [INFO] __main__:   items:        210 loaded from config
06:16:25 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:16:25 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:16:25 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:16:25 [INFO] __main__:   game_config:  loaded
06:16:25 [INFO] __main__: Initializing persistence …
06:16:25 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:16:25 [INFO] __main__:   database:     connected (gameserver.db)
06:16:25 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:16:22, version 1)
06:16:25 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:16:25 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:16:25 [INFO] __main__: Creating services …
06:16:25 [INFO] __main__:   upgrade_provider: 210 items registered
06:16:25 [INFO] __main__:   all services created
06:16:25 [INFO] __main__: Wiring event handlers …
06:16:25 [INFO] __main__:   event handlers registered
06:16:25 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:16:25 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:16:25 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:16:25 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:16:25 [INFO] __main__: Restored 2 empires from saved state
06:16:25 [INFO] __main__: Starting network server …
06:16:25 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:16:25 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:16:25 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:16:25 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:16:25 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:16:25 [INFO] __main__: Starting game loop …
06:16:25 [INFO] __main__:   game loop running (1 s tick)
06:16:25 [INFO] websockets.server: connection open
06:16:25 [INFO] gameserver.network.server: Session registered: uid=-1
06:16:25 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52176)
06:16:25 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:16:25 [INFO] gameserver.network.server: Session registered: uid=2
06:16:25 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:16:27 [INFO] gameserver.network.server: Session removed: uid=2
06:16:27 [INFO] websockets.server: connection open
06:16:27 [INFO] gameserver.network.server: Session registered: uid=-2
06:16:27 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 52199)
06:16:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:16:27 [INFO] gameserver.network.server: Session registered: uid=2
06:16:27 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:22:55 [INFO] gameserver.network.server: Session removed: uid=2
06:22:56 [INFO] websockets.server: connection open
06:22:56 [INFO] gameserver.network.server: Session registered: uid=-3
06:22:56 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 57948)
06:22:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:22:56 [INFO] gameserver.network.server: Session registered: uid=2
06:22:56 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
06:23:05 [INFO] __main__: Shutdown signal received — stopping …
06:23:05 [INFO] __main__: Shutting down …
06:23:05 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:23:05 [INFO] websockets.server: server closing
06:23:05 [INFO] gameserver.network.server: Session removed: uid=2
06:23:05 [INFO] websockets.server: server closed
06:23:05 [INFO] gameserver.network.server: WebSocket server stopped
06:23:05 [INFO] __main__:   WebSocket server stopped
06:23:05 [INFO] __main__:   debug dashboard stopped
06:23:05 [INFO] __main__:   database closed
06:23:05 [INFO] __main__:   goodbye
06:23:07 [INFO] __main__: === Game Server starting ===
06:23:07 [INFO] __main__: Loading configuration …
06:23:07 [INFO] __main__:   items:        210 loaded from config
06:23:07 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:23:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:23:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:23:07 [INFO] __main__:   game_config:  loaded
06:23:07 [INFO] __main__: Initializing persistence …
06:23:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:23:07 [INFO] __main__:   database:     connected (gameserver.db)
06:23:07 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:23:05, version 1)
06:23:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:23:07 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:23:07 [INFO] __main__: Creating services …
06:23:07 [INFO] __main__:   upgrade_provider: 210 items registered
06:23:07 [INFO] __main__:   all services created
06:23:07 [INFO] __main__: Wiring event handlers …
06:23:07 [INFO] __main__:   event handlers registered
06:23:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:23:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:23:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:23:07 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:23:07 [INFO] __main__: Restored 2 empires from saved state
06:23:07 [INFO] __main__: Starting network server …
06:23:07 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:23:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:23:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:23:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:23:07 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:23:07 [INFO] __main__: Starting game loop …
06:23:07 [INFO] __main__:   game loop running (1 s tick)
06:23:08 [INFO] websockets.server: connection open
06:23:08 [INFO] gameserver.network.server: Session registered: uid=-1
06:23:08 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55103)
06:23:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:23:08 [INFO] gameserver.network.server: Session registered: uid=2
06:23:08 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:23:09 [INFO] gameserver.network.server: Session removed: uid=2
06:23:09 [INFO] websockets.server: connection open
06:23:09 [INFO] gameserver.network.server: Session registered: uid=-2
06:23:09 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55126)
06:23:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:23:09 [INFO] gameserver.network.server: Session registered: uid=2
06:23:09 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:23:12 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=TRANSPORTER slots=1
06:23:13 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=TRANSPORTER slots=1
06:23:14 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=TRANSPORTER slots=1
06:23:14 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=TRANSPORTER slots=1
06:23:14 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=TRANSPORTER slots=1
06:23:16 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SAMURAI slots=1
06:25:29 [INFO] gameserver.network.server: Session removed: uid=2
06:25:29 [INFO] websockets.server: connection open
06:25:29 [INFO] gameserver.network.server: Session registered: uid=-3
06:25:29 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 61023)
06:25:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:25:29 [INFO] gameserver.network.server: Session registered: uid=2
06:25:29 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
06:25:31 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=TRANSPORTER slots=1
06:25:33 [INFO] __main__: Shutdown signal received — stopping …
06:25:34 [INFO] __main__: Shutting down …
06:25:34 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:25:34 [INFO] websockets.server: server closing
06:25:34 [INFO] gameserver.network.server: Session removed: uid=2
06:25:34 [INFO] websockets.server: server closed
06:25:34 [INFO] gameserver.network.server: WebSocket server stopped
06:25:34 [INFO] __main__:   WebSocket server stopped
06:25:34 [INFO] __main__:   debug dashboard stopped
06:25:34 [INFO] __main__:   database closed
06:25:34 [INFO] __main__:   goodbye
06:25:35 [INFO] __main__: === Game Server starting ===
06:25:35 [INFO] __main__: Loading configuration …
06:25:36 [INFO] __main__:   items:        210 loaded from config
06:25:36 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:25:36 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:25:36 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:25:36 [INFO] __main__:   game_config:  loaded
06:25:36 [INFO] __main__: Initializing persistence …
06:25:36 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:25:36 [INFO] __main__:   database:     connected (gameserver.db)
06:25:36 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:25:34, version 1)
06:25:36 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:25:36 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:25:36 [INFO] __main__: Creating services …
06:25:36 [INFO] __main__:   upgrade_provider: 210 items registered
06:25:36 [INFO] __main__:   all services created
06:25:36 [INFO] __main__: Wiring event handlers …
06:25:36 [INFO] __main__:   event handlers registered
06:25:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:25:36 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:25:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:25:36 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:25:36 [INFO] __main__: Restored 2 empires from saved state
06:25:36 [INFO] __main__: Starting network server …
06:25:36 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:25:36 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:25:36 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:25:36 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:25:36 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:25:36 [INFO] __main__: Starting game loop …
06:25:36 [INFO] __main__:   game loop running (1 s tick)
06:25:37 [INFO] websockets.server: connection open
06:25:37 [INFO] gameserver.network.server: Session registered: uid=-1
06:25:37 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54370)
06:25:37 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:25:37 [INFO] gameserver.network.server: Session registered: uid=2
06:25:37 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:25:44 [INFO] gameserver.network.server: Session removed: uid=2
06:25:45 [INFO] websockets.server: connection open
06:25:45 [INFO] gameserver.network.server: Session registered: uid=-2
06:25:45 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55146)
06:25:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:25:45 [INFO] gameserver.network.server: Session registered: uid=2
06:25:45 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:25:46 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=TRANSPORTER slots=1
06:25:51 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:26:07 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=1
06:26:11 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:26:14 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=1
06:26:17 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:26:59 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=1
06:26:59 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=1
06:26:59 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=1
06:27:00 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SAMURAI slots=1
06:27:00 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SAMURAI slots=1
06:27:00 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SAMURAI slots=1
06:27:00 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 critter=WARRIOR
06:27:01 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=WARRIOR slots=1
06:27:01 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=WARRIOR slots=1
06:27:01 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=WARRIOR slots=1
06:27:04 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:27:46 [INFO] gameserver.network.handlers: change_army success uid=2 aid=1: 'hello_army2' → 'hello_army'
06:28:33 [INFO] gameserver.network.server: Session removed: uid=2
06:28:33 [INFO] websockets.server: connection open
06:28:33 [INFO] gameserver.network.server: Session registered: uid=-3
06:28:33 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60929)
06:28:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:28:33 [INFO] gameserver.network.server: Session registered: uid=2
06:28:33 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
06:28:36 [INFO] gameserver.network.handlers: change_army success uid=2 aid=1: 'hello_army' → 'hello_army'
06:28:48 [INFO] gameserver.network.server: Session removed: uid=2
06:28:48 [INFO] websockets.server: connection open
06:28:48 [INFO] gameserver.network.server: Session registered: uid=-4
06:28:48 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 58048)
06:28:48 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:28:48 [INFO] gameserver.network.server: Session registered: uid=2
06:28:48 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
06:28:56 [INFO] __main__: Shutdown signal received — stopping …
06:28:56 [INFO] __main__: Shutting down …
06:28:56 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:28:56 [INFO] websockets.server: server closing
06:28:56 [INFO] gameserver.network.server: Session removed: uid=2
06:28:56 [INFO] websockets.server: server closed
06:28:56 [INFO] gameserver.network.server: WebSocket server stopped
06:28:56 [INFO] __main__:   WebSocket server stopped
06:28:56 [INFO] __main__:   debug dashboard stopped
06:28:56 [INFO] __main__:   database closed
06:28:56 [INFO] __main__:   goodbye
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_typing_extra.py", line 492, in _eval_type_backport
    return _eval_type(value, globalns, localns, type_params)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_typing_extra.py", line 545, in _eval_type
    return typing._eval_type(  # type: ignore
  File "/usr/lib/python3.9/typing.py", line 283, in _eval_type
    return t._evaluate(globalns, localns, recursive_guard)
  File "/usr/lib/python3.9/typing.py", line 539, in _evaluate
    eval(self.__forward_code__, globalns, localns),
  File "<string>", line 1, in <module>
TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 40, in <module>
    from gameserver.network.router import Router
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 16, in <module>
    from gameserver.models.messages import GameMessage, parse_message
  File "/home/pi/e3/python_server/src/gameserver/models/messages.py", line 151, in <module>
    class ChangeWaveRequest(GameMessage):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_model_construction.py", line 242, in __new__
    set_model_fields(cls, config_wrapper=config_wrapper, ns_resolver=ns_resolver)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_model_construction.py", line 566, in set_model_fields
    fields, class_vars = collect_model_fields(cls, config_wrapper, ns_resolver, typevars_map=typevars_map)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_fields.py", line 256, in collect_model_fields
    type_hints = _typing_extra.get_model_type_hints(cls, ns_resolver=ns_resolver)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_typing_extra.py", line 350, in get_model_type_hints
    hints[name] = try_eval_type(value, globalns, localns)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_typing_extra.py", line 404, in try_eval_type
    return eval_type_backport(value, globalns, localns), True
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_typing_extra.py", line 455, in eval_type_backport
    return _eval_type_backport(value, globalns, localns, type_params)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/pydantic/_internal/_typing_extra.py", line 500, in _eval_type_backport
    raise TypeError(
TypeError: Unable to evaluate type annotation 'int | None'. If you are making use of the new typing syntax (unions using `|` since Python 3.10 or builtins subscripting since Python 3.9), you should either replace the use of new syntax with the existing `typing` constructs or install the `eval_type_backport` package.
06:29:59 [INFO] __main__: === Game Server starting ===
06:29:59 [INFO] __main__: Loading configuration …
06:30:00 [INFO] __main__:   items:        210 loaded from config
06:30:00 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:30:00 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:30:00 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:30:00 [INFO] __main__:   game_config:  loaded
06:30:00 [INFO] __main__: Initializing persistence …
06:30:00 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:30:00 [INFO] __main__:   database:     connected (gameserver.db)
06:30:00 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:28:56, version 1)
06:30:00 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:30:00 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:30:00 [INFO] __main__: Creating services …
06:30:00 [INFO] __main__:   upgrade_provider: 210 items registered
06:30:00 [INFO] __main__:   all services created
06:30:00 [INFO] __main__: Wiring event handlers …
06:30:00 [INFO] __main__:   event handlers registered
06:30:00 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:30:00 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:30:00 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:30:00 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:30:00 [INFO] __main__: Restored 2 empires from saved state
06:30:00 [INFO] __main__: Starting network server …
06:30:00 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:30:00 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:30:00 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:30:00 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:30:00 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:30:00 [INFO] __main__: Starting game loop …
06:30:00 [INFO] __main__:   game loop running (1 s tick)
06:30:07 [INFO] websockets.server: connection open
06:30:07 [INFO] gameserver.network.server: Session registered: uid=-1
06:30:07 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55043)
06:30:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:30:07 [INFO] gameserver.network.server: Session registered: uid=2
06:30:07 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:30:11 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=2
06:30:13 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SAMURAI slots=2
06:30:15 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:31:15 [INFO] gameserver.network.server: Session removed: uid=2
06:31:15 [INFO] websockets.server: connection open
06:31:15 [INFO] gameserver.network.server: Session registered: uid=-2
06:31:15 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55648)
06:31:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:31:15 [INFO] gameserver.network.server: Session registered: uid=2
06:31:15 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:31:17 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=3
06:31:17 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=4
06:32:15 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:34:52 [INFO] __main__: Shutdown signal received — stopping …
06:34:53 [INFO] __main__: Shutting down …
06:34:53 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:34:53 [INFO] websockets.server: server closing
06:34:53 [INFO] gameserver.network.server: Session removed: uid=2
06:34:53 [INFO] websockets.server: server closed
06:34:53 [INFO] gameserver.network.server: WebSocket server stopped
06:34:53 [INFO] __main__:   WebSocket server stopped
06:34:53 [INFO] __main__:   debug dashboard stopped
06:34:53 [INFO] __main__:   database closed
06:34:53 [INFO] __main__:   goodbye
06:36:51 [INFO] __main__: === Game Server starting ===
06:36:51 [INFO] __main__: Loading configuration …
06:36:52 [INFO] __main__:   items:        210 loaded from config
06:36:52 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:36:52 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:36:52 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:36:52 [INFO] __main__:   game_config:  loaded
06:36:52 [INFO] __main__: Initializing persistence …
06:36:52 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:36:52 [INFO] __main__:   database:     connected (gameserver.db)
06:36:52 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:34:53, version 1)
06:36:52 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:36:52 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:36:52 [INFO] __main__: Creating services …
06:36:52 [INFO] __main__:   upgrade_provider: 210 items registered
06:36:52 [INFO] __main__:   all services created
06:36:52 [INFO] __main__: Wiring event handlers …
06:36:52 [INFO] __main__:   event handlers registered
06:36:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:36:52 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:36:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:36:52 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:36:52 [INFO] __main__: Restored 2 empires from saved state
06:36:52 [INFO] __main__: Starting network server …
06:36:52 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:36:52 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:36:52 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:36:52 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:36:52 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:36:52 [INFO] __main__: Starting game loop …
06:36:52 [INFO] __main__:   game loop running (1 s tick)
06:36:57 [INFO] websockets.server: connection open
06:36:57 [INFO] gameserver.network.server: Session registered: uid=-1
06:36:57 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64387)
06:36:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:36:57 [INFO] gameserver.network.server: Session registered: uid=2
06:36:57 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:37:00 [INFO] gameserver.network.handlers: new_army success uid=2 aid=1 name=test
06:37:03 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 critter=WARRIOR with 5 placeholders
06:37:06 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=SLAVE slots=5
06:37:14 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 critter=WARRIOR with 5 placeholders
06:37:18 [INFO] gameserver.network.server: Session removed: uid=2
06:37:18 [INFO] websockets.server: connection open
06:37:18 [INFO] gameserver.network.server: Session registered: uid=-2
06:37:18 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59028)
06:37:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:37:18 [INFO] gameserver.network.server: Session registered: uid=2
06:37:18 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:40:42 [INFO] __main__: Shutdown signal received — stopping …
06:40:43 [INFO] __main__: Shutting down …
06:40:43 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:40:43 [INFO] websockets.server: server closing
06:40:43 [INFO] gameserver.network.server: Session removed: uid=2
06:40:43 [INFO] websockets.server: server closed
06:40:43 [INFO] gameserver.network.server: WebSocket server stopped
06:40:43 [INFO] __main__:   WebSocket server stopped
06:40:43 [INFO] __main__:   debug dashboard stopped
06:40:43 [INFO] __main__:   database closed
06:40:43 [INFO] __main__:   goodbye
06:40:44 [INFO] __main__: === Game Server starting ===
06:40:44 [INFO] __main__: Loading configuration …
06:40:45 [INFO] __main__:   items:        210 loaded from config
06:40:45 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:40:45 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:40:45 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:40:45 [INFO] __main__:   game_config:  loaded
06:40:45 [INFO] __main__: Initializing persistence …
06:40:45 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:40:45 [INFO] __main__:   database:     connected (gameserver.db)
06:40:45 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:40:43, version 1)
06:40:45 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:40:45 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:40:45 [INFO] __main__: Creating services …
06:40:45 [INFO] __main__:   upgrade_provider: 210 items registered
06:40:45 [INFO] __main__:   all services created
06:40:45 [INFO] __main__: Wiring event handlers …
06:40:45 [INFO] __main__:   event handlers registered
06:40:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:40:45 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:40:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:40:45 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:40:45 [INFO] __main__: Restored 2 empires from saved state
06:40:45 [INFO] __main__: Starting network server …
06:40:45 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:40:45 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:40:45 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:40:45 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:40:45 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:40:45 [INFO] __main__: Starting game loop …
06:40:45 [INFO] __main__:   game loop running (1 s tick)
06:40:46 [INFO] websockets.server: connection open
06:40:46 [INFO] gameserver.network.server: Session registered: uid=-1
06:40:46 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59527)
06:40:46 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:40:46 [INFO] gameserver.network.server: Session registered: uid=2
06:40:46 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:40:47 [INFO] gameserver.network.server: Session removed: uid=2
06:40:47 [INFO] websockets.server: connection open
06:40:47 [INFO] gameserver.network.server: Session registered: uid=-2
06:40:47 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59549)
06:40:47 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:40:47 [INFO] gameserver.network.server: Session registered: uid=2
06:40:47 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:40:50 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=WARRIOR slots=5
06:40:52 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE slots=5
06:40:53 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 with 5 SLAVE critters
06:40:54 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE slots=6
06:40:54 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE slots=7
06:40:55 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE slots=8
06:40:55 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE slots=9
06:40:55 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE slots=10
06:40:56 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE slots=6
06:40:56 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE slots=7
06:40:57 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE slots=8
06:40:57 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE slots=9
06:41:43 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:41:54 [INFO] __main__: Shutdown signal received — stopping …
06:41:54 [INFO] __main__: Shutting down …
06:41:55 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:41:55 [INFO] websockets.server: server closing
06:41:55 [INFO] gameserver.network.server: Session removed: uid=2
06:41:55 [INFO] websockets.server: server closed
06:41:55 [INFO] gameserver.network.server: WebSocket server stopped
06:41:55 [INFO] __main__:   WebSocket server stopped
06:41:55 [INFO] __main__:   debug dashboard stopped
06:41:55 [INFO] __main__:   database closed
06:41:55 [INFO] __main__:   goodbye
06:43:48 [INFO] __main__: === Game Server starting ===
06:43:48 [INFO] __main__: Loading configuration …
06:43:49 [INFO] __main__:   items:        210 loaded from config
06:43:49 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:43:49 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:43:49 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:43:49 [INFO] __main__:   game_config:  loaded
06:43:49 [INFO] __main__: Initializing persistence …
06:43:49 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:43:49 [INFO] __main__:   database:     connected (gameserver.db)
06:43:49 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:41:54, version 1)
06:43:49 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:43:49 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:43:49 [INFO] __main__: Creating services …
06:43:49 [INFO] __main__:   upgrade_provider: 210 items registered
06:43:49 [INFO] __main__:   all services created
06:43:49 [INFO] __main__: Wiring event handlers …
06:43:49 [INFO] __main__:   event handlers registered
06:43:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:43:49 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:43:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:43:49 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:43:49 [INFO] __main__: Restored 2 empires from saved state
06:43:49 [INFO] __main__: Starting network server …
06:43:49 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:43:49 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:43:49 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:43:49 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:43:49 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:43:49 [INFO] __main__: Starting game loop …
06:43:49 [INFO] __main__:   game loop running (1 s tick)
06:43:51 [INFO] websockets.server: connection open
06:43:51 [INFO] gameserver.network.server: Session registered: uid=-1
06:43:51 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57187)
06:43:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:43:51 [INFO] gameserver.network.server: Session registered: uid=2
06:43:51 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:43:52 [INFO] gameserver.network.server: Session removed: uid=2
06:43:52 [INFO] websockets.server: connection open
06:43:52 [INFO] gameserver.network.server: Session registered: uid=-2
06:43:52 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57209)
06:43:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:43:52 [INFO] gameserver.network.server: Session registered: uid=2
06:43:52 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:43:54 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE critter_count=11
06:43:55 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE critter_count=11
06:43:56 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE critter_count=11
06:43:56 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE critter_count=11
06:43:56 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE critter_count=11
06:43:57 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE critter_count=10
06:43:58 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE critter_count=10
06:43:58 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE critter_count=10
06:43:58 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=WARRIOR critter_count=6
06:43:59 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=WARRIOR critter_count=6
06:43:59 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=WARRIOR critter_count=6
06:44:56 [INFO] __main__: Shutdown signal received — stopping …
06:44:56 [INFO] __main__: Shutting down …
06:44:56 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:44:56 [INFO] websockets.server: server closing
06:44:56 [INFO] gameserver.network.server: Session removed: uid=2
06:44:56 [INFO] websockets.server: server closed
06:44:56 [INFO] gameserver.network.server: WebSocket server stopped
06:44:56 [INFO] __main__:   WebSocket server stopped
06:44:56 [INFO] __main__:   debug dashboard stopped
06:44:56 [INFO] __main__:   database closed
06:44:56 [INFO] __main__:   goodbye
06:47:41 [INFO] __main__: === Game Server starting ===
06:47:41 [INFO] __main__: Loading configuration …
06:47:42 [INFO] __main__:   items:        210 loaded from config
06:47:42 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:47:42 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:47:42 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:47:42 [INFO] __main__:   game_config:  loaded
06:47:42 [INFO] __main__: Initializing persistence …
06:47:42 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:47:42 [INFO] __main__:   database:     connected (gameserver.db)
06:47:42 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:44:56, version 1)
06:47:42 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:47:42 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:47:42 [INFO] __main__: Creating services …
06:47:42 [INFO] __main__:   upgrade_provider: 210 items registered
06:47:42 [INFO] __main__:   all services created
06:47:42 [INFO] __main__: Wiring event handlers …
06:47:42 [INFO] __main__:   event handlers registered
06:47:42 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:47:42 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:47:42 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:47:42 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:47:42 [INFO] __main__: Restored 2 empires from saved state
06:47:42 [INFO] __main__: Starting network server …
06:47:42 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:47:42 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:47:42 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:47:42 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:47:42 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:47:42 [INFO] __main__: Starting game loop …
06:47:42 [INFO] __main__:   game loop running (1 s tick)
06:47:51 [INFO] websockets.server: connection open
06:47:51 [INFO] gameserver.network.server: Session registered: uid=-1
06:47:51 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53487)
06:47:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:47:51 [INFO] gameserver.network.server: Session registered: uid=2
06:47:51 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:47:55 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=WARRIOR critter_count=2
06:47:56 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=WARRIOR critter_count=2
06:47:56 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=WARRIOR critter_count=2
06:47:57 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE critter_count=2
06:47:58 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=2 critter=SLAVE critter_count=2
06:48:14 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:48:27 [INFO] __main__: Shutdown signal received — stopping …
06:48:27 [INFO] __main__: Shutting down …
06:48:27 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:48:27 [INFO] websockets.server: server closing
06:48:27 [INFO] gameserver.network.server: Session removed: uid=2
06:48:27 [INFO] websockets.server: server closed
06:48:27 [INFO] gameserver.network.server: WebSocket server stopped
06:48:27 [INFO] __main__:   WebSocket server stopped
06:48:27 [INFO] __main__:   debug dashboard stopped
06:48:27 [INFO] __main__:   database closed
06:48:27 [INFO] __main__:   goodbye
06:49:32 [INFO] __main__: === Game Server starting ===
06:49:32 [INFO] __main__: Loading configuration …
06:49:33 [INFO] __main__:   items:        210 loaded from config
06:49:33 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:49:33 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:49:33 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:49:33 [INFO] __main__:   game_config:  loaded
06:49:33 [INFO] __main__: Initializing persistence …
06:49:33 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:49:33 [INFO] __main__:   database:     connected (gameserver.db)
06:49:33 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:48:27, version 1)
06:49:33 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:49:33 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:49:33 [INFO] __main__: Creating services …
06:49:33 [INFO] __main__:   upgrade_provider: 210 items registered
06:49:33 [INFO] __main__:   all services created
06:49:33 [INFO] __main__: Wiring event handlers …
06:49:33 [INFO] __main__:   event handlers registered
06:49:33 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:49:33 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:49:33 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:49:33 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:49:33 [INFO] __main__: Restored 2 empires from saved state
06:49:33 [INFO] __main__: Starting network server …
06:49:33 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:49:33 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:49:33 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:49:33 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:49:33 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:49:33 [INFO] __main__: Starting game loop …
06:49:33 [INFO] __main__:   game loop running (1 s tick)
06:49:44 [INFO] websockets.server: connection open
06:49:44 [INFO] gameserver.network.server: Session registered: uid=-1
06:49:44 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57955)
06:49:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:49:44 [INFO] gameserver.network.server: Session registered: uid=2
06:49:44 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:49:46 [INFO] gameserver.network.server: Session removed: uid=2
06:49:46 [INFO] websockets.server: connection open
06:49:46 [INFO] gameserver.network.server: Session registered: uid=-2
06:49:46 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57977)
06:49:46 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:49:46 [INFO] gameserver.network.server: Session registered: uid=2
06:49:46 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:49:52 [INFO] __main__: Shutdown signal received — stopping …
06:49:53 [INFO] __main__: Shutting down …
06:49:53 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:49:53 [INFO] websockets.server: server closing
06:49:53 [INFO] gameserver.network.server: Session removed: uid=2
06:49:53 [INFO] websockets.server: server closed
06:49:53 [INFO] gameserver.network.server: WebSocket server stopped
06:49:53 [INFO] __main__:   WebSocket server stopped
06:49:53 [INFO] __main__:   debug dashboard stopped
06:49:53 [INFO] __main__:   database closed
06:49:53 [INFO] __main__:   goodbye
06:50:01 [INFO] __main__: === Game Server starting ===
06:50:01 [INFO] __main__: Loading configuration …
06:50:01 [INFO] __main__:   items:        210 loaded from config
06:50:01 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:50:01 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:50:01 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:50:01 [INFO] __main__:   game_config:  loaded
06:50:01 [INFO] __main__: Initializing persistence …
06:50:01 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:50:01 [INFO] __main__:   database:     connected (gameserver.db)
06:50:01 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:49:53, version 1)
06:50:01 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:50:01 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:50:01 [INFO] __main__: Creating services …
06:50:01 [INFO] __main__:   upgrade_provider: 210 items registered
06:50:01 [INFO] __main__:   all services created
06:50:01 [INFO] __main__: Wiring event handlers …
06:50:01 [INFO] __main__:   event handlers registered
06:50:01 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:50:01 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:50:01 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:50:01 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:50:01 [INFO] __main__: Restored 2 empires from saved state
06:50:01 [INFO] __main__: Starting network server …
06:50:01 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:50:01 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:50:01 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:50:01 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:50:01 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:50:01 [INFO] __main__: Starting game loop …
06:50:01 [INFO] __main__:   game loop running (1 s tick)
06:50:03 [INFO] websockets.server: connection open
06:50:03 [INFO] gameserver.network.server: Session registered: uid=-1
06:50:03 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57984)
06:50:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:50:03 [INFO] gameserver.network.server: Session registered: uid=2
06:50:03 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:50:07 [INFO] gameserver.network.server: Session removed: uid=2
06:50:07 [INFO] websockets.server: connection open
06:50:07 [INFO] gameserver.network.server: Session registered: uid=-2
06:50:07 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57987)
06:50:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:50:07 [INFO] gameserver.network.server: Session registered: uid=2
06:50:07 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:50:07 [INFO] gameserver.network.server: Session removed: uid=2
06:50:07 [INFO] websockets.server: connection open
06:50:07 [INFO] gameserver.network.server: Session registered: uid=-3
06:50:07 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 57989)
06:50:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:50:07 [INFO] gameserver.network.server: Session registered: uid=2
06:50:07 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
06:50:07 [INFO] gameserver.network.server: Session removed: uid=2
06:50:07 [INFO] websockets.server: connection open
06:50:07 [INFO] gameserver.network.server: Session registered: uid=-4
06:50:07 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 57991)
06:50:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:50:07 [INFO] gameserver.network.server: Session registered: uid=2
06:50:07 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
06:50:07 [INFO] gameserver.network.server: Session removed: uid=2
06:50:08 [INFO] websockets.server: connection open
06:50:08 [INFO] gameserver.network.server: Session registered: uid=-5
06:50:08 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 57993)
06:50:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:50:08 [INFO] gameserver.network.server: Session registered: uid=2
06:50:08 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
06:50:17 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
06:50:38 [INFO] __main__: Shutdown signal received — stopping …
06:50:39 [INFO] __main__: Shutting down …
06:50:39 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:50:39 [INFO] websockets.server: server closing
06:50:39 [INFO] gameserver.network.server: Session removed: uid=2
06:50:39 [INFO] websockets.server: server closed
06:50:39 [INFO] gameserver.network.server: WebSocket server stopped
06:50:39 [INFO] __main__:   WebSocket server stopped
06:50:39 [INFO] __main__:   debug dashboard stopped
06:50:39 [INFO] __main__:   database closed
06:50:39 [INFO] __main__:   goodbye
06:51:08 [INFO] __main__: === Game Server starting ===
06:51:08 [INFO] __main__: Loading configuration …
06:51:09 [INFO] __main__:   items:        210 loaded from config
06:51:09 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:51:09 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:51:09 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:51:09 [INFO] __main__:   game_config:  loaded
06:51:09 [INFO] __main__: Initializing persistence …
06:51:09 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:51:09 [INFO] __main__:   database:     connected (gameserver.db)
06:51:09 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:50:39, version 1)
06:51:09 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:51:09 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:51:09 [INFO] __main__: Creating services …
06:51:09 [INFO] __main__:   upgrade_provider: 210 items registered
06:51:09 [INFO] __main__:   all services created
06:51:09 [INFO] __main__: Wiring event handlers …
06:51:09 [INFO] __main__:   event handlers registered
06:51:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:51:09 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:51:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:51:09 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:51:09 [INFO] __main__: Restored 2 empires from saved state
06:51:09 [INFO] __main__: Starting network server …
06:51:09 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:51:09 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:51:09 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:51:09 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:51:09 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:51:09 [INFO] __main__: Starting game loop …
06:51:09 [INFO] __main__:   game loop running (1 s tick)
06:51:09 [INFO] websockets.server: connection open
06:51:09 [INFO] gameserver.network.server: Session registered: uid=-1
06:51:09 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59686)
06:51:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:51:09 [INFO] gameserver.network.server: Session registered: uid=2
06:51:09 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:51:11 [INFO] gameserver.network.server: Session removed: uid=2
06:51:11 [INFO] websockets.server: connection open
06:51:11 [INFO] gameserver.network.server: Session registered: uid=-2
06:51:11 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59691)
06:51:11 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:51:11 [INFO] gameserver.network.server: Session registered: uid=2
06:51:11 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:51:15 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter=WARRIOR critter_count=2
06:51:23 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 with 5 SLAVE critters
06:51:24 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE critter_count=2
06:51:24 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE critter_count=2
06:51:25 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE critter_count=2
06:51:25 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter=SLAVE critter_count=2
06:51:36 [INFO] __main__: Shutdown signal received — stopping …
06:51:36 [INFO] __main__: Shutting down …
06:51:36 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:51:36 [INFO] websockets.server: server closing
06:51:36 [INFO] gameserver.network.server: Session removed: uid=2
06:51:36 [INFO] websockets.server: server closed
06:51:36 [INFO] gameserver.network.server: WebSocket server stopped
06:51:36 [INFO] __main__:   WebSocket server stopped
06:51:36 [INFO] __main__:   debug dashboard stopped
06:51:36 [INFO] __main__:   database closed
06:51:36 [INFO] __main__:   goodbye
06:56:31 [INFO] __main__: === Game Server starting ===
06:56:31 [INFO] __main__: Loading configuration …
06:56:32 [INFO] __main__:   items:        210 loaded from config
06:56:32 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:56:32 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:56:32 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:56:32 [INFO] __main__:   game_config:  loaded
06:56:32 [INFO] __main__: Initializing persistence …
06:56:32 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:56:32 [INFO] __main__:   database:     connected (gameserver.db)
06:56:32 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:51:36, version 1)
06:56:32 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
06:56:32 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
06:56:32 [INFO] __main__: Creating services …
06:56:32 [INFO] __main__:   upgrade_provider: 210 items registered
06:56:32 [INFO] __main__:   all services created
06:56:32 [INFO] __main__: Wiring event handlers …
06:56:32 [INFO] __main__:   event handlers registered
06:56:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:56:32 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:56:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:56:32 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:56:32 [INFO] __main__: Restored 2 empires from saved state
06:56:32 [INFO] __main__: Starting network server …
06:56:32 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:56:32 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:56:32 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:56:32 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:56:32 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:56:32 [INFO] __main__: Starting game loop …
06:56:32 [INFO] __main__:   game loop running (1 s tick)
06:56:47 [INFO] websockets.server: connection open
06:56:47 [INFO] gameserver.network.server: Session registered: uid=-1
06:56:47 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63355)
06:56:47 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:56:47 [INFO] gameserver.network.server: Session registered: uid=2
06:56:47 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:56:55 [INFO] gameserver.network.handlers: new_army success uid=2 aid=1 name=test
06:56:57 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 wave_id=1 with 5 SLAVE critters
06:56:57 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_type=SLAVE critter_count=6
06:56:58 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_type=SLAVE critter_count=7
06:56:58 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_type=SLAVE critter_count=8
06:56:58 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_type=SLAVE critter_count=9
06:57:16 [INFO] __main__: Shutdown signal received — stopping …
06:57:17 [INFO] __main__: Shutting down …
06:57:17 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
06:57:17 [INFO] websockets.server: server closing
06:57:17 [INFO] gameserver.network.server: Session removed: uid=2
06:57:17 [INFO] websockets.server: server closed
06:57:17 [INFO] gameserver.network.server: WebSocket server stopped
06:57:17 [INFO] __main__:   WebSocket server stopped
06:57:17 [INFO] __main__:   debug dashboard stopped
06:57:17 [INFO] __main__:   database closed
06:57:17 [INFO] __main__:   goodbye
07:00:03 [INFO] __main__: === Game Server starting ===
07:00:03 [INFO] __main__: Loading configuration …
07:00:04 [INFO] __main__:   items:        210 loaded from config
07:00:04 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
07:00:04 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
07:00:04 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
07:00:04 [INFO] __main__:   game_config:  loaded
07:00:04 [INFO] __main__: Initializing persistence …
07:00:04 [INFO] gameserver.persistence.database: Database connected: gameserver.db
07:00:04 [INFO] __main__:   database:     connected (gameserver.db)
07:00:04 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T06:57:17, version 1)
07:00:04 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
07:00:04 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
07:00:04 [INFO] __main__: Creating services …
07:00:04 [INFO] __main__:   upgrade_provider: 210 items registered
07:00:04 [INFO] __main__:   all services created
07:00:04 [INFO] __main__: Wiring event handlers …
07:00:04 [INFO] __main__:   event handlers registered
07:00:04 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
07:00:04 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
07:00:04 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
07:00:04 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
07:00:04 [INFO] __main__: Restored 2 empires from saved state
07:00:04 [INFO] __main__: Starting network server …
07:00:04 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
07:00:04 [INFO] websockets.server: server listening on 0.0.0.0:8765
07:00:04 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
07:00:04 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
07:00:04 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
07:00:04 [INFO] __main__: Starting game loop …
07:00:04 [INFO] __main__:   game loop running (1 s tick)
07:00:32 [INFO] websockets.server: connection open
07:00:32 [INFO] gameserver.network.server: Session registered: uid=-1
07:00:32 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60900)
07:00:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
07:00:32 [INFO] gameserver.network.server: Session registered: uid=2
07:00:32 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
07:00:35 [INFO] gameserver.network.handlers: change_wave: replaced all critters in wave 0 with type WARRIOR (count=9)
07:00:35 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_type=WARRIOR critter_count=9
07:00:37 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
07:00:57 [INFO] __main__: Shutdown signal received — stopping …
07:00:57 [INFO] __main__: Shutting down …
07:00:57 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
07:00:57 [INFO] websockets.server: server closing
07:00:57 [INFO] gameserver.network.server: Session removed: uid=2
07:00:57 [INFO] websockets.server: server closed
07:00:57 [INFO] gameserver.network.server: WebSocket server stopped
07:00:57 [INFO] __main__:   WebSocket server stopped
07:00:57 [INFO] __main__:   debug dashboard stopped
07:00:57 [INFO] __main__:   database closed
07:00:57 [INFO] __main__:   goodbye
18:43:41 [INFO] __main__: === Game Server starting ===
18:43:41 [INFO] __main__: Loading configuration …
18:43:42 [INFO] __main__:   items:        210 loaded from config
18:43:42 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:43:42 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:43:42 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:43:42 [INFO] __main__:   game_config:  loaded
18:43:42 [INFO] __main__: Initializing persistence …
18:43:42 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:43:42 [INFO] __main__:   database:     connected (gameserver.db)
18:43:42 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T07:00:57, version 1)
18:43:42 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:43:42 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:43:42 [INFO] __main__: Creating services …
18:43:42 [INFO] __main__:   upgrade_provider: 210 items registered
18:43:42 [INFO] __main__:   all services created
18:43:42 [INFO] __main__: Wiring event handlers …
18:43:42 [INFO] __main__:   event handlers registered
18:43:42 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:43:42 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:43:42 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:43:42 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:43:42 [INFO] __main__: Restored 2 empires from saved state
18:43:42 [INFO] __main__: Starting network server …
18:43:42 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
18:43:42 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:43:42 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:43:42 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:43:42 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:43:42 [INFO] __main__: Starting game loop …
18:43:42 [INFO] __main__:   game loop running (1 s tick)
18:43:44 [INFO] __main__: Shutdown signal received — stopping …
18:43:44 [INFO] __main__: Shutting down …
18:43:44 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:43:44 [INFO] websockets.server: server closing
18:43:44 [INFO] websockets.server: server closed
18:43:44 [INFO] gameserver.network.server: WebSocket server stopped
18:43:44 [INFO] __main__:   WebSocket server stopped
18:43:44 [INFO] __main__:   debug dashboard stopped
18:43:44 [INFO] __main__:   database closed
18:43:44 [INFO] __main__:   goodbye
18:44:44 [INFO] __main__: === Game Server starting ===
18:44:44 [INFO] __main__: Loading configuration …
18:44:45 [INFO] __main__:   items:        210 loaded from config
18:44:45 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:44:45 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:44:45 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:44:45 [INFO] __main__:   game_config:  loaded
18:44:45 [INFO] __main__: Initializing persistence …
18:44:45 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:44:45 [INFO] __main__:   database:     connected (gameserver.db)
18:44:45 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T18:43:44, version 1)
18:44:45 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:44:45 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:44:45 [INFO] __main__: Creating services …
18:44:45 [INFO] __main__:   upgrade_provider: 210 items registered
18:44:45 [INFO] __main__:   all services created
18:44:45 [INFO] __main__: Wiring event handlers …
18:44:45 [INFO] __main__:   event handlers registered
18:44:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:44:45 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:44:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:44:45 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:44:45 [INFO] __main__: Restored 2 empires from saved state
18:44:45 [INFO] __main__: Starting network server …
18:44:45 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
18:44:45 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:44:45 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:44:45 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:44:45 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:44:45 [INFO] __main__: Starting game loop …
18:44:45 [INFO] __main__:   game loop running (1 s tick)
18:45:06 [INFO] websockets.server: connection open
18:45:06 [INFO] gameserver.network.server: Session registered: uid=-1
18:45:06 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59756)
18:45:12 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:45:12 [INFO] gameserver.network.server: Session registered: uid=2
18:45:12 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:45:19 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 wave_id=1 with 5 SLAVE critters
18:45:21 [INFO] gameserver.network.handlers: change_wave: replaced all critters in wave 1 with type BOWMAN (count=5)
18:45:21 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=1 critter_type=BOWMAN critter_count=5
18:45:30 [INFO] __main__: Shutdown signal received — stopping …
18:45:31 [INFO] __main__: Shutting down …
18:45:31 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:45:31 [INFO] websockets.server: server closing
18:45:31 [INFO] gameserver.network.server: Session removed: uid=2
18:45:31 [INFO] websockets.server: server closed
18:45:31 [INFO] gameserver.network.server: WebSocket server stopped
18:45:31 [INFO] __main__:   WebSocket server stopped
18:45:31 [INFO] __main__:   debug dashboard stopped
18:45:31 [INFO] __main__:   database closed
18:45:31 [INFO] __main__:   goodbye
18:45:33 [INFO] __main__: === Game Server starting ===
18:45:33 [INFO] __main__: Loading configuration …
18:45:34 [INFO] __main__:   items:        210 loaded from config
18:45:34 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:45:34 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:45:34 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:45:34 [INFO] __main__:   game_config:  loaded
18:45:34 [INFO] __main__: Initializing persistence …
18:45:34 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:45:34 [INFO] __main__:   database:     connected (gameserver.db)
18:45:34 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T18:45:31, version 1)
18:45:34 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
18:45:34 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
18:45:34 [INFO] __main__: Creating services …
18:45:34 [INFO] __main__:   upgrade_provider: 210 items registered
18:45:34 [INFO] __main__:   all services created
18:45:34 [INFO] __main__: Wiring event handlers …
18:45:34 [INFO] __main__:   event handlers registered
18:45:34 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:45:34 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:45:34 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:45:34 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:45:34 [INFO] __main__: Restored 2 empires from saved state
18:45:34 [INFO] __main__: Starting network server …
18:45:34 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
18:45:34 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:45:34 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:45:34 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:45:34 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:45:34 [INFO] __main__: Starting game loop …
18:45:34 [INFO] __main__:   game loop running (1 s tick)
18:45:34 [INFO] websockets.server: connection open
18:45:34 [INFO] gameserver.network.server: Session registered: uid=-1
18:45:34 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59835)
18:45:34 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:45:34 [INFO] gameserver.network.server: Session registered: uid=2
18:45:34 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:45:35 [INFO] gameserver.network.server: Session removed: uid=2
18:45:35 [INFO] websockets.server: connection open
18:45:35 [INFO] gameserver.network.server: Session registered: uid=-2
18:45:35 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59839)
18:45:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:45:35 [INFO] gameserver.network.server: Session registered: uid=2
18:45:35 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:45:40 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
18:50:44 [INFO] __main__: Shutdown signal received — stopping …
18:50:45 [INFO] __main__: Shutting down …
18:50:45 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:50:45 [INFO] websockets.server: server closing
18:50:45 [INFO] gameserver.network.server: Session removed: uid=2
18:50:45 [INFO] websockets.server: server closed
18:50:45 [INFO] gameserver.network.server: WebSocket server stopped
18:50:45 [INFO] __main__:   WebSocket server stopped
18:50:45 [INFO] __main__:   debug dashboard stopped
18:50:45 [INFO] __main__:   database closed
18:50:45 [INFO] __main__:   goodbye
19:45:52 [INFO] __main__: === Game Server starting ===
19:45:52 [INFO] __main__: Loading configuration …
19:45:53 [INFO] __main__:   items:        210 loaded from config
19:45:53 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:45:53 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:45:53 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:45:53 [INFO] __main__:   game_config:  loaded
19:45:53 [INFO] __main__: Initializing persistence …
19:45:53 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:45:53 [INFO] __main__:   database:     connected (gameserver.db)
19:45:53 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T18:50:45, version 1)
19:45:53 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:45:53 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:45:53 [INFO] __main__: Creating services …
19:45:53 [INFO] __main__:   upgrade_provider: 210 items registered
19:45:53 [INFO] __main__:   all services created
19:45:53 [INFO] __main__: Wiring event handlers …
19:45:53 [INFO] __main__:   event handlers registered
19:45:53 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:45:53 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:45:53 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:45:53 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:45:53 [INFO] __main__: Restored 2 empires from saved state
19:45:53 [INFO] __main__: Starting network server …
19:45:53 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
19:45:53 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:45:53 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:45:53 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:45:53 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:45:53 [INFO] __main__: Starting game loop …
19:45:53 [INFO] __main__:   game loop running (1 s tick)
19:46:54 [INFO] websockets.server: connection open
19:46:54 [INFO] gameserver.network.server: Session registered: uid=-1
19:46:54 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 65151)
19:46:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:46:54 [INFO] gameserver.network.server: Session registered: uid=2
19:46:54 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:47:00 [INFO] gameserver.network.handlers: new_army success uid=2 aid=1 name=asdf
19:47:01 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 wave_id=1 with 5 SLAVE slots
19:47:03 [INFO] gameserver.network.handlers: change_wave: updated wave 0 critter type to SWORDMAN
19:47:03 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SWORDMAN slots=5
19:47:12 [INFO] __main__: Shutdown signal received — stopping …
19:47:12 [INFO] __main__: Shutting down …
19:47:12 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:47:12 [INFO] websockets.server: server closing
19:47:12 [INFO] gameserver.network.server: Session removed: uid=2
19:47:12 [INFO] websockets.server: server closed
19:47:12 [INFO] gameserver.network.server: WebSocket server stopped
19:47:12 [INFO] __main__:   WebSocket server stopped
19:47:12 [INFO] __main__:   debug dashboard stopped
19:47:12 [INFO] __main__:   database closed
19:47:12 [INFO] __main__:   goodbye
19:47:14 [INFO] __main__: === Game Server starting ===
19:47:14 [INFO] __main__: Loading configuration …
19:47:15 [INFO] __main__:   items:        210 loaded from config
19:47:15 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:47:15 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:47:15 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:47:15 [INFO] __main__:   game_config:  loaded
19:47:15 [INFO] __main__: Initializing persistence …
19:47:15 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:47:15 [INFO] __main__:   database:     connected (gameserver.db)
19:47:15 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T19:47:12, version 1)
19:47:15 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
19:47:15 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
19:47:15 [INFO] __main__: Creating services …
19:47:15 [INFO] __main__:   upgrade_provider: 210 items registered
19:47:15 [INFO] __main__:   all services created
19:47:15 [INFO] __main__: Wiring event handlers …
19:47:15 [INFO] __main__:   event handlers registered
19:47:15 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:47:15 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:47:15 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:47:15 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:47:15 [INFO] __main__: Restored 2 empires from saved state
19:47:15 [INFO] __main__: Starting network server …
19:47:15 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
19:47:15 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:47:15 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:47:15 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:47:15 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:47:15 [INFO] __main__: Starting game loop …
19:47:15 [INFO] __main__:   game loop running (1 s tick)
19:47:15 [INFO] websockets.server: connection open
19:47:15 [INFO] gameserver.network.server: Session registered: uid=-1
19:47:15 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64495)
19:47:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:47:16 [INFO] gameserver.network.server: Session registered: uid=2
19:47:16 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:48:11 [INFO] __main__: Shutdown signal received — stopping …
19:48:11 [INFO] __main__: Shutting down …
19:48:11 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
19:48:11 [INFO] websockets.server: server closing
19:48:11 [INFO] gameserver.network.server: Session removed: uid=2
19:48:11 [INFO] websockets.server: server closed
19:48:11 [INFO] gameserver.network.server: WebSocket server stopped
19:48:11 [INFO] __main__:   WebSocket server stopped
19:48:11 [INFO] __main__:   debug dashboard stopped
19:48:11 [INFO] __main__:   database closed
19:48:11 [INFO] __main__:   goodbye
20:45:17 [INFO] __main__: === Game Server starting ===
20:45:17 [INFO] __main__: Loading configuration …
20:45:18 [INFO] __main__:   items:        210 loaded from config
20:45:18 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:45:18 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:45:18 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:45:18 [INFO] __main__:   game_config:  loaded
20:45:18 [INFO] __main__: Initializing persistence …
20:45:18 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:45:18 [INFO] __main__:   database:     connected (gameserver.db)
20:45:18 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T19:48:11, version 1)
20:45:18 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
20:45:18 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
20:45:18 [INFO] __main__: Creating services …
20:45:18 [INFO] __main__:   upgrade_provider: 210 items registered
20:45:18 [INFO] __main__:   all services created
20:45:18 [INFO] __main__: Wiring event handlers …
20:45:18 [INFO] __main__:   event handlers registered
20:45:18 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:45:18 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:45:18 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:45:18 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:45:18 [INFO] __main__: Restored 2 empires from saved state
20:45:18 [INFO] __main__: Starting network server …
20:45:18 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:45:18 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:45:18 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:45:18 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:45:18 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:45:18 [INFO] __main__: Starting game loop …
20:45:18 [INFO] __main__:   game loop running (1 s tick)
20:45:23 [INFO] websockets.server: connection open
20:45:23 [INFO] gameserver.network.server: Session registered: uid=-1
20:45:23 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60705)
20:45:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:45:23 [INFO] gameserver.network.server: Session registered: uid=2
20:45:23 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:45:25 [INFO] gameserver.network.server: Session removed: uid=2
20:45:37 [INFO] websockets.server: connection open
20:45:37 [INFO] gameserver.network.server: Session registered: uid=-2
20:45:37 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60728)
20:45:37 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:45:37 [INFO] gameserver.network.server: Session registered: uid=2
20:45:37 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:45:41 [INFO] gameserver.network.handlers: change_wave: updated wave 0 slots from 5 to 4
20:45:41 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SWORDMAN slots=4
20:45:43 [INFO] gameserver.network.handlers: change_wave: updated wave 0 slots from 4 to 5
20:45:43 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SWORDMAN slots=5
20:45:46 [INFO] gameserver.network.handlers: change_wave: updated wave 0 slots from 5 to 4
20:45:46 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SWORDMAN slots=4
20:45:46 [INFO] gameserver.network.handlers: change_wave: updated wave 0 slots from 4 to 3
20:45:46 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SWORDMAN slots=3
20:45:48 [INFO] gameserver.network.handlers: change_wave: updated wave 0 slots from 3 to 4
20:45:48 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SWORDMAN slots=4
20:45:48 [INFO] gameserver.network.handlers: change_wave: updated wave 0 slots from 4 to 5
20:45:48 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SWORDMAN slots=5
20:52:21 [INFO] gameserver.network.server: Session removed: uid=2
20:52:21 [INFO] websockets.server: connection open
20:52:21 [INFO] gameserver.network.server: Session registered: uid=-3
20:52:21 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 63191)
20:52:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:52:21 [INFO] gameserver.network.server: Session registered: uid=2
20:52:21 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
20:52:25 [INFO] gameserver.network.handlers: new_attack_request from uid=2 (not yet implemented)
21:02:06 [INFO] __main__: Shutdown signal received — stopping …
21:02:07 [INFO] __main__: Shutting down …
21:02:07 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:02:07 [INFO] websockets.server: server closing
21:02:07 [INFO] gameserver.network.server: Session removed: uid=2
21:02:07 [INFO] websockets.server: server closed
21:02:07 [INFO] gameserver.network.server: WebSocket server stopped
21:02:07 [INFO] __main__:   WebSocket server stopped
21:02:07 [INFO] __main__:   debug dashboard stopped
21:02:07 [INFO] __main__:   database closed
21:02:07 [INFO] __main__:   goodbye
21:02:08 [INFO] __main__: === Game Server starting ===
21:02:08 [INFO] __main__: Loading configuration …
21:02:09 [INFO] __main__:   items:        210 loaded from config
21:02:09 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:02:09 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:02:09 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:02:09 [INFO] __main__:   game_config:  loaded
21:02:09 [INFO] __main__: Initializing persistence …
21:02:09 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:02:09 [INFO] __main__:   database:     connected (gameserver.db)
21:02:09 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:02:07, version 1)
21:02:09 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:02:09 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:02:09 [INFO] __main__: Creating services …
21:02:09 [INFO] __main__:   upgrade_provider: 210 items registered
21:02:09 [INFO] __main__:   all services created
21:02:09 [INFO] __main__: Wiring event handlers …
21:02:09 [INFO] __main__:   event handlers registered
21:02:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:02:09 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:02:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:02:09 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:02:09 [INFO] __main__: Restored 2 empires from saved state
21:02:09 [INFO] __main__: Starting network server …
21:02:09 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:02:09 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:02:09 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:02:09 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:02:09 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:02:09 [INFO] __main__: Starting game loop …
21:02:09 [INFO] __main__:   game loop running (1 s tick)
21:02:10 [INFO] websockets.server: connection open
21:02:10 [INFO] gameserver.network.server: Session registered: uid=-1
21:02:10 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63249)
21:02:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:02:10 [INFO] gameserver.network.server: Session registered: uid=2
21:02:10 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:02:15 [INFO] gameserver.network.server: Session removed: uid=2
21:02:15 [INFO] websockets.server: connection open
21:02:15 [INFO] gameserver.network.server: Session registered: uid=-2
21:02:15 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63257)
21:02:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:02:15 [INFO] gameserver.network.server: Session registered: uid=2
21:02:15 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:02:49 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=military_request sender=0
21:04:16 [INFO] gameserver.network.server: Session removed: uid=2
21:04:16 [INFO] websockets.server: connection open
21:04:16 [INFO] gameserver.network.server: Session registered: uid=-3
21:04:16 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 57177)
21:04:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:04:16 [INFO] gameserver.network.server: Session registered: uid=2
21:04:16 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:05:52 [INFO] __main__: Shutdown signal received — stopping …
21:05:53 [INFO] __main__: Shutting down …
21:05:53 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:05:53 [INFO] websockets.server: server closing
21:05:53 [INFO] gameserver.network.server: Session removed: uid=2
21:05:53 [INFO] websockets.server: server closed
21:05:53 [INFO] gameserver.network.server: WebSocket server stopped
21:05:53 [INFO] __main__:   WebSocket server stopped
21:05:53 [INFO] __main__:   debug dashboard stopped
21:05:53 [INFO] __main__:   database closed
21:05:53 [INFO] __main__:   goodbye
21:05:55 [INFO] __main__: === Game Server starting ===
21:05:55 [INFO] __main__: Loading configuration …
21:05:55 [INFO] __main__:   items:        210 loaded from config
21:05:55 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:05:55 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:05:55 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:05:55 [INFO] __main__:   game_config:  loaded
21:05:55 [INFO] __main__: Initializing persistence …
21:05:55 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:05:55 [INFO] __main__:   database:     connected (gameserver.db)
21:05:55 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:05:53, version 1)
21:05:55 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:05:55 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:05:55 [INFO] __main__: Creating services …
21:05:55 [INFO] __main__:   upgrade_provider: 210 items registered
21:05:55 [INFO] __main__:   all services created
21:05:55 [INFO] __main__: Wiring event handlers …
21:05:55 [INFO] __main__:   event handlers registered
21:05:55 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:05:55 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:05:55 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:05:55 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:05:55 [INFO] __main__: Restored 2 empires from saved state
21:05:55 [INFO] __main__: Starting network server …
21:05:55 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:05:55 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:05:55 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:05:55 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:05:55 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:05:55 [INFO] __main__: Starting game loop …
21:05:55 [INFO] __main__:   game loop running (1 s tick)
21:05:56 [INFO] websockets.server: connection open
21:05:56 [INFO] gameserver.network.server: Session registered: uid=-1
21:05:56 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 58279)
21:05:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:05:56 [INFO] gameserver.network.server: Session registered: uid=2
21:05:56 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:06:03 [INFO] gameserver.network.server: Session removed: uid=2
21:06:03 [INFO] websockets.server: connection open
21:06:03 [INFO] gameserver.network.server: Session registered: uid=-2
21:06:03 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 58303)
21:06:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:06:03 [INFO] gameserver.network.server: Session registered: uid=2
21:06:03 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:06:07 [INFO] gameserver.network.handlers: new_attack failed uid=2: opponent 'eem' not found
21:12:11 [INFO] __main__: Shutdown signal received — stopping …
21:12:12 [INFO] __main__: Shutting down …
21:12:12 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:12:12 [INFO] websockets.server: server closing
21:12:12 [INFO] gameserver.network.server: Session removed: uid=2
21:12:12 [INFO] websockets.server: server closed
21:12:12 [INFO] gameserver.network.server: WebSocket server stopped
21:12:12 [INFO] __main__:   WebSocket server stopped
21:12:12 [INFO] __main__:   debug dashboard stopped
21:12:12 [INFO] __main__:   database closed
21:12:12 [INFO] __main__:   goodbye
21:12:13 [INFO] __main__: === Game Server starting ===
21:12:13 [INFO] __main__: Loading configuration …
21:12:14 [INFO] __main__:   items:        210 loaded from config
21:12:14 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:12:14 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:12:14 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:12:14 [INFO] __main__:   game_config:  loaded
21:12:14 [INFO] __main__: Initializing persistence …
21:12:14 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:12:14 [INFO] __main__:   database:     connected (gameserver.db)
21:12:14 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:12:12, version 1)
21:12:14 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:12:14 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:12:14 [INFO] __main__: Creating services …
21:12:14 [INFO] __main__:   upgrade_provider: 210 items registered
21:12:14 [INFO] __main__:   all services created
21:12:14 [INFO] __main__: Wiring event handlers …
21:12:14 [INFO] __main__:   event handlers registered
21:12:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:12:14 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:12:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:12:14 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:12:14 [INFO] __main__: Restored 2 empires from saved state
21:12:14 [INFO] __main__: Starting network server …
21:12:14 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:12:14 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:12:14 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:12:14 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:12:14 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:12:14 [INFO] __main__: Starting game loop …
21:12:14 [INFO] __main__:   game loop running (1 s tick)
21:12:15 [INFO] websockets.server: connection open
21:12:15 [INFO] gameserver.network.server: Session registered: uid=-1
21:12:15 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53345)
21:12:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:12:15 [INFO] gameserver.network.server: Session registered: uid=2
21:12:15 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:12:24 [INFO] gameserver.network.server: Session removed: uid=2
21:12:24 [INFO] websockets.server: connection open
21:12:24 [INFO] gameserver.network.server: Session registered: uid=-2
21:12:24 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 53374)
21:12:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:12:24 [INFO] gameserver.network.server: Session registered: uid=2
21:12:24 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:12:28 [INFO] gameserver.network.handlers: new_attack failed uid=2: opponent 'eem' not found
21:13:24 [INFO] gameserver.network.handlers: new_attack failed uid=2: opponent 'eem' not found
21:16:41 [INFO] __main__: Shutdown signal received — stopping …
21:16:41 [INFO] __main__: Shutting down …
21:16:41 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:16:41 [INFO] websockets.server: server closing
21:16:41 [INFO] gameserver.network.server: Session removed: uid=2
21:16:41 [INFO] websockets.server: server closed
21:16:41 [INFO] gameserver.network.server: WebSocket server stopped
21:16:41 [INFO] __main__:   WebSocket server stopped
21:16:41 [INFO] __main__:   debug dashboard stopped
21:16:41 [INFO] __main__:   database closed
21:16:41 [INFO] __main__:   goodbye
21:16:43 [INFO] __main__: === Game Server starting ===
21:16:43 [INFO] __main__: Loading configuration …
21:16:43 [INFO] __main__:   items:        210 loaded from config
21:16:43 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:16:43 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:16:43 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:16:43 [INFO] __main__:   game_config:  loaded
21:16:43 [INFO] __main__: Initializing persistence …
21:16:43 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:16:43 [INFO] __main__:   database:     connected (gameserver.db)
21:16:43 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:16:41, version 1)
21:16:43 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:16:43 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:16:43 [INFO] __main__: Creating services …
21:16:43 [INFO] __main__:   upgrade_provider: 210 items registered
21:16:43 [INFO] __main__:   all services created
21:16:43 [INFO] __main__: Wiring event handlers …
21:16:43 [INFO] __main__:   event handlers registered
21:16:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:16:43 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:16:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:16:43 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:16:43 [INFO] __main__: Restored 2 empires from saved state
21:16:43 [INFO] __main__: Starting network server …
21:16:43 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:16:43 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:16:43 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:16:43 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:16:43 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:16:43 [INFO] __main__: Starting game loop …
21:16:43 [INFO] __main__:   game loop running (1 s tick)
21:16:44 [INFO] websockets.server: connection open
21:16:44 [INFO] gameserver.network.server: Session registered: uid=-1
21:16:44 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53715)
21:16:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:16:44 [INFO] gameserver.network.server: Session registered: uid=2
21:16:44 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:16:56 [INFO] gameserver.network.server: Session removed: uid=2
21:16:56 [INFO] websockets.server: connection open
21:16:56 [INFO] gameserver.network.server: Session registered: uid=-2
21:16:56 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60559)
21:16:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:16:56 [INFO] gameserver.network.server: Session registered: uid=2
21:16:56 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:17:00 [INFO] gameserver.network.handlers: new_attack failed uid=2: opponent 'eem' not found
21:17:10 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
21:17:10 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
21:17:12 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
21:17:12 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
21:17:33 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:17:33 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 2, 'free': 3}
21:17:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:17:37 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 1, 'free': 4}
21:20:34 [INFO] __main__: Shutdown signal received — stopping …
21:20:35 [INFO] __main__: Shutting down …
21:20:35 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:20:35 [INFO] websockets.server: server closing
21:20:35 [INFO] gameserver.network.server: Session removed: uid=2
21:20:35 [INFO] websockets.server: server closed
21:20:35 [INFO] gameserver.network.server: WebSocket server stopped
21:20:35 [INFO] __main__:   WebSocket server stopped
21:20:35 [INFO] __main__:   debug dashboard stopped
21:20:35 [INFO] __main__:   database closed
21:20:35 [INFO] __main__:   goodbye
21:20:37 [INFO] __main__: === Game Server starting ===
21:20:37 [INFO] __main__: Loading configuration …
21:20:38 [INFO] __main__:   items:        210 loaded from config
21:20:38 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:20:38 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:20:38 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:20:38 [INFO] __main__:   game_config:  loaded
21:20:38 [INFO] __main__: Initializing persistence …
21:20:38 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:20:38 [INFO] __main__:   database:     connected (gameserver.db)
21:20:38 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:20:35, version 1)
21:20:38 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:20:38 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:20:38 [INFO] __main__: Creating services …
21:20:38 [INFO] __main__:   upgrade_provider: 210 items registered
21:20:38 [INFO] __main__:   all services created
21:20:38 [INFO] __main__: Wiring event handlers …
21:20:38 [INFO] __main__:   event handlers registered
21:20:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:20:38 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:20:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:20:38 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:20:38 [INFO] __main__: Restored 2 empires from saved state
21:20:38 [INFO] __main__: Starting network server …
21:20:38 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:20:38 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:20:38 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:20:38 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:20:38 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:20:38 [INFO] __main__: Starting game loop …
21:20:38 [INFO] __main__:   game loop running (1 s tick)
21:20:38 [INFO] websockets.server: connection open
21:20:38 [INFO] gameserver.network.server: Session registered: uid=-1
21:20:38 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50488)
21:20:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:20:38 [INFO] gameserver.network.server: Session registered: uid=2
21:20:38 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:20:41 [INFO] gameserver.network.server: Session removed: uid=2
21:20:41 [INFO] websockets.server: connection open
21:20:41 [INFO] gameserver.network.server: Session registered: uid=-2
21:20:41 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50496)
21:20:41 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:20:41 [INFO] gameserver.network.server: Session registered: uid=2
21:20:41 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:20:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:20:45 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 0, 'free': 5}
21:20:46 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:20:46 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 1, 'free': 4}
21:20:53 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:20:53 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 2, 'free': 3}
21:21:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:21:06 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 3, 'free': 2}
21:21:09 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:21:09 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 4, 'free': 1}
21:21:13 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:21:13 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 5, 'free': 0}
21:21:19 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:21:19 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 10, got 11)
21:21:27 [INFO] gameserver.network.server: Session removed: uid=2
21:21:27 [INFO] websockets.server: connection open
21:21:27 [INFO] gameserver.network.server: Session registered: uid=-3
21:21:27 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 61410)
21:21:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:21:27 [INFO] gameserver.network.server: Session registered: uid=2
21:21:27 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:21:29 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
21:21:29 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 6740.3, have 4815.8)
21:21:42 [INFO] gameserver.network.handlers: new_attack failed uid=2: opponent 'eem' not found
21:21:53 [INFO] __main__: Shutdown signal received — stopping …
21:21:54 [INFO] __main__: Shutting down …
21:21:54 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:21:54 [INFO] websockets.server: server closing
21:21:54 [INFO] gameserver.network.server: Session removed: uid=2
21:21:54 [INFO] websockets.server: server closed
21:21:54 [INFO] gameserver.network.server: WebSocket server stopped
21:21:54 [INFO] __main__:   WebSocket server stopped
21:21:54 [INFO] __main__:   debug dashboard stopped
21:21:54 [INFO] __main__:   database closed
21:21:54 [INFO] __main__:   goodbye
21:21:55 [INFO] __main__: === Game Server starting ===
21:21:55 [INFO] __main__: Loading configuration …
21:21:56 [INFO] __main__:   items:        210 loaded from config
21:21:56 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:21:56 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:21:56 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:21:56 [INFO] __main__:   game_config:  loaded
21:21:56 [INFO] __main__: Initializing persistence …
21:21:56 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:21:56 [INFO] __main__:   database:     connected (gameserver.db)
21:21:56 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:21:54, version 1)
21:21:56 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:21:56 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:21:56 [INFO] __main__: Creating services …
21:21:56 [INFO] __main__:   upgrade_provider: 210 items registered
21:21:56 [INFO] __main__:   all services created
21:21:56 [INFO] __main__: Wiring event handlers …
21:21:56 [INFO] __main__:   event handlers registered
21:21:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:21:56 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:21:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:21:56 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:21:56 [INFO] __main__: Restored 2 empires from saved state
21:21:56 [INFO] __main__: Starting network server …
21:21:56 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:21:56 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:21:56 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:21:56 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:21:56 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:21:56 [INFO] __main__: Starting game loop …
21:21:56 [INFO] __main__:   game loop running (1 s tick)
21:21:57 [INFO] websockets.server: connection open
21:21:57 [INFO] gameserver.network.server: Session registered: uid=-1
21:21:57 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57932)
21:21:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:21:57 [INFO] gameserver.network.server: Session registered: uid=2
21:21:57 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:22:15 [INFO] __main__: Shutdown signal received — stopping …
21:22:16 [INFO] __main__: Shutting down …
21:22:16 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:22:16 [INFO] websockets.server: server closing
21:22:16 [INFO] gameserver.network.server: Session removed: uid=2
21:22:16 [INFO] websockets.server: server closed
21:22:16 [INFO] gameserver.network.server: WebSocket server stopped
21:22:16 [INFO] __main__:   WebSocket server stopped
21:22:16 [INFO] __main__:   debug dashboard stopped
21:22:16 [INFO] __main__:   database closed
21:22:16 [INFO] __main__:   goodbye
21:22:18 [INFO] __main__: === Game Server starting ===
21:22:18 [INFO] __main__: Loading configuration …
21:22:19 [INFO] __main__:   items:        210 loaded from config
21:22:19 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:22:19 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:22:19 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:22:19 [INFO] __main__:   game_config:  loaded
21:22:19 [INFO] __main__: Initializing persistence …
21:22:19 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:22:19 [INFO] __main__:   database:     connected (gameserver.db)
21:22:19 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:22:16, version 1)
21:22:19 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:22:19 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:22:19 [INFO] __main__: Creating services …
21:22:19 [INFO] __main__:   upgrade_provider: 210 items registered
21:22:19 [INFO] __main__:   all services created
21:22:19 [INFO] __main__: Wiring event handlers …
21:22:19 [INFO] __main__:   event handlers registered
21:22:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:22:19 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:22:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:22:19 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:22:19 [INFO] __main__: Restored 2 empires from saved state
21:22:19 [INFO] __main__: Starting network server …
21:22:19 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:22:19 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:22:19 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:22:19 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:22:19 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:22:19 [INFO] __main__: Starting game loop …
21:22:19 [INFO] __main__:   game loop running (1 s tick)
21:22:19 [INFO] websockets.server: connection open
21:22:19 [INFO] gameserver.network.server: Session registered: uid=-1
21:22:19 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 58055)
21:22:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:22:19 [INFO] gameserver.network.server: Session registered: uid=2
21:22:19 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:22:27 [INFO] websockets.server: connection open
21:22:27 [INFO] gameserver.network.server: Session registered: uid=-2
21:22:27 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59560)
21:22:28 [INFO] gameserver.network.server: Session removed: uid=2
21:22:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:22:32 [INFO] gameserver.network.server: Session registered: uid=2
21:22:32 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:22:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:22:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 4, 'free': 1}
21:23:01 [INFO] gameserver.network.handlers: new_attack failed uid=2: opponent 'eem' not found
21:23:05 [INFO] gameserver.network.server: Session removed: uid=2
21:23:05 [INFO] websockets.server: connection open
21:23:05 [INFO] gameserver.network.server: Session registered: uid=-3
21:23:05 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 59606)
21:23:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:23:05 [INFO] gameserver.network.server: Session registered: uid=2
21:23:05 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:23:13 [INFO] gameserver.engine.empire_service: Empire 2: started research ALPHABET_WRITING (effort=1500.0)
21:23:13 [INFO] gameserver.network.handlers: new_item success uid=2 iid=ALPHABET_WRITING
21:25:06 [INFO] __main__: Shutdown signal received — stopping …
21:25:06 [INFO] __main__: Shutting down …
21:25:06 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:25:06 [INFO] websockets.server: server closing
21:25:06 [INFO] gameserver.network.server: Session removed: uid=2
21:25:06 [INFO] websockets.server: server closed
21:25:06 [INFO] gameserver.network.server: WebSocket server stopped
21:25:06 [INFO] __main__:   WebSocket server stopped
21:25:06 [INFO] __main__:   debug dashboard stopped
21:25:06 [INFO] __main__:   database closed
21:25:06 [INFO] __main__:   goodbye
21:25:08 [INFO] __main__: === Game Server starting ===
21:25:08 [INFO] __main__: Loading configuration …
21:25:08 [INFO] __main__:   items:        210 loaded from config
21:25:08 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:25:08 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:25:08 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:25:08 [INFO] __main__:   game_config:  loaded
21:25:08 [INFO] __main__: Initializing persistence …
21:25:08 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:25:08 [INFO] __main__:   database:     connected (gameserver.db)
21:25:09 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:25:06, version 1)
21:25:09 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:25:09 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:25:09 [INFO] __main__: Creating services …
21:25:09 [INFO] __main__:   upgrade_provider: 210 items registered
21:25:09 [INFO] __main__:   all services created
21:25:09 [INFO] __main__: Wiring event handlers …
21:25:09 [INFO] __main__:   event handlers registered
21:25:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:25:09 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:25:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:25:09 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:25:09 [INFO] __main__: Restored 2 empires from saved state
21:25:09 [INFO] __main__: Starting network server …
21:25:09 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:25:09 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:25:09 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:25:09 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:25:09 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:25:09 [INFO] __main__: Starting game loop …
21:25:09 [INFO] __main__:   game loop running (1 s tick)
21:25:09 [INFO] websockets.server: connection open
21:25:09 [INFO] gameserver.network.server: Session registered: uid=-1
21:25:09 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60791)
21:25:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:25:09 [INFO] gameserver.network.server: Session registered: uid=2
21:25:09 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:25:54 [INFO] gameserver.network.handlers: new_attack failed uid=2: opponent 'eem' not found
21:29:41 [INFO] gameserver.network.handlers: new_attack failed uid=2: opponent 'eem' not found
21:29:56 [INFO] __main__: Shutdown signal received — stopping …
21:29:56 [INFO] __main__: Shutting down …
21:29:56 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:29:56 [INFO] websockets.server: server closing
21:29:56 [INFO] gameserver.network.server: Session removed: uid=2
21:29:56 [INFO] websockets.server: server closed
21:29:56 [INFO] gameserver.network.server: WebSocket server stopped
21:29:56 [INFO] __main__:   WebSocket server stopped
21:29:56 [INFO] __main__:   debug dashboard stopped
21:29:56 [INFO] __main__:   database closed
21:29:56 [INFO] __main__:   goodbye
21:29:58 [INFO] __main__: === Game Server starting ===
21:29:58 [INFO] __main__: Loading configuration …
21:29:58 [INFO] __main__:   items:        210 loaded from config
21:29:58 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:29:58 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:29:58 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:29:58 [INFO] __main__:   game_config:  loaded
21:29:58 [INFO] __main__: Initializing persistence …
21:29:58 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:29:58 [INFO] __main__:   database:     connected (gameserver.db)
21:29:58 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:29:56, version 1)
21:29:58 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:29:58 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:29:58 [INFO] __main__: Creating services …
21:29:58 [INFO] __main__:   upgrade_provider: 210 items registered
21:29:58 [INFO] __main__:   all services created
21:29:58 [INFO] __main__: Wiring event handlers …
21:29:58 [INFO] __main__:   event handlers registered
21:29:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:29:58 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:29:58 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:29:58 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:29:58 [INFO] __main__: Restored 2 empires from saved state
21:29:58 [INFO] __main__: Starting network server …
21:29:58 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:29:58 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:29:58 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:29:58 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:29:58 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:29:58 [INFO] __main__: Starting game loop …
21:29:58 [INFO] __main__:   game loop running (1 s tick)
21:29:59 [INFO] websockets.server: connection open
21:29:59 [INFO] gameserver.network.server: Session registered: uid=-1
21:29:59 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53638)
21:29:59 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:29:59 [INFO] gameserver.network.server: Session registered: uid=2
21:29:59 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:30:03 [INFO] gameserver.network.server: Session removed: uid=2
21:30:03 [INFO] websockets.server: connection open
21:30:03 [INFO] gameserver.network.server: Session registered: uid=-2
21:30:03 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 53646)
21:30:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:30:03 [INFO] gameserver.network.server: Session registered: uid=2
21:30:03 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:30:17 [WARNING] gameserver.network.handlers: [new_attack] FAIL uid=2: opponent 'eem' not found
21:30:17 [ERROR] gameserver.network.server: Handler error: type=new_attack_request uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 65, in route
    return await handler(message, sender_uid)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 550, in handle_new_attack
    "_debug": f"Available empires: {[e.name for e in svc.empire_service.get_all()]}",
AttributeError: 'EmpireService' object has no attribute 'get_all'
21:31:24 [INFO] __main__: Shutdown signal received — stopping …
21:31:24 [INFO] __main__: Shutting down …
21:31:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:31:24 [INFO] websockets.server: server closing
21:31:25 [INFO] gameserver.network.server: Session removed: uid=2
21:31:25 [INFO] websockets.server: server closed
21:31:25 [INFO] gameserver.network.server: WebSocket server stopped
21:31:25 [INFO] __main__:   WebSocket server stopped
21:31:25 [INFO] __main__:   debug dashboard stopped
21:31:25 [INFO] __main__:   database closed
21:31:25 [INFO] __main__:   goodbye
21:31:26 [INFO] __main__: === Game Server starting ===
21:31:26 [INFO] __main__: Loading configuration …
21:31:27 [INFO] __main__:   items:        210 loaded from config
21:31:27 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:31:27 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:31:27 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:31:27 [INFO] __main__:   game_config:  loaded
21:31:27 [INFO] __main__: Initializing persistence …
21:31:27 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:31:27 [INFO] __main__:   database:     connected (gameserver.db)
21:31:27 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:31:24, version 1)
21:31:27 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:31:27 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:31:27 [INFO] __main__: Creating services …
21:31:27 [INFO] __main__:   upgrade_provider: 210 items registered
21:31:27 [INFO] __main__:   all services created
21:31:27 [INFO] __main__: Wiring event handlers …
21:31:27 [INFO] __main__:   event handlers registered
21:31:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:31:27 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:31:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:31:27 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:31:27 [INFO] __main__: Restored 2 empires from saved state
21:31:27 [INFO] __main__: Starting network server …
21:31:27 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:31:27 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:31:27 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:31:27 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:31:27 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:31:27 [INFO] __main__: Starting game loop …
21:31:27 [INFO] __main__:   game loop running (1 s tick)
21:31:28 [INFO] websockets.server: connection open
21:31:28 [INFO] gameserver.network.server: Session registered: uid=-1
21:31:28 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64504)
21:31:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:31:28 [INFO] gameserver.network.server: Session registered: uid=2
21:31:28 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:32:10 [INFO] gameserver.network.server: Session removed: uid=2
21:32:10 [INFO] websockets.server: connection open
21:32:10 [INFO] gameserver.network.server: Session registered: uid=-2
21:32:10 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 58265)
21:32:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:32:10 [INFO] gameserver.network.server: Session registered: uid=2
21:32:10 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:32:38 [INFO] gameserver.network.server: Session removed: uid=2
21:32:38 [INFO] websockets.server: connection open
21:32:38 [INFO] gameserver.network.server: Session registered: uid=-3
21:32:38 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 62273)
21:32:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:32:38 [INFO] gameserver.network.server: Session registered: uid=2
21:32:38 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:32:42 [ERROR] gameserver.network.server: Handler error: type=new_attack_request uid=2
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 196, in _handle_message
    response = await self._router.route(data, uid)
  File "/home/pi/e3/python_server/src/gameserver/network/router.py", line 65, in route
    return await handler(message, sender_uid)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 544, in handle_new_attack
    available_empires = [e.name for e in svc.empire_service.all_empires().values()]
TypeError: 'dict' object is not callable
21:33:20 [INFO] gameserver.network.server: Session removed: uid=2
21:33:20 [INFO] websockets.server: connection open
21:33:20 [INFO] gameserver.network.server: Session registered: uid=-4
21:33:20 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 51717)
21:33:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:33:20 [INFO] gameserver.network.server: Session registered: uid=2
21:33:20 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
21:35:27 [INFO] __main__: Shutdown signal received — stopping …
21:35:28 [INFO] __main__: Shutting down …
21:35:28 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
21:35:28 [INFO] websockets.server: server closing
21:35:28 [INFO] gameserver.network.server: Session removed: uid=2
21:35:28 [INFO] websockets.server: server closed
21:35:28 [INFO] gameserver.network.server: WebSocket server stopped
21:35:28 [INFO] __main__:   WebSocket server stopped
21:35:28 [INFO] __main__:   debug dashboard stopped
21:35:28 [INFO] __main__:   database closed
21:35:28 [INFO] __main__:   goodbye
21:35:29 [INFO] __main__: === Game Server starting ===
21:35:29 [INFO] __main__: Loading configuration …
21:35:29 [INFO] __main__:   items:        210 loaded from config
21:35:32 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:35:32 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:35:32 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:35:32 [INFO] __main__:   game_config:  loaded
21:35:32 [INFO] __main__: Initializing persistence …
21:35:32 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:35:32 [INFO] __main__:   database:     connected (gameserver.db)
21:35:32 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:35:28, version 1)
21:35:32 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
21:35:32 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
21:35:32 [INFO] __main__: Creating services …
21:35:32 [INFO] __main__:   upgrade_provider: 210 items registered
21:35:32 [INFO] __main__:   all services created
21:35:32 [INFO] __main__: Wiring event handlers …
21:35:32 [INFO] __main__:   event handlers registered
21:35:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:35:32 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:35:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:35:32 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:35:32 [INFO] __main__: Restored 2 empires from saved state
21:35:32 [INFO] __main__: Starting network server …
21:35:32 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:35:32 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:35:32 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:35:32 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:35:32 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:35:32 [INFO] __main__: Starting game loop …
21:35:32 [INFO] __main__:   game loop running (1 s tick)
21:35:32 [INFO] websockets.server: connection open
21:35:32 [INFO] gameserver.network.server: Session registered: uid=-1
21:35:32 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57106)
21:35:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:35:32 [INFO] gameserver.network.server: Session registered: uid=2
21:35:32 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:35:32 [INFO] gameserver.network.server: Session removed: uid=2
21:35:33 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
21:35:33 [INFO] websockets.server: connection open
21:35:33 [INFO] gameserver.network.server: Session registered: uid=-2
21:35:33 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57135)
21:35:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:35:33 [INFO] gameserver.network.server: Session registered: uid=2
21:35:33 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:35:40 [WARNING] gameserver.network.handlers: [new_attack] FAIL uid=2: opponent '2' not found (available: ['TestImperium', 'Empire1'])
21:36:02 [WARNING] gameserver.network.handlers: [new_attack] FAIL uid=2: Cannot attack yourself
21:38:44 [INFO] gameserver.network.server: Session removed: uid=2
21:38:45 [INFO] websockets.server: connection open
21:38:45 [INFO] gameserver.network.server: Session registered: uid=-3
21:38:45 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 50980)
21:38:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:38:45 [INFO] gameserver.network.server: Session registered: uid=2
21:38:45 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:38:49 [WARNING] gameserver.network.handlers: [new_attack] FAIL uid=2: Cannot attack yourself
21:38:54 [INFO] gameserver.engine.attack_service: Attack started: id=1  2→100  army=1  ETA=60s
21:38:54 [INFO] gameserver.network.handlers: [new_attack] SUCCESS uid=2 → defender=100 army=1 attack_id=1 ETA=60.0s total=60.0s
21:39:19 [INFO] gameserver.network.handlers: change_army success uid=2 aid=1: 'asdf' → 'test'
21:39:31 [INFO] __main__: Shutdown signal received — stopping …
21:39:31 [INFO] __main__: Shutting down …
21:39:31 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:39:31 [INFO] websockets.server: server closing
21:39:31 [INFO] gameserver.network.server: Session removed: uid=2
21:39:31 [INFO] websockets.server: server closed
21:39:31 [INFO] gameserver.network.server: WebSocket server stopped
21:39:31 [INFO] __main__:   WebSocket server stopped
21:39:31 [INFO] __main__:   debug dashboard stopped
21:39:31 [INFO] __main__:   database closed
21:39:31 [INFO] __main__:   goodbye
21:42:37 [INFO] __main__: === Game Server starting ===
21:42:37 [INFO] __main__: Loading configuration …
21:42:38 [INFO] __main__:   items:        210 loaded from config
21:42:38 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:42:38 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:42:38 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:42:38 [INFO] __main__:   game_config:  loaded
21:42:38 [INFO] __main__: Initializing persistence …
21:42:38 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:42:38 [INFO] __main__:   database:     connected (gameserver.db)
21:42:38 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:39:31, version 1)
21:42:38 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:42:38 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:42:38 [INFO] __main__: Creating services …
21:42:38 [INFO] __main__:   upgrade_provider: 210 items registered
21:42:38 [INFO] __main__:   all services created
21:42:38 [INFO] __main__: Wiring event handlers …
21:42:38 [INFO] __main__:   event handlers registered
21:42:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:42:38 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:42:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:42:38 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:42:38 [INFO] __main__: Restored 2 empires from saved state
21:42:38 [INFO] __main__: Restored 1 attacks from saved state
21:42:38 [INFO] __main__: Starting network server …
21:42:38 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:42:38 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:42:38 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:42:38 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:42:38 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:42:38 [INFO] __main__: Starting game loop …
21:42:38 [INFO] __main__:   game loop running (1 s tick)
21:43:58 [INFO] websockets.server: connection open
21:43:58 [INFO] gameserver.network.server: Session registered: uid=-1
21:43:58 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60971)
21:43:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:43:58 [INFO] gameserver.network.server: Session registered: uid=2
21:43:58 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:44:00 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:44:00 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 3, 'free': 2}
21:44:08 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:44:08 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 4, 'free': 1}
21:44:09 [INFO] gameserver.network.handlers: change_citizen request from uid=2
21:44:09 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 3, 'free': 2}
21:45:33 [INFO] gameserver.network.server: Session removed: uid=2
21:45:33 [INFO] websockets.server: connection open
21:45:33 [INFO] gameserver.network.server: Session registered: uid=-2
21:45:33 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57671)
21:45:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:45:33 [INFO] gameserver.network.server: Session registered: uid=2
21:45:33 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:47:22 [INFO] gameserver.network.server: Session removed: uid=2
21:47:23 [INFO] websockets.server: connection open
21:47:23 [INFO] gameserver.network.server: Session registered: uid=-3
21:47:23 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 52470)
21:47:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:47:23 [INFO] gameserver.network.server: Session registered: uid=2
21:47:23 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:48:38 [INFO] gameserver.network.server: Session removed: uid=2
21:48:38 [INFO] websockets.server: connection open
21:48:38 [INFO] gameserver.network.server: Session registered: uid=-4
21:48:38 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 63047)
21:48:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:48:38 [INFO] gameserver.network.server: Session registered: uid=2
21:48:38 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
21:49:33 [INFO] gameserver.engine.empire_service: Empire 2: knowledge ALPHABET_WRITING completed
21:49:36 [INFO] gameserver.network.server: Session removed: uid=2
21:49:37 [INFO] websockets.server: connection open
21:49:37 [INFO] gameserver.network.server: Session registered: uid=-5
21:49:37 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 58636)
21:49:37 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:49:37 [INFO] gameserver.network.server: Session registered: uid=2
21:49:37 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
21:50:04 [WARNING] gameserver.network.handlers: [new_attack] FAIL uid=2: Cannot attack yourself
21:50:08 [WARNING] gameserver.network.handlers: [new_attack] FAIL uid=2: Attacker or defender empire not found
21:50:14 [WARNING] gameserver.network.handlers: [new_attack] FAIL uid=2: Army is already attacking
21:51:08 [INFO] gameserver.network.server: Session removed: uid=2
21:51:08 [INFO] websockets.server: connection open
21:51:08 [INFO] gameserver.network.server: Session registered: uid=-6
21:51:08 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 60503)
21:51:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:51:08 [INFO] gameserver.network.server: Session registered: uid=2
21:51:08 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
21:53:34 [INFO] gameserver.network.server: Session removed: uid=2
21:53:35 [INFO] websockets.server: connection open
21:53:35 [INFO] gameserver.network.server: Session registered: uid=-7
21:53:35 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 62041)
21:53:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:53:35 [INFO] gameserver.network.server: Session registered: uid=2
21:53:35 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
21:53:51 [INFO] gameserver.network.server: Session removed: uid=2
21:53:51 [INFO] websockets.server: connection open
21:53:51 [INFO] gameserver.network.server: Session registered: uid=-8
21:53:51 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 62086)
21:53:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:53:51 [INFO] gameserver.network.server: Session registered: uid=2
21:53:51 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
21:54:00 [INFO] __main__: Shutdown signal received — stopping …
21:54:00 [INFO] __main__: Shutting down …
21:54:00 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:54:00 [INFO] websockets.server: server closing
21:54:00 [INFO] gameserver.network.server: Session removed: uid=2
21:54:00 [INFO] websockets.server: server closed
21:54:00 [INFO] gameserver.network.server: WebSocket server stopped
21:54:00 [INFO] __main__:   WebSocket server stopped
21:54:00 [INFO] __main__:   debug dashboard stopped
21:54:00 [INFO] __main__:   database closed
21:54:00 [INFO] __main__:   goodbye
21:54:02 [INFO] __main__: === Game Server starting ===
21:54:02 [INFO] __main__: Loading configuration …
21:54:02 [INFO] __main__:   items:        210 loaded from config
21:54:02 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:54:03 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:54:03 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:54:03 [INFO] __main__:   game_config:  loaded
21:54:03 [INFO] __main__: Initializing persistence …
21:54:03 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:54:03 [INFO] __main__:   database:     connected (gameserver.db)
21:54:03 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:54:00, version 1)
21:54:03 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:54:03 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:54:03 [INFO] __main__: Creating services …
21:54:03 [INFO] __main__:   upgrade_provider: 210 items registered
21:54:03 [INFO] __main__:   all services created
21:54:03 [INFO] __main__: Wiring event handlers …
21:54:03 [INFO] __main__:   event handlers registered
21:54:03 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:54:03 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:54:03 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:54:03 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:54:03 [INFO] __main__: Restored 2 empires from saved state
21:54:03 [INFO] __main__: Restored 1 attacks from saved state
21:54:03 [INFO] __main__: Starting network server …
21:54:03 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:54:03 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:54:03 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:54:03 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:54:03 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:54:03 [INFO] __main__: Starting game loop …
21:54:03 [INFO] __main__:   game loop running (1 s tick)
21:54:04 [INFO] websockets.server: connection open
21:54:04 [INFO] gameserver.network.server: Session registered: uid=-1
21:54:04 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50027)
21:54:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:54:04 [INFO] gameserver.network.server: Session registered: uid=2
21:54:04 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:54:05 [INFO] gameserver.network.server: Session removed: uid=2
21:54:05 [INFO] websockets.server: connection open
21:54:05 [INFO] gameserver.network.server: Session registered: uid=-2
21:54:05 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50051)
21:54:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:54:05 [INFO] gameserver.network.server: Session registered: uid=2
21:54:05 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:54:52 [INFO] gameserver.network.server: Session removed: uid=2
21:54:52 [INFO] websockets.server: connection open
21:54:52 [INFO] gameserver.network.server: Session registered: uid=-3
21:54:52 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 50117)
21:54:52 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:54:52 [INFO] gameserver.network.server: Session registered: uid=2
21:54:52 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:56:56 [INFO] gameserver.network.server: Session removed: uid=2
21:56:57 [INFO] websockets.server: connection open
21:56:57 [INFO] gameserver.network.server: Session registered: uid=-4
21:56:57 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 57940)
21:56:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:56:57 [INFO] gameserver.network.server: Session registered: uid=2
21:56:57 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
21:57:30 [INFO] gameserver.network.server: Session removed: uid=2
21:57:30 [INFO] websockets.server: connection open
21:57:30 [INFO] gameserver.network.server: Session registered: uid=-5
21:57:30 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 57027)
21:57:30 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:57:30 [INFO] gameserver.network.server: Session registered: uid=2
21:57:30 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
21:59:06 [INFO] __main__: Shutdown signal received — stopping …
21:59:07 [INFO] __main__: Shutting down …
21:59:07 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:59:07 [INFO] websockets.server: server closing
21:59:07 [INFO] gameserver.network.server: Session removed: uid=2
21:59:07 [INFO] websockets.server: server closed
21:59:07 [INFO] gameserver.network.server: WebSocket server stopped
21:59:07 [INFO] __main__:   WebSocket server stopped
21:59:07 [INFO] __main__:   debug dashboard stopped
21:59:07 [INFO] __main__:   database closed
21:59:07 [INFO] __main__:   goodbye
21:59:08 [INFO] __main__: === Game Server starting ===
21:59:08 [INFO] __main__: Loading configuration …
21:59:09 [INFO] __main__:   items:        210 loaded from config
21:59:09 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:59:09 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:59:09 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
21:59:09 [INFO] __main__:   game_config:  loaded
21:59:09 [INFO] __main__: Initializing persistence …
21:59:09 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:59:09 [INFO] __main__:   database:     connected (gameserver.db)
21:59:09 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T21:59:07, version 1)
21:59:09 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:59:09 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:59:09 [INFO] __main__: Creating services …
21:59:09 [INFO] __main__:   upgrade_provider: 210 items registered
21:59:09 [INFO] __main__:   all services created
21:59:09 [INFO] __main__: Wiring event handlers …
21:59:09 [INFO] __main__:   event handlers registered
21:59:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:59:09 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:59:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:59:09 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:59:09 [INFO] __main__: Restored 2 empires from saved state
21:59:09 [INFO] __main__: Restored 1 attacks from saved state
21:59:09 [INFO] __main__: Starting network server …
21:59:09 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:59:09 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:59:09 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:59:09 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:59:09 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:59:09 [INFO] __main__: Starting game loop …
21:59:09 [INFO] __main__:   game loop running (1 s tick)
21:59:10 [INFO] websockets.server: connection open
21:59:10 [INFO] gameserver.network.server: Session registered: uid=-1
21:59:10 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54117)
21:59:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:59:10 [INFO] gameserver.network.server: Session registered: uid=2
21:59:10 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:59:19 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=100
21:59:58 [INFO] gameserver.network.server: Session removed: uid=2
21:59:58 [INFO] websockets.server: connection open
21:59:58 [INFO] gameserver.network.server: Session registered: uid=-2
21:59:58 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 52006)
21:59:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:59:58 [INFO] gameserver.network.server: Session registered: uid=2
21:59:58 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:00:11 [INFO] gameserver.network.handlers: change_wave: updated wave 0 slots from 5 to 6
22:00:11 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SWORDMAN slots=6
22:00:22 [INFO] gameserver.network.handlers: change_citizen request from uid=2
22:00:22 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 2, 'free': 3}
22:04:57 [INFO] websockets.server: connection open
22:04:57 [INFO] gameserver.network.server: Session registered: uid=-3
22:04:57 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.122', 61579)
22:04:57 [INFO] gameserver.network.server: Session removed: uid=-3
22:05:20 [INFO] __main__: Shutdown signal received — stopping …
22:05:21 [INFO] __main__: Shutting down …
22:05:21 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:05:21 [INFO] websockets.server: server closing
22:05:21 [INFO] gameserver.network.server: Session removed: uid=2
22:05:21 [INFO] websockets.server: server closed
22:05:21 [INFO] gameserver.network.server: WebSocket server stopped
22:05:21 [INFO] __main__:   WebSocket server stopped
22:05:21 [INFO] __main__:   debug dashboard stopped
22:05:21 [INFO] __main__:   database closed
22:05:21 [INFO] __main__:   goodbye
22:05:22 [INFO] __main__: === Game Server starting ===
22:05:22 [INFO] __main__: Loading configuration …
22:05:23 [INFO] __main__:   items:        210 loaded from config
22:05:23 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:05:23 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:05:23 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
22:05:23 [INFO] __main__:   game_config:  loaded
22:05:23 [INFO] __main__: Initializing persistence …
22:05:23 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:05:23 [INFO] __main__:   database:     connected (gameserver.db)
22:05:23 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T22:05:21, version 1)
22:05:23 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:05:23 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:05:23 [INFO] __main__: Creating services …
22:05:23 [INFO] __main__:   upgrade_provider: 210 items registered
22:05:23 [INFO] __main__:   all services created
22:05:23 [INFO] __main__: Wiring event handlers …
22:05:23 [INFO] __main__:   event handlers registered
22:05:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:05:23 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:05:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:05:23 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:05:23 [INFO] __main__: Restored 2 empires from saved state
22:05:23 [INFO] __main__: Restored 1 attacks from saved state
22:05:23 [INFO] __main__: Starting network server …
22:05:23 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:05:23 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:05:23 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:05:23 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:05:23 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:05:23 [INFO] __main__: Starting game loop …
22:05:23 [INFO] __main__:   game loop running (1 s tick)
22:05:24 [INFO] websockets.server: connection open
22:05:24 [INFO] gameserver.network.server: Session registered: uid=-1
22:05:24 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57352)
22:05:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:05:24 [INFO] gameserver.network.server: Session registered: uid=2
22:05:24 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:05:28 [INFO] gameserver.network.server: Session removed: uid=2
22:05:28 [INFO] websockets.server: connection open
22:05:28 [INFO] gameserver.network.server: Session registered: uid=-2
22:05:28 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57377)
22:05:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:05:28 [INFO] gameserver.network.server: Session registered: uid=2
22:05:28 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:05:29 [INFO] gameserver.network.handlers: change_citizen request from uid=2
22:05:29 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 1, 'free': 4}
22:05:30 [INFO] gameserver.network.handlers: change_citizen request from uid=2
22:05:30 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 2, 'free': 3}
22:05:32 [INFO] gameserver.network.handlers: change_citizen request from uid=2
22:05:32 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 3, 'free': 2}
22:05:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
22:05:37 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 2, 'free': 3}
22:05:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
22:05:37 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 1, 'free': 4}
22:05:38 [INFO] gameserver.network.handlers: change_citizen request from uid=2
22:05:38 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 0, 'free': 5}
22:06:12 [INFO] __main__: Shutdown signal received — stopping …
22:06:12 [INFO] __main__: Shutting down …
22:06:12 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:06:12 [INFO] websockets.server: server closing
22:06:12 [INFO] gameserver.network.server: Session removed: uid=2
22:06:12 [INFO] websockets.server: server closed
22:06:12 [INFO] gameserver.network.server: WebSocket server stopped
22:06:12 [INFO] __main__:   WebSocket server stopped
22:06:12 [INFO] __main__:   debug dashboard stopped
22:06:12 [INFO] __main__:   database closed
22:06:12 [INFO] __main__:   goodbye
04:43:49 [INFO] __main__: === Game Server starting ===
04:43:49 [INFO] __main__: Loading configuration …
04:43:50 [INFO] __main__:   items:        210 loaded from config
04:43:50 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
04:43:50 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
04:43:50 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
04:43:50 [INFO] __main__:   game_config:  loaded
04:43:50 [INFO] __main__: Initializing persistence …
04:43:50 [INFO] gameserver.persistence.database: Database connected: gameserver.db
04:43:50 [INFO] __main__:   database:     connected (gameserver.db)
04:43:50 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-09T22:06:12, version 1)
04:43:50 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
04:43:50 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
04:43:50 [INFO] __main__: Creating services …
04:43:50 [INFO] __main__:   upgrade_provider: 210 items registered
04:43:50 [INFO] __main__:   all services created
04:43:50 [INFO] __main__: Wiring event handlers …
04:43:50 [INFO] __main__:   event handlers registered
04:43:50 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
04:43:50 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
04:43:50 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
04:43:50 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
04:43:50 [INFO] __main__: Restored 2 empires from saved state
04:43:50 [INFO] __main__: Restored 1 attacks from saved state
04:43:50 [INFO] __main__: Starting network server …
04:43:50 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
04:43:50 [INFO] websockets.server: server listening on 0.0.0.0:8765
04:43:50 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
04:43:50 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
04:43:50 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
04:43:50 [INFO] __main__: Starting game loop …
04:43:50 [INFO] __main__:   game loop running (1 s tick)
04:43:59 [INFO] websockets.server: connection open
04:43:59 [INFO] gameserver.network.server: Session registered: uid=-1
04:43:59 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 65362)
04:44:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
04:44:04 [INFO] gameserver.network.server: Session registered: uid=2
04:44:04 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
04:44:06 [INFO] gameserver.network.handlers: change_citizen request from uid=2
04:44:06 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 1, 'free': 4}
04:46:10 [INFO] gameserver.network.server: Session removed: uid=2
04:46:10 [INFO] websockets.server: connection open
04:46:10 [INFO] gameserver.network.server: Session registered: uid=-2
04:46:10 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 65466)
04:46:38 [INFO] gameserver.network.server: Session removed: uid=-2
04:46:38 [INFO] websockets.server: connection open
04:46:38 [INFO] gameserver.network.server: Session registered: uid=-3
04:46:38 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 64042)
04:46:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
04:46:43 [INFO] gameserver.network.server: Session registered: uid=2
04:46:43 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
04:49:29 [INFO] __main__: Shutdown signal received — stopping …
04:49:30 [INFO] __main__: Shutting down …
04:49:30 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
04:49:30 [INFO] websockets.server: server closing
04:49:30 [INFO] gameserver.network.server: Session removed: uid=2
04:49:30 [INFO] websockets.server: server closed
04:49:30 [INFO] gameserver.network.server: WebSocket server stopped
04:49:30 [INFO] __main__:   WebSocket server stopped
04:49:30 [INFO] __main__:   debug dashboard stopped
04:49:30 [INFO] __main__:   database closed
04:49:30 [INFO] __main__:   goodbye
04:49:31 [INFO] __main__: === Game Server starting ===
04:49:31 [INFO] __main__: Loading configuration …
04:49:32 [INFO] __main__:   items:        210 loaded from config
04:49:32 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
04:49:32 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
04:49:32 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
04:49:32 [INFO] __main__:   game_config:  loaded
04:49:32 [INFO] __main__: Initializing persistence …
04:49:32 [INFO] gameserver.persistence.database: Database connected: gameserver.db
04:49:32 [INFO] __main__:   database:     connected (gameserver.db)
04:49:32 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T04:49:30, version 1)
04:49:32 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
04:49:32 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
04:49:32 [INFO] __main__: Creating services …
04:49:32 [INFO] __main__:   upgrade_provider: 210 items registered
04:49:32 [INFO] __main__:   all services created
04:49:32 [INFO] __main__: Wiring event handlers …
04:49:32 [INFO] __main__:   event handlers registered
04:49:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
04:49:32 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
04:49:32 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
04:49:32 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
04:49:32 [INFO] __main__: Restored 2 empires from saved state
04:49:32 [INFO] __main__: Restored 1 attacks from saved state
04:49:32 [INFO] __main__: Starting network server …
04:49:32 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
04:49:32 [INFO] websockets.server: server listening on 0.0.0.0:8765
04:49:32 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
04:49:32 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
04:49:32 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
04:49:32 [INFO] __main__: Starting game loop …
04:49:32 [INFO] __main__:   game loop running (1 s tick)
04:49:33 [INFO] websockets.server: connection open
04:49:33 [INFO] gameserver.network.server: Session registered: uid=-1
04:49:33 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 65240)
04:49:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
04:49:33 [INFO] gameserver.network.server: Session registered: uid=2
04:49:33 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
04:49:40 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
04:49:40 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
04:49:50 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:49:50 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:49:54 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
04:49:54 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
04:49:56 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
04:49:56 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
04:52:41 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
04:52:41 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
04:52:51 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
04:52:51 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
04:52:59 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:52:59 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:23 [INFO] gameserver.network.server: Session removed: uid=2
04:53:23 [INFO] websockets.server: connection open
04:53:23 [INFO] gameserver.network.server: Session registered: uid=-2
04:53:23 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 56145)
04:53:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
04:53:23 [INFO] gameserver.network.server: Session registered: uid=2
04:53:23 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
04:53:25 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
04:53:25 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
04:53:27 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
04:53:27 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
04:53:27 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
04:53:27 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
04:53:29 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:53:29 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:30 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:53:30 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:30 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:53:30 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:31 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:53:31 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:31 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:53:31 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:34 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
04:53:34 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
04:53:35 [INFO] gameserver.network.server: Session removed: uid=2
04:53:36 [INFO] websockets.server: connection open
04:53:36 [INFO] gameserver.network.server: Session registered: uid=-3
04:53:36 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 56221)
04:53:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
04:53:36 [INFO] gameserver.network.server: Session registered: uid=2
04:53:36 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
04:53:39 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:53:39 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:40 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:53:40 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:42 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
04:53:42 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
04:53:49 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:53:49 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
04:53:57 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
04:53:57 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
04:53:58 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
04:53:58 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
04:53:59 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
04:53:59 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
04:54:00 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
04:54:00 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
04:54:00 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
04:54:00 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
04:54:01 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
04:54:01 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
04:54:03 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
04:54:03 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
04:54:04 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
04:54:04 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
04:59:24 [INFO] __main__: Shutdown signal received — stopping …
04:59:24 [INFO] __main__: Shutting down …
04:59:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
04:59:24 [INFO] websockets.server: server closing
04:59:24 [INFO] gameserver.network.server: Session removed: uid=2
04:59:24 [INFO] websockets.server: server closed
04:59:24 [INFO] gameserver.network.server: WebSocket server stopped
04:59:24 [INFO] __main__:   WebSocket server stopped
04:59:24 [INFO] __main__:   debug dashboard stopped
04:59:24 [INFO] __main__:   database closed
04:59:24 [INFO] __main__:   goodbye
04:59:26 [INFO] __main__: === Game Server starting ===
04:59:26 [INFO] __main__: Loading configuration …
04:59:26 [INFO] __main__:   items:        210 loaded from config
04:59:26 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
04:59:26 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
04:59:26 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
04:59:26 [INFO] __main__:   game_config:  loaded
04:59:26 [INFO] __main__: Initializing persistence …
04:59:26 [INFO] gameserver.persistence.database: Database connected: gameserver.db
04:59:26 [INFO] __main__:   database:     connected (gameserver.db)
04:59:26 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T04:59:24, version 1)
04:59:26 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
04:59:26 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
04:59:26 [INFO] __main__: Creating services …
04:59:26 [INFO] __main__:   upgrade_provider: 210 items registered
04:59:26 [INFO] __main__:   all services created
04:59:26 [INFO] __main__: Wiring event handlers …
04:59:26 [INFO] __main__:   event handlers registered
04:59:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
04:59:26 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
04:59:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
04:59:26 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
04:59:26 [INFO] __main__: Restored 2 empires from saved state
04:59:26 [INFO] __main__: Restored 1 attacks from saved state
04:59:26 [INFO] __main__: Starting network server …
04:59:26 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
04:59:26 [INFO] websockets.server: server listening on 0.0.0.0:8765
04:59:26 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
04:59:26 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
04:59:26 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
04:59:26 [INFO] __main__: Starting game loop …
04:59:26 [INFO] __main__:   game loop running (1 s tick)
04:59:27 [INFO] websockets.server: connection open
04:59:27 [INFO] gameserver.network.server: Session registered: uid=-1
04:59:27 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54379)
04:59:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
04:59:27 [INFO] gameserver.network.server: Session registered: uid=2
04:59:27 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
04:59:28 [INFO] gameserver.network.server: Session removed: uid=2
04:59:28 [INFO] websockets.server: connection open
04:59:28 [INFO] gameserver.network.server: Session registered: uid=-2
04:59:28 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 54401)
04:59:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
04:59:28 [INFO] gameserver.network.server: Session registered: uid=2
04:59:28 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
04:59:32 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
04:59:32 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
04:59:34 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
04:59:34 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
05:04:16 [INFO] __main__: Shutdown signal received — stopping …
05:04:17 [INFO] __main__: Shutting down …
05:04:17 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:04:17 [INFO] websockets.server: server closing
05:04:17 [INFO] gameserver.network.server: Session removed: uid=2
05:04:17 [INFO] websockets.server: server closed
05:04:17 [INFO] gameserver.network.server: WebSocket server stopped
05:04:17 [INFO] __main__:   WebSocket server stopped
05:04:17 [INFO] __main__:   debug dashboard stopped
05:04:17 [INFO] __main__:   database closed
05:04:17 [INFO] __main__:   goodbye
05:04:18 [INFO] __main__: === Game Server starting ===
05:04:18 [INFO] __main__: Loading configuration …
05:04:19 [INFO] __main__:   items:        210 loaded from config
05:04:19 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:04:19 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:04:19 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:04:19 [INFO] __main__:   game_config:  loaded
05:04:19 [INFO] __main__: Initializing persistence …
05:04:19 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:04:19 [INFO] __main__:   database:     connected (gameserver.db)
05:04:19 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:04:17, version 1)
05:04:19 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:04:19 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:04:19 [INFO] __main__: Creating services …
05:04:19 [INFO] __main__:   upgrade_provider: 210 items registered
05:04:19 [INFO] __main__:   all services created
05:04:19 [INFO] __main__: Wiring event handlers …
05:04:19 [INFO] __main__:   event handlers registered
05:04:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:04:19 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:04:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:04:19 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:04:19 [INFO] __main__: Restored 2 empires from saved state
05:04:19 [INFO] __main__: Restored 1 attacks from saved state
05:04:19 [INFO] __main__: Starting network server …
05:04:19 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:04:19 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:04:19 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:04:19 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:04:19 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:04:19 [INFO] __main__: Starting game loop …
05:04:19 [INFO] __main__:   game loop running (1 s tick)
05:04:20 [INFO] websockets.server: connection open
05:04:20 [INFO] gameserver.network.server: Session registered: uid=-1
05:04:20 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57944)
05:04:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:04:20 [INFO] gameserver.network.server: Session registered: uid=2
05:04:20 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:04:21 [INFO] gameserver.network.server: Session removed: uid=2
05:04:21 [INFO] websockets.server: connection open
05:04:21 [INFO] gameserver.network.server: Session registered: uid=-2
05:04:21 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57967)
05:04:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:04:21 [INFO] gameserver.network.server: Session registered: uid=2
05:04:21 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:04:23 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
05:04:23 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
05:04:29 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
05:04:29 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
05:04:33 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
05:04:33 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
05:04:40 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
05:04:40 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
05:04:44 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
05:04:44 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
05:04:57 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
05:04:57 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
05:06:42 [INFO] gameserver.network.server: Session removed: uid=2
05:06:42 [INFO] websockets.server: connection open
05:06:42 [INFO] gameserver.network.server: Session registered: uid=-3
05:06:42 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 57580)
05:06:42 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:06:42 [INFO] gameserver.network.server: Session registered: uid=2
05:06:42 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
05:06:44 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
05:06:44 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
05:06:52 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
05:06:52 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
05:06:53 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
05:06:53 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
05:07:00 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
05:07:00 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
05:08:56 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
05:08:56 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
05:08:58 [INFO] gameserver.network.server: Session removed: uid=2
05:08:58 [INFO] websockets.server: connection open
05:08:58 [INFO] gameserver.network.server: Session registered: uid=-4
05:08:58 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 50624)
05:08:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:08:58 [INFO] gameserver.network.server: Session registered: uid=2
05:08:58 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
05:08:59 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
05:08:59 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
05:09:04 [INFO] gameserver.engine.empire_service: Empire 2: started building MEDICUS (effort=4000.0)
05:09:04 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MEDICUS
05:09:09 [INFO] gameserver.engine.empire_service: Empire 2: started building BULLETIN_BOARD (effort=10000.0)
05:09:09 [INFO] gameserver.network.handlers: new_item success uid=2 iid=BULLETIN_BOARD
05:09:12 [INFO] gameserver.engine.empire_service: Empire 2: started research RELIGION (effort=3500.0)
05:09:12 [INFO] gameserver.network.handlers: new_item success uid=2 iid=RELIGION
05:09:14 [INFO] gameserver.engine.empire_service: Empire 2: started research COPPER_BRONZE (effort=2500.0)
05:09:14 [INFO] gameserver.network.handlers: new_item success uid=2 iid=COPPER_BRONZE
05:30:44 [INFO] gameserver.engine.empire_service: Empire 2: knowledge COPPER_BRONZE completed
05:30:56 [INFO] __main__: Shutdown signal received — stopping …
05:30:56 [INFO] __main__: Shutting down …
05:30:56 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:30:56 [INFO] websockets.server: server closing
05:30:56 [INFO] gameserver.network.server: Session removed: uid=2
05:30:56 [INFO] websockets.server: server closed
05:30:56 [INFO] gameserver.network.server: WebSocket server stopped
05:30:56 [INFO] __main__:   WebSocket server stopped
05:30:56 [INFO] __main__:   debug dashboard stopped
05:30:56 [INFO] __main__:   database closed
05:30:56 [INFO] __main__:   goodbye
05:30:58 [INFO] __main__: === Game Server starting ===
05:30:58 [INFO] __main__: Loading configuration …
05:30:58 [INFO] __main__:   items:        210 loaded from config
05:30:58 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:30:58 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:30:59 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:30:59 [INFO] __main__:   game_config:  loaded
05:30:59 [INFO] __main__: Initializing persistence …
05:30:59 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:30:59 [INFO] __main__:   database:     connected (gameserver.db)
05:30:59 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:30:56, version 1)
05:30:59 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:30:59 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:30:59 [INFO] __main__: Creating services …
05:30:59 [INFO] __main__:   upgrade_provider: 210 items registered
05:30:59 [INFO] __main__:   all services created
05:30:59 [INFO] __main__: Wiring event handlers …
05:30:59 [INFO] __main__:   event handlers registered
05:30:59 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:30:59 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:30:59 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:30:59 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:30:59 [INFO] __main__: Restored 2 empires from saved state
05:30:59 [INFO] __main__: Restored 1 attacks from saved state
05:30:59 [INFO] __main__: Starting network server …
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 421, in <module>
    main()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 417, in main
    asyncio.run(_start())
  File "/usr/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.9/asyncio/base_events.py", line 642, in run_until_complete
    return future.result()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 392, in _start
    await start_network(services)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 286, in start_network
    register_all_handlers(services)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1733, in register_all_handlers
    services.events.on(BattleStartRequested, _create_battle_start_handler())
AttributeError: 'Services' object has no attribute 'events'
05:32:06 [INFO] __main__: === Game Server starting ===
05:32:06 [INFO] __main__: Loading configuration …
05:32:07 [INFO] __main__:   items:        210 loaded from config
05:32:07 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:32:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:32:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:32:07 [INFO] __main__:   game_config:  loaded
05:32:07 [INFO] __main__: Initializing persistence …
05:32:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:32:07 [INFO] __main__:   database:     connected (gameserver.db)
05:32:07 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:30:56, version 1)
05:32:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:32:07 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:32:07 [INFO] __main__: Creating services …
05:32:07 [INFO] __main__:   upgrade_provider: 210 items registered
05:32:07 [INFO] __main__:   all services created
05:32:07 [INFO] __main__: Wiring event handlers …
05:32:07 [INFO] __main__:   event handlers registered
05:32:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:32:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:32:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:32:07 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:32:07 [INFO] __main__: Restored 2 empires from saved state
05:32:07 [INFO] __main__: Restored 1 attacks from saved state
05:32:07 [INFO] __main__: Starting network server …
05:32:07 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:32:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:32:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:32:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:32:07 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:32:07 [INFO] __main__: Starting game loop …
05:32:07 [INFO] __main__:   game loop running (1 s tick)
05:32:10 [INFO] websockets.server: connection open
05:32:10 [INFO] gameserver.network.server: Session registered: uid=-1
05:32:10 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50251)
05:32:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:32:10 [INFO] gameserver.network.server: Session registered: uid=2
05:32:10 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:32:24 [INFO] gameserver.network.server: Session removed: uid=2
05:32:24 [INFO] websockets.server: connection open
05:32:24 [INFO] gameserver.network.server: Session registered: uid=-2
05:32:24 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50275)
05:32:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:32:24 [INFO] gameserver.network.server: Session registered: uid=2
05:32:24 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:37:05 [INFO] __main__: === Game Server starting ===
05:37:05 [INFO] __main__: Loading configuration …
05:37:06 [INFO] __main__:   items:        210 loaded from config
05:37:06 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:37:06 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:37:06 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:37:06 [INFO] __main__:   game_config:  loaded
05:37:06 [INFO] __main__: Initializing persistence …
05:37:06 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:37:06 [INFO] __main__:   database:     connected (gameserver.db)
05:37:06 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:30:56, version 1)
05:37:06 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:37:06 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:37:06 [INFO] __main__: Creating services …
05:37:06 [INFO] __main__:   upgrade_provider: 210 items registered
05:37:06 [INFO] __main__:   all services created
05:37:06 [INFO] __main__: Wiring event handlers …
05:37:06 [INFO] __main__:   event handlers registered
05:37:06 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:37:06 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:37:06 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:37:06 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:37:06 [INFO] __main__: Restored 2 empires from saved state
05:37:06 [INFO] __main__: Restored 1 attacks from saved state
05:37:06 [INFO] __main__: Starting network server …
05:37:06 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 454, in <module>
    main()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 450, in main
    asyncio.run(_start(config_dir=config_dir))
  File "/usr/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.9/asyncio/base_events.py", line 642, in run_until_complete
    return future.result()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 408, in _start
    await start_network(services)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 300, in start_network
    await services.server.start()
  File "/home/pi/e3/python_server/src/gameserver/network/server.py", line 57, in start
    self._server = await websockets.serve(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 831, in __await_impl__
    server = await self.create_server
  File "/usr/lib/python3.9/asyncio/base_events.py", line 1494, in create_server
    raise OSError(err.errno, 'error while attempting '
OSError: [Errno 98] error while attempting to bind on address ('0.0.0.0', 8765): address already in use
05:38:41 [INFO] __main__: Shutdown signal received — stopping …
05:38:41 [INFO] __main__: Shutting down …
05:38:41 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:38:41 [INFO] websockets.server: server closing
05:38:42 [INFO] gameserver.network.server: Session removed: uid=2
05:38:42 [INFO] websockets.server: server closed
05:38:42 [INFO] gameserver.network.server: WebSocket server stopped
05:38:42 [INFO] __main__:   WebSocket server stopped
05:38:42 [INFO] __main__:   debug dashboard stopped
05:38:42 [INFO] __main__:   database closed
05:38:42 [INFO] __main__:   goodbye
05:38:44 [INFO] __main__: === Game Server starting ===
05:38:44 [INFO] __main__: Loading configuration …
05:38:45 [INFO] __main__:   items:        210 loaded from config
05:38:45 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:38:45 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:38:45 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:38:45 [INFO] __main__:   game_config:  loaded
05:38:45 [INFO] __main__: Initializing persistence …
05:38:45 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:38:45 [INFO] __main__:   database:     connected (gameserver.db)
05:38:45 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:38:41, version 1)
05:38:45 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:38:45 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:38:45 [INFO] __main__: Creating services …
05:38:45 [INFO] __main__:   upgrade_provider: 210 items registered
05:38:45 [INFO] __main__:   all services created
05:38:45 [INFO] __main__: Wiring event handlers …
05:38:45 [INFO] __main__:   event handlers registered
05:38:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:38:45 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:38:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:38:45 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:38:45 [INFO] __main__: Restored 2 empires from saved state
05:38:45 [INFO] __main__: Restored 1 attacks from saved state
05:38:45 [INFO] __main__: Starting network server …
05:38:45 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:38:45 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:38:45 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:38:45 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:38:45 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:38:45 [INFO] __main__: Starting game loop …
05:38:45 [INFO] __main__:   game loop running (1 s tick)
05:38:45 [INFO] websockets.server: connection open
05:38:45 [INFO] gameserver.network.server: Session registered: uid=-1
05:38:45 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52969)
05:38:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:38:45 [INFO] gameserver.network.server: Session registered: uid=2
05:38:45 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:38:50 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
05:38:57 [INFO] __main__: Shutdown signal received — stopping …
05:38:57 [INFO] __main__: Shutting down …
05:38:57 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:38:57 [INFO] websockets.server: server closing
05:38:57 [INFO] gameserver.network.server: Session removed: uid=2
05:38:57 [INFO] websockets.server: server closed
05:38:57 [INFO] gameserver.network.server: WebSocket server stopped
05:38:57 [INFO] __main__:   WebSocket server stopped
05:38:57 [INFO] __main__:   debug dashboard stopped
05:38:57 [INFO] __main__:   database closed
05:38:57 [INFO] __main__:   goodbye
05:38:58 [INFO] __main__: === Game Server starting ===
05:38:58 [INFO] __main__: Loading configuration …
05:38:59 [INFO] __main__:   items:        210 loaded from config
05:38:59 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:38:59 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:38:59 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:38:59 [INFO] __main__:   game_config:  loaded
05:38:59 [INFO] __main__: Initializing persistence …
05:38:59 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:38:59 [INFO] __main__:   database:     connected (gameserver.db)
05:38:59 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:38:57, version 1)
05:38:59 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:38:59 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:38:59 [INFO] __main__: Creating services …
05:38:59 [INFO] __main__:   upgrade_provider: 210 items registered
05:38:59 [INFO] __main__:   all services created
05:38:59 [INFO] __main__: Wiring event handlers …
05:38:59 [INFO] __main__:   event handlers registered
05:38:59 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:38:59 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:38:59 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:38:59 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:38:59 [INFO] __main__: Restored 2 empires from saved state
05:38:59 [INFO] __main__: Restored 1 attacks from saved state
05:38:59 [INFO] __main__: Starting network server …
05:38:59 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:38:59 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:38:59 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:38:59 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:38:59 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:38:59 [INFO] __main__: Starting game loop …
05:38:59 [INFO] __main__:   game loop running (1 s tick)
05:39:00 [INFO] websockets.server: connection open
05:39:00 [INFO] gameserver.network.server: Session registered: uid=-1
05:39:00 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52970)
05:39:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:39:00 [INFO] gameserver.network.server: Session registered: uid=2
05:39:00 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:39:16 [INFO] __main__: Shutdown signal received — stopping …
05:39:16 [INFO] __main__: Shutting down …
05:39:16 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:39:16 [INFO] websockets.server: server closing
05:39:16 [INFO] gameserver.network.server: Session removed: uid=2
05:39:16 [INFO] websockets.server: server closed
05:39:16 [INFO] gameserver.network.server: WebSocket server stopped
05:39:16 [INFO] __main__:   WebSocket server stopped
05:39:16 [INFO] __main__:   debug dashboard stopped
05:39:16 [INFO] __main__:   database closed
05:39:16 [INFO] __main__:   goodbye
05:39:18 [INFO] __main__: === Game Server starting ===
05:39:18 [INFO] __main__: Loading configuration …
05:39:19 [INFO] __main__:   items:        210 loaded from config
05:39:19 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:39:19 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:39:19 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:39:19 [INFO] __main__:   game_config:  loaded
05:39:19 [INFO] __main__: Initializing persistence …
05:39:19 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:39:19 [INFO] __main__:   database:     connected (gameserver.db)
05:39:19 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:39:16, version 1)
05:39:19 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:39:19 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:39:19 [INFO] __main__: Creating services …
05:39:19 [INFO] __main__:   upgrade_provider: 210 items registered
05:39:19 [INFO] __main__:   all services created
05:39:19 [INFO] __main__: Wiring event handlers …
05:39:19 [INFO] __main__:   event handlers registered
05:39:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:39:19 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:39:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:39:19 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:39:19 [INFO] __main__: Restored 2 empires from saved state
05:39:19 [INFO] __main__: Restored 1 attacks from saved state
05:39:19 [INFO] __main__: Starting network server …
05:39:19 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:39:19 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:39:19 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:39:19 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:39:19 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:39:19 [INFO] __main__: Starting game loop …
05:39:19 [INFO] __main__:   game loop running (1 s tick)
05:39:19 [INFO] websockets.server: connection open
05:39:19 [INFO] gameserver.network.server: Session registered: uid=-1
05:39:19 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52971)
05:39:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:39:19 [INFO] gameserver.network.server: Session registered: uid=2
05:39:19 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:39:43 [INFO] gameserver.network.server: Session removed: uid=2
05:39:43 [INFO] websockets.server: connection open
05:39:43 [INFO] gameserver.network.server: Session registered: uid=-2
05:39:43 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 64582)
05:39:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:39:43 [INFO] gameserver.network.server: Session registered: uid=2
05:39:43 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:40:06 [INFO] __main__: Shutdown signal received — stopping …
05:40:07 [INFO] __main__: Shutting down …
05:40:07 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:40:07 [INFO] websockets.server: server closing
05:40:07 [INFO] gameserver.network.server: Session removed: uid=2
05:40:07 [INFO] websockets.server: server closed
05:40:07 [INFO] gameserver.network.server: WebSocket server stopped
05:40:07 [INFO] __main__:   WebSocket server stopped
05:40:07 [INFO] __main__:   debug dashboard stopped
05:40:07 [INFO] __main__:   database closed
05:40:07 [INFO] __main__:   goodbye
05:40:08 [INFO] __main__: === Game Server starting ===
05:40:08 [INFO] __main__: Loading configuration …
05:40:08 [INFO] __main__:   items:        0 loaded from state2.yaml
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 454, in <module>
    main()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 450, in main
    asyncio.run(_start(config_dir=config_dir))
  File "/usr/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.9/asyncio/base_events.py", line 642, in run_until_complete
    return future.result()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 382, in _start
    config = load_configuration(config_dir=config_dir)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 142, in load_configuration
    hex_map = load_map(map_path)
  File "/home/pi/e3/python_server/src/gameserver/loaders/map_loader.py", line 36, in load_map
    with path.open() as f:
  File "/usr/lib/python3.9/pathlib.py", line 1241, in open
    return io.open(self, mode, buffering, encoding, errors, newline,
  File "/usr/lib/python3.9/pathlib.py", line 1109, in _opener
    return self._accessor.open(self, flags, mode)
NotADirectoryError: [Errno 20] Not a directory: 'state2.yaml/maps/default.yaml'
05:44:38 [INFO] __main__: === Game Server starting ===
05:44:38 [INFO] __main__: Loading configuration …
05:44:39 [INFO] __main__:   items:        210 loaded from config
05:44:39 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:44:39 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:44:39 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:44:39 [INFO] __main__:   game_config:  loaded
05:44:39 [INFO] __main__: Initializing persistence …
05:44:39 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:44:39 [INFO] __main__:   database:     connected (gameserver.db)
05:44:39 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:40:07, version 1)
05:44:39 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:44:39 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:44:39 [INFO] __main__: Creating services …
05:44:39 [INFO] __main__:   upgrade_provider: 210 items registered
05:44:39 [INFO] __main__:   all services created
05:44:39 [INFO] __main__: Wiring event handlers …
05:44:39 [INFO] __main__:   event handlers registered
05:44:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:44:39 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:44:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:44:39 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:44:39 [INFO] __main__: Restored 2 empires from saved state
05:44:39 [INFO] __main__: Restored 1 attacks from saved state
05:44:39 [INFO] __main__: Starting network server …
05:44:39 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:44:39 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:44:39 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:44:39 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:44:39 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:44:39 [INFO] __main__: Starting game loop …
05:44:39 [INFO] __main__:   game loop running (1 s tick)
05:44:43 [INFO] websockets.server: connection open
05:44:43 [INFO] gameserver.network.server: Session registered: uid=-1
05:44:43 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53100)
05:44:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:44:43 [INFO] gameserver.network.server: Session registered: uid=2
05:44:43 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:45:31 [INFO] __main__: Shutdown signal received — stopping …
05:45:32 [INFO] __main__: Shutting down …
05:45:32 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:45:32 [INFO] websockets.server: server closing
05:45:32 [INFO] gameserver.network.server: Session removed: uid=2
05:45:32 [INFO] websockets.server: server closed
05:45:32 [INFO] gameserver.network.server: WebSocket server stopped
05:45:32 [INFO] __main__:   WebSocket server stopped
05:45:32 [INFO] __main__:   debug dashboard stopped
05:45:32 [INFO] __main__:   database closed
05:45:32 [INFO] __main__:   goodbye
05:45:34 [INFO] __main__: === Game Server starting ===
05:45:34 [INFO] __main__: Loading configuration …
05:45:35 [INFO] __main__:   items:        210 loaded from config
05:45:35 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:45:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:45:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:45:35 [INFO] __main__:   game_config:  loaded
05:45:35 [INFO] __main__: Initializing persistence …
05:45:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:45:35 [INFO] __main__:   database:     connected (gameserver.db)
05:45:35 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
05:45:35 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:45:35 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:45:35 [INFO] __main__: Creating services …
05:45:35 [INFO] __main__:   upgrade_provider: 210 items registered
05:45:35 [INFO] __main__:   all services created
05:45:35 [INFO] __main__: Wiring event handlers …
05:45:35 [INFO] __main__:   event handlers registered
05:45:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:45:35 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:45:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:45:35 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:45:35 [INFO] __main__: Restored 2 empires from saved state
05:45:35 [INFO] __main__: Restored 1 attacks from saved state
05:45:35 [INFO] __main__: Starting network server …
05:45:35 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:45:35 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:45:35 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:45:35 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:45:35 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:45:35 [INFO] __main__: Starting game loop …
05:45:35 [INFO] __main__:   game loop running (1 s tick)
05:45:35 [INFO] websockets.server: connection open
05:45:35 [INFO] gameserver.network.server: Session registered: uid=-1
05:45:35 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53101)
05:45:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:45:35 [INFO] gameserver.network.server: Session registered: uid=2
05:45:35 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:46:06 [INFO] __main__: Shutdown signal received — stopping …
05:46:06 [INFO] __main__: Shutting down …
05:46:06 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:46:06 [INFO] websockets.server: server closing
05:46:06 [INFO] gameserver.network.server: Session removed: uid=2
05:46:06 [INFO] websockets.server: server closed
05:46:06 [INFO] gameserver.network.server: WebSocket server stopped
05:46:06 [INFO] __main__:   WebSocket server stopped
05:46:06 [INFO] __main__:   debug dashboard stopped
05:46:06 [INFO] __main__:   database closed
05:46:06 [INFO] __main__:   goodbye
05:46:08 [INFO] __main__: === Game Server starting ===
05:46:08 [INFO] __main__: Loading configuration …
05:46:08 [INFO] __main__:   items:        210 loaded from config
05:46:08 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:46:08 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:46:08 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:46:08 [INFO] __main__:   game_config:  loaded
05:46:08 [INFO] __main__: Initializing persistence …
05:46:08 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:46:08 [INFO] __main__:   database:     connected (gameserver.db)
05:46:08 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:46:06, version 1)
05:46:08 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:46:08 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:46:08 [INFO] __main__: Creating services …
05:46:08 [INFO] __main__:   upgrade_provider: 210 items registered
05:46:08 [INFO] __main__:   all services created
05:46:08 [INFO] __main__: Wiring event handlers …
05:46:08 [INFO] __main__:   event handlers registered
05:46:08 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:46:08 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:46:08 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:46:08 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:46:08 [INFO] __main__: Restored 2 empires from saved state
05:46:08 [INFO] __main__: Restored 1 attacks from saved state
05:46:08 [INFO] __main__: Starting network server …
05:46:08 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:46:08 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:46:08 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:46:08 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:46:08 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:46:08 [INFO] __main__: Starting game loop …
05:46:08 [INFO] __main__:   game loop running (1 s tick)
05:46:09 [INFO] websockets.server: connection open
05:46:09 [INFO] gameserver.network.server: Session registered: uid=-1
05:46:09 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53109)
05:46:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:46:09 [INFO] gameserver.network.server: Session registered: uid=2
05:46:09 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:46:42 [INFO] gameserver.network.server: Session removed: uid=2
05:47:04 [INFO] websockets.server: connection open
05:47:04 [INFO] gameserver.network.server: Session registered: uid=-2
05:47:04 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62662)
05:47:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:47:04 [INFO] gameserver.network.server: Session registered: uid=2
05:47:04 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:47:49 [INFO] gameserver.engine.attack_service: Attack 1 arrived: 100→2 army=1 (entering siege)
05:48:19 [INFO] gameserver.engine.attack_service: Attack 1 siege complete: 100→2 army=1 (starting battle)
05:48:19 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
05:48:19 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
05:48:24 [INFO] __main__: Shutdown signal received — stopping …
05:48:25 [INFO] __main__: Shutting down …
05:48:25 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:48:25 [INFO] websockets.server: server closing
05:48:25 [INFO] gameserver.network.server: Session removed: uid=2
05:48:25 [INFO] websockets.server: server closed
05:48:25 [INFO] gameserver.network.server: WebSocket server stopped
05:48:25 [INFO] __main__:   WebSocket server stopped
05:48:25 [INFO] __main__:   debug dashboard stopped
05:48:25 [INFO] __main__:   database closed
05:48:25 [INFO] __main__:   goodbye
05:48:43 [INFO] __main__: === Game Server starting ===
05:48:43 [INFO] __main__: Loading configuration …
05:48:44 [INFO] __main__:   items:        210 loaded from config
05:48:44 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:48:44 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:48:44 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:48:44 [INFO] __main__:   game_config:  loaded
05:48:44 [INFO] __main__: Initializing persistence …
05:48:44 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:48:44 [INFO] __main__:   database:     connected (gameserver.db)
05:48:44 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:48:25, version 1)
05:48:44 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:48:44 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:48:44 [INFO] __main__: Creating services …
05:48:44 [INFO] __main__:   upgrade_provider: 210 items registered
05:48:44 [INFO] __main__:   all services created
05:48:44 [INFO] __main__: Wiring event handlers …
05:48:44 [INFO] __main__:   event handlers registered
05:48:44 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:48:44 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:48:44 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:48:44 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:48:44 [INFO] __main__: Restored 2 empires from saved state
05:48:44 [INFO] __main__: Restored 1 attacks from saved state
05:48:44 [INFO] __main__: Starting network server …
05:48:44 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:48:44 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:48:44 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:48:44 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:48:44 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:48:44 [INFO] __main__: Starting game loop …
05:48:44 [INFO] __main__:   game loop running (1 s tick)
05:48:44 [INFO] websockets.server: connection open
05:48:44 [INFO] gameserver.network.server: Session registered: uid=-1
05:48:44 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53608)
05:48:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:48:44 [INFO] gameserver.network.server: Session registered: uid=2
05:48:44 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:48:49 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
05:49:45 [INFO] __main__: Shutdown signal received — stopping …
05:49:45 [INFO] __main__: Shutting down …
05:49:45 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:49:45 [INFO] websockets.server: server closing
05:49:45 [INFO] gameserver.network.server: Session removed: uid=2
05:49:45 [INFO] websockets.server: server closed
05:49:45 [INFO] gameserver.network.server: WebSocket server stopped
05:49:45 [INFO] __main__:   WebSocket server stopped
05:49:45 [INFO] __main__:   debug dashboard stopped
05:49:45 [INFO] __main__:   database closed
05:49:45 [INFO] __main__:   goodbye
05:49:51 [INFO] __main__: === Game Server starting ===
05:49:51 [INFO] __main__: Loading configuration …
05:49:51 [INFO] __main__:   items:        210 loaded from config
05:49:51 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:49:51 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:49:51 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:49:51 [INFO] __main__:   game_config:  loaded
05:49:51 [INFO] __main__: Initializing persistence …
05:49:51 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:49:51 [INFO] __main__:   database:     connected (gameserver.db)
05:49:52 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:49:45, version 1)
05:49:52 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:49:52 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:49:52 [INFO] __main__: Creating services …
05:49:52 [INFO] __main__:   upgrade_provider: 210 items registered
05:49:52 [INFO] __main__:   all services created
05:49:52 [INFO] __main__: Wiring event handlers …
05:49:52 [INFO] __main__:   event handlers registered
05:49:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:49:52 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:49:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:49:52 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:49:52 [INFO] __main__: Restored 2 empires from saved state
05:49:52 [INFO] __main__: Restored 1 attacks from saved state
05:49:52 [INFO] __main__: Starting network server …
05:49:52 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:49:52 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:49:52 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:49:52 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:49:52 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:49:52 [INFO] __main__: Starting game loop …
05:49:52 [INFO] __main__:   game loop running (1 s tick)
05:49:53 [INFO] websockets.server: connection open
05:49:53 [INFO] gameserver.network.server: Session registered: uid=-1
05:49:53 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60657)
05:49:53 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:49:53 [INFO] gameserver.network.server: Session registered: uid=2
05:49:53 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:49:56 [INFO] gameserver.network.server: Session removed: uid=2
05:49:56 [INFO] websockets.server: connection open
05:49:56 [INFO] gameserver.network.server: Session registered: uid=-2
05:49:56 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60669)
05:49:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:49:56 [INFO] gameserver.network.server: Session registered: uid=2
05:49:56 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:49:58 [INFO] gameserver.network.server: Session removed: uid=2
05:49:58 [INFO] websockets.server: connection open
05:49:58 [INFO] gameserver.network.server: Session registered: uid=-3
05:49:58 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60671)
05:49:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:49:58 [INFO] gameserver.network.server: Session registered: uid=2
05:49:58 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
05:50:10 [INFO] gameserver.network.server: Session removed: uid=2
05:50:10 [INFO] websockets.server: connection open
05:50:10 [INFO] gameserver.network.server: Session registered: uid=-4
05:50:10 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 55139)
05:50:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:50:10 [INFO] gameserver.network.server: Session registered: uid=2
05:50:10 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
05:50:20 [INFO] __main__: Shutdown signal received — stopping …
05:50:21 [INFO] __main__: Shutting down …
05:50:21 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:50:21 [INFO] websockets.server: server closing
05:50:21 [INFO] gameserver.network.server: Session removed: uid=2
05:50:21 [INFO] websockets.server: server closed
05:50:21 [INFO] gameserver.network.server: WebSocket server stopped
05:50:21 [INFO] __main__:   WebSocket server stopped
05:50:21 [INFO] __main__:   debug dashboard stopped
05:50:21 [INFO] __main__:   database closed
05:50:21 [INFO] __main__:   goodbye
05:50:42 [INFO] __main__: === Game Server starting ===
05:50:42 [INFO] __main__: Loading configuration …
05:50:43 [INFO] __main__:   items:        210 loaded from config
05:50:43 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:50:43 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:50:43 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:50:43 [INFO] __main__:   game_config:  loaded
05:50:43 [INFO] __main__: Initializing persistence …
05:50:43 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:50:43 [INFO] __main__:   database:     connected (gameserver.db)
05:50:43 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:50:21, version 1)
05:50:43 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:50:43 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:50:43 [INFO] __main__: Creating services …
05:50:43 [INFO] __main__:   upgrade_provider: 210 items registered
05:50:43 [INFO] __main__:   all services created
05:50:43 [INFO] __main__: Wiring event handlers …
05:50:43 [INFO] __main__:   event handlers registered
05:50:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:50:43 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:50:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:50:43 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:50:43 [INFO] __main__: Restored 2 empires from saved state
05:50:43 [INFO] __main__: Restored 1 attacks from saved state
05:50:43 [INFO] __main__: Starting network server …
05:50:43 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:50:43 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:50:43 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:50:43 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:50:43 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:50:43 [INFO] __main__: Starting game loop …
05:50:43 [INFO] __main__:   game loop running (1 s tick)
05:50:44 [INFO] websockets.server: connection open
05:50:44 [INFO] gameserver.network.server: Session registered: uid=-1
05:50:44 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55152)
05:50:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:50:44 [INFO] gameserver.network.server: Session registered: uid=2
05:50:44 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:50:45 [INFO] __main__: Shutdown signal received — stopping …
05:50:46 [INFO] __main__: Shutting down …
05:50:46 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:50:46 [INFO] websockets.server: server closing
05:50:46 [INFO] gameserver.network.server: Session removed: uid=2
05:50:46 [INFO] websockets.server: server closed
05:50:46 [INFO] gameserver.network.server: WebSocket server stopped
05:50:46 [INFO] __main__:   WebSocket server stopped
05:50:46 [INFO] __main__:   debug dashboard stopped
05:50:46 [INFO] __main__:   database closed
05:50:46 [INFO] __main__:   goodbye
05:51:28 [INFO] __main__: === Game Server starting ===
05:51:28 [INFO] __main__: Loading configuration …
05:51:28 [INFO] __main__:   items:        210 loaded from config
05:51:28 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:51:28 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:51:28 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:51:28 [INFO] __main__:   game_config:  loaded
05:51:28 [INFO] __main__: Initializing persistence …
05:51:28 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:51:28 [INFO] __main__:   database:     connected (gameserver.db)
05:51:28 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
05:51:28 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:51:28 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:51:28 [INFO] __main__: Creating services …
05:51:28 [INFO] __main__:   upgrade_provider: 210 items registered
05:51:28 [INFO] __main__:   all services created
05:51:28 [INFO] __main__: Wiring event handlers …
05:51:28 [INFO] __main__:   event handlers registered
05:51:28 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:51:28 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:51:28 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:51:28 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:51:28 [INFO] __main__: Restored 2 empires from saved state
05:51:28 [INFO] __main__: Restored 1 attacks from saved state
05:51:28 [INFO] __main__: Starting network server …
05:51:28 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:51:28 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:51:28 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:51:28 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:51:28 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:51:28 [INFO] __main__: Starting game loop …
05:51:28 [INFO] __main__:   game loop running (1 s tick)
05:51:28 [INFO] websockets.server: connection open
05:51:28 [INFO] gameserver.network.server: Session registered: uid=-1
05:51:28 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55171)
05:51:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:51:28 [INFO] gameserver.network.server: Session registered: uid=2
05:51:28 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:51:31 [INFO] gameserver.network.server: Session removed: uid=2
05:51:31 [INFO] websockets.server: connection open
05:51:31 [INFO] gameserver.network.server: Session registered: uid=-2
05:51:31 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55174)
05:51:31 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:51:31 [INFO] gameserver.network.server: Session registered: uid=2
05:51:31 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:51:34 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
05:53:39 [INFO] gameserver.engine.attack_service: Attack 1 arrived: 100→2 army=1 (entering siege)
05:54:09 [INFO] gameserver.engine.attack_service: Attack 1 siege complete: 100→2 army=1 (starting battle)
05:54:09 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
05:54:09 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
05:57:39 [INFO] __main__: Shutdown signal received — stopping …
05:57:39 [INFO] __main__: Shutting down …
05:57:39 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:57:39 [INFO] websockets.server: server closing
05:57:39 [INFO] gameserver.network.server: Session removed: uid=2
05:57:39 [INFO] websockets.server: server closed
05:57:39 [INFO] gameserver.network.server: WebSocket server stopped
05:57:39 [INFO] __main__:   WebSocket server stopped
05:57:39 [INFO] __main__:   debug dashboard stopped
05:57:39 [INFO] __main__:   database closed
05:57:39 [INFO] __main__:   goodbye
05:57:41 [INFO] __main__: === Game Server starting ===
05:57:41 [INFO] __main__: Loading configuration …
05:57:41 [INFO] __main__:   items:        210 loaded from config
05:57:41 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:57:41 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:57:41 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:57:41 [INFO] __main__:   game_config:  loaded
05:57:41 [INFO] __main__: Initializing persistence …
05:57:41 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:57:41 [INFO] __main__:   database:     connected (gameserver.db)
05:57:41 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
05:57:41 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:57:41 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:57:41 [INFO] __main__: Creating services …
05:57:41 [INFO] __main__:   upgrade_provider: 210 items registered
05:57:41 [INFO] __main__:   all services created
05:57:41 [INFO] __main__: Wiring event handlers …
05:57:41 [INFO] __main__:   event handlers registered
05:57:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:57:41 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:57:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:57:41 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:57:41 [INFO] __main__: Restored 2 empires from saved state
05:57:41 [INFO] __main__: Restored 1 attacks from saved state
05:57:41 [INFO] __main__: Starting network server …
05:57:41 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:57:41 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:57:41 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:57:41 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:57:41 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:57:41 [INFO] __main__: Starting game loop …
05:57:41 [INFO] __main__:   game loop running (1 s tick)
05:57:42 [INFO] websockets.server: connection open
05:57:42 [INFO] gameserver.network.server: Session registered: uid=-1
05:57:42 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51933)
05:57:42 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:57:42 [INFO] gameserver.network.server: Session registered: uid=2
05:57:42 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:57:45 [INFO] gameserver.network.server: Session removed: uid=2
05:57:45 [INFO] websockets.server: connection open
05:57:45 [INFO] gameserver.network.server: Session registered: uid=-2
05:57:45 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 51940)
05:57:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:57:45 [INFO] gameserver.network.server: Session registered: uid=2
05:57:45 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
05:57:58 [INFO] __main__: Shutdown signal received — stopping …
05:57:58 [INFO] __main__: Shutting down …
05:57:58 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:57:58 [INFO] websockets.server: server closing
05:57:58 [INFO] gameserver.network.server: Session removed: uid=2
05:57:58 [INFO] websockets.server: server closed
05:57:58 [INFO] gameserver.network.server: WebSocket server stopped
05:57:58 [INFO] __main__:   WebSocket server stopped
05:57:58 [INFO] __main__:   debug dashboard stopped
05:57:58 [INFO] __main__:   database closed
05:57:58 [INFO] __main__:   goodbye
05:58:00 [INFO] __main__: === Game Server starting ===
05:58:00 [INFO] __main__: Loading configuration …
05:58:01 [INFO] __main__:   items:        210 loaded from config
05:58:01 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:58:01 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:58:01 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:58:01 [INFO] __main__:   game_config:  loaded
05:58:01 [INFO] __main__: Initializing persistence …
05:58:01 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:58:01 [INFO] __main__:   database:     connected (gameserver.db)
05:58:01 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
05:58:01 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:58:01 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:58:01 [INFO] __main__: Creating services …
05:58:01 [INFO] __main__:   upgrade_provider: 210 items registered
05:58:01 [INFO] __main__:   all services created
05:58:01 [INFO] __main__: Wiring event handlers …
05:58:01 [INFO] __main__:   event handlers registered
05:58:01 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:58:01 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:58:01 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:58:01 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:58:01 [INFO] __main__: Restored 2 empires from saved state
05:58:01 [INFO] __main__: Restored 1 attacks from saved state
05:58:01 [INFO] __main__: Starting network server …
05:58:01 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:58:01 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:58:01 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:58:01 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:58:01 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:58:01 [INFO] __main__: Starting game loop …
05:58:01 [INFO] __main__:   game loop running (1 s tick)
05:58:01 [INFO] websockets.server: connection open
05:58:01 [INFO] gameserver.network.server: Session registered: uid=-1
05:58:01 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55980)
05:58:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:58:01 [INFO] gameserver.network.server: Session registered: uid=2
05:58:01 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:58:11 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
05:58:36 [INFO] __main__: Shutdown signal received — stopping …
05:58:36 [INFO] __main__: Shutting down …
05:58:36 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:58:36 [INFO] websockets.server: server closing
05:58:36 [INFO] gameserver.network.server: Session removed: uid=2
05:58:36 [INFO] websockets.server: server closed
05:58:36 [INFO] gameserver.network.server: WebSocket server stopped
05:58:36 [INFO] __main__:   WebSocket server stopped
05:58:36 [INFO] __main__:   debug dashboard stopped
05:58:36 [INFO] __main__:   database closed
05:58:36 [INFO] __main__:   goodbye
05:58:53 [INFO] __main__: === Game Server starting ===
05:58:53 [INFO] __main__: Loading configuration …
05:58:54 [INFO] __main__:   items:        210 loaded from config
05:58:54 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
05:58:54 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
05:58:54 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
05:58:54 [INFO] __main__:   game_config:  loaded
05:58:54 [INFO] __main__: Initializing persistence …
05:58:54 [INFO] gameserver.persistence.database: Database connected: gameserver.db
05:58:54 [INFO] __main__:   database:     connected (gameserver.db)
05:58:54 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:58:36, version 1)
05:58:54 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
05:58:54 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
05:58:54 [INFO] __main__: Creating services …
05:58:54 [INFO] __main__:   upgrade_provider: 210 items registered
05:58:54 [INFO] __main__:   all services created
05:58:54 [INFO] __main__: Wiring event handlers …
05:58:54 [INFO] __main__:   event handlers registered
05:58:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
05:58:54 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
05:58:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
05:58:54 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
05:58:54 [INFO] __main__: Restored 2 empires from saved state
05:58:54 [INFO] __main__: Restored 1 attacks from saved state
05:58:54 [INFO] __main__: Starting network server …
05:58:54 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
05:58:54 [INFO] websockets.server: server listening on 0.0.0.0:8765
05:58:54 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
05:58:54 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
05:58:54 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
05:58:54 [INFO] __main__: Starting game loop …
05:58:54 [INFO] __main__:   game loop running (1 s tick)
05:58:56 [INFO] websockets.server: connection open
05:58:56 [INFO] gameserver.network.server: Session registered: uid=-1
05:58:56 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49982)
05:58:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
05:58:56 [INFO] gameserver.network.server: Session registered: uid=2
05:58:56 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
05:59:00 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
05:59:00 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
05:59:00 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
05:59:19 [INFO] __main__: Shutdown signal received — stopping …
05:59:20 [INFO] __main__: Shutting down …
05:59:20 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
05:59:20 [INFO] websockets.server: server closing
05:59:20 [INFO] gameserver.network.server: Session removed: uid=2
05:59:20 [INFO] websockets.server: server closed
05:59:20 [INFO] gameserver.network.server: WebSocket server stopped
05:59:20 [INFO] __main__:   WebSocket server stopped
05:59:20 [INFO] __main__:   debug dashboard stopped
05:59:20 [INFO] __main__:   database closed
05:59:20 [INFO] __main__:   goodbye
06:04:03 [INFO] __main__: === Game Server starting ===
06:04:03 [INFO] __main__: Loading configuration …
06:04:04 [INFO] __main__:   items:        210 loaded from config
06:04:04 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:04:04 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:04:04 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:04:04 [INFO] __main__:   game_config:  loaded
06:04:04 [INFO] __main__: Initializing persistence …
06:04:04 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:04:04 [INFO] __main__:   database:     connected (gameserver.db)
06:04:04 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T05:59:20, version 1)
06:04:04 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
06:04:04 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
06:04:04 [INFO] __main__: Creating services …
06:04:04 [INFO] __main__:   upgrade_provider: 210 items registered
06:04:04 [INFO] __main__:   all services created
06:04:04 [INFO] __main__: Wiring event handlers …
06:04:04 [INFO] __main__:   event handlers registered
06:04:04 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:04:04 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:04:04 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:04:04 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:04:04 [INFO] __main__: Restored 2 empires from saved state
06:04:04 [INFO] __main__: Restored 1 attacks from saved state
06:04:04 [INFO] __main__: Starting network server …
06:04:04 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:04:04 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:04:04 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:04:04 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:04:04 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:04:04 [INFO] __main__: Starting game loop …
06:04:04 [INFO] __main__:   game loop running (1 s tick)
06:04:39 [INFO] websockets.server: connection open
06:04:39 [INFO] gameserver.network.server: Session registered: uid=-1
06:04:39 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62803)
06:04:39 [INFO] gameserver.network.server: Client disconnected: uid=-1 code=CloseCode.ABNORMAL_CLOSURE
06:04:39 [INFO] gameserver.network.server: Session removed: uid=-1
06:04:39 [INFO] websockets.server: connection open
06:04:39 [INFO] gameserver.network.server: Session registered: uid=-2
06:04:39 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62809)
06:04:39 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:04:39 [INFO] gameserver.network.server: Session registered: uid=2
06:04:39 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:04:59 [INFO] __main__: Shutdown signal received — stopping …
06:05:00 [INFO] __main__: Shutting down …
06:05:00 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
06:05:00 [INFO] websockets.server: server closing
06:05:00 [INFO] gameserver.network.server: Session removed: uid=2
06:05:00 [INFO] websockets.server: server closed
06:05:00 [INFO] gameserver.network.server: WebSocket server stopped
06:05:00 [INFO] __main__:   WebSocket server stopped
06:05:00 [INFO] __main__:   debug dashboard stopped
06:05:00 [INFO] __main__:   database closed
06:05:00 [INFO] __main__:   goodbye
06:05:09 [INFO] __main__: === Game Server starting ===
06:05:09 [INFO] __main__: Loading configuration …
06:05:09 [INFO] __main__:   items:        210 loaded from config
06:05:09 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:05:09 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:05:09 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:05:09 [INFO] __main__:   game_config:  loaded
06:05:09 [INFO] __main__: Initializing persistence …
06:05:09 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:05:09 [INFO] __main__:   database:     connected (gameserver.db)
06:05:10 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
06:05:10 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
06:05:10 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
06:05:10 [INFO] __main__: Creating services …
06:05:10 [INFO] __main__:   upgrade_provider: 210 items registered
06:05:10 [INFO] __main__:   all services created
06:05:10 [INFO] __main__: Wiring event handlers …
06:05:10 [INFO] __main__:   event handlers registered
06:05:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:05:10 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:05:10 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:05:10 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:05:10 [INFO] __main__: Restored 2 empires from saved state
06:05:10 [INFO] __main__: Restored 1 attacks from saved state
06:05:10 [INFO] __main__: Starting network server …
06:05:10 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:05:10 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:05:10 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:05:10 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:05:10 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:05:10 [INFO] __main__: Starting game loop …
06:05:10 [INFO] __main__:   game loop running (1 s tick)
06:05:10 [INFO] websockets.server: connection open
06:05:10 [INFO] gameserver.network.server: Session registered: uid=-1
06:05:10 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57421)
06:05:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:05:10 [INFO] gameserver.network.server: Session registered: uid=2
06:05:10 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:05:14 [INFO] gameserver.network.server: Session removed: uid=2
06:05:14 [INFO] websockets.server: connection open
06:05:14 [INFO] gameserver.network.server: Session registered: uid=-2
06:05:14 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 51089)
06:05:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:05:14 [INFO] gameserver.network.server: Session registered: uid=2
06:05:14 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:05:20 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
06:05:20 [INFO] gameserver.network.server: Session removed: uid=2
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 456, in <module>
    main()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 452, in main
    asyncio.run(_start(config_dir=config_dir, state_file=state_file))
  File "/usr/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.9/asyncio/base_events.py", line 642, in run_until_complete
    return future.result()
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 413, in _start
    await start_game_loop(services)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 336, in start_game_loop
    await services.game_loop.run()
  File "/home/pi/e3/python_server/src/gameserver/engine/game_loop.py", line 73, in run
    self._step(dt)
  File "/home/pi/e3/python_server/src/gameserver/engine/game_loop.py", line 106, in _step
    battles_to_start = self._attacks.step_all(dt)
  File "/home/pi/e3/python_server/src/gameserver/engine/attack_service.py", line 189, in step_all
    result = self.step(attack, dt)
  File "/home/pi/e3/python_server/src/gameserver/engine/attack_service.py", line 149, in step
    self._events.emit(AttackPhaseChanged(
  File "/home/pi/e3/python_server/src/gameserver/util/events.py", line 123, in emit
    handler(event)
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1425, in _on_attack_phase_changed
    if svc.server and attacker_uid in svc.server.sessions:
AttributeError: 'Server' object has no attribute 'sessions'
06:07:16 [INFO] __main__: === Game Server starting ===
06:07:16 [INFO] __main__: Loading configuration …
06:07:17 [INFO] __main__:   items:        210 loaded from config
06:07:17 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:07:17 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:07:17 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:07:17 [INFO] __main__:   game_config:  loaded
06:07:17 [INFO] __main__: Initializing persistence …
06:07:17 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:07:17 [INFO] __main__:   database:     connected (gameserver.db)
06:07:17 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T06:05:00, version 1)
06:07:17 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
06:07:17 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
06:07:17 [INFO] __main__: Creating services …
06:07:17 [INFO] __main__:   upgrade_provider: 210 items registered
06:07:17 [INFO] __main__:   all services created
06:07:17 [INFO] __main__: Wiring event handlers …
06:07:17 [INFO] __main__:   event handlers registered
06:07:17 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:07:17 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:07:17 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:07:17 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:07:17 [INFO] __main__: Restored 2 empires from saved state
06:07:17 [INFO] __main__: Restored 1 attacks from saved state
06:07:17 [INFO] __main__: Starting network server …
06:07:17 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:07:17 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:07:17 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:07:17 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:07:17 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:07:17 [INFO] __main__: Starting game loop …
06:07:17 [INFO] __main__:   game loop running (1 s tick)
06:07:17 [INFO] websockets.server: connection open
06:07:17 [INFO] gameserver.network.server: Session registered: uid=-1
06:07:17 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54712)
06:07:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:07:17 [INFO] gameserver.network.server: Session registered: uid=2
06:07:17 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:07:22 [INFO] gameserver.network.server: Session removed: uid=2
06:07:22 [INFO] websockets.server: connection open
06:07:22 [INFO] gameserver.network.server: Session registered: uid=-2
06:07:22 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 54718)
06:07:22 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:07:22 [INFO] gameserver.network.server: Session registered: uid=2
06:07:22 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:07:35 [INFO] __main__: Shutdown signal received — stopping …
06:07:35 [INFO] __main__: Shutting down …
06:07:35 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
06:07:35 [INFO] websockets.server: server closing
06:07:35 [INFO] gameserver.network.server: Session removed: uid=2
06:07:35 [INFO] websockets.server: server closed
06:07:35 [INFO] gameserver.network.server: WebSocket server stopped
06:07:35 [INFO] __main__:   WebSocket server stopped
06:07:35 [INFO] __main__:   debug dashboard stopped
06:07:35 [INFO] __main__:   database closed
06:07:35 [INFO] __main__:   goodbye
06:07:37 [INFO] __main__: === Game Server starting ===
06:07:37 [INFO] __main__: Loading configuration …
06:07:38 [INFO] __main__:   items:        210 loaded from config
06:07:38 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:07:38 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:07:38 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:07:38 [INFO] __main__:   game_config:  loaded
06:07:38 [INFO] __main__: Initializing persistence …
06:07:38 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:07:38 [INFO] __main__:   database:     connected (gameserver.db)
06:07:38 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
06:07:38 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
06:07:38 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
06:07:38 [INFO] __main__: Creating services …
06:07:38 [INFO] __main__:   upgrade_provider: 210 items registered
06:07:38 [INFO] __main__:   all services created
06:07:38 [INFO] __main__: Wiring event handlers …
06:07:38 [INFO] __main__:   event handlers registered
06:07:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:07:38 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:07:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:07:38 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:07:38 [INFO] __main__: Restored 2 empires from saved state
06:07:38 [INFO] __main__: Restored 1 attacks from saved state
06:07:38 [INFO] __main__: Starting network server …
06:07:38 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:07:38 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:07:38 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:07:38 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:07:38 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:07:38 [INFO] __main__: Starting game loop …
06:07:38 [INFO] __main__:   game loop running (1 s tick)
06:07:38 [INFO] websockets.server: connection open
06:07:38 [INFO] gameserver.network.server: Session registered: uid=-1
06:07:38 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49919)
06:07:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:07:38 [INFO] gameserver.network.server: Session registered: uid=2
06:07:38 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:07:38 [INFO] gameserver.network.server: Session removed: uid=2
06:07:39 [INFO] websockets.server: connection open
06:07:39 [INFO] gameserver.network.server: Session registered: uid=-2
06:07:39 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 49922)
06:07:39 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:07:39 [INFO] gameserver.network.server: Session registered: uid=2
06:07:39 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:07:48 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
06:08:18 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
06:08:18 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
06:08:18 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
06:14:36 [INFO] __main__: Shutdown signal received — stopping …
06:14:36 [INFO] __main__: Shutting down …
06:14:36 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
06:14:36 [INFO] websockets.server: server closing
06:14:36 [INFO] gameserver.network.server: Session removed: uid=2
06:14:36 [INFO] websockets.server: server closed
06:14:36 [INFO] gameserver.network.server: WebSocket server stopped
06:14:36 [INFO] __main__:   WebSocket server stopped
06:14:36 [INFO] __main__:   debug dashboard stopped
06:14:36 [INFO] __main__:   database closed
06:14:36 [INFO] __main__:   goodbye
06:14:38 [INFO] __main__: === Game Server starting ===
06:14:38 [INFO] __main__: Loading configuration …
06:14:38 [INFO] __main__:   items:        210 loaded from config
06:14:38 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:14:38 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:14:38 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:14:38 [INFO] __main__:   game_config:  loaded
06:14:38 [INFO] __main__: Initializing persistence …
06:14:38 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:14:38 [INFO] __main__:   database:     connected (gameserver.db)
06:14:39 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
06:14:39 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
06:14:39 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
06:14:39 [INFO] __main__: Creating services …
06:14:39 [INFO] __main__:   upgrade_provider: 210 items registered
06:14:39 [INFO] __main__:   all services created
06:14:39 [INFO] __main__: Wiring event handlers …
06:14:39 [INFO] __main__:   event handlers registered
06:14:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:14:39 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:14:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:14:39 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:14:39 [INFO] __main__: Restored 2 empires from saved state
06:14:39 [INFO] __main__: Restored 1 attacks from saved state
06:14:39 [INFO] __main__: Starting network server …
06:14:39 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:14:39 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:14:39 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:14:39 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:14:39 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:14:39 [INFO] __main__: Starting game loop …
06:14:39 [INFO] __main__:   game loop running (1 s tick)
06:14:40 [INFO] websockets.server: connection open
06:14:40 [INFO] gameserver.network.server: Session registered: uid=-1
06:14:40 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51062)
06:14:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:14:40 [INFO] gameserver.network.server: Session registered: uid=2
06:14:40 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:14:49 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
06:14:53 [INFO] gameserver.network.server: Session removed: uid=2
06:14:53 [INFO] websockets.server: connection open
06:14:53 [INFO] gameserver.network.server: Session registered: uid=-2
06:14:53 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 61386)
06:14:53 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:14:53 [INFO] gameserver.network.server: Session registered: uid=2
06:14:53 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:15:19 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
06:15:19 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
06:15:19 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
06:15:28 [INFO] gameserver.network.server: Session removed: uid=2
06:15:28 [INFO] websockets.server: connection open
06:15:28 [INFO] gameserver.network.server: Session registered: uid=-3
06:15:28 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 49767)
06:15:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:15:28 [INFO] gameserver.network.server: Session registered: uid=2
06:15:28 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
06:19:00 [INFO] gameserver.network.server: Session removed: uid=2
06:19:00 [INFO] websockets.server: connection open
06:19:00 [INFO] gameserver.network.server: Session registered: uid=-4
06:19:00 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 62729)
06:19:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:19:00 [INFO] gameserver.network.server: Session registered: uid=2
06:19:00 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
06:20:14 [INFO] __main__: Shutdown signal received — stopping …
06:20:14 [INFO] __main__: Shutting down …
06:20:14 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
06:20:14 [INFO] websockets.server: server closing
06:20:14 [INFO] gameserver.network.server: Session removed: uid=2
06:20:14 [INFO] websockets.server: server closed
06:20:14 [INFO] gameserver.network.server: WebSocket server stopped
06:20:14 [INFO] __main__:   WebSocket server stopped
06:20:14 [INFO] __main__:   debug dashboard stopped
06:20:14 [INFO] __main__:   database closed
06:20:14 [INFO] __main__:   goodbye
06:20:16 [INFO] __main__: === Game Server starting ===
06:20:16 [INFO] __main__: Loading configuration …
06:20:16 [INFO] __main__:   items:        210 loaded from config
06:20:16 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:20:16 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:20:16 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:20:16 [INFO] __main__:   game_config:  loaded
06:20:16 [INFO] __main__: Initializing persistence …
06:20:16 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:20:16 [INFO] __main__:   database:     connected (gameserver.db)
06:20:16 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
06:20:16 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
06:20:16 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
06:20:16 [INFO] __main__: Creating services …
06:20:16 [INFO] __main__:   upgrade_provider: 210 items registered
06:20:16 [INFO] __main__:   all services created
06:20:16 [INFO] __main__: Wiring event handlers …
06:20:16 [INFO] __main__:   event handlers registered
06:20:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:20:16 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:20:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:20:16 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:20:16 [INFO] __main__: Restored 2 empires from saved state
06:20:16 [INFO] __main__: Restored 1 attacks from saved state
06:20:16 [INFO] __main__: Starting network server …
06:20:16 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:20:16 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:20:16 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:20:16 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:20:16 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:20:16 [INFO] __main__: Starting game loop …
06:20:16 [INFO] __main__:   game loop running (1 s tick)
06:20:17 [INFO] websockets.server: connection open
06:20:17 [INFO] gameserver.network.server: Session registered: uid=-1
06:20:17 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49196)
06:20:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:20:17 [INFO] gameserver.network.server: Session registered: uid=2
06:20:17 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:20:17 [INFO] gameserver.network.server: Session removed: uid=2
06:20:17 [INFO] websockets.server: connection open
06:20:17 [INFO] gameserver.network.server: Session registered: uid=-2
06:20:17 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 49200)
06:20:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:20:17 [INFO] gameserver.network.server: Session registered: uid=2
06:20:17 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:20:26 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
06:20:39 [INFO] gameserver.network.server: Session removed: uid=2
06:20:40 [INFO] websockets.server: connection open
06:20:40 [INFO] gameserver.network.server: Session registered: uid=-3
06:20:40 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 49210)
06:20:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:20:40 [INFO] gameserver.network.server: Session registered: uid=2
06:20:40 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
06:20:56 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
06:20:56 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
06:20:56 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
06:22:21 [INFO] __main__: Shutdown signal received — stopping …
06:22:21 [INFO] __main__: Shutting down …
06:22:21 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
06:22:21 [INFO] websockets.server: server closing
06:22:21 [INFO] gameserver.network.server: Session removed: uid=2
06:22:21 [INFO] websockets.server: server closed
06:22:21 [INFO] gameserver.network.server: WebSocket server stopped
06:22:21 [INFO] __main__:   WebSocket server stopped
06:22:21 [INFO] __main__:   debug dashboard stopped
06:22:21 [INFO] __main__:   database closed
06:22:21 [INFO] __main__:   goodbye
06:22:22 [INFO] __main__: === Game Server starting ===
06:22:22 [INFO] __main__: Loading configuration …
06:22:23 [INFO] __main__:   items:        210 loaded from config
06:22:23 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:22:23 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:22:23 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:22:23 [INFO] __main__:   game_config:  loaded
06:22:23 [INFO] __main__: Initializing persistence …
06:22:23 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:22:23 [INFO] __main__:   database:     connected (gameserver.db)
06:22:23 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
06:22:23 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
06:22:23 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
06:22:23 [INFO] __main__: Creating services …
06:22:23 [INFO] __main__:   upgrade_provider: 210 items registered
06:22:23 [INFO] __main__:   all services created
06:22:23 [INFO] __main__: Wiring event handlers …
06:22:23 [INFO] __main__:   event handlers registered
06:22:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:22:23 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:22:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:22:23 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:22:23 [INFO] __main__: Restored 2 empires from saved state
06:22:23 [INFO] __main__: Restored 1 attacks from saved state
06:22:23 [INFO] __main__: Starting network server …
06:22:23 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:22:23 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:22:23 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:22:23 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:22:23 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:22:23 [INFO] __main__: Starting game loop …
06:22:23 [INFO] __main__:   game loop running (1 s tick)
06:22:23 [INFO] websockets.server: connection open
06:22:23 [INFO] gameserver.network.server: Session registered: uid=-1
06:22:23 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 61025)
06:22:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:22:23 [INFO] gameserver.network.server: Session registered: uid=2
06:22:23 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:22:29 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
06:22:33 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
06:23:03 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
06:23:03 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
06:23:03 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
06:23:14 [INFO] gameserver.network.server: Session removed: uid=2
06:23:14 [INFO] websockets.server: connection open
06:23:14 [INFO] gameserver.network.server: Session registered: uid=-2
06:23:14 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 54807)
06:23:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:23:14 [INFO] gameserver.network.server: Session registered: uid=2
06:23:14 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:23:26 [INFO] __main__: Shutdown signal received — stopping …
06:23:26 [INFO] __main__: Shutting down …
06:23:26 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
06:23:26 [INFO] websockets.server: server closing
06:23:26 [INFO] gameserver.network.server: Session removed: uid=2
06:23:26 [INFO] websockets.server: server closed
06:23:26 [INFO] gameserver.network.server: WebSocket server stopped
06:23:26 [INFO] __main__:   WebSocket server stopped
06:23:26 [INFO] __main__:   debug dashboard stopped
06:23:26 [INFO] __main__:   database closed
06:23:26 [INFO] __main__:   goodbye
06:23:28 [INFO] __main__: === Game Server starting ===
06:23:28 [INFO] __main__: Loading configuration …
06:23:29 [INFO] __main__:   items:        210 loaded from config
06:23:29 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
06:23:29 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
06:23:29 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
06:23:29 [INFO] __main__:   game_config:  loaded
06:23:29 [INFO] __main__: Initializing persistence …
06:23:29 [INFO] gameserver.persistence.database: Database connected: gameserver.db
06:23:29 [INFO] __main__:   database:     connected (gameserver.db)
06:23:29 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
06:23:29 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
06:23:29 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
06:23:29 [INFO] __main__: Creating services …
06:23:29 [INFO] __main__:   upgrade_provider: 210 items registered
06:23:29 [INFO] __main__:   all services created
06:23:29 [INFO] __main__: Wiring event handlers …
06:23:29 [INFO] __main__:   event handlers registered
06:23:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
06:23:29 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
06:23:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
06:23:29 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
06:23:29 [INFO] __main__: Restored 2 empires from saved state
06:23:29 [INFO] __main__: Restored 1 attacks from saved state
06:23:29 [INFO] __main__: Starting network server …
06:23:29 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
06:23:29 [INFO] websockets.server: server listening on 0.0.0.0:8765
06:23:29 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
06:23:29 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
06:23:29 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
06:23:29 [INFO] __main__: Starting game loop …
06:23:29 [INFO] __main__:   game loop running (1 s tick)
06:23:29 [INFO] websockets.server: connection open
06:23:29 [INFO] gameserver.network.server: Session registered: uid=-1
06:23:29 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54082)
06:23:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:23:29 [INFO] gameserver.network.server: Session registered: uid=2
06:23:29 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
06:23:39 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
06:24:09 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
06:24:09 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
06:24:09 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
06:25:38 [INFO] gameserver.network.server: Session removed: uid=2
06:25:38 [INFO] websockets.server: connection open
06:25:38 [INFO] gameserver.network.server: Session registered: uid=-2
06:25:38 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 58660)
06:25:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
06:25:38 [INFO] gameserver.network.server: Session registered: uid=2
06:25:38 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
06:26:06 [INFO] gameserver.network.server: Session removed: uid=2
08:19:21 [INFO] gameserver.engine.empire_service: Empire 2: applied effects for BULLETIN_BOARD: {'culture_offset': 0.05}
08:19:21 [INFO] gameserver.engine.empire_service: Empire 2: building BULLETIN_BOARD completed
17:54:01 [INFO] __main__: Shutdown signal received — stopping …
17:54:01 [INFO] __main__: Shutting down …
17:54:01 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
17:54:01 [INFO] websockets.server: server closing
17:54:01 [INFO] websockets.server: server closed
17:54:01 [INFO] gameserver.network.server: WebSocket server stopped
17:54:01 [INFO] __main__:   WebSocket server stopped
17:54:01 [INFO] __main__:   debug dashboard stopped
17:54:01 [INFO] __main__:   database closed
17:54:01 [INFO] __main__:   goodbye
17:54:54 [INFO] __main__: === Game Server starting ===
17:54:54 [INFO] __main__: Loading configuration …
17:54:54 [INFO] __main__:   items:        210 loaded from config
17:54:54 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
17:54:54 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:54:54 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
17:54:54 [INFO] __main__:   game_config:  loaded
17:54:54 [INFO] __main__: Initializing persistence …
17:54:54 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:54:54 [INFO] __main__:   database:     connected (gameserver.db)
17:54:54 [ERROR] gameserver.persistence.state_load: Failed to parse state file /home/pi/e3/python_server/config
Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/persistence/state_load.py", line 72, in load_state
    raw = yaml.safe_load(state_file.read_text(encoding="utf-8"))
  File "/usr/lib/python3.9/pathlib.py", line 1255, in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
  File "/usr/lib/python3.9/pathlib.py", line 1241, in open
    return io.open(self, mode, buffering, encoding, errors, newline,
IsADirectoryError: [Errno 21] Is a directory: '/home/pi/e3/python_server/config'
17:54:54 [INFO] __main__:   state:        no previous state found — fresh start
17:54:54 [INFO] __main__: Creating services …
17:54:54 [INFO] __main__:   upgrade_provider: 210 items registered
17:54:54 [INFO] __main__:   all services created
17:54:54 [INFO] __main__: Wiring event handlers …
17:54:54 [INFO] __main__:   event handlers registered
17:54:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:54:54 [INFO] __main__: Test empire registered: uid=100 name='TestImperium'
17:54:54 [INFO] __main__: Starting network server …
17:54:54 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
17:54:54 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:54:54 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:54:54 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:54:54 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:54:54 [INFO] __main__: Starting game loop …
17:54:54 [INFO] __main__:   game loop running (1 s tick)
17:55:11 [INFO] websockets.server: connection open
17:55:11 [INFO] gameserver.network.server: Session registered: uid=-1
17:55:11 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55041)
17:55:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:55:14 [INFO] gameserver.network.server: Session registered: uid=2
17:55:14 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
17:55:59 [INFO] gameserver.network.server: Session removed: uid=2
17:56:00 [INFO] websockets.server: connection open
17:56:00 [INFO] gameserver.network.server: Session registered: uid=-2
17:56:00 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55338)
17:56:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:56:00 [INFO] gameserver.network.server: Session registered: uid=2
17:56:00 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
17:56:04 [INFO] gameserver.network.handlers: notification_request from uid=2 (not yet implemented)
17:56:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:56:09 [INFO] gameserver.network.server: Session registered: uid=2
17:56:09 [INFO] gameserver.network.server: Session upgraded: guest=2 → uid=2
17:56:28 [INFO] gameserver.network.server: Session removed: uid=2
17:56:28 [INFO] websockets.server: connection open
17:56:28 [INFO] gameserver.network.server: Session registered: uid=-3
17:56:28 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 55013)
17:56:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:56:28 [INFO] gameserver.network.server: Session registered: uid=2
17:56:28 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
17:56:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:56:33 [INFO] gameserver.network.server: Session registered: uid=2
17:56:33 [INFO] gameserver.network.server: Session upgraded: guest=2 → uid=2
17:57:55 [INFO] gameserver.network.handlers: notification_request from uid=2 (not yet implemented)
17:57:58 [INFO] gameserver.network.server: Session removed: uid=2
17:57:58 [INFO] websockets.server: connection open
17:57:58 [INFO] gameserver.network.server: Session registered: uid=-4
17:57:58 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 60118)
17:57:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
17:57:58 [INFO] gameserver.network.server: Session registered: uid=2
17:57:58 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:00:53 [INFO] __main__: Shutdown signal received — stopping …
18:00:54 [INFO] __main__: Shutting down …
18:00:54 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (1 empires, 0 attacks, 0 battles)
18:00:54 [INFO] websockets.server: server closing
18:00:54 [INFO] gameserver.network.server: Session removed: uid=2
18:00:54 [INFO] websockets.server: server closed
18:00:54 [INFO] gameserver.network.server: WebSocket server stopped
18:00:54 [INFO] __main__:   WebSocket server stopped
18:00:54 [INFO] __main__:   debug dashboard stopped
18:00:54 [INFO] __main__:   database closed
18:00:54 [INFO] __main__:   goodbye
18:00:55 [INFO] __main__: === Game Server starting ===
18:00:55 [INFO] __main__: Loading configuration …
18:00:56 [INFO] __main__:   items:        210 loaded from config
18:00:56 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:00:56 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:00:56 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:00:56 [INFO] __main__:   game_config:  loaded
18:00:56 [INFO] __main__: Initializing persistence …
18:00:56 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:00:56 [INFO] __main__:   database:     connected (gameserver.db)
18:00:56 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T18:00:54, version 1)
18:00:56 [INFO] gameserver.persistence.state_load: Restored 1 empires, 0 attacks, 0 battles
18:00:56 [INFO] __main__:   state:        restored from disk (1 empires, 0 attacks)
18:00:56 [INFO] __main__: Creating services …
18:00:56 [INFO] __main__:   upgrade_provider: 210 items registered
18:00:56 [INFO] __main__:   all services created
18:00:56 [INFO] __main__: Wiring event handlers …
18:00:56 [INFO] __main__:   event handlers registered
18:00:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:00:56 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:00:56 [INFO] __main__: Restored 1 empires from saved state
18:00:56 [INFO] __main__: Starting network server …
18:00:56 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
18:00:56 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:00:56 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:00:56 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:00:56 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:00:56 [INFO] __main__: Starting game loop …
18:00:56 [INFO] __main__:   game loop running (1 s tick)
18:00:57 [INFO] websockets.server: connection open
18:00:57 [INFO] gameserver.network.server: Session registered: uid=-1
18:00:57 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 60225)
18:00:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:00:57 [INFO] gameserver.network.server: Session registered: uid=2
18:00:57 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:01:01 [INFO] gameserver.network.server: Session removed: uid=2
18:01:01 [INFO] websockets.server: connection open
18:01:01 [INFO] gameserver.network.server: Session registered: uid=-2
18:01:01 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 60235)
18:01:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:01:01 [INFO] gameserver.network.server: Session registered: uid=2
18:01:01 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:01:04 [INFO] gameserver.network.server: Session removed: uid=2
18:01:04 [INFO] websockets.server: connection open
18:01:04 [INFO] gameserver.network.server: Session registered: uid=-3
18:01:04 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 60239)
18:01:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:01:04 [INFO] gameserver.network.server: Session registered: uid=2
18:01:04 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:01:05 [INFO] gameserver.network.server: Session removed: uid=2
18:01:05 [INFO] websockets.server: connection open
18:01:05 [INFO] gameserver.network.server: Session registered: uid=-4
18:01:05 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 60241)
18:01:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:01:05 [INFO] gameserver.network.server: Session registered: uid=2
18:01:05 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
18:01:16 [INFO] gameserver.network.server: Session removed: uid=2
18:01:16 [INFO] websockets.server: connection open
18:01:16 [INFO] gameserver.network.server: Session registered: uid=-5
18:01:16 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 52901)
18:01:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:01:16 [INFO] gameserver.network.server: Session registered: uid=2
18:01:16 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
18:02:15 [INFO] __main__: Shutdown signal received — stopping …
18:02:16 [INFO] __main__: Shutting down …
18:02:16 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (1 empires, 0 attacks, 0 battles)
18:02:16 [INFO] websockets.server: server closing
18:02:16 [INFO] gameserver.network.server: Session removed: uid=2
18:02:16 [INFO] websockets.server: server closed
18:02:16 [INFO] gameserver.network.server: WebSocket server stopped
18:02:16 [INFO] __main__:   WebSocket server stopped
18:02:16 [INFO] __main__:   debug dashboard stopped
18:02:16 [INFO] __main__:   database closed
18:02:16 [INFO] __main__:   goodbye
18:02:17 [INFO] __main__: === Game Server starting ===
18:02:17 [INFO] __main__: Loading configuration …
18:02:18 [INFO] __main__:   items:        210 loaded from config
18:02:18 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:02:18 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:02:18 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:02:18 [INFO] __main__:   game_config:  loaded
18:02:18 [INFO] __main__: Initializing persistence …
18:02:18 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:02:18 [INFO] __main__:   database:     connected (gameserver.db)
18:02:18 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T18:02:16, version 1)
18:02:18 [INFO] gameserver.persistence.state_load: Restored 1 empires, 0 attacks, 0 battles
18:02:18 [INFO] __main__:   state:        restored from disk (1 empires, 0 attacks)
18:02:18 [INFO] __main__: Creating services …
18:02:18 [INFO] __main__:   upgrade_provider: 210 items registered
18:02:18 [INFO] __main__:   all services created
18:02:18 [INFO] __main__: Wiring event handlers …
18:02:18 [INFO] __main__:   event handlers registered
18:02:18 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:02:18 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:02:18 [INFO] __main__: Restored 1 empires from saved state
18:02:18 [INFO] __main__: Starting network server …
18:02:18 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
18:02:18 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:02:18 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:02:18 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:02:18 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:02:18 [INFO] __main__: Starting game loop …
18:02:18 [INFO] __main__:   game loop running (1 s tick)
18:02:19 [INFO] websockets.server: connection open
18:02:19 [INFO] gameserver.network.server: Session registered: uid=-1
18:02:19 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52946)
18:02:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:02:19 [INFO] gameserver.network.server: Session registered: uid=2
18:02:19 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:02:23 [INFO] gameserver.network.server: Session removed: uid=2
18:02:23 [INFO] websockets.server: connection open
18:02:23 [INFO] gameserver.network.server: Session registered: uid=-2
18:02:23 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 52950)
18:02:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:02:23 [INFO] gameserver.network.server: Session registered: uid=2
18:02:23 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:02:24 [INFO] gameserver.network.server: Session removed: uid=2
18:02:24 [INFO] websockets.server: connection open
18:02:24 [INFO] gameserver.network.server: Session registered: uid=-3
18:02:24 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 52974)
18:02:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:02:24 [INFO] gameserver.network.server: Session registered: uid=2
18:02:24 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
18:02:53 [INFO] __main__: Shutdown signal received — stopping …
18:02:53 [INFO] __main__: Shutting down …
18:02:53 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (1 empires, 0 attacks, 0 battles)
18:02:53 [INFO] websockets.server: server closing
18:02:53 [INFO] gameserver.network.server: Session removed: uid=2
18:02:53 [INFO] websockets.server: server closed
18:02:53 [INFO] gameserver.network.server: WebSocket server stopped
18:02:53 [INFO] __main__:   WebSocket server stopped
18:02:53 [INFO] __main__:   debug dashboard stopped
18:02:53 [INFO] __main__:   database closed
18:02:53 [INFO] __main__:   goodbye
18:02:55 [INFO] __main__: === Game Server starting ===
18:02:55 [INFO] __main__: Loading configuration …
18:02:56 [INFO] __main__:   items:        210 loaded from config
18:02:56 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
18:02:56 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:02:56 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
18:02:56 [INFO] __main__:   game_config:  loaded
18:02:56 [INFO] __main__: Initializing persistence …
18:02:56 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:02:56 [INFO] __main__:   database:     connected (gameserver.db)
18:02:56 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
18:02:56 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:02:56 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:02:56 [INFO] __main__: Creating services …
18:02:56 [INFO] __main__:   upgrade_provider: 210 items registered
18:02:56 [INFO] __main__:   all services created
18:02:56 [INFO] __main__: Wiring event handlers …
18:02:56 [INFO] __main__:   event handlers registered
18:02:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:02:56 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:02:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:02:56 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:02:56 [INFO] __main__: Restored 2 empires from saved state
18:02:56 [INFO] __main__: Restored 1 attacks from saved state
18:02:56 [INFO] __main__: Starting network server …
18:02:56 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
18:02:56 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:02:56 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:02:56 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:02:56 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:02:56 [INFO] __main__: Starting game loop …
18:02:56 [INFO] __main__:   game loop running (1 s tick)
18:02:56 [INFO] websockets.server: connection open
18:02:56 [INFO] gameserver.network.server: Session registered: uid=-1
18:02:56 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 61570)
18:02:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:02:56 [INFO] gameserver.network.server: Session registered: uid=2
18:02:56 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
18:02:58 [INFO] gameserver.network.server: Session removed: uid=2
18:02:58 [INFO] websockets.server: connection open
18:02:58 [INFO] gameserver.network.server: Session registered: uid=-2
18:02:58 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 61573)
18:02:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
18:02:58 [INFO] gameserver.network.server: Session registered: uid=2
18:02:58 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
18:03:06 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:03:36 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:03:36 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:03:36 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
19:16:37 [INFO] gameserver.network.handlers: change_citizen request from uid=2
19:16:37 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 0, 'free': 5}
19:16:38 [INFO] gameserver.network.handlers: change_citizen request from uid=2
19:16:38 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 4, 'artist': 0, 'free': 4}
19:16:49 [INFO] gameserver.network.handlers: notification_request from uid=2 (not yet implemented)
19:17:58 [INFO] gameserver.network.server: Session removed: uid=2
19:17:58 [INFO] websockets.server: connection open
19:17:58 [INFO] gameserver.network.server: Session registered: uid=-3
19:17:58 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 55007)
19:17:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:17:58 [INFO] gameserver.network.server: Session registered: uid=2
19:17:58 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:18:12 [INFO] gameserver.network.server: Session removed: uid=2
19:18:12 [INFO] websockets.server: connection open
19:18:12 [INFO] gameserver.network.server: Session registered: uid=-4
19:18:12 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 55037)
19:18:12 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:18:12 [INFO] gameserver.network.server: Session registered: uid=2
19:18:12 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
19:26:32 [INFO] gameserver.network.server: Session removed: uid=2
19:26:32 [INFO] websockets.server: connection open
19:26:32 [INFO] gameserver.network.server: Session registered: uid=-5
19:26:32 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 52333)
19:26:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:26:32 [INFO] gameserver.network.server: Session registered: uid=2
19:26:32 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
19:27:16 [INFO] websockets.server: connection open
19:27:16 [INFO] gameserver.network.server: Session registered: uid=-6
19:27:16 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.122', 58715)
19:27:27 [INFO] __main__: Shutdown signal received — stopping …
19:27:27 [INFO] __main__: Shutting down …
19:27:28 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
19:27:28 [INFO] websockets.server: server closing
19:27:28 [INFO] gameserver.network.server: Session removed: uid=2
19:27:28 [INFO] gameserver.network.server: Session removed: uid=-6
19:27:28 [INFO] websockets.server: server closed
19:27:28 [INFO] gameserver.network.server: WebSocket server stopped
19:27:28 [INFO] __main__:   WebSocket server stopped
19:27:28 [INFO] __main__:   debug dashboard stopped
19:27:28 [INFO] __main__:   database closed
19:27:28 [INFO] __main__:   goodbye
Traceback (most recent call last):
  File "/usr/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/pi/e3/python_server/src/gameserver/main.py", line 50, in <module>
    from gameserver.network.handlers import register_all_handlers
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 939
    \"wave_id\": i,
SyntaxError: unexpected character after line continuation character
19:28:40 [INFO] __main__: === Game Server starting ===
19:28:40 [INFO] __main__: Loading configuration …
19:28:40 [INFO] __main__:   items:        210 loaded from config
19:28:41 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:28:41 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:28:41 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:28:41 [INFO] __main__:   game_config:  loaded
19:28:41 [INFO] __main__: Initializing persistence …
19:28:41 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:28:41 [INFO] __main__:   database:     connected (gameserver.db)
19:28:41 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
19:28:41 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
19:28:41 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
19:28:41 [INFO] __main__: Creating services …
19:28:41 [INFO] __main__:   upgrade_provider: 210 items registered
19:28:41 [INFO] __main__:   all services created
19:28:41 [INFO] __main__: Wiring event handlers …
19:28:41 [INFO] __main__:   event handlers registered
19:28:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:28:41 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:28:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:28:41 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:28:41 [INFO] __main__: Restored 2 empires from saved state
19:28:41 [INFO] __main__: Restored 1 attacks from saved state
19:28:41 [INFO] __main__: Starting network server …
19:28:41 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
19:28:41 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:28:41 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:28:41 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:28:41 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:28:41 [INFO] __main__: Starting game loop …
19:28:41 [INFO] __main__:   game loop running (1 s tick)
19:28:44 [INFO] websockets.server: connection open
19:28:44 [INFO] gameserver.network.server: Session registered: uid=-1
19:28:44 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59255)
19:28:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:28:44 [INFO] gameserver.network.server: Session registered: uid=2
19:28:44 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:28:45 [INFO] gameserver.network.server: Session removed: uid=2
19:28:45 [INFO] websockets.server: connection open
19:28:45 [INFO] gameserver.network.server: Session registered: uid=-2
19:28:45 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59262)
19:28:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:28:45 [INFO] gameserver.network.server: Session registered: uid=2
19:28:45 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:28:51 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
19:29:21 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
19:29:21 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
19:29:21 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
19:33:47 [INFO] __main__: Shutdown signal received — stopping …
19:33:48 [INFO] __main__: Shutting down …
19:33:48 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
19:33:48 [INFO] websockets.server: server closing
19:33:48 [INFO] gameserver.network.server: Session removed: uid=2
19:33:48 [INFO] websockets.server: server closed
19:33:48 [INFO] gameserver.network.server: WebSocket server stopped
19:33:48 [INFO] __main__:   WebSocket server stopped
19:33:48 [INFO] __main__:   debug dashboard stopped
19:33:48 [INFO] __main__:   database closed
19:33:48 [INFO] __main__:   goodbye
19:33:49 [INFO] __main__: === Game Server starting ===
19:33:49 [INFO] __main__: Loading configuration …
19:33:50 [INFO] __main__:   items:        210 loaded from config
19:33:50 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:33:50 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:33:50 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:33:50 [INFO] __main__:   game_config:  loaded
19:33:50 [INFO] __main__: Initializing persistence …
19:33:50 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:33:50 [INFO] __main__:   database:     connected (gameserver.db)
19:33:50 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
19:33:50 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
19:33:50 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
19:33:50 [INFO] __main__: Creating services …
19:33:50 [INFO] __main__:   upgrade_provider: 210 items registered
19:33:50 [INFO] __main__:   all services created
19:33:50 [INFO] __main__: Wiring event handlers …
19:33:50 [INFO] __main__:   event handlers registered
19:33:50 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:33:50 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:33:50 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:33:50 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:33:50 [INFO] __main__: Restored 2 empires from saved state
19:33:50 [INFO] __main__: Restored 1 attacks from saved state
19:33:50 [INFO] __main__: Starting network server …
19:33:50 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
19:33:50 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:33:50 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:33:50 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:33:50 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:33:50 [INFO] __main__: Starting game loop …
19:33:50 [INFO] __main__:   game loop running (1 s tick)
19:33:51 [INFO] websockets.server: connection open
19:33:51 [INFO] gameserver.network.server: Session registered: uid=-1
19:33:51 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54843)
19:33:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:33:51 [INFO] gameserver.network.server: Session registered: uid=2
19:33:51 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:34:00 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
19:34:21 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
19:34:22 [INFO] gameserver.network.server: Session removed: uid=2
19:34:23 [INFO] websockets.server: connection open
19:34:23 [INFO] gameserver.network.server: Session registered: uid=-2
19:34:23 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 54881)
19:34:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:34:23 [INFO] gameserver.network.server: Session registered: uid=2
19:34:23 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:34:30 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
19:34:30 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
19:34:30 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
19:34:39 [INFO] gameserver.network.server: Session removed: uid=2
19:34:39 [INFO] websockets.server: connection open
19:34:39 [INFO] gameserver.network.server: Session registered: uid=-3
19:34:39 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 54891)
19:34:39 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:34:39 [INFO] gameserver.network.server: Session registered: uid=2
19:34:39 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:35:43 [INFO] gameserver.network.server: Session removed: uid=2
19:35:43 [INFO] websockets.server: connection open
19:35:43 [INFO] gameserver.network.server: Session registered: uid=-4
19:35:43 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 55092)
19:35:43 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:35:43 [INFO] gameserver.network.server: Session registered: uid=2
19:35:43 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
19:35:43 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
19:35:54 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
19:35:55 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
19:38:28 [INFO] __main__: Shutdown signal received — stopping …
19:38:29 [INFO] __main__: Shutting down …
19:38:29 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
19:38:29 [INFO] websockets.server: server closing
19:38:29 [INFO] gameserver.network.server: Session removed: uid=2
19:38:29 [INFO] websockets.server: server closed
19:38:29 [INFO] gameserver.network.server: WebSocket server stopped
19:38:29 [INFO] __main__:   WebSocket server stopped
19:38:29 [INFO] __main__:   debug dashboard stopped
19:38:29 [INFO] __main__:   database closed
19:38:29 [INFO] __main__:   goodbye
19:38:30 [INFO] __main__: === Game Server starting ===
19:38:30 [INFO] __main__: Loading configuration …
19:38:31 [INFO] __main__:   items:        210 loaded from config
19:38:31 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:38:31 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:38:31 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:38:31 [INFO] __main__:   game_config:  loaded
19:38:31 [INFO] __main__: Initializing persistence …
19:38:31 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:38:31 [INFO] __main__:   database:     connected (gameserver.db)
19:38:31 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
19:38:31 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
19:38:31 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
19:38:31 [INFO] __main__: Creating services …
19:38:31 [INFO] __main__:   upgrade_provider: 210 items registered
19:38:31 [INFO] __main__:   all services created
19:38:31 [INFO] __main__: Wiring event handlers …
19:38:31 [INFO] __main__:   event handlers registered
19:38:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:38:31 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:38:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:38:31 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:38:31 [INFO] __main__: Restored 2 empires from saved state
19:38:31 [INFO] __main__: Restored 1 attacks from saved state
19:38:31 [INFO] __main__: Starting network server …
19:38:31 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
19:38:31 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:38:31 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:38:31 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:38:31 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:38:31 [INFO] __main__: Starting game loop …
19:38:31 [INFO] __main__:   game loop running (1 s tick)
19:38:32 [INFO] websockets.server: connection open
19:38:32 [INFO] gameserver.network.server: Session registered: uid=-1
19:38:32 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 58167)
19:38:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:38:32 [INFO] gameserver.network.server: Session registered: uid=2
19:38:32 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:38:32 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
19:38:33 [INFO] gameserver.network.server: Session removed: uid=2
19:38:33 [INFO] websockets.server: connection open
19:38:33 [INFO] gameserver.network.server: Session registered: uid=-2
19:38:33 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 58174)
19:38:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:38:33 [INFO] gameserver.network.server: Session registered: uid=2
19:38:33 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:38:41 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
19:38:45 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
19:38:45 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
19:39:11 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
19:39:11 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
19:39:11 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
19:44:34 [INFO] __main__: Shutdown signal received — stopping …
19:44:35 [INFO] __main__: Shutting down …
19:44:35 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
19:44:35 [INFO] websockets.server: server closing
19:44:35 [INFO] gameserver.network.server: Session removed: uid=2
19:44:35 [INFO] websockets.server: server closed
19:44:35 [INFO] gameserver.network.server: WebSocket server stopped
19:44:35 [INFO] __main__:   WebSocket server stopped
19:44:35 [INFO] __main__:   debug dashboard stopped
19:44:35 [INFO] __main__:   database closed
19:44:35 [INFO] __main__:   goodbye
19:44:36 [INFO] __main__: === Game Server starting ===
19:44:36 [INFO] __main__: Loading configuration …
19:44:37 [INFO] __main__:   items:        210 loaded from config
19:44:37 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:44:37 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:44:37 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:44:37 [INFO] __main__:   game_config:  loaded
19:44:37 [INFO] __main__: Initializing persistence …
19:44:37 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:44:37 [INFO] __main__:   database:     connected (gameserver.db)
19:44:37 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
19:44:37 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
19:44:37 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
19:44:37 [INFO] __main__: Creating services …
19:44:37 [INFO] __main__:   upgrade_provider: 210 items registered
19:44:37 [INFO] __main__:   all services created
19:44:37 [INFO] __main__: Wiring event handlers …
19:44:37 [INFO] __main__:   event handlers registered
19:44:37 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:44:37 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:44:37 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:44:37 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:44:37 [INFO] __main__: Restored 2 empires from saved state
19:44:37 [INFO] __main__: Restored 1 attacks from saved state
19:44:37 [INFO] __main__: Starting network server …
19:44:37 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
19:44:37 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:44:37 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:44:37 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:44:37 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:44:37 [INFO] __main__: Starting game loop …
19:44:37 [INFO] __main__:   game loop running (1 s tick)
19:44:38 [INFO] websockets.server: connection open
19:44:38 [INFO] gameserver.network.server: Session registered: uid=-1
19:44:38 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55366)
19:44:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:44:38 [INFO] gameserver.network.server: Session registered: uid=2
19:44:38 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:44:39 [INFO] gameserver.network.server: Session removed: uid=2
19:44:40 [INFO] websockets.server: connection open
19:44:40 [INFO] gameserver.network.server: Session registered: uid=-2
19:44:40 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55374)
19:44:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:44:40 [INFO] gameserver.network.server: Session registered: uid=2
19:44:40 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:44:40 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
19:44:40 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
19:44:47 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
19:45:17 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
19:45:17 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
19:45:17 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
19:51:14 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
19:53:15 [INFO] __main__: Shutdown signal received — stopping …
19:53:15 [INFO] __main__: Shutting down …
19:53:15 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
19:53:15 [INFO] websockets.server: server closing
19:53:15 [INFO] gameserver.network.server: Session removed: uid=2
19:53:15 [INFO] websockets.server: server closed
19:53:15 [INFO] gameserver.network.server: WebSocket server stopped
19:53:15 [INFO] __main__:   WebSocket server stopped
19:53:15 [INFO] __main__:   debug dashboard stopped
19:53:15 [INFO] __main__:   database closed
19:53:15 [INFO] __main__:   goodbye
19:53:17 [INFO] __main__: === Game Server starting ===
19:53:17 [INFO] __main__: Loading configuration …
19:53:18 [INFO] __main__:   items:        210 loaded from config
19:53:18 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
19:53:18 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
19:53:18 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
19:53:18 [INFO] __main__:   game_config:  loaded
19:53:18 [INFO] __main__: Initializing persistence …
19:53:18 [INFO] gameserver.persistence.database: Database connected: gameserver.db
19:53:18 [INFO] __main__:   database:     connected (gameserver.db)
19:53:18 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
19:53:18 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
19:53:18 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
19:53:18 [INFO] __main__: Creating services …
19:53:18 [INFO] __main__:   upgrade_provider: 210 items registered
19:53:18 [INFO] __main__:   all services created
19:53:18 [INFO] __main__: Wiring event handlers …
19:53:18 [INFO] __main__:   event handlers registered
19:53:18 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
19:53:18 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
19:53:18 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
19:53:18 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
19:53:18 [INFO] __main__: Restored 2 empires from saved state
19:53:18 [INFO] __main__: Restored 1 attacks from saved state
19:53:18 [INFO] __main__: Starting network server …
19:53:18 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
19:53:18 [INFO] websockets.server: server listening on 0.0.0.0:8765
19:53:18 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
19:53:18 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
19:53:18 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
19:53:18 [INFO] __main__: Starting game loop …
19:53:18 [INFO] __main__:   game loop running (1 s tick)
19:53:18 [INFO] websockets.server: connection open
19:53:18 [INFO] gameserver.network.server: Session registered: uid=-1
19:53:18 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57212)
19:53:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:53:18 [INFO] gameserver.network.server: Session registered: uid=2
19:53:18 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
19:53:20 [INFO] gameserver.network.server: Session removed: uid=2
19:53:20 [INFO] websockets.server: connection open
19:53:20 [INFO] gameserver.network.server: Session registered: uid=-2
19:53:20 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57220)
19:53:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:53:20 [INFO] gameserver.network.server: Session registered: uid=2
19:53:20 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
19:53:28 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
19:53:31 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
19:53:31 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
19:53:58 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
19:53:58 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
19:53:58 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
19:54:08 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1573, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 149, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 170, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 369, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 369, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

19:54:48 [INFO] gameserver.network.server: Session removed: uid=2
19:54:48 [INFO] websockets.server: connection open
19:54:48 [INFO] gameserver.network.server: Session registered: uid=-3
19:54:48 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 57929)
19:54:48 [INFO] gameserver.network.auth: Login success: eem (uid=2)
19:54:48 [INFO] gameserver.network.server: Session registered: uid=2
19:54:48 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
19:54:48 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
19:54:48 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:19:11 [INFO] gameserver.network.server: Session removed: uid=2
20:19:11 [INFO] websockets.server: connection open
20:19:11 [INFO] gameserver.network.server: Session registered: uid=-4
20:19:11 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 58299)
20:19:11 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:19:11 [INFO] gameserver.network.server: Session registered: uid=2
20:19:11 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
20:19:11 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
20:19:11 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:19:13 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
20:19:15 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
20:19:15 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:21:15 [INFO] __main__: Shutdown signal received — stopping …
20:21:15 [INFO] __main__: Shutting down …
20:21:15 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:21:15 [INFO] websockets.server: server closing
20:21:15 [INFO] gameserver.network.server: Session removed: uid=2
20:21:15 [INFO] websockets.server: server closed
20:21:15 [INFO] gameserver.network.server: WebSocket server stopped
20:21:15 [INFO] __main__:   WebSocket server stopped
20:21:15 [INFO] __main__:   debug dashboard stopped
20:21:15 [INFO] __main__:   database closed
20:21:15 [INFO] __main__:   goodbye
20:21:17 [INFO] __main__: === Game Server starting ===
20:21:17 [INFO] __main__: Loading configuration …
20:21:18 [INFO] __main__:   items:        210 loaded from config
20:21:18 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:21:18 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:21:18 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:21:18 [INFO] __main__:   game_config:  loaded
20:21:18 [INFO] __main__: Initializing persistence …
20:21:18 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:21:18 [INFO] __main__:   database:     connected (gameserver.db)
20:21:18 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
20:21:18 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:21:18 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:21:18 [INFO] __main__: Creating services …
20:21:18 [INFO] __main__:   upgrade_provider: 210 items registered
20:21:18 [INFO] __main__:   all services created
20:21:18 [INFO] __main__: Wiring event handlers …
20:21:18 [INFO] __main__:   event handlers registered
20:21:18 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:21:18 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:21:18 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:21:18 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:21:18 [INFO] __main__: Restored 2 empires from saved state
20:21:18 [INFO] __main__: Restored 1 attacks from saved state
20:21:18 [INFO] __main__: Starting network server …
20:21:18 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:21:18 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:21:18 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:21:18 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:21:18 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:21:18 [INFO] __main__: Starting game loop …
20:21:18 [INFO] __main__:   game loop running (1 s tick)
20:21:18 [INFO] websockets.server: connection open
20:21:18 [INFO] gameserver.network.server: Session registered: uid=-1
20:21:18 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63913)
20:21:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:21:18 [INFO] gameserver.network.server: Session registered: uid=2
20:21:18 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:21:18 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:21:18 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:21:19 [INFO] gameserver.network.server: Session removed: uid=2
20:21:19 [INFO] websockets.server: connection open
20:21:19 [INFO] gameserver.network.server: Session registered: uid=-2
20:21:19 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63915)
20:21:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:21:19 [INFO] gameserver.network.server: Session registered: uid=2
20:21:19 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:21:19 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:21:19 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:21:23 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
20:21:28 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:21:31 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
20:21:31 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:21:58 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:21:58 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:21:58 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:22:08 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1573, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 149, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 170, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 369, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 369, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

20:22:58 [INFO] __main__: Shutdown signal received — stopping …
20:22:58 [INFO] __main__: Shutting down …
20:22:58 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:22:58 [INFO] websockets.server: server closing
20:22:58 [INFO] gameserver.network.server: Session removed: uid=2
20:22:58 [INFO] websockets.server: server closed
20:22:58 [INFO] gameserver.network.server: WebSocket server stopped
20:22:58 [INFO] __main__:   WebSocket server stopped
20:22:58 [INFO] __main__:   debug dashboard stopped
20:22:58 [INFO] __main__:   database closed
20:22:58 [INFO] __main__:   goodbye
20:23:08 [INFO] __main__: === Game Server starting ===
20:23:08 [INFO] __main__: Loading configuration …
20:23:09 [INFO] __main__:   items:        210 loaded from config
20:23:09 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:23:09 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:23:09 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:23:09 [INFO] __main__:   game_config:  loaded
20:23:09 [INFO] __main__: Initializing persistence …
20:23:09 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:23:09 [INFO] __main__:   database:     connected (gameserver.db)
20:23:09 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T05:30:56, version 1)
20:23:09 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:23:09 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:23:09 [INFO] __main__: Creating services …
20:23:09 [INFO] __main__:   upgrade_provider: 210 items registered
20:23:09 [INFO] __main__:   all services created
20:23:09 [INFO] __main__: Wiring event handlers …
20:23:09 [INFO] __main__:   event handlers registered
20:23:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:23:09 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:23:09 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:23:09 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:23:09 [INFO] __main__: Restored 2 empires from saved state
20:23:09 [INFO] __main__: Restored 1 attacks from saved state
20:23:09 [INFO] __main__: Starting network server …
20:23:09 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:23:09 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:23:09 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:23:09 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:23:09 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:23:09 [INFO] __main__: Starting game loop …
20:23:09 [INFO] __main__:   game loop running (1 s tick)
20:23:09 [INFO] websockets.server: connection open
20:23:09 [INFO] gameserver.network.server: Session registered: uid=-1
20:23:09 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50057)
20:23:09 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:23:09 [INFO] gameserver.network.server: Session registered: uid=2
20:23:09 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:23:11 [INFO] __main__: Shutdown signal received — stopping …
20:23:11 [INFO] __main__: Shutting down …
20:23:11 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:23:11 [INFO] websockets.server: server closing
20:23:11 [INFO] gameserver.network.server: Session removed: uid=2
20:23:15 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
20:23:15 [INFO] websockets.server: server closed
20:23:15 [INFO] gameserver.network.server: WebSocket server stopped
20:23:15 [INFO] __main__:   WebSocket server stopped
20:23:15 [INFO] __main__:   debug dashboard stopped
20:23:15 [INFO] __main__:   database closed
20:23:15 [INFO] __main__:   goodbye
20:23:37 [INFO] __main__: === Game Server starting ===
20:23:37 [INFO] __main__: Loading configuration …
20:23:38 [INFO] __main__:   items:        210 loaded from config
20:23:38 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:23:38 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:23:38 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:23:38 [INFO] __main__:   game_config:  loaded
20:23:38 [INFO] __main__: Initializing persistence …
20:23:38 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:23:38 [INFO] __main__:   database:     connected (gameserver.db)
20:23:38 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
20:23:38 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:23:38 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:23:38 [INFO] __main__: Creating services …
20:23:38 [INFO] __main__:   upgrade_provider: 210 items registered
20:23:38 [INFO] __main__:   all services created
20:23:38 [INFO] __main__: Wiring event handlers …
20:23:38 [INFO] __main__:   event handlers registered
20:23:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:23:38 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:23:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:23:38 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:23:38 [INFO] __main__: Restored 2 empires from saved state
20:23:38 [INFO] __main__: Restored 1 attacks from saved state
20:23:38 [INFO] __main__: Starting network server …
20:23:38 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:23:38 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:23:38 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:23:38 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:23:38 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:23:38 [INFO] __main__: Starting game loop …
20:23:38 [INFO] __main__:   game loop running (1 s tick)
20:23:38 [INFO] websockets.server: connection open
20:23:38 [INFO] gameserver.network.server: Session registered: uid=-1
20:23:38 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50081)
20:23:38 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:23:38 [INFO] gameserver.network.server: Session registered: uid=2
20:23:38 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:23:40 [INFO] gameserver.network.server: Session removed: uid=2
20:23:40 [INFO] websockets.server: connection open
20:23:40 [INFO] gameserver.network.server: Session registered: uid=-2
20:23:40 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50090)
20:23:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:23:40 [INFO] gameserver.network.server: Session registered: uid=2
20:23:40 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:23:40 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:23:40 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:23:44 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
20:23:48 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:24:18 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:24:18 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:24:18 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:24:28 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1573, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 149, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 170, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 369, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 369, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

20:26:01 [INFO] gameserver.network.server: Session removed: uid=2
20:26:02 [INFO] websockets.server: connection open
20:26:02 [INFO] gameserver.network.server: Session registered: uid=-3
20:26:02 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 59319)
20:26:02 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:26:02 [INFO] gameserver.network.server: Session registered: uid=2
20:26:02 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
20:26:02 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
20:26:02 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:26:05 [INFO] __main__: Shutdown signal received — stopping …
20:26:05 [INFO] __main__: Shutting down …
20:26:05 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:26:05 [INFO] websockets.server: server closing
20:26:05 [INFO] gameserver.network.server: Session removed: uid=2
20:26:05 [INFO] websockets.server: server closed
20:26:05 [INFO] gameserver.network.server: WebSocket server stopped
20:26:05 [INFO] __main__:   WebSocket server stopped
20:26:05 [INFO] __main__:   debug dashboard stopped
20:26:05 [INFO] __main__:   database closed
20:26:05 [INFO] __main__:   goodbye
20:26:07 [INFO] __main__: === Game Server starting ===
20:26:07 [INFO] __main__: Loading configuration …
20:26:07 [INFO] __main__:   items:        210 loaded from config
20:26:07 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:26:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:26:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:26:07 [INFO] __main__:   game_config:  loaded
20:26:07 [INFO] __main__: Initializing persistence …
20:26:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:26:07 [INFO] __main__:   database:     connected (gameserver.db)
20:26:08 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
20:26:08 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:26:08 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:26:08 [INFO] __main__: Creating services …
20:26:08 [INFO] __main__:   upgrade_provider: 210 items registered
20:26:08 [INFO] __main__:   all services created
20:26:08 [INFO] __main__: Wiring event handlers …
20:26:08 [INFO] __main__:   event handlers registered
20:26:08 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:26:08 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:26:08 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:26:08 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:26:08 [INFO] __main__: Restored 2 empires from saved state
20:26:08 [INFO] __main__: Restored 1 attacks from saved state
20:26:08 [INFO] __main__: Starting network server …
20:26:08 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:26:08 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:26:08 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:26:08 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:26:08 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:26:08 [INFO] __main__: Starting game loop …
20:26:08 [INFO] __main__:   game loop running (1 s tick)
20:26:08 [INFO] websockets.server: connection open
20:26:08 [INFO] gameserver.network.server: Session registered: uid=-1
20:26:08 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59327)
20:26:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:26:08 [INFO] gameserver.network.server: Session registered: uid=2
20:26:08 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:26:10 [INFO] gameserver.network.server: Session removed: uid=2
20:26:10 [INFO] websockets.server: connection open
20:26:10 [INFO] gameserver.network.server: Session registered: uid=-2
20:26:10 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59351)
20:26:10 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:26:10 [INFO] gameserver.network.server: Session registered: uid=2
20:26:10 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:26:10 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:26:10 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:26:18 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:26:22 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
20:26:23 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
20:26:23 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:26:48 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:26:48 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:26:48 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:26:58 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1573, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 149, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 170, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 369, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 369, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

20:29:31 [INFO] __main__: Shutdown signal received — stopping …
20:29:32 [INFO] __main__: Shutting down …
20:29:32 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:29:32 [INFO] websockets.server: server closing
20:29:32 [INFO] gameserver.network.server: Session removed: uid=2
20:29:32 [INFO] websockets.server: server closed
20:29:32 [INFO] gameserver.network.server: WebSocket server stopped
20:29:32 [INFO] __main__:   WebSocket server stopped
20:29:32 [INFO] __main__:   debug dashboard stopped
20:29:32 [INFO] __main__:   database closed
20:29:32 [INFO] __main__:   goodbye
20:29:33 [INFO] __main__: === Game Server starting ===
20:29:33 [INFO] __main__: Loading configuration …
20:29:34 [INFO] __main__:   items:        210 loaded from config
20:29:34 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:29:34 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:29:34 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:29:34 [INFO] __main__:   game_config:  loaded
20:29:34 [INFO] __main__: Initializing persistence …
20:29:34 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:29:34 [INFO] __main__:   database:     connected (gameserver.db)
20:29:34 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
20:29:34 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:29:34 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:29:34 [INFO] __main__: Creating services …
20:29:34 [INFO] __main__:   upgrade_provider: 210 items registered
20:29:34 [INFO] __main__:   all services created
20:29:34 [INFO] __main__: Wiring event handlers …
20:29:34 [INFO] __main__:   event handlers registered
20:29:34 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:29:34 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:29:34 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:29:34 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:29:34 [INFO] __main__: Restored 2 empires from saved state
20:29:34 [INFO] __main__: Restored 1 attacks from saved state
20:29:34 [INFO] __main__: Starting network server …
20:29:34 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:29:34 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:29:34 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:29:34 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:29:34 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:29:34 [INFO] __main__: Starting game loop …
20:29:34 [INFO] __main__:   game loop running (1 s tick)
20:29:35 [INFO] websockets.server: connection open
20:29:35 [INFO] gameserver.network.server: Session registered: uid=-1
20:29:35 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62629)
20:29:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:29:35 [INFO] gameserver.network.server: Session registered: uid=2
20:29:35 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:29:37 [INFO] gameserver.network.server: Session removed: uid=2
20:29:37 [INFO] websockets.server: connection open
20:29:37 [INFO] gameserver.network.server: Session registered: uid=-2
20:29:37 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62653)
20:29:37 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:29:37 [INFO] gameserver.network.server: Session registered: uid=2
20:29:37 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:29:37 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:29:37 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:29:44 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:30:14 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:30:14 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:30:14 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:30:24 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1575, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

20:31:36 [INFO] __main__: Shutdown signal received — stopping …
20:31:37 [INFO] __main__: Shutting down …
20:31:37 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:31:37 [INFO] websockets.server: server closing
20:31:37 [INFO] gameserver.network.server: Session removed: uid=2
20:31:37 [INFO] websockets.server: server closed
20:31:37 [INFO] gameserver.network.server: WebSocket server stopped
20:31:37 [INFO] __main__:   WebSocket server stopped
20:31:37 [INFO] __main__:   debug dashboard stopped
20:31:37 [INFO] __main__:   database closed
20:31:37 [INFO] __main__:   goodbye
20:31:39 [INFO] __main__: === Game Server starting ===
20:31:39 [INFO] __main__: Loading configuration …
20:31:39 [INFO] __main__:   items:        210 loaded from config
20:31:39 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:31:39 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:31:39 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (29 keys)
20:31:39 [INFO] __main__:   game_config:  loaded
20:31:39 [INFO] __main__: Initializing persistence …
20:31:39 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:31:39 [INFO] __main__:   database:     connected (gameserver.db)
20:31:39 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
20:31:39 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:31:39 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:31:39 [INFO] __main__: Creating services …
20:31:39 [INFO] __main__:   upgrade_provider: 210 items registered
20:31:39 [INFO] __main__:   all services created
20:31:39 [INFO] __main__: Wiring event handlers …
20:31:39 [INFO] __main__:   event handlers registered
20:31:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:31:39 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:31:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:31:39 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:31:39 [INFO] __main__: Restored 2 empires from saved state
20:31:39 [INFO] __main__: Restored 1 attacks from saved state
20:31:39 [INFO] __main__: Starting network server …
20:31:39 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:31:39 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:31:39 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:31:39 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:31:39 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:31:39 [INFO] __main__: Starting game loop …
20:31:39 [INFO] __main__:   game loop running (1 s tick)
20:31:40 [INFO] websockets.server: connection open
20:31:40 [INFO] gameserver.network.server: Session registered: uid=-1
20:31:40 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55156)
20:31:40 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:31:40 [INFO] gameserver.network.server: Session registered: uid=2
20:31:40 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:31:42 [INFO] gameserver.network.server: Session removed: uid=2
20:31:42 [INFO] websockets.server: connection open
20:31:42 [INFO] gameserver.network.server: Session registered: uid=-2
20:31:42 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55161)
20:31:42 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:31:42 [INFO] gameserver.network.server: Session registered: uid=2
20:31:42 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:31:42 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:31:42 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:31:49 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:32:19 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:32:19 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:32:19 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:32:29 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1575, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

20:44:47 [INFO] __main__: Shutdown signal received — stopping …
20:44:47 [INFO] __main__: Shutting down …
20:44:47 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:44:47 [INFO] websockets.server: server closing
20:44:47 [INFO] gameserver.network.server: Session removed: uid=2
20:44:47 [INFO] websockets.server: server closed
20:44:47 [INFO] gameserver.network.server: WebSocket server stopped
20:44:47 [INFO] __main__:   WebSocket server stopped
20:44:47 [INFO] __main__:   debug dashboard stopped
20:44:47 [INFO] __main__:   database closed
20:44:47 [INFO] __main__:   goodbye
20:44:49 [INFO] __main__: === Game Server starting ===
20:44:49 [INFO] __main__: Loading configuration …
20:44:50 [INFO] __main__:   items:        210 loaded from config
20:44:50 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:44:50 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:44:50 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
20:44:50 [INFO] __main__:   game_config:  loaded
20:44:50 [INFO] __main__: Initializing persistence …
20:44:50 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:44:50 [INFO] __main__:   database:     connected (gameserver.db)
20:44:50 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
20:44:50 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:44:50 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:44:50 [INFO] __main__: Creating services …
20:44:50 [INFO] __main__:   upgrade_provider: 210 items registered
20:44:50 [INFO] __main__:   all services created
20:44:50 [INFO] __main__: Wiring event handlers …
20:44:50 [INFO] __main__:   event handlers registered
20:44:50 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:44:50 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:44:50 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:44:50 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:44:50 [INFO] __main__: Restored 2 empires from saved state
20:44:50 [INFO] __main__: Restored 1 attacks from saved state
20:44:50 [INFO] __main__: Starting network server …
20:44:50 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:44:50 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:44:50 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:44:50 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:44:50 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:44:50 [INFO] __main__: Starting game loop …
20:44:50 [INFO] __main__:   game loop running (1 s tick)
20:44:50 [INFO] websockets.server: connection open
20:44:50 [INFO] gameserver.network.server: Session registered: uid=-1
20:44:50 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55732)
20:44:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:44:50 [INFO] gameserver.network.server: Session registered: uid=2
20:44:50 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:44:50 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:44:50 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:44:56 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
20:45:00 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:45:30 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:45:30 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:45:30 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:45:40 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1575, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

20:45:56 [INFO] __main__: Shutdown signal received — stopping …
20:45:57 [INFO] __main__: Shutting down …
20:45:57 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:45:57 [INFO] websockets.server: server closing
20:45:57 [INFO] gameserver.network.server: Session removed: uid=2
20:45:57 [INFO] websockets.server: server closed
20:45:57 [INFO] gameserver.network.server: WebSocket server stopped
20:45:57 [INFO] __main__:   WebSocket server stopped
20:45:57 [INFO] __main__:   debug dashboard stopped
20:45:57 [INFO] __main__:   database closed
20:45:57 [INFO] __main__:   goodbye
20:45:59 [INFO] __main__: === Game Server starting ===
20:45:59 [INFO] __main__: Loading configuration …
20:46:00 [INFO] __main__:   items:        210 loaded from config
20:46:00 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:46:00 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:46:00 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
20:46:00 [INFO] __main__:   game_config:  loaded
20:46:00 [INFO] __main__: Initializing persistence …
20:46:00 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:46:00 [INFO] __main__:   database:     connected (gameserver.db)
20:46:00 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T20:45:57, version 1)
20:46:00 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:46:00 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:46:00 [INFO] __main__: Creating services …
20:46:00 [INFO] __main__:   upgrade_provider: 210 items registered
20:46:00 [INFO] __main__:   all services created
20:46:00 [INFO] __main__: Wiring event handlers …
20:46:00 [INFO] __main__:   event handlers registered
20:46:00 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:46:00 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:46:00 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:46:00 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:46:00 [INFO] __main__: Restored 2 empires from saved state
20:46:00 [INFO] __main__: Restored 1 attacks from saved state
20:46:00 [INFO] __main__: Starting network server …
20:46:00 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:46:00 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:46:00 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:46:00 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:46:00 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:46:00 [INFO] __main__: Starting game loop …
20:46:00 [INFO] __main__:   game loop running (1 s tick)
20:46:00 [INFO] websockets.server: connection open
20:46:00 [INFO] gameserver.network.server: Session registered: uid=-1
20:46:00 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52769)
20:46:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:46:00 [INFO] gameserver.network.server: Session registered: uid=2
20:46:00 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:46:06 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
20:46:08 [INFO] gameserver.network.server: Session removed: uid=2
20:46:08 [INFO] websockets.server: connection open
20:46:08 [INFO] gameserver.network.server: Session registered: uid=-2
20:46:08 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 52794)
20:46:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:46:08 [INFO] gameserver.network.server: Session registered: uid=2
20:46:08 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:46:08 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
20:46:08 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:46:09 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
20:46:12 [INFO] gameserver.network.server: Session removed: uid=2
20:46:12 [INFO] websockets.server: connection open
20:46:12 [INFO] gameserver.network.server: Session registered: uid=-3
20:46:12 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 52820)
20:46:12 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:46:12 [INFO] gameserver.network.server: Session registered: uid=2
20:46:12 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
20:47:24 [INFO] __main__: Shutdown signal received — stopping …
20:47:24 [INFO] __main__: Shutting down …
20:47:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:47:24 [INFO] websockets.server: server closing
20:47:25 [INFO] gameserver.network.server: Session removed: uid=2
20:47:25 [INFO] websockets.server: server closed
20:47:25 [INFO] gameserver.network.server: WebSocket server stopped
20:47:25 [INFO] __main__:   WebSocket server stopped
20:47:25 [INFO] __main__:   debug dashboard stopped
20:47:25 [INFO] __main__:   database closed
20:47:25 [INFO] __main__:   goodbye
20:47:26 [INFO] __main__: === Game Server starting ===
20:47:26 [INFO] __main__: Loading configuration …
20:47:27 [INFO] __main__:   items:        210 loaded from config
20:47:27 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:47:27 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:47:27 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
20:47:27 [INFO] __main__:   game_config:  loaded
20:47:27 [INFO] __main__: Initializing persistence …
20:47:27 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:47:27 [INFO] __main__:   database:     connected (gameserver.db)
20:47:27 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
20:47:27 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:47:27 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:47:27 [INFO] __main__: Creating services …
20:47:27 [INFO] __main__:   upgrade_provider: 210 items registered
20:47:27 [INFO] __main__:   all services created
20:47:27 [INFO] __main__: Wiring event handlers …
20:47:27 [INFO] __main__:   event handlers registered
20:47:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:47:27 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:47:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:47:27 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:47:27 [INFO] __main__: Restored 2 empires from saved state
20:47:27 [INFO] __main__: Restored 1 attacks from saved state
20:47:27 [INFO] __main__: Starting network server …
20:47:27 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:47:27 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:47:27 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:47:27 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:47:27 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:47:27 [INFO] __main__: Starting game loop …
20:47:27 [INFO] __main__:   game loop running (1 s tick)
20:47:28 [INFO] websockets.server: connection open
20:47:28 [INFO] gameserver.network.server: Session registered: uid=-1
20:47:28 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52848)
20:47:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:47:28 [INFO] gameserver.network.server: Session registered: uid=2
20:47:28 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:47:28 [INFO] gameserver.network.server: Session removed: uid=2
20:47:29 [INFO] websockets.server: connection open
20:47:29 [INFO] gameserver.network.server: Session registered: uid=-2
20:47:29 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 52872)
20:47:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:47:29 [INFO] gameserver.network.server: Session registered: uid=2
20:47:29 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:47:37 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:47:44 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
20:47:44 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:48:07 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:48:07 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:48:07 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:48:17 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1575, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

20:48:34 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
20:49:50 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
20:49:50 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:54:38 [INFO] __main__: Shutdown signal received — stopping …
20:54:39 [INFO] __main__: Shutting down …
20:54:39 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:54:39 [INFO] websockets.server: server closing
20:54:39 [INFO] gameserver.network.server: Session removed: uid=2
20:54:39 [INFO] websockets.server: server closed
20:54:39 [INFO] gameserver.network.server: WebSocket server stopped
20:54:39 [INFO] __main__:   WebSocket server stopped
20:54:39 [INFO] __main__:   debug dashboard stopped
20:54:39 [INFO] __main__:   database closed
20:54:39 [INFO] __main__:   goodbye
20:54:41 [INFO] __main__: === Game Server starting ===
20:54:41 [INFO] __main__: Loading configuration …
20:54:42 [INFO] __main__:   items:        210 loaded from config
20:54:42 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:54:42 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:54:42 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
20:54:42 [INFO] __main__:   game_config:  loaded
20:54:42 [INFO] __main__: Initializing persistence …
20:54:42 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:54:42 [INFO] __main__:   database:     connected (gameserver.db)
20:54:42 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
20:54:42 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:54:42 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:54:42 [INFO] __main__: Creating services …
20:54:42 [INFO] __main__:   upgrade_provider: 210 items registered
20:54:42 [INFO] __main__:   all services created
20:54:42 [INFO] __main__: Wiring event handlers …
20:54:42 [INFO] __main__:   event handlers registered
20:54:42 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:54:42 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:54:42 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:54:42 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:54:42 [INFO] __main__: Restored 2 empires from saved state
20:54:42 [INFO] __main__: Restored 1 attacks from saved state
20:54:42 [INFO] __main__: Starting network server …
20:54:42 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:54:42 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:54:42 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:54:42 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:54:42 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:54:42 [INFO] __main__: Starting game loop …
20:54:42 [INFO] __main__:   game loop running (1 s tick)
20:54:42 [INFO] websockets.server: connection open
20:54:42 [INFO] gameserver.network.server: Session registered: uid=-1
20:54:42 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 61620)
20:54:42 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:54:42 [INFO] gameserver.network.server: Session registered: uid=2
20:54:42 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:54:43 [INFO] gameserver.network.server: Session removed: uid=2
20:54:44 [INFO] websockets.server: connection open
20:54:44 [INFO] gameserver.network.server: Session registered: uid=-2
20:54:44 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 61646)
20:54:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:54:44 [INFO] gameserver.network.server: Session registered: uid=2
20:54:44 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:54:44 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:54:44 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:54:45 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
20:54:52 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:54:58 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
20:54:58 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:55:02 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:55:02 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:55:02 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:55:12 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1580, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

20:58:15 [INFO] __main__: Shutdown signal received — stopping …
20:58:16 [INFO] __main__: Shutting down …
20:58:16 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:58:16 [INFO] websockets.server: server closing
20:58:16 [INFO] gameserver.network.server: Session removed: uid=2
20:58:16 [INFO] websockets.server: server closed
20:58:16 [INFO] gameserver.network.server: WebSocket server stopped
20:58:16 [INFO] __main__:   WebSocket server stopped
20:58:16 [INFO] __main__:   debug dashboard stopped
20:58:16 [INFO] __main__:   database closed
20:58:16 [INFO] __main__:   goodbye
20:58:18 [INFO] __main__: === Game Server starting ===
20:58:18 [INFO] __main__: Loading configuration …
20:58:18 [INFO] __main__:   items:        210 loaded from config
20:58:19 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
20:58:19 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:58:19 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
20:58:19 [INFO] __main__:   game_config:  loaded
20:58:19 [INFO] __main__: Initializing persistence …
20:58:19 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:58:19 [INFO] __main__:   database:     connected (gameserver.db)
20:58:19 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
20:58:19 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:58:19 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:58:19 [INFO] __main__: Creating services …
20:58:19 [INFO] __main__:   upgrade_provider: 210 items registered
20:58:19 [INFO] __main__:   all services created
20:58:19 [INFO] __main__: Wiring event handlers …
20:58:19 [INFO] __main__:   event handlers registered
20:58:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:58:19 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:58:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:58:19 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:58:19 [INFO] __main__: Restored 2 empires from saved state
20:58:19 [INFO] __main__: Restored 1 attacks from saved state
20:58:19 [INFO] __main__: Starting network server …
20:58:19 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
20:58:19 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:58:19 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:58:19 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:58:19 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:58:19 [INFO] __main__: Starting game loop …
20:58:19 [INFO] __main__:   game loop running (1 s tick)
20:58:19 [INFO] websockets.server: connection open
20:58:19 [INFO] gameserver.network.server: Session registered: uid=-1
20:58:19 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52906)
20:58:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:58:19 [INFO] gameserver.network.server: Session registered: uid=2
20:58:19 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
20:58:25 [INFO] gameserver.network.server: Session removed: uid=2
20:58:25 [INFO] websockets.server: connection open
20:58:25 [INFO] gameserver.network.server: Session registered: uid=-2
20:58:25 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59783)
20:58:25 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:58:25 [INFO] gameserver.network.server: Session registered: uid=2
20:58:25 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
20:58:25 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
20:58:25 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:58:29 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:58:39 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:58:39 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:58:39 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:58:49 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1594, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

21:21:13 [INFO] __main__: Shutdown signal received — stopping …
21:21:14 [INFO] __main__: Shutting down …
21:21:14 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:21:14 [INFO] websockets.server: server closing
21:21:14 [INFO] gameserver.network.server: Session removed: uid=2
21:21:14 [INFO] websockets.server: server closed
21:21:14 [INFO] gameserver.network.server: WebSocket server stopped
21:21:14 [INFO] __main__:   WebSocket server stopped
21:21:14 [INFO] __main__:   debug dashboard stopped
21:21:14 [INFO] __main__:   database closed
21:21:14 [INFO] __main__:   goodbye
21:21:15 [INFO] __main__: === Game Server starting ===
21:21:15 [INFO] __main__: Loading configuration …
21:21:16 [INFO] __main__:   items:        210 loaded from config
21:21:16 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:21:16 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:21:16 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:21:16 [INFO] __main__:   game_config:  loaded
21:21:16 [INFO] __main__: Initializing persistence …
21:21:16 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:21:16 [INFO] __main__:   database:     connected (gameserver.db)
21:21:16 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:21:16 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:21:16 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:21:16 [INFO] __main__: Creating services …
21:21:16 [INFO] __main__:   upgrade_provider: 210 items registered
21:21:16 [INFO] __main__:   all services created
21:21:16 [INFO] __main__: Wiring event handlers …
21:21:16 [INFO] __main__:   event handlers registered
21:21:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:21:16 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:21:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:21:16 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:21:16 [INFO] __main__: Restored 2 empires from saved state
21:21:16 [INFO] __main__: Restored 1 attacks from saved state
21:21:16 [INFO] __main__: Starting network server …
21:21:16 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:21:16 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:21:16 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:21:16 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:21:16 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:21:16 [INFO] __main__: Starting game loop …
21:21:16 [INFO] __main__:   game loop running (1 s tick)
21:21:17 [INFO] websockets.server: connection open
21:21:17 [INFO] gameserver.network.server: Session registered: uid=-1
21:21:17 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51538)
21:21:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:21:17 [INFO] gameserver.network.server: Session registered: uid=2
21:21:17 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:21:19 [INFO] gameserver.network.server: Session removed: uid=2
21:21:19 [INFO] websockets.server: connection open
21:21:19 [INFO] gameserver.network.server: Session registered: uid=-2
21:21:19 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 51564)
21:21:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:21:19 [INFO] gameserver.network.server: Session registered: uid=2
21:21:19 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:21:19 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
21:21:19 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:21:26 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:21:33 [INFO] gameserver.network.server: Session removed: uid=2
21:21:33 [INFO] websockets.server: connection open
21:21:33 [INFO] gameserver.network.server: Session registered: uid=-3
21:21:33 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 51599)
21:21:33 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:21:33 [INFO] gameserver.network.server: Session registered: uid=2
21:21:33 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:21:33 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
21:21:33 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:21:36 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:21:36 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:21:36 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:21:46 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1594, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

21:22:06 [INFO] gameserver.network.server: Session removed: uid=2
21:22:06 [INFO] websockets.server: connection open
21:22:06 [INFO] gameserver.network.server: Session registered: uid=-4
21:22:06 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 51639)
21:22:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:22:06 [INFO] gameserver.network.server: Session registered: uid=2
21:22:06 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
21:22:06 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
21:22:06 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:22:26 [INFO] __main__: Shutdown signal received — stopping …
21:22:26 [INFO] __main__: Shutting down …
21:22:26 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:22:26 [INFO] websockets.server: server closing
21:22:26 [INFO] gameserver.network.server: Session removed: uid=2
21:22:26 [INFO] websockets.server: server closed
21:22:26 [INFO] gameserver.network.server: WebSocket server stopped
21:22:26 [INFO] __main__:   WebSocket server stopped
21:22:26 [INFO] __main__:   debug dashboard stopped
21:22:26 [INFO] __main__:   database closed
21:22:26 [INFO] __main__:   goodbye
21:22:28 [INFO] __main__: === Game Server starting ===
21:22:28 [INFO] __main__: Loading configuration …
21:22:29 [INFO] __main__:   items:        210 loaded from config
21:22:29 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:22:29 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:22:29 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:22:29 [INFO] __main__:   game_config:  loaded
21:22:29 [INFO] __main__: Initializing persistence …
21:22:29 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:22:29 [INFO] __main__:   database:     connected (gameserver.db)
21:22:29 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:22:29 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:22:29 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:22:29 [INFO] __main__: Creating services …
21:22:29 [INFO] __main__:   upgrade_provider: 210 items registered
21:22:29 [INFO] __main__:   all services created
21:22:29 [INFO] __main__: Wiring event handlers …
21:22:29 [INFO] __main__:   event handlers registered
21:22:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:22:29 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:22:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:22:29 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:22:29 [INFO] __main__: Restored 2 empires from saved state
21:22:29 [INFO] __main__: Restored 1 attacks from saved state
21:22:29 [INFO] __main__: Starting network server …
21:22:29 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:22:29 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:22:29 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:22:29 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:22:29 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:22:29 [INFO] __main__: Starting game loop …
21:22:29 [INFO] __main__:   game loop running (1 s tick)
21:22:29 [INFO] websockets.server: connection open
21:22:29 [INFO] gameserver.network.server: Session registered: uid=-1
21:22:29 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63387)
21:22:29 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:22:29 [INFO] gameserver.network.server: Session registered: uid=2
21:22:29 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:22:39 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:22:47 [INFO] gameserver.network.server: Session removed: uid=2
21:22:47 [INFO] websockets.server: connection open
21:22:47 [INFO] gameserver.network.server: Session registered: uid=-2
21:22:47 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63416)
21:22:47 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:22:47 [INFO] gameserver.network.server: Session registered: uid=2
21:22:47 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:22:47 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
21:22:47 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:22:49 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:22:49 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:22:49 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:22:58 [INFO] gameserver.network.server: Session removed: uid=2
21:22:58 [INFO] websockets.server: connection open
21:22:58 [INFO] gameserver.network.server: Session registered: uid=-3
21:22:58 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 63420)
21:22:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:22:58 [INFO] gameserver.network.server: Session registered: uid=2
21:22:58 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
21:22:58 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
21:22:58 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:22:59 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1594, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

21:24:02 [INFO] __main__: Shutdown signal received — stopping …
21:24:03 [INFO] __main__: Shutting down …
21:24:03 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:24:03 [INFO] websockets.server: server closing
21:24:03 [INFO] gameserver.network.server: Session removed: uid=2
21:24:03 [INFO] websockets.server: server closed
21:24:03 [INFO] gameserver.network.server: WebSocket server stopped
21:24:03 [INFO] __main__:   WebSocket server stopped
21:24:03 [INFO] __main__:   debug dashboard stopped
21:24:03 [INFO] __main__:   database closed
21:24:03 [INFO] __main__:   goodbye
21:24:04 [INFO] __main__: === Game Server starting ===
21:24:04 [INFO] __main__: Loading configuration …
21:24:05 [INFO] __main__:   items:        210 loaded from config
21:24:05 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:24:05 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:24:05 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:24:05 [INFO] __main__:   game_config:  loaded
21:24:05 [INFO] __main__: Initializing persistence …
21:24:05 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:24:05 [INFO] __main__:   database:     connected (gameserver.db)
21:24:05 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:24:05 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:24:05 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:24:05 [INFO] __main__: Creating services …
21:24:05 [INFO] __main__:   upgrade_provider: 210 items registered
21:24:05 [INFO] __main__:   all services created
21:24:05 [INFO] __main__: Wiring event handlers …
21:24:05 [INFO] __main__:   event handlers registered
21:24:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:24:05 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:24:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:24:05 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:24:05 [INFO] __main__: Restored 2 empires from saved state
21:24:05 [INFO] __main__: Restored 1 attacks from saved state
21:24:05 [INFO] __main__: Starting network server …
21:24:05 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:24:05 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:24:05 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:24:05 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:24:05 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:24:05 [INFO] __main__: Starting game loop …
21:24:05 [INFO] __main__:   game loop running (1 s tick)
21:24:05 [INFO] websockets.server: connection open
21:24:05 [INFO] gameserver.network.server: Session registered: uid=-1
21:24:05 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57547)
21:24:05 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:24:05 [INFO] gameserver.network.server: Session registered: uid=2
21:24:05 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:24:15 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:24:18 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
21:24:18 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:24:25 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:24:25 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:24:25 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:24:35 [ERROR] gameserver.network.handlers: Battle loop crashed: Traceback (most recent call last):
  File "/home/pi/e3/python_server/src/gameserver/network/handlers.py", line 1594, in _run_battle_task
    await battle_svc.run_battle(battle, send_fn, broadcast_interval_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 160, in run_battle
    self.tick(battle, dt_ms)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 181, in tick
    self._check_finished(battle)
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in _check_finished
    all_armies_done = all(a.is_finished for a in battle.armies.values())
  File "/home/pi/e3/python_server/src/gameserver/engine/battle_service.py", line 395, in <genexpr>
    all_armies_done = all(a.is_finished for a in battle.armies.values())
AttributeError: 'Army' object has no attribute 'is_finished'

21:24:57 [INFO] __main__: Shutdown signal received — stopping …
21:24:57 [INFO] __main__: Shutting down …
21:24:57 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:24:57 [INFO] websockets.server: server closing
21:24:57 [INFO] gameserver.network.server: Session removed: uid=2
21:24:57 [INFO] websockets.server: server closed
21:24:57 [INFO] gameserver.network.server: WebSocket server stopped
21:24:57 [INFO] __main__:   WebSocket server stopped
21:24:57 [INFO] __main__:   debug dashboard stopped
21:24:57 [INFO] __main__:   database closed
21:24:57 [INFO] __main__:   goodbye
21:24:59 [INFO] __main__: === Game Server starting ===
21:24:59 [INFO] __main__: Loading configuration …
21:24:59 [INFO] __main__:   items:        210 loaded from config
21:24:59 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:24:59 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:25:00 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:25:00 [INFO] __main__:   game_config:  loaded
21:25:00 [INFO] __main__: Initializing persistence …
21:25:00 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:25:00 [INFO] __main__:   database:     connected (gameserver.db)
21:25:00 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:25:00 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:25:00 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:25:00 [INFO] __main__: Creating services …
21:25:00 [INFO] __main__:   upgrade_provider: 210 items registered
21:25:00 [INFO] __main__:   all services created
21:25:00 [INFO] __main__: Wiring event handlers …
21:25:00 [INFO] __main__:   event handlers registered
21:25:00 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:25:00 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:25:00 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:25:00 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:25:00 [INFO] __main__: Restored 2 empires from saved state
21:25:00 [INFO] __main__: Restored 1 attacks from saved state
21:25:00 [INFO] __main__: Starting network server …
21:25:00 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:25:00 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:25:00 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:25:00 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:25:00 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:25:00 [INFO] __main__: Starting game loop …
21:25:00 [INFO] __main__:   game loop running (1 s tick)
21:25:00 [INFO] websockets.server: connection open
21:25:00 [INFO] gameserver.network.server: Session registered: uid=-1
21:25:00 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62904)
21:25:00 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:25:00 [INFO] gameserver.network.server: Session registered: uid=2
21:25:00 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:25:10 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:25:12 [INFO] gameserver.network.server: Session removed: uid=2
21:25:12 [INFO] websockets.server: connection open
21:25:12 [INFO] gameserver.network.server: Session registered: uid=-2
21:25:12 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62914)
21:25:12 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:25:12 [INFO] gameserver.network.server: Session registered: uid=2
21:25:12 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:25:12 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
21:25:12 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:25:20 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:25:20 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:25:20 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:26:48 [INFO] __main__: Shutdown signal received — stopping …
21:26:49 [INFO] __main__: Shutting down …
21:26:49 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:26:49 [INFO] websockets.server: server closing
21:26:49 [INFO] gameserver.network.server: Session removed: uid=2
21:26:49 [INFO] websockets.server: server closed
21:26:49 [INFO] gameserver.network.server: WebSocket server stopped
21:26:49 [INFO] __main__:   WebSocket server stopped
21:26:49 [INFO] __main__:   debug dashboard stopped
21:26:49 [INFO] __main__:   database closed
21:26:49 [INFO] __main__:   goodbye
21:26:50 [INFO] __main__: === Game Server starting ===
21:26:50 [INFO] __main__: Loading configuration …
21:26:51 [INFO] __main__:   items:        210 loaded from config
21:26:51 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:26:51 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:26:51 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:26:51 [INFO] __main__:   game_config:  loaded
21:26:51 [INFO] __main__: Initializing persistence …
21:26:51 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:26:51 [INFO] __main__:   database:     connected (gameserver.db)
21:26:51 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:26:51 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:26:51 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:26:51 [INFO] __main__: Creating services …
21:26:51 [INFO] __main__:   upgrade_provider: 210 items registered
21:26:51 [INFO] __main__:   all services created
21:26:51 [INFO] __main__: Wiring event handlers …
21:26:51 [INFO] __main__:   event handlers registered
21:26:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:26:51 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:26:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:26:51 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:26:51 [INFO] __main__: Restored 2 empires from saved state
21:26:51 [INFO] __main__: Restored 1 attacks from saved state
21:26:51 [INFO] __main__: Starting network server …
21:26:51 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:26:51 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:26:51 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:26:51 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:26:51 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:26:51 [INFO] __main__: Starting game loop …
21:26:51 [INFO] __main__:   game loop running (1 s tick)
21:26:51 [INFO] websockets.server: connection open
21:26:51 [INFO] gameserver.network.server: Session registered: uid=-1
21:26:51 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56141)
21:26:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:26:51 [INFO] gameserver.network.server: Session registered: uid=2
21:26:51 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:26:51 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
21:26:51 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:26:58 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
21:27:01 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:27:11 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:27:11 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:27:11 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:27:14 [INFO] gameserver.network.server: Session removed: uid=2
21:27:14 [INFO] websockets.server: connection open
21:27:14 [INFO] gameserver.network.server: Session registered: uid=-2
21:27:14 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 56149)
21:27:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:27:14 [INFO] gameserver.network.server: Session registered: uid=2
21:27:14 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:27:14 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
21:27:14 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:27:32 [INFO] __main__: Shutdown signal received — stopping …
21:27:32 [INFO] __main__: Shutting down …
21:27:32 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:27:32 [INFO] websockets.server: server closing
21:27:32 [INFO] gameserver.network.server: Session removed: uid=2
21:27:32 [INFO] websockets.server: server closed
21:27:32 [INFO] gameserver.network.server: WebSocket server stopped
21:27:32 [INFO] __main__:   WebSocket server stopped
21:27:32 [INFO] __main__:   debug dashboard stopped
21:27:32 [INFO] __main__:   database closed
21:27:32 [INFO] __main__:   goodbye
21:27:35 [INFO] __main__: === Game Server starting ===
21:27:35 [INFO] __main__: Loading configuration …
21:27:36 [INFO] __main__:   items:        210 loaded from config
21:27:36 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:27:36 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:27:36 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:27:36 [INFO] __main__:   game_config:  loaded
21:27:36 [INFO] __main__: Initializing persistence …
21:27:36 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:27:36 [INFO] __main__:   database:     connected (gameserver.db)
21:27:36 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T21:27:32, version 1)
21:27:36 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:27:36 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:27:36 [INFO] __main__: Creating services …
21:27:36 [INFO] __main__:   upgrade_provider: 210 items registered
21:27:36 [INFO] __main__:   all services created
21:27:36 [INFO] __main__: Wiring event handlers …
21:27:36 [INFO] __main__:   event handlers registered
21:27:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:27:36 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:27:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:27:36 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:27:36 [INFO] __main__: Restored 2 empires from saved state
21:27:36 [INFO] __main__: Restored 1 attacks from saved state
21:27:36 [INFO] __main__: Starting network server …
21:27:36 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:27:36 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:27:36 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:27:36 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:27:36 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:27:36 [INFO] __main__: Starting game loop …
21:27:36 [INFO] __main__:   game loop running (1 s tick)
21:27:36 [INFO] websockets.server: connection open
21:27:36 [INFO] gameserver.network.server: Session registered: uid=-1
21:27:36 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59445)
21:27:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:27:36 [INFO] gameserver.network.server: Session registered: uid=2
21:27:36 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:27:41 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
21:28:04 [INFO] __main__: Shutdown signal received — stopping …
21:28:05 [INFO] __main__: Shutting down …
21:28:05 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:28:05 [INFO] websockets.server: server closing
21:28:05 [INFO] gameserver.network.server: Session removed: uid=2
21:28:05 [INFO] websockets.server: server closed
21:28:05 [INFO] gameserver.network.server: WebSocket server stopped
21:28:05 [INFO] __main__:   WebSocket server stopped
21:28:05 [INFO] __main__:   debug dashboard stopped
21:28:05 [INFO] __main__:   database closed
21:28:05 [INFO] __main__:   goodbye
21:28:06 [INFO] __main__: === Game Server starting ===
21:28:06 [INFO] __main__: Loading configuration …
21:28:07 [INFO] __main__:   items:        210 loaded from config
21:28:07 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:28:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:28:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:28:07 [INFO] __main__:   game_config:  loaded
21:28:07 [INFO] __main__: Initializing persistence …
21:28:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:28:07 [INFO] __main__:   database:     connected (gameserver.db)
21:28:07 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:28:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:28:07 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:28:07 [INFO] __main__: Creating services …
21:28:07 [INFO] __main__:   upgrade_provider: 210 items registered
21:28:07 [INFO] __main__:   all services created
21:28:07 [INFO] __main__: Wiring event handlers …
21:28:07 [INFO] __main__:   event handlers registered
21:28:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:28:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:28:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:28:07 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:28:07 [INFO] __main__: Restored 2 empires from saved state
21:28:07 [INFO] __main__: Restored 1 attacks from saved state
21:28:07 [INFO] __main__: Starting network server …
21:28:07 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:28:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:28:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:28:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:28:07 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:28:07 [INFO] __main__: Starting game loop …
21:28:07 [INFO] __main__:   game loop running (1 s tick)
21:28:08 [INFO] websockets.server: connection open
21:28:08 [INFO] gameserver.network.server: Session registered: uid=-1
21:28:08 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59459)
21:28:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:28:08 [INFO] gameserver.network.server: Session registered: uid=2
21:28:08 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:28:14 [INFO] gameserver.network.server: Client disconnected: uid=-1 code=1001
21:28:14 [INFO] gameserver.network.server: Session removed: uid=2
21:28:14 [INFO] websockets.server: connection open
21:28:14 [INFO] gameserver.network.server: Session registered: uid=-2
21:28:14 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59463)
21:28:14 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:28:14 [INFO] gameserver.network.server: Session registered: uid=2
21:28:14 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:28:14 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
21:28:14 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:28:17 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:28:27 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:28:27 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:28:27 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:30:31 [INFO] __main__: Shutdown signal received — stopping …
21:30:31 [INFO] __main__: Shutting down …
21:30:31 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:30:31 [INFO] websockets.server: server closing
21:30:31 [INFO] gameserver.network.server: Session removed: uid=2
21:30:31 [INFO] websockets.server: server closed
21:30:31 [INFO] gameserver.network.server: WebSocket server stopped
21:30:31 [INFO] __main__:   WebSocket server stopped
21:30:31 [INFO] __main__:   debug dashboard stopped
21:30:31 [INFO] __main__:   database closed
21:30:31 [INFO] __main__:   goodbye
21:30:34 [INFO] __main__: === Game Server starting ===
21:30:34 [INFO] __main__: Loading configuration …
21:30:35 [INFO] __main__:   items:        210 loaded from config
21:30:35 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:30:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:30:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:30:35 [INFO] __main__:   game_config:  loaded
21:30:35 [INFO] __main__: Initializing persistence …
21:30:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:30:35 [INFO] __main__:   database:     connected (gameserver.db)
21:30:35 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T21:30:31, version 1)
21:30:35 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:30:35 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:30:35 [INFO] __main__: Creating services …
21:30:35 [INFO] __main__:   upgrade_provider: 210 items registered
21:30:35 [INFO] __main__:   all services created
21:30:35 [INFO] __main__: Wiring event handlers …
21:30:35 [INFO] __main__:   event handlers registered
21:30:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:30:35 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:30:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:30:35 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:30:35 [INFO] __main__: Restored 2 empires from saved state
21:30:35 [INFO] __main__: Restored 1 attacks from saved state
21:30:35 [INFO] __main__: Starting network server …
21:30:35 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:30:35 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:30:35 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:30:35 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:30:35 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:30:35 [INFO] __main__: Starting game loop …
21:30:35 [INFO] __main__:   game loop running (1 s tick)
21:30:35 [INFO] websockets.server: connection open
21:30:35 [INFO] gameserver.network.server: Session registered: uid=-1
21:30:35 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53171)
21:30:35 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:30:35 [INFO] gameserver.network.server: Session registered: uid=2
21:30:35 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:30:40 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
21:31:03 [INFO] __main__: Shutdown signal received — stopping …
21:31:04 [INFO] __main__: Shutting down …
21:31:04 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:31:04 [INFO] websockets.server: server closing
21:31:04 [INFO] gameserver.network.server: Session removed: uid=2
21:31:04 [INFO] websockets.server: server closed
21:31:04 [INFO] gameserver.network.server: WebSocket server stopped
21:31:04 [INFO] __main__:   WebSocket server stopped
21:31:04 [INFO] __main__:   debug dashboard stopped
21:31:04 [INFO] __main__:   database closed
21:31:04 [INFO] __main__:   goodbye
21:31:05 [INFO] __main__: === Game Server starting ===
21:31:05 [INFO] __main__: Loading configuration …
21:31:06 [INFO] __main__:   items:        210 loaded from config
21:31:06 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:31:06 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:31:06 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:31:06 [INFO] __main__:   game_config:  loaded
21:31:06 [INFO] __main__: Initializing persistence …
21:31:06 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:31:06 [INFO] __main__:   database:     connected (gameserver.db)
21:31:06 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:31:06 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:31:06 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:31:06 [INFO] __main__: Creating services …
21:31:06 [INFO] __main__:   upgrade_provider: 210 items registered
21:31:06 [INFO] __main__:   all services created
21:31:06 [INFO] __main__: Wiring event handlers …
21:31:06 [INFO] __main__:   event handlers registered
21:31:06 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:31:06 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:31:06 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:31:06 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:31:06 [INFO] __main__: Restored 2 empires from saved state
21:31:06 [INFO] __main__: Restored 1 attacks from saved state
21:31:06 [INFO] __main__: Starting network server …
21:31:06 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:31:06 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:31:06 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:31:06 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:31:06 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:31:06 [INFO] __main__: Starting game loop …
21:31:06 [INFO] __main__:   game loop running (1 s tick)
21:31:07 [INFO] websockets.server: connection open
21:31:07 [INFO] gameserver.network.server: Session registered: uid=-1
21:31:07 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53188)
21:31:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:31:07 [INFO] gameserver.network.server: Session registered: uid=2
21:31:07 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:31:16 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:31:26 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:31:26 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:31:26 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:32:03 [INFO] gameserver.network.server: Session removed: uid=2
21:32:03 [INFO] websockets.server: connection open
21:32:03 [INFO] gameserver.network.server: Session registered: uid=-2
21:32:03 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 53210)
21:32:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:32:03 [INFO] gameserver.network.server: Session registered: uid=2
21:32:03 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:32:03 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
21:32:03 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:33:48 [INFO] __main__: Shutdown signal received — stopping …
21:33:48 [INFO] __main__: Shutting down …
21:33:48 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:33:48 [INFO] websockets.server: server closing
21:33:48 [INFO] gameserver.network.server: Session removed: uid=2
21:33:48 [INFO] websockets.server: server closed
21:33:48 [INFO] gameserver.network.server: WebSocket server stopped
21:33:48 [INFO] __main__:   WebSocket server stopped
21:33:48 [INFO] __main__:   debug dashboard stopped
21:33:48 [INFO] __main__:   database closed
21:33:48 [INFO] __main__:   goodbye
21:33:50 [INFO] __main__: === Game Server starting ===
21:33:50 [INFO] __main__: Loading configuration …
21:33:51 [INFO] __main__:   items:        210 loaded from config
21:33:51 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:33:51 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:33:51 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:33:51 [INFO] __main__:   game_config:  loaded
21:33:51 [INFO] __main__: Initializing persistence …
21:33:51 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:33:51 [INFO] __main__:   database:     connected (gameserver.db)
21:33:51 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:33:51 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:33:51 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:33:51 [INFO] __main__: Creating services …
21:33:51 [INFO] __main__:   upgrade_provider: 210 items registered
21:33:51 [INFO] __main__:   all services created
21:33:51 [INFO] __main__: Wiring event handlers …
21:33:51 [INFO] __main__:   event handlers registered
21:33:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:33:51 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:33:51 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:33:51 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:33:51 [INFO] __main__: Restored 2 empires from saved state
21:33:51 [INFO] __main__: Restored 1 attacks from saved state
21:33:51 [INFO] __main__: Starting network server …
21:33:51 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:33:51 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:33:51 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:33:51 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:33:51 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:33:51 [INFO] __main__: Starting game loop …
21:33:51 [INFO] __main__:   game loop running (1 s tick)
21:33:51 [INFO] websockets.server: connection open
21:33:51 [INFO] gameserver.network.server: Session registered: uid=-1
21:33:51 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50448)
21:33:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:33:51 [INFO] gameserver.network.server: Session registered: uid=2
21:33:51 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:33:57 [INFO] gameserver.network.server: Session removed: uid=2
21:33:57 [INFO] websockets.server: connection open
21:33:57 [INFO] gameserver.network.server: Session registered: uid=-2
21:33:57 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50456)
21:33:57 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:33:57 [INFO] gameserver.network.server: Session registered: uid=2
21:33:57 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:33:57 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
21:33:57 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:34:01 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:34:11 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:34:11 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:34:11 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:34:11 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
21:34:12 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:34:13 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:34:14 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:34:15 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:34:16 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:34:17 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:34:18 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:34:19 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:34:20 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:34:21 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:34:32 [INFO] __main__: Shutdown signal received — stopping …
21:34:33 [INFO] __main__: Shutting down …
21:34:33 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:34:33 [INFO] websockets.server: server closing
21:34:33 [INFO] gameserver.network.server: Session removed: uid=2
21:34:33 [INFO] websockets.server: server closed
21:34:33 [INFO] gameserver.network.server: WebSocket server stopped
21:34:33 [INFO] __main__:   WebSocket server stopped
21:34:33 [INFO] __main__:   debug dashboard stopped
21:34:33 [INFO] __main__:   database closed
21:34:33 [INFO] __main__:   goodbye
21:34:35 [INFO] __main__: === Game Server starting ===
21:34:35 [INFO] __main__: Loading configuration …
21:34:36 [INFO] __main__:   items:        210 loaded from config
21:34:36 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:34:36 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:34:36 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:34:36 [INFO] __main__:   game_config:  loaded
21:34:36 [INFO] __main__: Initializing persistence …
21:34:36 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:34:36 [INFO] __main__:   database:     connected (gameserver.db)
21:34:36 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-10T21:34:33, version 1)
21:34:36 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:34:36 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:34:36 [INFO] __main__: Creating services …
21:34:36 [INFO] __main__:   upgrade_provider: 210 items registered
21:34:36 [INFO] __main__:   all services created
21:34:36 [INFO] __main__: Wiring event handlers …
21:34:36 [INFO] __main__:   event handlers registered
21:34:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:34:36 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:34:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:34:36 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:34:36 [INFO] __main__: Restored 2 empires from saved state
21:34:36 [INFO] __main__: Restored 1 attacks from saved state
21:34:36 [INFO] __main__: Starting network server …
21:34:36 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:34:36 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:34:36 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:34:36 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:34:36 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:34:36 [INFO] __main__: Starting game loop …
21:34:36 [INFO] __main__:   game loop running (1 s tick)
21:34:36 [INFO] websockets.server: connection open
21:34:36 [INFO] gameserver.network.server: Session registered: uid=-1
21:34:36 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 54073)
21:34:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:34:36 [INFO] gameserver.network.server: Session registered: uid=2
21:34:36 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:34:43 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
21:36:18 [INFO] __main__: Shutdown signal received — stopping …
21:36:18 [INFO] __main__: Shutting down …
21:36:18 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:36:18 [INFO] websockets.server: server closing
21:36:18 [INFO] gameserver.network.server: Session removed: uid=2
21:36:18 [INFO] websockets.server: server closed
21:36:18 [INFO] gameserver.network.server: WebSocket server stopped
21:36:18 [INFO] __main__:   WebSocket server stopped
21:36:18 [INFO] __main__:   debug dashboard stopped
21:36:18 [INFO] __main__:   database closed
21:36:18 [INFO] __main__:   goodbye
21:36:20 [INFO] __main__: === Game Server starting ===
21:36:20 [INFO] __main__: Loading configuration …
21:36:21 [INFO] __main__:   items:        210 loaded from config
21:36:21 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:36:21 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:36:21 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:36:21 [INFO] __main__:   game_config:  loaded
21:36:21 [INFO] __main__: Initializing persistence …
21:36:21 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:36:21 [INFO] __main__:   database:     connected (gameserver.db)
21:36:21 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:36:21 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:36:21 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:36:21 [INFO] __main__: Creating services …
21:36:21 [INFO] __main__:   upgrade_provider: 210 items registered
21:36:21 [INFO] __main__:   all services created
21:36:21 [INFO] __main__: Wiring event handlers …
21:36:21 [INFO] __main__:   event handlers registered
21:36:21 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:36:21 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:36:21 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:36:21 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:36:21 [INFO] __main__: Restored 2 empires from saved state
21:36:21 [INFO] __main__: Restored 1 attacks from saved state
21:36:21 [INFO] __main__: Starting network server …
21:36:21 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:36:21 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:36:21 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:36:21 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:36:21 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:36:21 [INFO] __main__: Starting game loop …
21:36:21 [INFO] __main__:   game loop running (1 s tick)
21:36:21 [INFO] websockets.server: connection open
21:36:21 [INFO] gameserver.network.server: Session registered: uid=-1
21:36:21 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 52819)
21:36:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:36:21 [INFO] gameserver.network.server: Session registered: uid=2
21:36:21 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:36:21 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
21:36:21 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:36:27 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
21:36:31 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:36:41 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:36:41 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:36:41 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:36:41 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
21:36:42 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:36:43 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:36:44 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:36:45 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:36:46 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:36:47 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:36:48 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:36:49 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:36:50 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:36:51 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:39:29 [INFO] __main__: Shutdown signal received — stopping …
21:39:29 [INFO] __main__: Shutting down …
21:39:29 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:39:29 [INFO] websockets.server: server closing
21:39:29 [INFO] gameserver.network.server: Session removed: uid=2
21:39:29 [INFO] websockets.server: server closed
21:39:29 [INFO] gameserver.network.server: WebSocket server stopped
21:39:29 [INFO] __main__:   WebSocket server stopped
21:39:29 [INFO] __main__:   debug dashboard stopped
21:39:29 [INFO] __main__:   database closed
21:39:29 [INFO] __main__:   goodbye
21:39:31 [INFO] __main__: === Game Server starting ===
21:39:31 [INFO] __main__: Loading configuration …
21:39:31 [INFO] __main__:   items:        210 loaded from config
21:39:31 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:39:31 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:39:31 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:39:31 [INFO] __main__:   game_config:  loaded
21:39:31 [INFO] __main__: Initializing persistence …
21:39:31 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:39:31 [INFO] __main__:   database:     connected (gameserver.db)
21:39:31 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:39:31 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:39:31 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:39:31 [INFO] __main__: Creating services …
21:39:31 [INFO] __main__:   upgrade_provider: 210 items registered
21:39:31 [INFO] __main__:   all services created
21:39:31 [INFO] __main__: Wiring event handlers …
21:39:31 [INFO] __main__:   event handlers registered
21:39:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:39:31 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:39:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:39:31 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:39:31 [INFO] __main__: Restored 2 empires from saved state
21:39:31 [INFO] __main__: Restored 1 attacks from saved state
21:39:31 [INFO] __main__: Starting network server …
21:39:31 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:39:31 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:39:31 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:39:31 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:39:31 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:39:31 [INFO] __main__: Starting game loop …
21:39:31 [INFO] __main__:   game loop running (1 s tick)
21:39:32 [INFO] websockets.server: connection open
21:39:32 [INFO] gameserver.network.server: Session registered: uid=-1
21:39:32 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 61575)
21:39:32 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:39:32 [INFO] gameserver.network.server: Session registered: uid=2
21:39:32 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:39:32 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
21:39:32 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:39:37 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
21:39:41 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:39:51 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:39:51 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:39:51 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:39:52 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
21:39:52 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:39:53 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:39:55 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:39:56 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:39:57 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:39:58 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:39:59 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:40:00 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:40:01 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:40:02 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:42:46 [INFO] __main__: Shutdown signal received — stopping …
21:42:47 [INFO] __main__: Shutting down …
21:42:47 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:42:47 [INFO] websockets.server: server closing
21:42:47 [INFO] gameserver.network.server: Session removed: uid=2
21:42:47 [INFO] websockets.server: server closed
21:42:47 [INFO] gameserver.network.server: WebSocket server stopped
21:42:47 [INFO] __main__:   WebSocket server stopped
21:42:47 [INFO] __main__:   debug dashboard stopped
21:42:47 [INFO] __main__:   database closed
21:42:47 [INFO] __main__:   goodbye
21:42:49 [INFO] __main__: === Game Server starting ===
21:42:49 [INFO] __main__: Loading configuration …
21:42:50 [INFO] __main__:   items:        210 loaded from config
21:42:50 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:42:50 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:42:50 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:42:50 [INFO] __main__:   game_config:  loaded
21:42:50 [INFO] __main__: Initializing persistence …
21:42:50 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:42:50 [INFO] __main__:   database:     connected (gameserver.db)
21:42:50 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:42:50 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:42:50 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:42:50 [INFO] __main__: Creating services …
21:42:50 [INFO] __main__:   upgrade_provider: 210 items registered
21:42:50 [INFO] __main__:   all services created
21:42:50 [INFO] __main__: Wiring event handlers …
21:42:50 [INFO] __main__:   event handlers registered
21:42:50 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:42:50 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:42:50 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:42:50 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:42:50 [INFO] __main__: Restored 2 empires from saved state
21:42:50 [INFO] __main__: Restored 1 attacks from saved state
21:42:50 [INFO] __main__: Starting network server …
21:42:50 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:42:50 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:42:50 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:42:50 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:42:50 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:42:50 [INFO] __main__: Starting game loop …
21:42:50 [INFO] __main__:   game loop running (1 s tick)
21:42:50 [INFO] websockets.server: connection open
21:42:50 [INFO] gameserver.network.server: Session registered: uid=-1
21:42:50 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57828)
21:42:50 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:42:50 [INFO] gameserver.network.server: Session registered: uid=2
21:42:50 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:43:00 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:43:10 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:43:10 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:43:10 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:43:10 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
21:43:18 [INFO] gameserver.network.server: Session removed: uid=2
21:43:18 [INFO] websockets.server: connection open
21:43:18 [INFO] gameserver.network.server: Session registered: uid=-2
21:43:18 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 57842)
21:43:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:43:18 [INFO] gameserver.network.server: Session registered: uid=2
21:43:18 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:43:18 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
21:43:18 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:43:18 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:43:19 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:43:20 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:46:13 [INFO] __main__: Shutdown signal received — stopping …
21:46:13 [INFO] __main__: Shutting down …
21:46:13 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:46:13 [INFO] websockets.server: server closing
21:46:13 [INFO] gameserver.network.server: Session removed: uid=2
21:46:13 [INFO] websockets.server: server closed
21:46:13 [INFO] gameserver.network.server: WebSocket server stopped
21:46:13 [INFO] __main__:   WebSocket server stopped
21:46:13 [INFO] __main__:   debug dashboard stopped
21:46:13 [INFO] __main__:   database closed
21:46:13 [INFO] __main__:   goodbye
21:46:15 [INFO] __main__: === Game Server starting ===
21:46:15 [INFO] __main__: Loading configuration …
21:46:15 [INFO] __main__:   items:        210 loaded from config
21:46:15 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:46:15 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:46:16 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:46:16 [INFO] __main__:   game_config:  loaded
21:46:16 [INFO] __main__: Initializing persistence …
21:46:16 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:46:16 [INFO] __main__:   database:     connected (gameserver.db)
21:46:16 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:46:16 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:46:16 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:46:16 [INFO] __main__: Creating services …
21:46:16 [INFO] __main__:   upgrade_provider: 210 items registered
21:46:16 [INFO] __main__:   all services created
21:46:16 [INFO] __main__: Wiring event handlers …
21:46:16 [INFO] __main__:   event handlers registered
21:46:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:46:16 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:46:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:46:16 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:46:16 [INFO] __main__: Restored 2 empires from saved state
21:46:16 [INFO] __main__: Restored 1 attacks from saved state
21:46:16 [INFO] __main__: Starting network server …
21:46:16 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:46:16 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:46:16 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:46:16 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:46:16 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:46:16 [INFO] __main__: Starting game loop …
21:46:16 [INFO] __main__:   game loop running (1 s tick)
21:46:17 [INFO] websockets.server: connection open
21:46:17 [INFO] gameserver.network.server: Session registered: uid=-1
21:46:17 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 49646)
21:46:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:46:17 [INFO] gameserver.network.server: Session registered: uid=2
21:46:17 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:46:20 [INFO] gameserver.network.server: Session removed: uid=2
21:46:20 [INFO] websockets.server: connection open
21:46:20 [INFO] gameserver.network.server: Session registered: uid=-2
21:46:20 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 49656)
21:46:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:46:20 [INFO] gameserver.network.server: Session registered: uid=2
21:46:20 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
21:46:20 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
21:46:20 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:46:26 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:46:29 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:46:29 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:46:29 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:46:29 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
21:46:30 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:46:31 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:46:32 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:46:33 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:46:34 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:46:35 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:46:36 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:46:37 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:46:38 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:46:39 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:50:33 [INFO] __main__: Shutdown signal received — stopping …
21:50:34 [INFO] __main__: Shutting down …
21:50:34 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
21:50:34 [INFO] websockets.server: server closing
21:50:34 [INFO] gameserver.network.server: Session removed: uid=2
21:50:34 [INFO] websockets.server: server closed
21:50:34 [INFO] gameserver.network.server: WebSocket server stopped
21:50:34 [INFO] __main__:   WebSocket server stopped
21:50:34 [INFO] __main__:   debug dashboard stopped
21:50:34 [INFO] __main__:   database closed
21:50:34 [INFO] __main__:   goodbye
21:50:35 [INFO] __main__: === Game Server starting ===
21:50:35 [INFO] __main__: Loading configuration …
21:50:36 [INFO] __main__:   items:        210 loaded from config
21:50:36 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
21:50:36 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
21:50:36 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
21:50:36 [INFO] __main__:   game_config:  loaded
21:50:36 [INFO] __main__: Initializing persistence …
21:50:36 [INFO] gameserver.persistence.database: Database connected: gameserver.db
21:50:36 [INFO] __main__:   database:     connected (gameserver.db)
21:50:36 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
21:50:36 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
21:50:36 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
21:50:36 [INFO] __main__: Creating services …
21:50:36 [INFO] __main__:   upgrade_provider: 210 items registered
21:50:36 [INFO] __main__:   all services created
21:50:36 [INFO] __main__: Wiring event handlers …
21:50:36 [INFO] __main__:   event handlers registered
21:50:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
21:50:36 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
21:50:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
21:50:36 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
21:50:36 [INFO] __main__: Restored 2 empires from saved state
21:50:36 [INFO] __main__: Restored 1 attacks from saved state
21:50:36 [INFO] __main__: Starting network server …
21:50:36 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
21:50:36 [INFO] websockets.server: server listening on 0.0.0.0:8765
21:50:36 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
21:50:36 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
21:50:36 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
21:50:36 [INFO] __main__: Starting game loop …
21:50:36 [INFO] __main__:   game loop running (1 s tick)
21:50:36 [INFO] websockets.server: connection open
21:50:36 [INFO] gameserver.network.server: Session registered: uid=-1
21:50:36 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50724)
21:50:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
21:50:36 [INFO] gameserver.network.server: Session registered: uid=2
21:50:36 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
21:50:36 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
21:50:36 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
21:50:42 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
21:50:46 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
21:50:49 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
21:50:49 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
21:50:49 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
21:50:49 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
21:50:50 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:50:51 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
21:50:52 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:50:53 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
21:50:54 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:50:55 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
21:50:56 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:50:57 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
21:50:58 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
21:50:59 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:10:50 [INFO] __main__: Shutdown signal received — stopping …
22:10:51 [INFO] __main__: Shutting down …
22:10:51 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:10:51 [INFO] websockets.server: server closing
22:10:51 [INFO] gameserver.network.server: Session removed: uid=2
22:10:51 [INFO] websockets.server: server closed
22:10:51 [INFO] gameserver.network.server: WebSocket server stopped
22:10:51 [INFO] __main__:   WebSocket server stopped
22:10:51 [INFO] __main__:   debug dashboard stopped
22:10:51 [INFO] __main__:   database closed
22:10:51 [INFO] __main__:   goodbye
22:10:53 [INFO] __main__: === Game Server starting ===
22:10:53 [INFO] __main__: Loading configuration …
22:10:53 [INFO] __main__:   items:        210 loaded from config
22:10:53 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:10:53 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:10:54 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:10:54 [INFO] __main__:   game_config:  loaded
22:10:54 [INFO] __main__: Initializing persistence …
22:10:54 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:10:54 [INFO] __main__:   database:     connected (gameserver.db)
22:10:54 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:10:54 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:10:54 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:10:54 [INFO] __main__: Creating services …
22:10:54 [INFO] __main__:   upgrade_provider: 210 items registered
22:10:54 [INFO] __main__:   all services created
22:10:54 [INFO] __main__: Wiring event handlers …
22:10:54 [INFO] __main__:   event handlers registered
22:10:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:10:54 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:10:54 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:10:54 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:10:54 [INFO] __main__: Restored 2 empires from saved state
22:10:54 [INFO] __main__: Restored 1 attacks from saved state
22:10:54 [INFO] __main__: Starting network server …
22:10:54 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:10:54 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:10:54 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:10:54 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:10:54 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:10:54 [INFO] __main__: Starting game loop …
22:10:54 [INFO] __main__:   game loop running (1 s tick)
22:10:54 [INFO] websockets.server: connection open
22:10:54 [INFO] gameserver.network.server: Session registered: uid=-1
22:10:54 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62048)
22:10:54 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:10:54 [INFO] gameserver.network.server: Session registered: uid=2
22:10:54 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:10:58 [INFO] gameserver.network.server: Session removed: uid=2
22:10:58 [INFO] websockets.server: connection open
22:10:58 [INFO] gameserver.network.server: Session registered: uid=-2
22:10:58 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62058)
22:10:58 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:10:58 [INFO] gameserver.network.server: Session registered: uid=2
22:10:58 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:10:58 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
22:10:58 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:11:04 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:11:07 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:11:07 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:11:07 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:11:07 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:11:08 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
22:11:09 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
22:11:10 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:11:11 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:11:12 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:11:13 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:11:14 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:11:15 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:11:16 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:11:17 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:13:09 [INFO] __main__: Shutdown signal received — stopping …
22:13:10 [INFO] __main__: Shutting down …
22:13:10 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:13:10 [INFO] websockets.server: server closing
22:13:10 [INFO] gameserver.network.server: Session removed: uid=2
22:13:10 [INFO] websockets.server: server closed
22:13:10 [INFO] gameserver.network.server: WebSocket server stopped
22:13:10 [INFO] __main__:   WebSocket server stopped
22:13:10 [INFO] __main__:   debug dashboard stopped
22:13:10 [INFO] __main__:   database closed
22:13:10 [INFO] __main__:   goodbye
22:13:11 [INFO] __main__: === Game Server starting ===
22:13:11 [INFO] __main__: Loading configuration …
22:13:12 [INFO] __main__:   items:        210 loaded from config
22:13:12 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:13:12 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:13:12 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:13:12 [INFO] __main__:   game_config:  loaded
22:13:12 [INFO] __main__: Initializing persistence …
22:13:12 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:13:12 [INFO] __main__:   database:     connected (gameserver.db)
22:13:12 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:13:12 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:13:12 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:13:12 [INFO] __main__: Creating services …
22:13:12 [INFO] __main__:   upgrade_provider: 210 items registered
22:13:12 [INFO] __main__:   all services created
22:13:12 [INFO] __main__: Wiring event handlers …
22:13:12 [INFO] __main__:   event handlers registered
22:13:12 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:13:12 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:13:12 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:13:12 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:13:12 [INFO] __main__: Restored 2 empires from saved state
22:13:12 [INFO] __main__: Restored 1 attacks from saved state
22:13:12 [INFO] __main__: Starting network server …
22:13:12 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:13:12 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:13:12 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:13:12 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:13:12 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:13:12 [INFO] __main__: Starting game loop …
22:13:12 [INFO] __main__:   game loop running (1 s tick)
22:13:13 [INFO] websockets.server: connection open
22:13:13 [INFO] gameserver.network.server: Session registered: uid=-1
22:13:13 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 62116)
22:13:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:13:13 [INFO] gameserver.network.server: Session registered: uid=2
22:13:13 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:13:22 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:13:25 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:13:25 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:13:25 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:13:25 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:13:28 [INFO] gameserver.network.server: Session removed: uid=2
22:13:28 [INFO] websockets.server: connection open
22:13:28 [INFO] gameserver.network.server: Session registered: uid=-2
22:13:28 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 62125)
22:13:28 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:13:28 [INFO] gameserver.network.server: Session registered: uid=2
22:13:28 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:13:28 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
22:13:28 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:13:28 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:13:29 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:13:30 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:13:31 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:13:32 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:13:33 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:13:34 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:13:35 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:23:20 [INFO] __main__: Shutdown signal received — stopping …
22:23:21 [INFO] __main__: Shutting down …
22:23:21 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:23:21 [INFO] websockets.server: server closing
22:23:21 [INFO] gameserver.network.server: Session removed: uid=2
22:23:21 [INFO] websockets.server: server closed
22:23:21 [INFO] gameserver.network.server: WebSocket server stopped
22:23:21 [INFO] __main__:   WebSocket server stopped
22:23:21 [INFO] __main__:   debug dashboard stopped
22:23:21 [INFO] __main__:   database closed
22:23:21 [INFO] __main__:   goodbye
22:23:22 [INFO] __main__: === Game Server starting ===
22:23:22 [INFO] __main__: Loading configuration …
22:23:23 [INFO] __main__:   items:        210 loaded from config
22:23:23 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:23:23 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:23:23 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:23:23 [INFO] __main__:   game_config:  loaded
22:23:23 [INFO] __main__: Initializing persistence …
22:23:23 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:23:23 [INFO] __main__:   database:     connected (gameserver.db)
22:23:23 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:23:23 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:23:23 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:23:23 [INFO] __main__: Creating services …
22:23:23 [INFO] __main__:   upgrade_provider: 210 items registered
22:23:23 [INFO] __main__:   all services created
22:23:23 [INFO] __main__: Wiring event handlers …
22:23:23 [INFO] __main__:   event handlers registered
22:23:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:23:23 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:23:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:23:23 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:23:23 [INFO] __main__: Restored 2 empires from saved state
22:23:23 [INFO] __main__: Restored 1 attacks from saved state
22:23:23 [INFO] __main__: Starting network server …
22:23:23 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:23:23 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:23:23 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:23:23 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:23:23 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:23:23 [INFO] __main__: Starting game loop …
22:23:23 [INFO] __main__:   game loop running (1 s tick)
22:23:24 [INFO] websockets.server: connection open
22:23:24 [INFO] gameserver.network.server: Session registered: uid=-1
22:23:24 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 50092)
22:23:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:23:24 [INFO] gameserver.network.server: Session registered: uid=2
22:23:24 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:23:25 [INFO] gameserver.network.server: Session removed: uid=2
22:23:25 [INFO] websockets.server: connection open
22:23:25 [INFO] gameserver.network.server: Session registered: uid=-2
22:23:25 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 50097)
22:23:25 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:23:25 [INFO] gameserver.network.server: Session registered: uid=2
22:23:25 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:23:25 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
22:23:25 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:23:33 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:23:36 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:23:36 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:23:36 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:23:36 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:23:37 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
22:23:38 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
22:23:39 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:23:40 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:23:41 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:23:42 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:23:43 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:23:44 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:23:45 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:23:46 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:27:20 [INFO] __main__: Shutdown signal received — stopping …
22:27:20 [INFO] __main__: Shutting down …
22:27:20 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:27:20 [INFO] websockets.server: server closing
22:27:20 [INFO] gameserver.network.server: Session removed: uid=2
22:27:20 [INFO] websockets.server: server closed
22:27:20 [INFO] gameserver.network.server: WebSocket server stopped
22:27:20 [INFO] __main__:   WebSocket server stopped
22:27:20 [INFO] __main__:   debug dashboard stopped
22:27:20 [INFO] __main__:   database closed
22:27:20 [INFO] __main__:   goodbye
22:27:22 [INFO] __main__: === Game Server starting ===
22:27:22 [INFO] __main__: Loading configuration …
22:27:23 [INFO] __main__:   items:        210 loaded from config
22:27:23 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:27:23 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:27:23 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:27:23 [INFO] __main__:   game_config:  loaded
22:27:23 [INFO] __main__: Initializing persistence …
22:27:23 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:27:23 [INFO] __main__:   database:     connected (gameserver.db)
22:27:23 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:27:23 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:27:23 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:27:23 [INFO] __main__: Creating services …
22:27:23 [INFO] __main__:   upgrade_provider: 210 items registered
22:27:23 [INFO] __main__:   all services created
22:27:23 [INFO] __main__: Wiring event handlers …
22:27:23 [INFO] __main__:   event handlers registered
22:27:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:27:23 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:27:23 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:27:23 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:27:23 [INFO] __main__: Restored 2 empires from saved state
22:27:23 [INFO] __main__: Restored 1 attacks from saved state
22:27:23 [INFO] __main__: Starting network server …
22:27:23 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:27:23 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:27:23 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:27:23 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:27:23 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:27:23 [INFO] __main__: Starting game loop …
22:27:23 [INFO] __main__:   game loop running (1 s tick)
22:27:23 [INFO] websockets.server: connection open
22:27:23 [INFO] gameserver.network.server: Session registered: uid=-1
22:27:23 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 63012)
22:27:23 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:27:23 [INFO] gameserver.network.server: Session registered: uid=2
22:27:23 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:27:26 [INFO] gameserver.network.server: Session removed: uid=2
22:27:27 [INFO] websockets.server: connection open
22:27:27 [INFO] gameserver.network.server: Session registered: uid=-2
22:27:27 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 63020)
22:27:27 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:27:27 [INFO] gameserver.network.server: Session registered: uid=2
22:27:27 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:27:27 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
22:27:27 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:27:33 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:27:36 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:27:36 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:27:36 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:27:36 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:27:37 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
22:27:38 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
22:27:39 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:27:40 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:27:41 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:27:42 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:27:43 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:27:44 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:27:45 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:27:46 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:31:58 [INFO] __main__: Shutdown signal received — stopping …
22:31:59 [INFO] __main__: Shutting down …
22:31:59 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:31:59 [INFO] websockets.server: server closing
22:31:59 [INFO] gameserver.network.server: Session removed: uid=2
22:31:59 [INFO] websockets.server: server closed
22:31:59 [INFO] gameserver.network.server: WebSocket server stopped
22:31:59 [INFO] __main__:   WebSocket server stopped
22:31:59 [INFO] __main__:   debug dashboard stopped
22:31:59 [INFO] __main__:   database closed
22:31:59 [INFO] __main__:   goodbye
22:32:00 [INFO] __main__: === Game Server starting ===
22:32:00 [INFO] __main__: Loading configuration …
22:32:01 [INFO] __main__:   items:        210 loaded from config
22:32:01 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:32:01 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:32:01 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:32:01 [INFO] __main__:   game_config:  loaded
22:32:01 [INFO] __main__: Initializing persistence …
22:32:01 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:32:01 [INFO] __main__:   database:     connected (gameserver.db)
22:32:01 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:32:01 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:32:01 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:32:01 [INFO] __main__: Creating services …
22:32:01 [INFO] __main__:   upgrade_provider: 210 items registered
22:32:01 [INFO] __main__:   all services created
22:32:01 [INFO] __main__: Wiring event handlers …
22:32:01 [INFO] __main__:   event handlers registered
22:32:01 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:32:01 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:32:01 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:32:01 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:32:01 [INFO] __main__: Restored 2 empires from saved state
22:32:01 [INFO] __main__: Restored 1 attacks from saved state
22:32:01 [INFO] __main__: Starting network server …
22:32:01 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:32:01 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:32:01 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:32:01 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:32:01 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:32:01 [INFO] __main__: Starting game loop …
22:32:01 [INFO] __main__:   game loop running (1 s tick)
22:32:01 [INFO] websockets.server: connection open
22:32:01 [INFO] gameserver.network.server: Session registered: uid=-1
22:32:01 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56845)
22:32:01 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:32:01 [INFO] gameserver.network.server: Session registered: uid=2
22:32:01 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:32:01 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
22:32:01 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:32:07 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
22:32:10 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
22:32:11 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:32:12 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
22:32:12 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:32:14 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:32:14 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:32:14 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:32:14 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:32:15 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
22:32:16 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1 spawn_dict_keys=[('attacker_100', 1)]
22:32:17 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:32:18 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2 spawn_dict_keys=[('attacker_100', 1)]
22:32:19 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:32:20 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3 spawn_dict_keys=[('attacker_100', 1)]
22:32:21 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:32:22 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4 spawn_dict_keys=[('attacker_100', 1)]
22:32:23 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:32:24 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5 spawn_dict_keys=[('attacker_100', 1)]
22:41:02 [INFO] __main__: Shutdown signal received — stopping …
22:41:03 [INFO] __main__: Shutting down …
22:41:03 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:41:03 [INFO] websockets.server: server closing
22:41:03 [INFO] gameserver.network.server: Session removed: uid=2
22:41:03 [INFO] websockets.server: server closed
22:41:03 [INFO] gameserver.network.server: WebSocket server stopped
22:41:03 [INFO] __main__:   WebSocket server stopped
22:41:03 [INFO] __main__:   debug dashboard stopped
22:41:03 [INFO] __main__:   database closed
22:41:03 [INFO] __main__:   goodbye
22:41:04 [INFO] __main__: === Game Server starting ===
22:41:04 [INFO] __main__: Loading configuration …
22:41:05 [INFO] __main__:   items:        210 loaded from config
22:41:05 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:41:05 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:41:05 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:41:05 [INFO] __main__:   game_config:  loaded
22:41:05 [INFO] __main__: Initializing persistence …
22:41:05 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:41:05 [INFO] __main__:   database:     connected (gameserver.db)
22:41:05 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:41:05 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:41:05 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:41:05 [INFO] __main__: Creating services …
22:41:05 [INFO] __main__:   upgrade_provider: 210 items registered
22:41:05 [INFO] __main__:   all services created
22:41:05 [INFO] __main__: Wiring event handlers …
22:41:05 [INFO] __main__:   event handlers registered
22:41:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:41:05 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:41:05 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:41:05 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:41:05 [INFO] __main__: Restored 2 empires from saved state
22:41:05 [INFO] __main__: Restored 1 attacks from saved state
22:41:05 [INFO] __main__: Starting network server …
22:41:05 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:41:05 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:41:05 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:41:05 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:41:05 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:41:05 [INFO] __main__: Starting game loop …
22:41:05 [INFO] __main__:   game loop running (1 s tick)
22:41:06 [INFO] websockets.server: connection open
22:41:06 [INFO] gameserver.network.server: Session registered: uid=-1
22:41:06 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51105)
22:41:06 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:41:06 [INFO] gameserver.network.server: Session registered: uid=2
22:41:06 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:41:15 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:41:18 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:41:18 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:41:18 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:41:18 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:41:44 [INFO] __main__: Shutdown signal received — stopping …
22:41:44 [INFO] __main__: Shutting down …
22:41:45 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:41:45 [INFO] websockets.server: server closing
22:41:45 [INFO] gameserver.network.server: Session removed: uid=2
22:41:45 [INFO] websockets.server: server closed
22:41:45 [INFO] gameserver.network.server: WebSocket server stopped
22:41:45 [INFO] __main__:   WebSocket server stopped
22:41:45 [INFO] __main__:   debug dashboard stopped
22:41:45 [INFO] __main__:   database closed
22:41:45 [INFO] __main__:   goodbye
22:41:47 [INFO] __main__: === Game Server starting ===
22:41:47 [INFO] __main__: Loading configuration …
22:41:47 [INFO] __main__:   items:        210 loaded from config
22:41:48 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:41:48 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:41:48 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:41:48 [INFO] __main__:   game_config:  loaded
22:41:48 [INFO] __main__: Initializing persistence …
22:41:48 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:41:48 [INFO] __main__:   database:     connected (gameserver.db)
22:41:48 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:41:48 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:41:48 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:41:48 [INFO] __main__: Creating services …
22:41:48 [INFO] __main__:   upgrade_provider: 210 items registered
22:41:48 [INFO] __main__:   all services created
22:41:48 [INFO] __main__: Wiring event handlers …
22:41:48 [INFO] __main__:   event handlers registered
22:41:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:41:48 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:41:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:41:48 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:41:48 [INFO] __main__: Restored 2 empires from saved state
22:41:48 [INFO] __main__: Restored 1 attacks from saved state
22:41:48 [INFO] __main__: Starting network server …
22:41:48 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:41:48 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:41:48 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:41:48 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:41:48 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:41:48 [INFO] __main__: Starting game loop …
22:41:48 [INFO] __main__:   game loop running (1 s tick)
22:41:48 [INFO] websockets.server: connection open
22:41:48 [INFO] gameserver.network.server: Session registered: uid=-1
22:41:48 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56398)
22:41:48 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:41:48 [INFO] gameserver.network.server: Session registered: uid=2
22:41:48 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:41:49 [INFO] gameserver.network.server: Session removed: uid=2
22:41:49 [INFO] websockets.server: connection open
22:41:49 [INFO] gameserver.network.server: Session registered: uid=-2
22:41:49 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 56402)
22:41:49 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:41:49 [INFO] gameserver.network.server: Session registered: uid=2
22:41:49 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:41:49 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
22:41:49 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:41:54 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
22:41:58 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:42:01 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:42:01 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:42:01 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:42:01 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:42:02 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:42:03 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:42:04 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:42:05 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:42:06 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:42:07 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:42:08 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:42:09 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:42:10 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:42:11 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:46:24 [INFO] gameserver.network.server: Session removed: uid=2
22:46:24 [INFO] websockets.server: connection open
22:46:24 [INFO] gameserver.network.server: Session registered: uid=-3
22:46:24 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 58463)
22:46:24 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:46:24 [INFO] gameserver.network.server: Session registered: uid=2
22:46:24 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
22:46:24 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
22:46:24 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:46:33 [INFO] __main__: Shutdown signal received — stopping …
22:46:33 [INFO] __main__: Shutting down …
22:46:33 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:46:33 [INFO] websockets.server: server closing
22:46:33 [INFO] gameserver.network.server: Session removed: uid=2
22:46:33 [INFO] websockets.server: server closed
22:46:33 [INFO] gameserver.network.server: WebSocket server stopped
22:46:33 [INFO] __main__:   WebSocket server stopped
22:46:33 [INFO] __main__:   debug dashboard stopped
22:46:33 [INFO] __main__:   database closed
22:46:33 [INFO] __main__:   goodbye
22:46:34 [INFO] __main__: === Game Server starting ===
22:46:34 [INFO] __main__: Loading configuration …
22:46:35 [INFO] __main__:   items:        210 loaded from config
22:46:35 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:46:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:46:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:46:35 [INFO] __main__:   game_config:  loaded
22:46:35 [INFO] __main__: Initializing persistence …
22:46:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:46:35 [INFO] __main__:   database:     connected (gameserver.db)
22:46:35 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:46:35 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:46:35 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:46:35 [INFO] __main__: Creating services …
22:46:35 [INFO] __main__:   upgrade_provider: 210 items registered
22:46:35 [INFO] __main__:   all services created
22:46:35 [INFO] __main__: Wiring event handlers …
22:46:35 [INFO] __main__:   event handlers registered
22:46:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:46:35 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:46:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:46:35 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:46:35 [INFO] __main__: Restored 2 empires from saved state
22:46:35 [INFO] __main__: Restored 1 attacks from saved state
22:46:35 [INFO] __main__: Starting network server …
22:46:35 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:46:35 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:46:35 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:46:35 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:46:35 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:46:35 [INFO] __main__: Starting game loop …
22:46:35 [INFO] __main__:   game loop running (1 s tick)
22:46:36 [INFO] websockets.server: connection open
22:46:36 [INFO] gameserver.network.server: Session registered: uid=-1
22:46:36 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 53074)
22:46:36 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:46:36 [INFO] gameserver.network.server: Session registered: uid=2
22:46:36 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:46:39 [INFO] gameserver.network.server: Session removed: uid=2
22:46:39 [INFO] websockets.server: connection open
22:46:39 [INFO] gameserver.network.server: Session registered: uid=-2
22:46:39 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 53077)
22:46:39 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:46:39 [INFO] gameserver.network.server: Session registered: uid=2
22:46:39 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:46:39 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
22:46:39 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:46:45 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:46:48 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:46:48 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:46:48 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:46:48 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:46:49 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:46:50 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:46:51 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:46:52 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:46:53 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:46:54 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:46:55 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:46:56 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:46:57 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:46:58 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:50:17 [INFO] __main__: Shutdown signal received — stopping …
22:50:18 [INFO] __main__: Shutting down …
22:50:18 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:50:18 [INFO] websockets.server: server closing
22:50:18 [INFO] gameserver.network.server: Session removed: uid=2
22:50:18 [INFO] websockets.server: server closed
22:50:18 [INFO] gameserver.network.server: WebSocket server stopped
22:50:18 [INFO] __main__:   WebSocket server stopped
22:50:18 [INFO] __main__:   debug dashboard stopped
22:50:18 [INFO] __main__:   database closed
22:50:18 [INFO] __main__:   goodbye
22:50:20 [INFO] __main__: === Game Server starting ===
22:50:20 [INFO] __main__: Loading configuration …
22:50:21 [INFO] __main__:   items:        210 loaded from config
22:50:21 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:50:21 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:50:21 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:50:21 [INFO] __main__:   game_config:  loaded
22:50:21 [INFO] __main__: Initializing persistence …
22:50:21 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:50:21 [INFO] __main__:   database:     connected (gameserver.db)
22:50:21 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:50:21 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:50:21 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:50:21 [INFO] __main__: Creating services …
22:50:21 [INFO] __main__:   upgrade_provider: 210 items registered
22:50:21 [INFO] __main__:   all services created
22:50:21 [INFO] __main__: Wiring event handlers …
22:50:21 [INFO] __main__:   event handlers registered
22:50:21 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:50:21 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:50:21 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:50:21 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:50:21 [INFO] __main__: Restored 2 empires from saved state
22:50:21 [INFO] __main__: Restored 1 attacks from saved state
22:50:21 [INFO] __main__: Starting network server …
22:50:21 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:50:21 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:50:21 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:50:21 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:50:21 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:50:21 [INFO] __main__: Starting game loop …
22:50:21 [INFO] __main__:   game loop running (1 s tick)
22:50:21 [INFO] websockets.server: connection open
22:50:21 [INFO] gameserver.network.server: Session registered: uid=-1
22:50:21 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 51442)
22:50:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:50:21 [INFO] gameserver.network.server: Session registered: uid=2
22:50:21 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:50:21 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
22:50:21 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:50:27 [ERROR] websockets.server: opening handshake failed
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 138, in parse
    request_line = yield from parse_line(read_line)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 309, in parse_line
    line = yield from read_line(MAX_LINE_LENGTH)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/streams.py", line 46, in read_line
    raise EOFError(f"stream ends after {p} bytes, before end of line")
EOFError: stream ends after 0 bytes, before end of line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/server.py", line 545, in parse
    request = yield from Request.parse(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/http11.py", line 140, in parse
    raise EOFError("connection closed while reading HTTP request line") from exc
EOFError: connection closed while reading HTTP request line

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 356, in conn_handler
    await connection.handshake(
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/asyncio/server.py", line 207, in handshake
    raise self.protocol.handshake_exc
websockets.exceptions.InvalidMessage: did not receive a valid HTTP request
22:50:31 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:50:34 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:50:34 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:50:34 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:50:34 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:50:35 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:50:36 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:50:37 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:50:38 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:50:39 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:50:40 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:50:41 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:50:42 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:50:43 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:50:44 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:51:41 [INFO] __main__: Shutdown signal received — stopping …
22:51:42 [INFO] __main__: Shutting down …
22:51:42 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:51:42 [INFO] websockets.server: server closing
22:51:42 [INFO] gameserver.network.server: Session removed: uid=2
22:51:42 [INFO] websockets.server: server closed
22:51:42 [INFO] gameserver.network.server: WebSocket server stopped
22:51:42 [INFO] __main__:   WebSocket server stopped
22:51:42 [INFO] __main__:   debug dashboard stopped
22:51:42 [INFO] __main__:   database closed
22:51:42 [INFO] __main__:   goodbye
22:51:44 [INFO] __main__: === Game Server starting ===
22:51:44 [INFO] __main__: Loading configuration …
22:51:44 [INFO] __main__:   items:        210 loaded from config
22:51:45 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:51:45 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:51:45 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:51:45 [INFO] __main__:   game_config:  loaded
22:51:45 [INFO] __main__: Initializing persistence …
22:51:45 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:51:45 [INFO] __main__:   database:     connected (gameserver.db)
22:51:45 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:51:45 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:51:45 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:51:45 [INFO] __main__: Creating services …
22:51:45 [INFO] __main__:   upgrade_provider: 210 items registered
22:51:45 [INFO] __main__:   all services created
22:51:45 [INFO] __main__: Wiring event handlers …
22:51:45 [INFO] __main__:   event handlers registered
22:51:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:51:45 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:51:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:51:45 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:51:45 [INFO] __main__: Restored 2 empires from saved state
22:51:45 [INFO] __main__: Restored 1 attacks from saved state
22:51:45 [INFO] __main__: Starting network server …
22:51:45 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:51:45 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:51:45 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:51:45 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:51:45 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:51:45 [INFO] __main__: Starting game loop …
22:51:45 [INFO] __main__:   game loop running (1 s tick)
22:51:45 [INFO] websockets.server: connection open
22:51:45 [INFO] gameserver.network.server: Session registered: uid=-1
22:51:45 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 64027)
22:51:45 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:51:45 [INFO] gameserver.network.server: Session registered: uid=2
22:51:45 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:51:55 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:51:58 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:51:58 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:51:58 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:51:58 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:52:03 [INFO] gameserver.network.server: Session removed: uid=2
22:52:03 [INFO] websockets.server: connection open
22:52:03 [INFO] gameserver.network.server: Session registered: uid=-2
22:52:03 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 56465)
22:52:03 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:52:03 [INFO] gameserver.network.server: Session registered: uid=2
22:52:03 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:52:03 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
22:52:03 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:52:03 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:52:04 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:52:05 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:52:06 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:52:07 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:52:08 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:53:08 [INFO] gameserver.network.server: Session removed: uid=2
22:53:08 [INFO] websockets.server: connection open
22:53:08 [INFO] gameserver.network.server: Session registered: uid=-3
22:53:08 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 56271)
22:53:08 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:53:08 [INFO] gameserver.network.server: Session registered: uid=2
22:53:08 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
22:53:08 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
22:53:08 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:53:11 [INFO] __main__: Shutdown signal received — stopping …
22:53:12 [INFO] __main__: Shutting down …
22:53:12 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:53:12 [INFO] websockets.server: server closing
22:53:12 [INFO] gameserver.network.server: Session removed: uid=2
22:53:12 [INFO] websockets.server: server closed
22:53:12 [INFO] gameserver.network.server: WebSocket server stopped
22:53:12 [INFO] __main__:   WebSocket server stopped
22:53:12 [INFO] __main__:   debug dashboard stopped
22:53:12 [INFO] __main__:   database closed
22:53:12 [INFO] __main__:   goodbye
22:53:13 [INFO] __main__: === Game Server starting ===
22:53:13 [INFO] __main__: Loading configuration …
22:53:14 [INFO] __main__:   items:        210 loaded from config
22:53:14 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:53:14 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:53:14 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:53:14 [INFO] __main__:   game_config:  loaded
22:53:14 [INFO] __main__: Initializing persistence …
22:53:14 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:53:14 [INFO] __main__:   database:     connected (gameserver.db)
22:53:14 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:53:14 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:53:14 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:53:14 [INFO] __main__: Creating services …
22:53:14 [INFO] __main__:   upgrade_provider: 210 items registered
22:53:14 [INFO] __main__:   all services created
22:53:14 [INFO] __main__: Wiring event handlers …
22:53:14 [INFO] __main__:   event handlers registered
22:53:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:53:14 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:53:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:53:14 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:53:14 [INFO] __main__: Restored 2 empires from saved state
22:53:14 [INFO] __main__: Restored 1 attacks from saved state
22:53:14 [INFO] __main__: Starting network server …
22:53:14 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:53:14 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:53:14 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:53:14 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:53:14 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:53:14 [INFO] __main__: Starting game loop …
22:53:14 [INFO] __main__:   game loop running (1 s tick)
22:53:15 [INFO] websockets.server: connection open
22:53:15 [INFO] gameserver.network.server: Session registered: uid=-1
22:53:15 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 56277)
22:53:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:53:15 [INFO] gameserver.network.server: Session registered: uid=2
22:53:15 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:53:16 [INFO] gameserver.network.server: Session removed: uid=2
22:53:16 [INFO] websockets.server: connection open
22:53:16 [INFO] gameserver.network.server: Session registered: uid=-2
22:53:16 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 56280)
22:53:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:53:16 [INFO] gameserver.network.server: Session registered: uid=2
22:53:16 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:53:24 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:53:27 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:53:27 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:53:27 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:53:27 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:53:27 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
22:53:27 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:53:27 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:53:28 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:53:29 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:53:30 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:53:31 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:53:32 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:53:33 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:53:34 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:53:35 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:53:36 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:53:37 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:54:00 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
22:54:40 [INFO] __main__: Shutdown signal received — stopping …
22:54:41 [INFO] __main__: Shutting down …
22:54:41 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:54:41 [INFO] websockets.server: server closing
22:54:41 [INFO] gameserver.network.server: Session removed: uid=2
22:54:41 [INFO] websockets.server: server closed
22:54:41 [INFO] gameserver.network.server: WebSocket server stopped
22:54:41 [INFO] __main__:   WebSocket server stopped
22:54:41 [INFO] __main__:   debug dashboard stopped
22:54:41 [INFO] __main__:   database closed
22:54:41 [INFO] __main__:   goodbye
22:54:42 [INFO] __main__: === Game Server starting ===
22:54:42 [INFO] __main__: Loading configuration …
22:54:43 [INFO] __main__:   items:        210 loaded from config
22:54:43 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:54:43 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:54:43 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:54:43 [INFO] __main__:   game_config:  loaded
22:54:43 [INFO] __main__: Initializing persistence …
22:54:43 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:54:43 [INFO] __main__:   database:     connected (gameserver.db)
22:54:43 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:54:43 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:54:43 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:54:43 [INFO] __main__: Creating services …
22:54:43 [INFO] __main__:   upgrade_provider: 210 items registered
22:54:43 [INFO] __main__:   all services created
22:54:43 [INFO] __main__: Wiring event handlers …
22:54:43 [INFO] __main__:   event handlers registered
22:54:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:54:43 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:54:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:54:43 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:54:43 [INFO] __main__: Restored 2 empires from saved state
22:54:43 [INFO] __main__: Restored 1 attacks from saved state
22:54:43 [INFO] __main__: Starting network server …
22:54:43 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:54:43 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:54:43 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:54:43 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:54:43 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:54:43 [INFO] __main__: Starting game loop …
22:54:43 [INFO] __main__:   game loop running (1 s tick)
22:54:44 [INFO] websockets.server: connection open
22:54:44 [INFO] gameserver.network.server: Session registered: uid=-1
22:54:44 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59604)
22:54:44 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:54:44 [INFO] gameserver.network.server: Session registered: uid=2
22:54:44 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:54:45 [INFO] __main__: Shutdown signal received — stopping …
22:54:45 [INFO] __main__: Shutting down …
22:54:45 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:54:45 [INFO] websockets.server: server closing
22:54:45 [INFO] gameserver.network.server: Session removed: uid=2
22:54:45 [INFO] websockets.server: server closed
22:54:45 [INFO] gameserver.network.server: WebSocket server stopped
22:54:45 [INFO] __main__:   WebSocket server stopped
22:54:45 [INFO] __main__:   debug dashboard stopped
22:54:45 [INFO] __main__:   database closed
22:54:45 [INFO] __main__:   goodbye
22:54:47 [INFO] __main__: === Game Server starting ===
22:54:47 [INFO] __main__: Loading configuration …
22:54:48 [INFO] __main__:   items:        210 loaded from config
22:54:48 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:54:48 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:54:48 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:54:48 [INFO] __main__:   game_config:  loaded
22:54:48 [INFO] __main__: Initializing persistence …
22:54:48 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:54:48 [INFO] __main__:   database:     connected (gameserver.db)
22:54:48 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:54:48 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:54:48 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:54:48 [INFO] __main__: Creating services …
22:54:48 [INFO] __main__:   upgrade_provider: 210 items registered
22:54:48 [INFO] __main__:   all services created
22:54:48 [INFO] __main__: Wiring event handlers …
22:54:48 [INFO] __main__:   event handlers registered
22:54:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:54:48 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:54:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:54:48 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:54:48 [INFO] __main__: Restored 2 empires from saved state
22:54:48 [INFO] __main__: Restored 1 attacks from saved state
22:54:48 [INFO] __main__: Starting network server …
22:54:48 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:54:48 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:54:48 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:54:48 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:54:48 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:54:48 [INFO] __main__: Starting game loop …
22:54:48 [INFO] __main__:   game loop running (1 s tick)
22:54:48 [INFO] websockets.server: connection open
22:54:48 [INFO] gameserver.network.server: Session registered: uid=-1
22:54:48 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59609)
22:54:48 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:54:48 [INFO] gameserver.network.server: Session registered: uid=2
22:54:48 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:54:58 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:55:00 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
22:55:00 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:55:01 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:55:01 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:55:01 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:55:01 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:55:02 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=2 critter_pointer=1
22:55:03 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=2 critter_pointer=1
22:55:04 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=2 critter_pointer=2
22:55:05 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=2 critter_pointer=2
22:55:06 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=2 critter_pointer=3
22:55:07 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=2 critter_pointer=3
22:55:22 [INFO] __main__: Shutdown signal received — stopping …
22:55:23 [INFO] __main__: Shutting down …
22:55:23 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:55:23 [INFO] websockets.server: server closing
22:55:23 [INFO] gameserver.network.server: Session removed: uid=2
22:55:23 [INFO] websockets.server: server closed
22:55:23 [INFO] gameserver.network.server: WebSocket server stopped
22:55:23 [INFO] __main__:   WebSocket server stopped
22:55:23 [INFO] __main__:   debug dashboard stopped
22:55:23 [INFO] __main__:   database closed
22:55:23 [INFO] __main__:   goodbye
22:55:24 [INFO] __main__: === Game Server starting ===
22:55:24 [INFO] __main__: Loading configuration …
22:55:25 [INFO] __main__:   items:        210 loaded from config
22:55:25 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:55:25 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:55:25 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:55:25 [INFO] __main__:   game_config:  loaded
22:55:25 [INFO] __main__: Initializing persistence …
22:55:25 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:55:25 [INFO] __main__:   database:     connected (gameserver.db)
22:55:25 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:55:25 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:55:25 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:55:25 [INFO] __main__: Creating services …
22:55:25 [INFO] __main__:   upgrade_provider: 210 items registered
22:55:25 [INFO] __main__:   all services created
22:55:25 [INFO] __main__: Wiring event handlers …
22:55:25 [INFO] __main__:   event handlers registered
22:55:25 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:55:25 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:55:25 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:55:25 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:55:25 [INFO] __main__: Restored 2 empires from saved state
22:55:25 [INFO] __main__: Restored 1 attacks from saved state
22:55:25 [INFO] __main__: Starting network server …
22:55:25 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:55:25 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:55:25 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:55:25 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:55:25 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:55:25 [INFO] __main__: Starting game loop …
22:55:25 [INFO] __main__:   game loop running (1 s tick)
22:55:26 [INFO] websockets.server: connection open
22:55:26 [INFO] gameserver.network.server: Session registered: uid=-1
22:55:26 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55547)
22:55:26 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:55:26 [INFO] gameserver.network.server: Session registered: uid=2
22:55:26 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:55:28 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
22:55:35 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:55:38 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:55:38 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:55:38 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:55:38 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:55:38 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
22:55:38 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:55:38 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:55:39 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:55:40 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:55:41 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:55:42 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:55:43 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:55:44 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:55:45 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:55:46 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:55:47 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:55:48 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:55:49 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:55:50 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:55:51 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:55:52 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:55:53 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:55:54 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=1
22:55:55 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=1
22:55:56 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=2
22:55:57 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=2
22:55:58 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=3
22:55:59 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=3
22:57:39 [INFO] __main__: Shutdown signal received — stopping …
22:57:39 [INFO] __main__: Shutting down …
22:57:39 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:57:39 [INFO] websockets.server: server closing
22:57:39 [INFO] gameserver.network.server: Session removed: uid=2
22:57:39 [INFO] websockets.server: server closed
22:57:39 [INFO] gameserver.network.server: WebSocket server stopped
22:57:39 [INFO] __main__:   WebSocket server stopped
22:57:39 [INFO] __main__:   debug dashboard stopped
22:57:39 [INFO] __main__:   database closed
22:57:39 [INFO] __main__:   goodbye
22:57:41 [INFO] __main__: === Game Server starting ===
22:57:41 [INFO] __main__: Loading configuration …
22:57:42 [INFO] __main__:   items:        210 loaded from config
22:57:42 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:57:42 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:57:42 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:57:42 [INFO] __main__:   game_config:  loaded
22:57:42 [INFO] __main__: Initializing persistence …
22:57:42 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:57:42 [INFO] __main__:   database:     connected (gameserver.db)
22:57:42 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:57:42 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:57:42 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:57:42 [INFO] __main__: Creating services …
22:57:42 [INFO] __main__:   upgrade_provider: 210 items registered
22:57:42 [INFO] __main__:   all services created
22:57:42 [INFO] __main__: Wiring event handlers …
22:57:42 [INFO] __main__:   event handlers registered
22:57:42 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:57:42 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:57:42 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:57:42 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:57:42 [INFO] __main__: Restored 2 empires from saved state
22:57:42 [INFO] __main__: Restored 1 attacks from saved state
22:57:42 [INFO] __main__: Starting network server …
22:57:42 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:57:42 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:57:42 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:57:42 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:57:42 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:57:42 [INFO] __main__: Starting game loop …
22:57:42 [INFO] __main__:   game loop running (1 s tick)
22:57:42 [INFO] websockets.server: connection open
22:57:42 [INFO] gameserver.network.server: Session registered: uid=-1
22:57:42 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 57884)
22:57:42 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:57:42 [INFO] gameserver.network.server: Session registered: uid=2
22:57:42 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:57:52 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:57:55 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:57:55 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:57:55 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:57:55 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:58:04 [INFO] gameserver.network.server: Session removed: uid=2
22:58:04 [INFO] websockets.server: connection open
22:58:04 [INFO] gameserver.network.server: Session registered: uid=-2
22:58:04 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55779)
22:58:04 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:04 [INFO] gameserver.network.server: Session registered: uid=2
22:58:04 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:58:04 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
22:58:04 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:58:04 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:58:05 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:58:06 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:07 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:08 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:09 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:10 [INFO] __main__: Shutdown signal received — stopping …
22:58:10 [INFO] __main__: Shutting down …
22:58:10 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
22:58:10 [INFO] websockets.server: server closing
22:58:10 [INFO] gameserver.network.server: Session removed: uid=2
22:58:10 [INFO] websockets.server: server closed
22:58:10 [INFO] gameserver.network.server: WebSocket server stopped
22:58:10 [INFO] __main__:   WebSocket server stopped
22:58:10 [INFO] __main__:   debug dashboard stopped
22:58:10 [INFO] __main__:   database closed
22:58:10 [INFO] __main__:   goodbye
22:58:12 [INFO] __main__: === Game Server starting ===
22:58:12 [INFO] __main__: Loading configuration …
22:58:12 [INFO] __main__:   items:        210 loaded from config
22:58:12 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
22:58:12 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
22:58:12 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
22:58:12 [INFO] __main__:   game_config:  loaded
22:58:12 [INFO] __main__: Initializing persistence …
22:58:12 [INFO] gameserver.persistence.database: Database connected: gameserver.db
22:58:12 [INFO] __main__:   database:     connected (gameserver.db)
22:58:12 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
22:58:12 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
22:58:12 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
22:58:12 [INFO] __main__: Creating services …
22:58:12 [INFO] __main__:   upgrade_provider: 210 items registered
22:58:12 [INFO] __main__:   all services created
22:58:12 [INFO] __main__: Wiring event handlers …
22:58:12 [INFO] __main__:   event handlers registered
22:58:12 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
22:58:12 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
22:58:12 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
22:58:12 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
22:58:12 [INFO] __main__: Restored 2 empires from saved state
22:58:12 [INFO] __main__: Restored 1 attacks from saved state
22:58:12 [INFO] __main__: Starting network server …
22:58:12 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
22:58:12 [INFO] websockets.server: server listening on 0.0.0.0:8765
22:58:12 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
22:58:12 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
22:58:12 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
22:58:12 [INFO] __main__: Starting game loop …
22:58:12 [INFO] __main__:   game loop running (1 s tick)
22:58:13 [INFO] websockets.server: connection open
22:58:13 [INFO] gameserver.network.server: Session registered: uid=-1
22:58:13 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 55790)
22:58:13 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:13 [INFO] gameserver.network.server: Session registered: uid=2
22:58:13 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
22:58:15 [INFO] gameserver.network.server: Session removed: uid=2
22:58:15 [INFO] websockets.server: connection open
22:58:15 [INFO] gameserver.network.server: Session registered: uid=-2
22:58:15 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 55793)
22:58:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:15 [INFO] gameserver.network.server: Session registered: uid=2
22:58:15 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
22:58:15 [INFO] gameserver.network.server: Session removed: uid=2
22:58:15 [INFO] websockets.server: connection open
22:58:15 [INFO] gameserver.network.server: Session registered: uid=-3
22:58:15 [INFO] gameserver.network.server: Client connected: uid=-3 remote=('192.168.178.2', 55796)
22:58:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:15 [INFO] gameserver.network.server: Session registered: uid=2
22:58:15 [INFO] gameserver.network.server: Session upgraded: guest=-3 → uid=2
22:58:15 [INFO] gameserver.network.server: Session removed: uid=2
22:58:15 [INFO] websockets.server: connection open
22:58:15 [INFO] gameserver.network.server: Session registered: uid=-4
22:58:15 [INFO] gameserver.network.server: Client connected: uid=-4 remote=('192.168.178.2', 55799)
22:58:15 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:15 [INFO] gameserver.network.server: Session registered: uid=2
22:58:15 [INFO] gameserver.network.server: Session upgraded: guest=-4 → uid=2
22:58:16 [INFO] gameserver.network.server: Session removed: uid=2
22:58:16 [INFO] websockets.server: connection open
22:58:16 [INFO] gameserver.network.server: Session registered: uid=-5
22:58:16 [INFO] gameserver.network.server: Client connected: uid=-5 remote=('192.168.178.2', 55803)
22:58:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:16 [INFO] gameserver.network.server: Session registered: uid=2
22:58:16 [INFO] gameserver.network.server: Session upgraded: guest=-5 → uid=2
22:58:16 [INFO] gameserver.network.server: Session removed: uid=2
22:58:16 [INFO] websockets.server: connection open
22:58:16 [INFO] gameserver.network.server: Session registered: uid=-6
22:58:16 [INFO] gameserver.network.server: Client connected: uid=-6 remote=('192.168.178.2', 55806)
22:58:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:16 [INFO] gameserver.network.server: Session registered: uid=2
22:58:16 [INFO] gameserver.network.server: Session upgraded: guest=-6 → uid=2
22:58:16 [INFO] gameserver.network.server: Session removed: uid=2
22:58:16 [INFO] websockets.server: connection open
22:58:16 [INFO] gameserver.network.server: Session registered: uid=-7
22:58:16 [INFO] gameserver.network.server: Client connected: uid=-7 remote=('192.168.178.2', 55809)
22:58:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:16 [INFO] gameserver.network.server: Session registered: uid=2
22:58:16 [INFO] gameserver.network.server: Session upgraded: guest=-7 → uid=2
22:58:16 [INFO] gameserver.network.server: Session removed: uid=2
22:58:16 [INFO] websockets.server: connection open
22:58:16 [INFO] gameserver.network.server: Session registered: uid=-8
22:58:16 [INFO] gameserver.network.server: Client connected: uid=-8 remote=('192.168.178.2', 55812)
22:58:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:16 [INFO] gameserver.network.server: Session registered: uid=2
22:58:16 [INFO] gameserver.network.server: Session upgraded: guest=-8 → uid=2
22:58:16 [INFO] gameserver.network.server: Session removed: uid=2
22:58:16 [INFO] websockets.server: connection open
22:58:16 [INFO] gameserver.network.server: Session registered: uid=-9
22:58:16 [INFO] gameserver.network.server: Client connected: uid=-9 remote=('192.168.178.2', 55815)
22:58:16 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:16 [INFO] gameserver.network.server: Session registered: uid=2
22:58:16 [INFO] gameserver.network.server: Session upgraded: guest=-9 → uid=2
22:58:16 [INFO] gameserver.network.server: Session removed: uid=2
22:58:17 [INFO] websockets.server: connection open
22:58:17 [INFO] gameserver.network.server: Session registered: uid=-10
22:58:17 [INFO] gameserver.network.server: Client connected: uid=-10 remote=('192.168.178.2', 55818)
22:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:17 [INFO] gameserver.network.server: Session registered: uid=2
22:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-10 → uid=2
22:58:17 [INFO] gameserver.network.server: Session removed: uid=2
22:58:17 [INFO] websockets.server: connection open
22:58:17 [INFO] gameserver.network.server: Session registered: uid=-11
22:58:17 [INFO] gameserver.network.server: Client connected: uid=-11 remote=('192.168.178.2', 55821)
22:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:17 [INFO] gameserver.network.server: Session registered: uid=2
22:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-11 → uid=2
22:58:17 [INFO] gameserver.network.server: Session removed: uid=2
22:58:17 [INFO] websockets.server: connection open
22:58:17 [INFO] gameserver.network.server: Session registered: uid=-12
22:58:17 [INFO] gameserver.network.server: Client connected: uid=-12 remote=('192.168.178.2', 55824)
22:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:17 [INFO] gameserver.network.server: Session registered: uid=2
22:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-12 → uid=2
22:58:17 [INFO] gameserver.network.server: Session removed: uid=2
22:58:17 [INFO] websockets.server: connection open
22:58:17 [INFO] gameserver.network.server: Session registered: uid=-13
22:58:17 [INFO] gameserver.network.server: Client connected: uid=-13 remote=('192.168.178.2', 55827)
22:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:17 [INFO] gameserver.network.server: Session registered: uid=2
22:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-13 → uid=2
22:58:17 [INFO] gameserver.network.server: Session removed: uid=2
22:58:17 [INFO] websockets.server: connection open
22:58:17 [INFO] gameserver.network.server: Session registered: uid=-14
22:58:17 [INFO] gameserver.network.server: Client connected: uid=-14 remote=('192.168.178.2', 55830)
22:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:17 [INFO] gameserver.network.server: Session registered: uid=2
22:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-14 → uid=2
22:58:17 [INFO] gameserver.network.server: Session removed: uid=2
22:58:17 [INFO] websockets.server: connection open
22:58:17 [INFO] gameserver.network.server: Session registered: uid=-15
22:58:17 [INFO] gameserver.network.server: Client connected: uid=-15 remote=('192.168.178.2', 55833)
22:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:17 [INFO] gameserver.network.server: Session registered: uid=2
22:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-15 → uid=2
22:58:17 [INFO] gameserver.network.server: Session removed: uid=2
22:58:17 [INFO] websockets.server: connection open
22:58:17 [INFO] gameserver.network.server: Session registered: uid=-16
22:58:17 [INFO] gameserver.network.server: Client connected: uid=-16 remote=('192.168.178.2', 55836)
22:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:17 [INFO] gameserver.network.server: Session registered: uid=2
22:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-16 → uid=2
22:58:17 [INFO] gameserver.network.server: Session removed: uid=2
22:58:17 [INFO] websockets.server: connection open
22:58:17 [INFO] gameserver.network.server: Session registered: uid=-17
22:58:17 [INFO] gameserver.network.server: Client connected: uid=-17 remote=('192.168.178.2', 55839)
22:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:17 [INFO] gameserver.network.server: Session registered: uid=2
22:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-17 → uid=2
22:58:18 [INFO] gameserver.network.server: Session removed: uid=2
22:58:18 [INFO] websockets.server: connection open
22:58:18 [INFO] gameserver.network.server: Session registered: uid=-18
22:58:18 [INFO] gameserver.network.server: Client connected: uid=-18 remote=('192.168.178.2', 55842)
22:58:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:18 [INFO] gameserver.network.server: Session registered: uid=2
22:58:18 [INFO] gameserver.network.server: Session upgraded: guest=-18 → uid=2
22:58:18 [INFO] gameserver.network.server: Session removed: uid=2
22:58:18 [INFO] websockets.server: connection open
22:58:18 [INFO] gameserver.network.server: Session registered: uid=-19
22:58:18 [INFO] gameserver.network.server: Client connected: uid=-19 remote=('192.168.178.2', 55845)
22:58:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:18 [INFO] gameserver.network.server: Session registered: uid=2
22:58:18 [INFO] gameserver.network.server: Session upgraded: guest=-19 → uid=2
22:58:18 [INFO] gameserver.network.server: Session removed: uid=2
22:58:18 [INFO] websockets.server: connection open
22:58:18 [INFO] gameserver.network.server: Session registered: uid=-20
22:58:18 [INFO] gameserver.network.server: Client connected: uid=-20 remote=('192.168.178.2', 55848)
22:58:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:18 [INFO] gameserver.network.server: Session registered: uid=2
22:58:18 [INFO] gameserver.network.server: Session upgraded: guest=-20 → uid=2
22:58:18 [INFO] gameserver.network.server: Session removed: uid=2
22:58:18 [INFO] websockets.server: connection open
22:58:18 [INFO] gameserver.network.server: Session registered: uid=-21
22:58:18 [INFO] gameserver.network.server: Client connected: uid=-21 remote=('192.168.178.2', 55851)
22:58:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:18 [INFO] gameserver.network.server: Session registered: uid=2
22:58:18 [INFO] gameserver.network.server: Session upgraded: guest=-21 → uid=2
22:58:18 [INFO] gameserver.network.server: Session removed: uid=2
22:58:18 [INFO] websockets.server: connection open
22:58:18 [INFO] gameserver.network.server: Session registered: uid=-22
22:58:18 [INFO] gameserver.network.server: Client connected: uid=-22 remote=('192.168.178.2', 55854)
22:58:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:18 [INFO] gameserver.network.server: Session registered: uid=2
22:58:18 [INFO] gameserver.network.server: Session upgraded: guest=-22 → uid=2
22:58:18 [INFO] gameserver.network.server: Session removed: uid=2
22:58:18 [INFO] websockets.server: connection open
22:58:18 [INFO] gameserver.network.server: Session registered: uid=-23
22:58:18 [INFO] gameserver.network.server: Client connected: uid=-23 remote=('192.168.178.2', 55857)
22:58:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:18 [INFO] gameserver.network.server: Session registered: uid=2
22:58:18 [INFO] gameserver.network.server: Session upgraded: guest=-23 → uid=2
22:58:18 [INFO] gameserver.network.server: Session removed: uid=2
22:58:19 [INFO] websockets.server: connection open
22:58:19 [INFO] gameserver.network.server: Session registered: uid=-24
22:58:19 [INFO] gameserver.network.server: Client connected: uid=-24 remote=('192.168.178.2', 55860)
22:58:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:19 [INFO] gameserver.network.server: Session registered: uid=2
22:58:19 [INFO] gameserver.network.server: Session upgraded: guest=-24 → uid=2
22:58:19 [INFO] gameserver.network.server: Session removed: uid=2
22:58:19 [INFO] websockets.server: connection open
22:58:19 [INFO] gameserver.network.server: Session registered: uid=-25
22:58:19 [INFO] gameserver.network.server: Client connected: uid=-25 remote=('192.168.178.2', 55863)
22:58:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:19 [INFO] gameserver.network.server: Session registered: uid=2
22:58:19 [INFO] gameserver.network.server: Session upgraded: guest=-25 → uid=2
22:58:19 [INFO] gameserver.network.server: Session removed: uid=2
22:58:19 [INFO] websockets.server: connection open
22:58:19 [INFO] gameserver.network.server: Session registered: uid=-26
22:58:19 [INFO] gameserver.network.server: Client connected: uid=-26 remote=('192.168.178.2', 55866)
22:58:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:19 [INFO] gameserver.network.server: Session registered: uid=2
22:58:19 [INFO] gameserver.network.server: Session upgraded: guest=-26 → uid=2
22:58:19 [INFO] gameserver.network.server: Session removed: uid=2
22:58:19 [INFO] websockets.server: connection open
22:58:19 [INFO] gameserver.network.server: Session registered: uid=-27
22:58:19 [INFO] gameserver.network.server: Client connected: uid=-27 remote=('192.168.178.2', 55869)
22:58:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:19 [INFO] gameserver.network.server: Session registered: uid=2
22:58:19 [INFO] gameserver.network.server: Session upgraded: guest=-27 → uid=2
22:58:19 [INFO] gameserver.network.server: Session removed: uid=2
22:58:19 [INFO] websockets.server: connection open
22:58:19 [INFO] gameserver.network.server: Session registered: uid=-28
22:58:19 [INFO] gameserver.network.server: Client connected: uid=-28 remote=('192.168.178.2', 55872)
22:58:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:19 [INFO] gameserver.network.server: Session registered: uid=2
22:58:19 [INFO] gameserver.network.server: Session upgraded: guest=-28 → uid=2
22:58:19 [INFO] gameserver.network.server: Session removed: uid=2
22:58:19 [INFO] websockets.server: connection open
22:58:19 [INFO] gameserver.network.server: Session registered: uid=-29
22:58:19 [INFO] gameserver.network.server: Client connected: uid=-29 remote=('192.168.178.2', 55875)
22:58:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:19 [INFO] gameserver.network.server: Session registered: uid=2
22:58:19 [INFO] gameserver.network.server: Session upgraded: guest=-29 → uid=2
22:58:19 [INFO] gameserver.network.server: Session removed: uid=2
22:58:19 [INFO] websockets.server: connection open
22:58:19 [INFO] gameserver.network.server: Session registered: uid=-30
22:58:19 [INFO] gameserver.network.server: Client connected: uid=-30 remote=('192.168.178.2', 55878)
22:58:19 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:19 [INFO] gameserver.network.server: Session registered: uid=2
22:58:19 [INFO] gameserver.network.server: Session upgraded: guest=-30 → uid=2
22:58:20 [INFO] gameserver.network.server: Session removed: uid=2
22:58:20 [INFO] websockets.server: connection open
22:58:20 [INFO] gameserver.network.server: Session registered: uid=-31
22:58:20 [INFO] gameserver.network.server: Client connected: uid=-31 remote=('192.168.178.2', 55881)
22:58:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:20 [INFO] gameserver.network.server: Session registered: uid=2
22:58:20 [INFO] gameserver.network.server: Session upgraded: guest=-31 → uid=2
22:58:20 [INFO] gameserver.network.server: Session removed: uid=2
22:58:20 [INFO] websockets.server: connection open
22:58:20 [INFO] gameserver.network.server: Session registered: uid=-32
22:58:20 [INFO] gameserver.network.server: Client connected: uid=-32 remote=('192.168.178.2', 55884)
22:58:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:20 [INFO] gameserver.network.server: Session registered: uid=2
22:58:20 [INFO] gameserver.network.server: Session upgraded: guest=-32 → uid=2
22:58:20 [INFO] gameserver.network.server: Session removed: uid=2
22:58:20 [INFO] websockets.server: connection open
22:58:20 [INFO] gameserver.network.server: Session registered: uid=-33
22:58:20 [INFO] gameserver.network.server: Client connected: uid=-33 remote=('192.168.178.2', 55887)
22:58:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:20 [INFO] gameserver.network.server: Session registered: uid=2
22:58:20 [INFO] gameserver.network.server: Session upgraded: guest=-33 → uid=2
22:58:20 [INFO] gameserver.network.server: Session removed: uid=2
22:58:20 [INFO] websockets.server: connection open
22:58:20 [INFO] gameserver.network.server: Session registered: uid=-34
22:58:20 [INFO] gameserver.network.server: Client connected: uid=-34 remote=('192.168.178.2', 55890)
22:58:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:20 [INFO] gameserver.network.server: Session registered: uid=2
22:58:20 [INFO] gameserver.network.server: Session upgraded: guest=-34 → uid=2
22:58:20 [INFO] gameserver.network.server: Session removed: uid=2
22:58:20 [INFO] websockets.server: connection open
22:58:20 [INFO] gameserver.network.server: Session registered: uid=-35
22:58:20 [INFO] gameserver.network.server: Client connected: uid=-35 remote=('192.168.178.2', 55893)
22:58:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:20 [INFO] gameserver.network.server: Session registered: uid=2
22:58:20 [INFO] gameserver.network.server: Session upgraded: guest=-35 → uid=2
22:58:20 [INFO] gameserver.network.server: Session removed: uid=2
22:58:20 [INFO] websockets.server: connection open
22:58:20 [INFO] gameserver.network.server: Session registered: uid=-36
22:58:20 [INFO] gameserver.network.server: Client connected: uid=-36 remote=('192.168.178.2', 55896)
22:58:20 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:20 [INFO] gameserver.network.server: Session registered: uid=2
22:58:20 [INFO] gameserver.network.server: Session upgraded: guest=-36 → uid=2
22:58:21 [INFO] gameserver.network.server: Session removed: uid=2
22:58:21 [INFO] websockets.server: connection open
22:58:21 [INFO] gameserver.network.server: Session registered: uid=-37
22:58:21 [INFO] gameserver.network.server: Client connected: uid=-37 remote=('192.168.178.2', 55900)
22:58:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:21 [INFO] gameserver.network.server: Session registered: uid=2
22:58:21 [INFO] gameserver.network.server: Session upgraded: guest=-37 → uid=2
22:58:21 [INFO] gameserver.network.server: Session removed: uid=2
22:58:21 [INFO] websockets.server: connection open
22:58:21 [INFO] gameserver.network.server: Session registered: uid=-38
22:58:21 [INFO] gameserver.network.server: Client connected: uid=-38 remote=('192.168.178.2', 55903)
22:58:21 [INFO] gameserver.network.auth: Login success: eem (uid=2)
22:58:21 [INFO] gameserver.network.server: Session registered: uid=2
22:58:21 [INFO] gameserver.network.server: Session upgraded: guest=-38 → uid=2
22:58:22 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
22:58:25 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
22:58:25 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
22:58:25 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
22:58:25 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
22:58:26 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
22:58:26 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
22:58:26 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:58:26 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:58:27 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
22:58:28 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:58:29 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
22:58:30 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:58:31 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
22:58:32 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:58:33 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
22:58:34 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:58:35 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
22:58:36 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:37 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:39 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:40 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:41 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
22:58:42 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=1
22:58:43 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=1
22:58:44 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=2
22:58:45 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=2
22:58:46 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=3
22:58:47 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=3
23:58:13 [INFO] __main__: Shutdown signal received — stopping …
23:58:14 [INFO] __main__: Shutting down …
23:58:14 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
23:58:14 [INFO] websockets.server: server closing
23:58:14 [INFO] gameserver.network.server: Session removed: uid=2
23:58:14 [INFO] websockets.server: server closed
23:58:14 [INFO] gameserver.network.server: WebSocket server stopped
23:58:14 [INFO] __main__:   WebSocket server stopped
23:58:14 [INFO] __main__:   debug dashboard stopped
23:58:14 [INFO] __main__:   database closed
23:58:14 [INFO] __main__:   goodbye
23:58:15 [INFO] __main__: === Game Server starting ===
23:58:15 [INFO] __main__: Loading configuration …
23:58:16 [INFO] __main__:   items:        210 loaded from config
23:58:16 [INFO] __main__:   map:          4 paths, 23 build tiles from config/maps/default.yaml
23:58:16 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
23:58:16 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (30 keys)
23:58:16 [INFO] __main__:   game_config:  loaded
23:58:16 [INFO] __main__: Initializing persistence …
23:58:16 [INFO] gameserver.persistence.database: Database connected: gameserver.db
23:58:16 [INFO] __main__:   database:     connected (gameserver.db)
23:58:16 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-10T20:23:11, version 1)
23:58:16 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
23:58:16 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
23:58:16 [INFO] __main__: Creating services …
23:58:16 [INFO] __main__:   upgrade_provider: 210 items registered
23:58:16 [INFO] __main__:   all services created
23:58:16 [INFO] __main__: Wiring event handlers …
23:58:16 [INFO] __main__:   event handlers registered
23:58:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
23:58:16 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
23:58:16 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
23:58:16 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.15000000000000002, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
23:58:16 [INFO] __main__: Restored 2 empires from saved state
23:58:16 [INFO] __main__: Restored 1 attacks from saved state
23:58:16 [INFO] __main__: Starting network server …
23:58:16 [INFO] gameserver.network.handlers: Registered 32 message handlers: summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire, battle_request
23:58:16 [INFO] websockets.server: server listening on 0.0.0.0:8765
23:58:16 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
23:58:16 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
23:58:16 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
23:58:16 [INFO] __main__: Starting game loop …
23:58:16 [INFO] __main__:   game loop running (1 s tick)
23:58:17 [INFO] websockets.server: connection open
23:58:17 [INFO] gameserver.network.server: Session registered: uid=-1
23:58:17 [INFO] gameserver.network.server: Client connected: uid=-1 remote=('192.168.178.2', 59808)
23:58:17 [INFO] gameserver.network.auth: Login success: eem (uid=2)
23:58:17 [INFO] gameserver.network.server: Session registered: uid=2
23:58:17 [INFO] gameserver.network.server: Session upgraded: guest=-1 → uid=2
23:58:18 [INFO] gameserver.network.server: Session removed: uid=2
23:58:18 [INFO] websockets.server: connection open
23:58:18 [INFO] gameserver.network.server: Session registered: uid=-2
23:58:18 [INFO] gameserver.network.server: Client connected: uid=-2 remote=('192.168.178.2', 59820)
23:58:18 [INFO] gameserver.network.auth: Login success: eem (uid=2)
23:58:18 [INFO] gameserver.network.server: Session registered: uid=2
23:58:18 [INFO] gameserver.network.server: Session upgraded: guest=-2 → uid=2
23:58:18 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
23:58:18 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
23:58:21 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
23:58:26 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
23:58:29 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
23:58:29 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
23:58:29 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
23:58:29 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=[100])
23:58:29 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
23:58:29 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
23:58:29 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
23:58:30 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
23:58:31 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=1
23:58:32 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
23:58:33 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=2
23:58:34 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
23:58:35 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=3
23:58:36 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
23:58:37 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=4
23:58:38 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
23:58:39 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=0 wave_id=1 critter_pointer=5
23:58:40 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
23:58:41 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
23:58:42 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
23:58:43 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
23:58:44 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=0
23:58:45 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=1
23:58:46 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=1
23:58:47 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=2
23:58:48 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=2
23:58:49 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=3
23:58:50 [INFO] gameserver.network.handlers: [battle_status] direction=attacker_100 wave_pointer=1 wave_id=2 critter_pointer=3
23:59:34 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
