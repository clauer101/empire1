11:54:48 [INFO] __main__: === Game Server starting ===
11:54:48 [INFO] __main__: Loading configuration …
11:54:48 [INFO] __main__:   items:        210 loaded from config
11:54:48 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:54:48 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:54:48 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:54:48 [INFO] __main__:   game_config:  loaded
11:54:48 [INFO] __main__: Initializing persistence …
11:54:48 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:54:48 [INFO] __main__:   database:     connected (gameserver.db)
11:54:48 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:54:48 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:54:48 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:54:48 [INFO] __main__: Creating services …
11:54:48 [INFO] __main__:   upgrade_provider: 210 items registered
11:54:48 [INFO] __main__:   all services created
11:54:48 [INFO] __main__: Wiring event handlers …
11:54:48 [INFO] __main__:   event handlers registered
11:54:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:54:48 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:54:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:54:48 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:54:48 [INFO] __main__: Restored 2 empires from saved state
11:54:48 [INFO] __main__: Restored 1 attacks from saved state
11:54:48 [INFO] __main__: Starting network servers …
11:54:48 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:54:48 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:54:48 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:54:48 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:54:49 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:54:49 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17520]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:54:50 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:54:50 [INFO] __main__: Starting game loop …
11:54:50 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:54:51 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
11:54:52 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:54:52 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:54:52 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:54:52 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:54:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:54:52 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.001 (speed=0.15, dt_ms=16.7, distance=0.003)
11:54:52 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.040 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:53 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.077 (speed=0.15, dt_ms=15.4, distance=0.002)
11:54:53 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.114 (speed=0.15, dt_ms=15.4, distance=0.002)
11:54:53 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:54:54 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.152 (speed=0.15, dt_ms=15.7, distance=0.002)
11:54:54 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.006 (speed=0.15, dt_ms=15.7, distance=0.002)
11:54:54 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.189 (speed=0.15, dt_ms=15.4, distance=0.002)
11:54:54 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.043 (speed=0.15, dt_ms=15.4, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.227 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.081 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.264 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.118 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.302 (speed=0.15, dt_ms=16.5, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.157 (speed=0.15, dt_ms=16.5, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.011 (speed=0.15, dt_ms=16.5, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.339 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.194 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.047 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.414 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.268 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.122 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.419 (speed=0.15, dt_ms=70.3, distance=0.011)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.273 (speed=0.15, dt_ms=70.3, distance=0.011)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.127 (speed=0.15, dt_ms=70.3, distance=0.011)
11:54:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.452 (speed=0.15, dt_ms=15.8, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.307 (speed=0.15, dt_ms=15.8, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.161 (speed=0.15, dt_ms=15.8, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.014 (speed=0.15, dt_ms=15.8, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.489 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.343 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.197 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.051 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.490 (speed=0.15, dt_ms=17.0, distance=0.003)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.344 (speed=0.15, dt_ms=17.0, distance=0.003)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.198 (speed=0.15, dt_ms=17.0, distance=0.003)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.052 (speed=0.15, dt_ms=17.0, distance=0.003)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.527 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.381 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.235 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.089 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.564 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.419 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.273 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.126 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.602 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.456 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.310 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.164 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.018 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.639 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.493 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.347 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.201 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.055 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.677 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.532 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.386 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.239 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.093 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.714 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.569 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.423 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.276 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.130 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.72
11:55:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.606 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.460 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.314 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.168 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.022 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.643 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.497 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.351 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.204 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.059 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.645 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.499 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.353 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.207 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.061 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.681 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.535 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.389 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.242 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.097 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.682 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.536 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.390 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.243 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.098 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.719 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.573 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.427 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.280 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.135 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.756 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.610 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.463 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.317 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.172 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.757 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.611 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.465 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.318 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.173 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.794 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.648 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.501 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.355 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.209 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.832 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.685 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.539 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.393 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.247 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.868 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.722 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.576 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.429 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.284 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.870 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.723 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.577 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.431 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.285 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=0.88
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.760 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.614 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.467 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.322 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.798 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.651 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.505 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.360 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.835 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.689 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.543 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.397 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.034 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.873 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.726 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.580 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.434 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.071 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.874 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.728 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.581 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.436 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.073 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.910 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.764 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.617 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.472 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.109 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.947 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.801 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.655 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.509 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.146 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.986 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.839 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.693 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.548 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.184 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.038 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.876 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.730 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.584 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.221 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.075 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=3 (SWORDMAN) killed at path_progress=1.00
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.914 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.767 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.622 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.259 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.113 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.952 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.805 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.660 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.297 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.150 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.005 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.989 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.843 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.697 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.334 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.188 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.042 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.880 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.735 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.372 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.226 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.080 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.918 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.773 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.410 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.263 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.118 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.954 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.809 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.446 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.300 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.154 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.007 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.956 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.811 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.448 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.301 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.156 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.009 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.993 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.847 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.484 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.338 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.192 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.045 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.885 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.522 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.376 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.230 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.083 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=4 (SWORDMAN) killed at path_progress=1.00
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.922 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.559 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.412 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.267 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.120 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.960 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.596 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.450 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.304 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.157 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.997 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.634 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.488 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.342 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.195 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.672 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.526 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.380 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.233 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.709 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.563 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.417 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.270 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.746 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.600 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.454 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.307 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.783 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.637 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.491 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.344 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.785 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.638 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.493 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.346 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.822 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.676 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.530 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.383 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:17 [INFO] __main__: Shutdown signal received — stopping …
11:55:17 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=5 (SWORDMAN) killed at path_progress=1.00
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.859 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.713 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.567 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.420 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:18 [INFO] __main__: Shutting down …
11:55:18 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
11:55:18 [INFO] websockets.server: server closing
11:55:18 [INFO] websockets.server: server closed
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.862 (speed=0.15, dt_ms=34.3, distance=0.005)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.715 (speed=0.15, dt_ms=34.3, distance=0.005)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.570 (speed=0.15, dt_ms=34.3, distance=0.005)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.423 (speed=0.15, dt_ms=34.3, distance=0.005)
11:55:18 [INFO] gameserver.network.server: WebSocket server stopped
11:55:18 [INFO] __main__:   WebSocket server stopped
11:55:18 [INFO] __main__:   REST API server stopped
11:55:18 [INFO] __main__:   debug dashboard stopped
11:55:18 [INFO] __main__:   database closed
11:55:18 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

11:55:19 [INFO] __main__: === Game Server starting ===
11:55:19 [INFO] __main__: Loading configuration …
11:55:20 [INFO] __main__:   items:        210 loaded from config
11:55:20 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:55:20 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:55:20 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:55:20 [INFO] __main__:   game_config:  loaded
11:55:20 [INFO] __main__: Initializing persistence …
11:55:20 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:55:20 [INFO] __main__:   database:     connected (gameserver.db)
11:55:20 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:55:20 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:55:20 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:55:20 [INFO] __main__: Creating services …
11:55:20 [INFO] __main__:   upgrade_provider: 210 items registered
11:55:20 [INFO] __main__:   all services created
11:55:20 [INFO] __main__: Wiring event handlers …
11:55:20 [INFO] __main__:   event handlers registered
11:55:20 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:55:20 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:55:20 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:55:20 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:55:20 [INFO] __main__: Restored 2 empires from saved state
11:55:20 [INFO] __main__: Restored 1 attacks from saved state
11:55:20 [INFO] __main__: Starting network servers …
11:55:20 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:55:20 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:55:20 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:55:20 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:55:21 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:55:21 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17614]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:55:21 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:55:21 [INFO] __main__: Starting game loop …
11:55:21 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:55:22 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
11:55:23 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:55:23 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:55:23 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:55:23 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:55:23 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
11:55:25 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:55:27 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:55:27 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=1.00
11:55:29 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:55:31 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:55:31 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=1.00
11:55:33 [INFO] __main__: Shutdown signal received — stopping …
11:55:33 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:55:33 [INFO] __main__: Shutting down …
11:55:33 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
11:55:33 [INFO] websockets.server: server closing
11:55:33 [INFO] websockets.server: server closed
11:55:33 [INFO] gameserver.network.server: WebSocket server stopped
11:55:33 [INFO] __main__:   WebSocket server stopped
11:55:33 [INFO] __main__:   REST API server stopped
11:55:33 [INFO] __main__:   debug dashboard stopped
11:55:33 [INFO] __main__:   database closed
11:55:33 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

11:55:35 [INFO] __main__: === Game Server starting ===
11:55:35 [INFO] __main__: Loading configuration …
11:55:35 [INFO] __main__:   items:        210 loaded from config
11:55:35 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:55:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:55:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:55:35 [INFO] __main__:   game_config:  loaded
11:55:35 [INFO] __main__: Initializing persistence …
11:55:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:55:35 [INFO] __main__:   database:     connected (gameserver.db)
11:55:36 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:55:36 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:55:36 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:55:36 [INFO] __main__: Creating services …
11:55:36 [INFO] __main__:   upgrade_provider: 210 items registered
11:55:36 [INFO] __main__:   all services created
11:55:36 [INFO] __main__: Wiring event handlers …
11:55:36 [INFO] __main__:   event handlers registered
11:55:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:55:36 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:55:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:55:36 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:55:36 [INFO] __main__: Restored 2 empires from saved state
11:55:36 [INFO] __main__: Restored 1 attacks from saved state
11:55:36 [INFO] __main__: Starting network servers …
11:55:36 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:55:36 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:55:36 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:55:36 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:55:37 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:55:37 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17674]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:55:37 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:55:37 [INFO] __main__: Starting game loop …
11:55:37 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:55:38 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
INFO:     192.168.178.2:56554 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:55:38 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:55:38 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:55:38 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
11:55:38 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:55:39 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:55:39 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:55:39 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:55:39 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:55:39 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
11:55:41 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:55:43 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:55:43 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=1.00
11:55:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:55:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:55:47 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=1.00
11:55:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:55:51 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=3 (SWORDMAN) killed at path_progress=1.00
11:55:53 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
11:55:55 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=4 (SWORDMAN) killed at path_progress=1.00
11:55:55 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
11:55:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
11:55:59 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=5 (SWORDMAN) killed at path_progress=1.00
11:55:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
11:56:03 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=6 (SWORDMAN) killed at path_progress=1.00
11:56:04 [INFO] __main__: Shutdown signal received — stopping …
11:56:05 [INFO] __main__: Shutting down …
11:56:05 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
11:56:05 [INFO] websockets.server: server closing
11:56:05 [INFO] websockets.server: server closed
11:56:05 [INFO] gameserver.network.server: WebSocket server stopped
11:56:05 [INFO] __main__:   WebSocket server stopped
11:56:05 [INFO] __main__:   REST API server stopped
11:56:05 [INFO] __main__:   debug dashboard stopped
11:56:05 [INFO] __main__:   database closed
11:56:05 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/applications.py", line 1138, in __call__
    await super().__call__(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 147, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 144, in app
    await func(session)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 509, in app
    await dependant.call(**solved_result.values)
  File "/home/pi/e3/python_server/src/gameserver/network/rest_api.py", line 286, in websocket_endpoint
    raw = await ws.receive_text()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 119, in receive_text
    message = await self.receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 47, in receive
    message = await self._receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 375, in asgi_receive
    data = await self.recv()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/legacy/protocol.py", line 538, in recv
    await asyncio.wait(
  File "/usr/lib/python3.9/asyncio/tasks.py", line 413, in wait
    return await _wait(fs, timeout, return_when, loop)
  File "/usr/lib/python3.9/asyncio/tasks.py", line 529, in _wait
    await waiter
asyncio.exceptions.CancelledError
INFO:     connection closed
11:56:06 [INFO] __main__: === Game Server starting ===
11:56:06 [INFO] __main__: Loading configuration …
11:56:07 [INFO] __main__:   items:        210 loaded from config
11:56:07 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:56:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:56:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:56:07 [INFO] __main__:   game_config:  loaded
11:56:07 [INFO] __main__: Initializing persistence …
11:56:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:56:07 [INFO] __main__:   database:     connected (gameserver.db)
11:56:07 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:56:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:56:07 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:56:07 [INFO] __main__: Creating services …
11:56:07 [INFO] __main__:   upgrade_provider: 210 items registered
11:56:07 [INFO] __main__:   all services created
11:56:07 [INFO] __main__: Wiring event handlers …
11:56:07 [INFO] __main__:   event handlers registered
11:56:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:56:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:56:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:56:07 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:56:07 [INFO] __main__: Restored 2 empires from saved state
11:56:07 [INFO] __main__: Restored 1 attacks from saved state
11:56:07 [INFO] __main__: Starting network servers …
11:56:07 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:56:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:56:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:56:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:56:08 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:56:08 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17754]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:56:08 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:56:08 [INFO] __main__: Starting game loop …
11:56:08 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
INFO:     192.168.178.2:60560 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:56:08 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:56:08 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:56:08 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
11:56:08 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:56:09 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
11:56:10 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:56:10 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:56:10 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:56:10 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:56:10 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
11:56:12 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:56:14 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:56:14 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=1.00
11:56:15 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:60573 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:56:15 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:56:15 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:56:15 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
11:56:15 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:56:16 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:56:18 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:56:18 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=1.00
11:56:20 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:56:22 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=3 (SWORDMAN) killed at path_progress=1.00
11:56:23 [INFO] __main__: Shutdown signal received — stopping …
11:56:24 [INFO] __main__: Shutting down …
11:56:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
11:56:24 [INFO] websockets.server: server closing
11:56:24 [INFO] websockets.server: server closed
11:56:24 [INFO] gameserver.network.server: WebSocket server stopped
11:56:24 [INFO] __main__:   WebSocket server stopped
11:56:24 [INFO] __main__:   REST API server stopped
11:56:24 [INFO] __main__:   debug dashboard stopped
11:56:24 [INFO] __main__:   database closed
11:56:24 [INFO] __main__:   goodbye
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/applications.py", line 1138, in __call__
    await super().__call__(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 147, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 144, in app
    await func(session)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 509, in app
    await dependant.call(**solved_result.values)
  File "/home/pi/e3/python_server/src/gameserver/network/rest_api.py", line 286, in websocket_endpoint
    raw = await ws.receive_text()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 119, in receive_text
    message = await self.receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 47, in receive
    message = await self._receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 375, in asgi_receive
    data = await self.recv()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/legacy/protocol.py", line 538, in recv
    await asyncio.wait(
  File "/usr/lib/python3.9/asyncio/tasks.py", line 413, in wait
    return await _wait(fs, timeout, return_when, loop)
  File "/usr/lib/python3.9/asyncio/tasks.py", line 529, in _wait
    await waiter
asyncio.exceptions.CancelledError
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

INFO:     connection closed
11:56:26 [INFO] __main__: === Game Server starting ===
11:56:26 [INFO] __main__: Loading configuration …
11:56:27 [INFO] __main__:   items:        210 loaded from config
11:56:27 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:56:27 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:56:27 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:56:27 [INFO] __main__:   game_config:  loaded
11:56:27 [INFO] __main__: Initializing persistence …
11:56:27 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:56:27 [INFO] __main__:   database:     connected (gameserver.db)
11:56:27 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:56:27 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:56:27 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:56:27 [INFO] __main__: Creating services …
11:56:27 [INFO] __main__:   upgrade_provider: 210 items registered
11:56:27 [INFO] __main__:   all services created
11:56:27 [INFO] __main__: Wiring event handlers …
11:56:27 [INFO] __main__:   event handlers registered
11:56:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:56:27 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:56:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:56:27 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:56:27 [INFO] __main__: Restored 2 empires from saved state
11:56:27 [INFO] __main__: Restored 1 attacks from saved state
11:56:27 [INFO] __main__: Starting network servers …
11:56:27 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:56:27 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:56:27 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:56:27 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:56:28 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:56:28 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17828]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:56:28 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:56:28 [INFO] __main__: Starting game loop …
11:56:28 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:56:29 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
11:56:30 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:56:30 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:56:30 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:56:30 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:56:30 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
INFO:     192.168.178.2:60592 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:56:31 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:56:31 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:56:31 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
11:56:31 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:56:32 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:56:34 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:56:36 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:56:38 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:56:38 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
11:56:40 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:56:42 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=1.00
11:56:45 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
11:56:46 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=3 (SWORDMAN) killed at path_progress=1.00
11:56:47 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
11:56:49 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
11:56:50 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=4 (SWORDMAN) killed at path_progress=1.00
11:56:51 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
11:56:54 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=5 (SWORDMAN) killed at path_progress=1.00
11:56:58 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=6 (SWORDMAN) killed at path_progress=1.00
11:57:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=1.00
11:57:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=1.00
11:57:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=1.00
11:57:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.97
11:57:00 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
11:57:00 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
11:57:00 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
11:58:58 [INFO] __main__: Shutdown signal received — stopping …
11:58:59 [INFO] __main__: Shutting down …
11:58:59 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
11:58:59 [INFO] websockets.server: server closing
11:58:59 [INFO] websockets.server: server closed
11:58:59 [INFO] gameserver.network.server: WebSocket server stopped
11:58:59 [INFO] __main__:   WebSocket server stopped
11:58:59 [INFO] __main__:   REST API server stopped
11:58:59 [INFO] __main__:   debug dashboard stopped
11:58:59 [INFO] __main__:   database closed
11:58:59 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/applications.py", line 1138, in __call__
    await super().__call__(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 147, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 144, in app
    await func(session)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 509, in app
    await dependant.call(**solved_result.values)
  File "/home/pi/e3/python_server/src/gameserver/network/rest_api.py", line 286, in websocket_endpoint
    raw = await ws.receive_text()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 119, in receive_text
    message = await self.receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 47, in receive
    message = await self._receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 375, in asgi_receive
    data = await self.recv()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/legacy/protocol.py", line 538, in recv
    await asyncio.wait(
  File "/usr/lib/python3.9/asyncio/tasks.py", line 413, in wait
    return await _wait(fs, timeout, return_when, loop)
  File "/usr/lib/python3.9/asyncio/tasks.py", line 529, in _wait
    await waiter
asyncio.exceptions.CancelledError
INFO:     connection closed
11:59:01 [INFO] __main__: === Game Server starting ===
11:59:01 [INFO] __main__: Loading configuration …
11:59:02 [INFO] __main__:   items:        210 loaded from config
11:59:02 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:59:02 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:59:02 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:59:02 [INFO] __main__:   game_config:  loaded
11:59:02 [INFO] __main__: Initializing persistence …
11:59:02 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:59:02 [INFO] __main__:   database:     connected (gameserver.db)
11:59:02 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:59:02 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:59:02 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:59:02 [INFO] __main__: Creating services …
11:59:02 [INFO] __main__:   upgrade_provider: 210 items registered
11:59:02 [INFO] __main__:   all services created
11:59:02 [INFO] __main__: Wiring event handlers …
11:59:02 [INFO] __main__:   event handlers registered
11:59:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:59:02 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:59:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:59:02 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:59:02 [INFO] __main__: Restored 2 empires from saved state
11:59:02 [INFO] __main__: Restored 1 attacks from saved state
11:59:02 [INFO] __main__: Starting network servers …
11:59:02 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:59:02 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:59:02 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:59:02 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:59:03 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:59:03 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17987]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:59:03 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:59:03 [INFO] __main__: Starting game loop …
11:59:03 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:59:04 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
INFO:     192.168.178.2:56386 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:59:05 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:59:05 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:59:05 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
11:59:05 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:59:05 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:59:05 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:59:05 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:59:05 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:59:05 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
11:59:07 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:59:09 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:59:11 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:59:13 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:59:13 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
11:59:15 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:59:17 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
11:59:19 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
11:59:19 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
11:59:21 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
11:59:21 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
11:59:23 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
11:59:23 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
11:59:25 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
11:59:25 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
11:59:25 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
11:59:25 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
INFO:     192.168.178.2:56399 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:59:26 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:59:26 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:59:26 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
11:59:26 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:59:27 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
11:59:29 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
11:59:31 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
11:59:33 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
11:59:33 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
11:59:33 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
11:59:33 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
11:59:33 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
11:59:33 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
INFO:     192.168.178.2:56405 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:59:42 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:59:42 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:59:42 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
11:59:47 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
11:59:47 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
12:00:49 [INFO] __main__: Shutdown signal received — stopping …
12:00:50 [INFO] __main__: Shutting down …
12:00:50 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
12:00:50 [INFO] websockets.server: server closing
12:00:50 [INFO] websockets.server: server closed
12:00:50 [INFO] gameserver.network.server: WebSocket server stopped
12:00:50 [INFO] __main__:   WebSocket server stopped
12:00:50 [INFO] __main__:   REST API server stopped
12:00:50 [INFO] __main__:   debug dashboard stopped
12:00:50 [INFO] __main__:   database closed
12:00:50 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

12:00:52 [INFO] __main__: === Game Server starting ===
12:00:52 [INFO] __main__: Loading configuration …
12:00:53 [INFO] __main__:   items:        210 loaded from config
12:00:53 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
12:00:53 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
12:00:53 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
12:00:53 [INFO] __main__:   game_config:  loaded
12:00:53 [INFO] __main__: Initializing persistence …
12:00:53 [INFO] gameserver.persistence.database: Database connected: gameserver.db
12:00:53 [INFO] __main__:   database:     connected (gameserver.db)
12:00:53 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
12:00:53 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
12:00:53 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
12:00:53 [INFO] __main__: Creating services …
12:00:53 [INFO] __main__:   upgrade_provider: 210 items registered
12:00:53 [INFO] __main__:   all services created
12:00:53 [INFO] __main__: Wiring event handlers …
12:00:53 [INFO] __main__:   event handlers registered
12:00:53 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
12:00:53 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
12:00:53 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
12:00:53 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
12:00:53 [INFO] __main__: Restored 2 empires from saved state
12:00:53 [INFO] __main__: Restored 1 attacks from saved state
12:00:53 [INFO] __main__: Starting network servers …
12:00:53 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
12:00:53 [INFO] websockets.server: server listening on 0.0.0.0:8765
12:00:53 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
12:00:53 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
12:00:54 [INFO] gameserver.network.rest_api: REST API created with 20 routes
12:00:54 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [18131]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
12:00:54 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
12:00:54 [INFO] __main__: Starting game loop …
12:00:54 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
12:00:55 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
12:00:56 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
12:00:56 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
12:00:56 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
12:00:56 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
12:00:56 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
12:00:58 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
12:01:00 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
12:01:02 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
12:01:04 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
12:01:04 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
12:01:06 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
12:01:08 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
12:01:10 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
12:01:11 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
12:01:12 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
12:01:13 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
12:01:14 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
12:01:15 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
12:01:16 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
12:01:17 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
12:01:18 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
12:01:20 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
12:01:22 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
12:01:24 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
12:01:24 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
12:01:24 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
12:01:24 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
12:02:59 [INFO] gameserver.network.handlers: new_army success uid=2 aid=1 name=huhu
12:03:03 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 wave_id=1 with 5 SLAVE slots
12:03:06 [INFO] gameserver.network.handlers: change_wave: updated wave 0 critter type to SOLDIER
12:03:06 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SOLDIER slots=5
12:03:13 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 wave_id=2 with 5 SLAVE slots
12:03:18 [INFO] gameserver.engine.attack_service: Attack started: id=1  2→100  army=1  ETA=60s
12:03:18 [INFO] gameserver.network.handlers: [new_attack] SUCCESS uid=2 → defender=100 army=1 attack_id=1 ETA=60.0s total=60.0s
12:04:17 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=2, defender=100, army=1)
12:04:18 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=2, defender=100, army=1)
12:04:18 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=2 defender=100 army=1
12:04:18 [ERROR] gameserver.network.handlers: [battle:start_requested] FAIL: defender 100 map has no valid path
14:33:38 [INFO] __main__: Shutdown signal received — stopping …
14:33:38 [INFO] __main__: Shutting down …
14:33:38 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
14:33:38 [INFO] websockets.server: server closing
14:33:38 [INFO] websockets.server: server closed
14:33:38 [INFO] gameserver.network.server: WebSocket server stopped
14:33:38 [INFO] __main__:   WebSocket server stopped
14:33:38 [INFO] __main__:   REST API server stopped
14:33:38 [INFO] __main__:   debug dashboard stopped
14:33:38 [INFO] __main__:   database closed
14:33:38 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

14:33:40 [INFO] __main__: === Game Server starting ===
14:33:40 [INFO] __main__: Loading configuration …
14:33:41 [INFO] __main__:   items:        210 loaded from config
14:33:41 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
14:33:41 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:33:41 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
14:33:41 [INFO] __main__:   game_config:  loaded
14:33:41 [INFO] __main__: Initializing persistence …
14:33:41 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:33:41 [INFO] __main__:   database:     connected (gameserver.db)
14:33:41 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
14:33:41 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
14:33:41 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
14:33:41 [INFO] __main__: Creating services …
14:33:41 [INFO] __main__:   upgrade_provider: 210 items registered
14:33:41 [INFO] __main__:   all services created
14:33:41 [INFO] __main__: Wiring event handlers …
14:33:41 [INFO] __main__:   event handlers registered
14:33:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:33:41 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:33:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:33:41 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
14:33:41 [INFO] __main__: Restored 2 empires from saved state
14:33:41 [INFO] __main__: Restored 1 attacks from saved state
14:33:41 [INFO] __main__: Starting network servers …
14:33:41 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:33:41 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:33:41 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:33:41 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:33:42 [INFO] gameserver.network.rest_api: REST API created with 20 routes
14:33:42 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [21614]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
14:33:42 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:33:42 [INFO] __main__: Starting game loop …
14:33:42 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
14:33:43 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
14:33:44 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
14:33:44 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
14:33:44 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
14:33:44 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
14:33:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
14:33:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
14:33:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
14:33:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
14:33:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
14:33:52 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
14:33:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
14:33:56 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
14:33:58 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
14:33:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
14:34:00 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
14:34:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
14:34:02 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
14:34:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
14:34:04 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
14:34:04 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
14:34:06 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
14:34:08 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
14:34:10 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
14:34:12 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
14:34:12 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
14:34:12 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
14:34:12 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
