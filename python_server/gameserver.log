11:54:48 [INFO] __main__: === Game Server starting ===
11:54:48 [INFO] __main__: Loading configuration …
11:54:48 [INFO] __main__:   items:        210 loaded from config
11:54:48 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:54:48 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:54:48 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:54:48 [INFO] __main__:   game_config:  loaded
11:54:48 [INFO] __main__: Initializing persistence …
11:54:48 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:54:48 [INFO] __main__:   database:     connected (gameserver.db)
11:54:48 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:54:48 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:54:48 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:54:48 [INFO] __main__: Creating services …
11:54:48 [INFO] __main__:   upgrade_provider: 210 items registered
11:54:48 [INFO] __main__:   all services created
11:54:48 [INFO] __main__: Wiring event handlers …
11:54:48 [INFO] __main__:   event handlers registered
11:54:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:54:48 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:54:48 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:54:48 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:54:48 [INFO] __main__: Restored 2 empires from saved state
11:54:48 [INFO] __main__: Restored 1 attacks from saved state
11:54:48 [INFO] __main__: Starting network servers …
11:54:48 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:54:48 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:54:48 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:54:48 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:54:49 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:54:49 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17520]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:54:50 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:54:50 [INFO] __main__: Starting game loop …
11:54:50 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:54:51 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
11:54:52 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:54:52 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:54:52 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:54:52 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:54:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:54:52 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.001 (speed=0.15, dt_ms=16.7, distance=0.003)
11:54:52 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.040 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:53 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.077 (speed=0.15, dt_ms=15.4, distance=0.002)
11:54:53 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.114 (speed=0.15, dt_ms=15.4, distance=0.002)
11:54:53 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:54:54 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.152 (speed=0.15, dt_ms=15.7, distance=0.002)
11:54:54 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.006 (speed=0.15, dt_ms=15.7, distance=0.002)
11:54:54 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.189 (speed=0.15, dt_ms=15.4, distance=0.002)
11:54:54 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.043 (speed=0.15, dt_ms=15.4, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.227 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.081 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.264 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.118 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:55 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.302 (speed=0.15, dt_ms=16.5, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.157 (speed=0.15, dt_ms=16.5, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.011 (speed=0.15, dt_ms=16.5, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.339 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.194 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:56 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.047 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.414 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.268 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.122 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.419 (speed=0.15, dt_ms=70.3, distance=0.011)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.273 (speed=0.15, dt_ms=70.3, distance=0.011)
11:54:57 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.127 (speed=0.15, dt_ms=70.3, distance=0.011)
11:54:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.452 (speed=0.15, dt_ms=15.8, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.307 (speed=0.15, dt_ms=15.8, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.161 (speed=0.15, dt_ms=15.8, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.014 (speed=0.15, dt_ms=15.8, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.489 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.343 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.197 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.051 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.490 (speed=0.15, dt_ms=17.0, distance=0.003)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.344 (speed=0.15, dt_ms=17.0, distance=0.003)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.198 (speed=0.15, dt_ms=17.0, distance=0.003)
11:54:58 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.052 (speed=0.15, dt_ms=17.0, distance=0.003)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.527 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.381 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.235 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.089 (speed=0.15, dt_ms=16.0, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.564 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.419 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.273 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.126 (speed=0.15, dt_ms=15.5, distance=0.002)
11:54:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.602 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.456 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.310 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.164 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.018 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.639 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.493 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.347 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.201 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:00 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.055 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.677 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.532 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.386 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.239 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.093 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=1 moved to progress=0.714 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.569 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.423 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.276 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.130 (speed=0.15, dt_ms=15.3, distance=0.002)
11:55:01 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.72
11:55:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.606 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.460 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.314 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.168 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.022 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.643 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.497 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.351 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.204 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.059 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.645 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.499 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.353 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.207 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:02 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.061 (speed=0.15, dt_ms=28.0, distance=0.004)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.681 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.535 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.389 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.242 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.097 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.682 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.536 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.390 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.243 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.098 (speed=0.15, dt_ms=19.4, distance=0.003)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.719 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.573 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.427 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.280 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:03 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.135 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.756 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.610 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.463 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.317 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.172 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.757 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.611 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.465 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.318 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.173 (speed=0.15, dt_ms=17.6, distance=0.003)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.794 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.648 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.501 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.355 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:04 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.209 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.832 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.685 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.539 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.393 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.247 (speed=0.15, dt_ms=17.3, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.868 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.722 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.576 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.429 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.284 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=2 moved to progress=0.870 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.723 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.577 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.431 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.285 (speed=0.15, dt_ms=17.4, distance=0.003)
11:55:05 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=0.88
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.760 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.614 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.467 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.322 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.798 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.651 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.505 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.360 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:06 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.835 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.689 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.543 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.397 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.034 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.873 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.726 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.580 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.434 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.071 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.874 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.728 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.581 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.436 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:07 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.073 (speed=0.15, dt_ms=23.2, distance=0.003)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.910 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.764 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.617 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.472 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.109 (speed=0.15, dt_ms=16.3, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.947 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.801 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.655 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.509 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.146 (speed=0.15, dt_ms=15.2, distance=0.002)
11:55:08 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=3 moved to progress=0.986 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.839 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.693 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.548 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.184 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.038 (speed=0.15, dt_ms=15.8, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.876 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.730 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.584 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.221 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.075 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:09 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=3 (SWORDMAN) killed at path_progress=1.00
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.914 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.767 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.622 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.259 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.113 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.952 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.805 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.660 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.297 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.150 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:10 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.005 (speed=0.15, dt_ms=15.4, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=4 moved to progress=0.989 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.843 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.697 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.334 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.188 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.042 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.880 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.735 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.372 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.226 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:11 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.080 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.918 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.773 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.410 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.263 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.118 (speed=0.15, dt_ms=17.2, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned with path_length=3, path=[Hex(0,2), Hex(0,1), Hex(1,0)]
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.954 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.809 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.446 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.300 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.154 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.007 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.956 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.811 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.448 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.301 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.156 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:12 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.009 (speed=0.15, dt_ms=21.7, distance=0.003)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=5 moved to progress=0.993 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.847 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.484 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.338 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.192 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.045 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.885 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.522 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.376 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.230 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.083 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:13 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=4 (SWORDMAN) killed at path_progress=1.00
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.922 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.559 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.412 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.267 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.120 (speed=0.15, dt_ms=16.9, distance=0.003)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.960 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.596 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.450 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.304 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:14 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.157 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=6 moved to progress=0.997 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.634 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.488 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.342 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.195 (speed=0.15, dt_ms=15.9, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.672 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.526 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.380 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:15 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.233 (speed=0.15, dt_ms=16.1, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.709 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.563 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.417 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.270 (speed=0.15, dt_ms=15.7, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.746 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.600 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.454 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:16 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.307 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.783 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.637 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.491 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.344 (speed=0.15, dt_ms=15.6, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.785 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.638 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.493 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.346 (speed=0.15, dt_ms=17.0, distance=0.003)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.822 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.676 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.530 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:17 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.383 (speed=0.15, dt_ms=16.0, distance=0.002)
11:55:17 [INFO] __main__: Shutdown signal received — stopping …
11:55:17 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=5 (SWORDMAN) killed at path_progress=1.00
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.859 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.713 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.567 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.420 (speed=0.15, dt_ms=15.5, distance=0.002)
11:55:18 [INFO] __main__: Shutting down …
11:55:18 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
11:55:18 [INFO] websockets.server: server closing
11:55:18 [INFO] websockets.server: server closed
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=7 moved to progress=0.862 (speed=0.15, dt_ms=34.3, distance=0.005)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=8 moved to progress=0.715 (speed=0.15, dt_ms=34.3, distance=0.005)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=9 moved to progress=0.570 (speed=0.15, dt_ms=34.3, distance=0.005)
11:55:18 [INFO] gameserver.engine.battle_service: [MOVE] Critter cid=10 moved to progress=0.423 (speed=0.15, dt_ms=34.3, distance=0.005)
11:55:18 [INFO] gameserver.network.server: WebSocket server stopped
11:55:18 [INFO] __main__:   WebSocket server stopped
11:55:18 [INFO] __main__:   REST API server stopped
11:55:18 [INFO] __main__:   debug dashboard stopped
11:55:18 [INFO] __main__:   database closed
11:55:18 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

11:55:19 [INFO] __main__: === Game Server starting ===
11:55:19 [INFO] __main__: Loading configuration …
11:55:20 [INFO] __main__:   items:        210 loaded from config
11:55:20 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:55:20 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:55:20 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:55:20 [INFO] __main__:   game_config:  loaded
11:55:20 [INFO] __main__: Initializing persistence …
11:55:20 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:55:20 [INFO] __main__:   database:     connected (gameserver.db)
11:55:20 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:55:20 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:55:20 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:55:20 [INFO] __main__: Creating services …
11:55:20 [INFO] __main__:   upgrade_provider: 210 items registered
11:55:20 [INFO] __main__:   all services created
11:55:20 [INFO] __main__: Wiring event handlers …
11:55:20 [INFO] __main__:   event handlers registered
11:55:20 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:55:20 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:55:20 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:55:20 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:55:20 [INFO] __main__: Restored 2 empires from saved state
11:55:20 [INFO] __main__: Restored 1 attacks from saved state
11:55:20 [INFO] __main__: Starting network servers …
11:55:20 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:55:20 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:55:20 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:55:20 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:55:21 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:55:21 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17614]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:55:21 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:55:21 [INFO] __main__: Starting game loop …
11:55:21 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:55:22 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
11:55:23 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:55:23 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:55:23 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:55:23 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:55:23 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
11:55:25 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:55:27 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:55:27 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=1.00
11:55:29 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:55:31 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:55:31 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=1.00
11:55:33 [INFO] __main__: Shutdown signal received — stopping …
11:55:33 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:55:33 [INFO] __main__: Shutting down …
11:55:33 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
11:55:33 [INFO] websockets.server: server closing
11:55:33 [INFO] websockets.server: server closed
11:55:33 [INFO] gameserver.network.server: WebSocket server stopped
11:55:33 [INFO] __main__:   WebSocket server stopped
11:55:33 [INFO] __main__:   REST API server stopped
11:55:33 [INFO] __main__:   debug dashboard stopped
11:55:33 [INFO] __main__:   database closed
11:55:33 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

11:55:35 [INFO] __main__: === Game Server starting ===
11:55:35 [INFO] __main__: Loading configuration …
11:55:35 [INFO] __main__:   items:        210 loaded from config
11:55:35 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:55:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:55:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:55:35 [INFO] __main__:   game_config:  loaded
11:55:35 [INFO] __main__: Initializing persistence …
11:55:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:55:35 [INFO] __main__:   database:     connected (gameserver.db)
11:55:36 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:55:36 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:55:36 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:55:36 [INFO] __main__: Creating services …
11:55:36 [INFO] __main__:   upgrade_provider: 210 items registered
11:55:36 [INFO] __main__:   all services created
11:55:36 [INFO] __main__: Wiring event handlers …
11:55:36 [INFO] __main__:   event handlers registered
11:55:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:55:36 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:55:36 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:55:36 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:55:36 [INFO] __main__: Restored 2 empires from saved state
11:55:36 [INFO] __main__: Restored 1 attacks from saved state
11:55:36 [INFO] __main__: Starting network servers …
11:55:36 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:55:36 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:55:36 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:55:36 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:55:37 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:55:37 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17674]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:55:37 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:55:37 [INFO] __main__: Starting game loop …
11:55:37 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:55:38 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
INFO:     192.168.178.2:56554 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:55:38 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:55:38 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:55:38 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
11:55:38 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:55:39 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:55:39 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:55:39 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:55:39 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:55:39 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
11:55:41 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:55:43 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:55:43 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=1.00
11:55:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:55:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:55:47 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=1.00
11:55:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:55:51 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=3 (SWORDMAN) killed at path_progress=1.00
11:55:53 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
11:55:55 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=4 (SWORDMAN) killed at path_progress=1.00
11:55:55 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
11:55:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
11:55:59 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=5 (SWORDMAN) killed at path_progress=1.00
11:55:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
11:56:03 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=6 (SWORDMAN) killed at path_progress=1.00
11:56:04 [INFO] __main__: Shutdown signal received — stopping …
11:56:05 [INFO] __main__: Shutting down …
11:56:05 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
11:56:05 [INFO] websockets.server: server closing
11:56:05 [INFO] websockets.server: server closed
11:56:05 [INFO] gameserver.network.server: WebSocket server stopped
11:56:05 [INFO] __main__:   WebSocket server stopped
11:56:05 [INFO] __main__:   REST API server stopped
11:56:05 [INFO] __main__:   debug dashboard stopped
11:56:05 [INFO] __main__:   database closed
11:56:05 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/applications.py", line 1138, in __call__
    await super().__call__(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 147, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 144, in app
    await func(session)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 509, in app
    await dependant.call(**solved_result.values)
  File "/home/pi/e3/python_server/src/gameserver/network/rest_api.py", line 286, in websocket_endpoint
    raw = await ws.receive_text()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 119, in receive_text
    message = await self.receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 47, in receive
    message = await self._receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 375, in asgi_receive
    data = await self.recv()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/legacy/protocol.py", line 538, in recv
    await asyncio.wait(
  File "/usr/lib/python3.9/asyncio/tasks.py", line 413, in wait
    return await _wait(fs, timeout, return_when, loop)
  File "/usr/lib/python3.9/asyncio/tasks.py", line 529, in _wait
    await waiter
asyncio.exceptions.CancelledError
INFO:     connection closed
11:56:06 [INFO] __main__: === Game Server starting ===
11:56:06 [INFO] __main__: Loading configuration …
11:56:07 [INFO] __main__:   items:        210 loaded from config
11:56:07 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:56:07 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:56:07 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:56:07 [INFO] __main__:   game_config:  loaded
11:56:07 [INFO] __main__: Initializing persistence …
11:56:07 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:56:07 [INFO] __main__:   database:     connected (gameserver.db)
11:56:07 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:56:07 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:56:07 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:56:07 [INFO] __main__: Creating services …
11:56:07 [INFO] __main__:   upgrade_provider: 210 items registered
11:56:07 [INFO] __main__:   all services created
11:56:07 [INFO] __main__: Wiring event handlers …
11:56:07 [INFO] __main__:   event handlers registered
11:56:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:56:07 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:56:07 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:56:07 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:56:07 [INFO] __main__: Restored 2 empires from saved state
11:56:07 [INFO] __main__: Restored 1 attacks from saved state
11:56:07 [INFO] __main__: Starting network servers …
11:56:07 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:56:07 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:56:07 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:56:07 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:56:08 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:56:08 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17754]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:56:08 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:56:08 [INFO] __main__: Starting game loop …
11:56:08 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
INFO:     192.168.178.2:60560 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:56:08 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:56:08 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:56:08 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=travelling)
11:56:08 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:56:09 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
11:56:10 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:56:10 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:56:10 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:56:10 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:56:10 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
11:56:12 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:56:14 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:56:14 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=1.00
11:56:15 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:60573 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:56:15 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:56:15 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:56:15 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
11:56:15 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:56:16 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:56:18 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:56:18 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=1.00
11:56:20 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:56:22 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=3 (SWORDMAN) killed at path_progress=1.00
11:56:23 [INFO] __main__: Shutdown signal received — stopping …
11:56:24 [INFO] __main__: Shutting down …
11:56:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
11:56:24 [INFO] websockets.server: server closing
11:56:24 [INFO] websockets.server: server closed
11:56:24 [INFO] gameserver.network.server: WebSocket server stopped
11:56:24 [INFO] __main__:   WebSocket server stopped
11:56:24 [INFO] __main__:   REST API server stopped
11:56:24 [INFO] __main__:   debug dashboard stopped
11:56:24 [INFO] __main__:   database closed
11:56:24 [INFO] __main__:   goodbye
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/applications.py", line 1138, in __call__
    await super().__call__(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 147, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 144, in app
    await func(session)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 509, in app
    await dependant.call(**solved_result.values)
  File "/home/pi/e3/python_server/src/gameserver/network/rest_api.py", line 286, in websocket_endpoint
    raw = await ws.receive_text()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 119, in receive_text
    message = await self.receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 47, in receive
    message = await self._receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 375, in asgi_receive
    data = await self.recv()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/legacy/protocol.py", line 538, in recv
    await asyncio.wait(
  File "/usr/lib/python3.9/asyncio/tasks.py", line 413, in wait
    return await _wait(fs, timeout, return_when, loop)
  File "/usr/lib/python3.9/asyncio/tasks.py", line 529, in _wait
    await waiter
asyncio.exceptions.CancelledError
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

INFO:     connection closed
11:56:26 [INFO] __main__: === Game Server starting ===
11:56:26 [INFO] __main__: Loading configuration …
11:56:27 [INFO] __main__:   items:        210 loaded from config
11:56:27 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:56:27 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:56:27 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:56:27 [INFO] __main__:   game_config:  loaded
11:56:27 [INFO] __main__: Initializing persistence …
11:56:27 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:56:27 [INFO] __main__:   database:     connected (gameserver.db)
11:56:27 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:56:27 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:56:27 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:56:27 [INFO] __main__: Creating services …
11:56:27 [INFO] __main__:   upgrade_provider: 210 items registered
11:56:27 [INFO] __main__:   all services created
11:56:27 [INFO] __main__: Wiring event handlers …
11:56:27 [INFO] __main__:   event handlers registered
11:56:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:56:27 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:56:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:56:27 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:56:27 [INFO] __main__: Restored 2 empires from saved state
11:56:27 [INFO] __main__: Restored 1 attacks from saved state
11:56:27 [INFO] __main__: Starting network servers …
11:56:27 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:56:27 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:56:27 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:56:27 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:56:28 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:56:28 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17828]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:56:28 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:56:28 [INFO] __main__: Starting game loop …
11:56:28 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:56:29 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
11:56:30 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:56:30 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:56:30 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:56:30 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:56:30 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
INFO:     192.168.178.2:60592 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:56:31 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:56:31 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:56:31 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
11:56:31 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:56:32 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:56:34 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:56:36 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:56:38 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:56:38 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
11:56:40 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:56:42 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=2 (SWORDMAN) killed at path_progress=1.00
11:56:45 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
11:56:46 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=3 (SWORDMAN) killed at path_progress=1.00
11:56:47 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
11:56:49 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
11:56:50 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=4 (SWORDMAN) killed at path_progress=1.00
11:56:51 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
11:56:54 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=5 (SWORDMAN) killed at path_progress=1.00
11:56:58 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=6 (SWORDMAN) killed at path_progress=1.00
11:57:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=1.00
11:57:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=1.00
11:57:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=1.00
11:57:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.97
11:57:00 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
11:57:00 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
11:57:00 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
11:58:58 [INFO] __main__: Shutdown signal received — stopping …
11:58:59 [INFO] __main__: Shutting down …
11:58:59 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
11:58:59 [INFO] websockets.server: server closing
11:58:59 [INFO] websockets.server: server closed
11:58:59 [INFO] gameserver.network.server: WebSocket server stopped
11:58:59 [INFO] __main__:   WebSocket server stopped
11:58:59 [INFO] __main__:   REST API server stopped
11:58:59 [INFO] __main__:   debug dashboard stopped
11:58:59 [INFO] __main__:   database closed
11:58:59 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/applications.py", line 1138, in __call__
    await super().__call__(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 147, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 144, in app
    await func(session)
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/fastapi/routing.py", line 509, in app
    await dependant.call(**solved_result.values)
  File "/home/pi/e3/python_server/src/gameserver/network/rest_api.py", line 286, in websocket_endpoint
    raw = await ws.receive_text()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 119, in receive_text
    message = await self.receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/websockets.py", line 47, in receive
    message = await self._receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 375, in asgi_receive
    data = await self.recv()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/websockets/legacy/protocol.py", line 538, in recv
    await asyncio.wait(
  File "/usr/lib/python3.9/asyncio/tasks.py", line 413, in wait
    return await _wait(fs, timeout, return_when, loop)
  File "/usr/lib/python3.9/asyncio/tasks.py", line 529, in _wait
    await waiter
asyncio.exceptions.CancelledError
INFO:     connection closed
11:59:01 [INFO] __main__: === Game Server starting ===
11:59:01 [INFO] __main__: Loading configuration …
11:59:02 [INFO] __main__:   items:        210 loaded from config
11:59:02 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
11:59:02 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
11:59:02 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
11:59:02 [INFO] __main__:   game_config:  loaded
11:59:02 [INFO] __main__: Initializing persistence …
11:59:02 [INFO] gameserver.persistence.database: Database connected: gameserver.db
11:59:02 [INFO] __main__:   database:     connected (gameserver.db)
11:59:02 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
11:59:02 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
11:59:02 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
11:59:02 [INFO] __main__: Creating services …
11:59:02 [INFO] __main__:   upgrade_provider: 210 items registered
11:59:02 [INFO] __main__:   all services created
11:59:02 [INFO] __main__: Wiring event handlers …
11:59:02 [INFO] __main__:   event handlers registered
11:59:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
11:59:02 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
11:59:02 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
11:59:02 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
11:59:02 [INFO] __main__: Restored 2 empires from saved state
11:59:02 [INFO] __main__: Restored 1 attacks from saved state
11:59:02 [INFO] __main__: Starting network servers …
11:59:02 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
11:59:02 [INFO] websockets.server: server listening on 0.0.0.0:8765
11:59:02 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
11:59:02 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
11:59:03 [INFO] gameserver.network.rest_api: REST API created with 20 routes
11:59:03 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [17987]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
11:59:03 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
11:59:03 [INFO] __main__: Starting game loop …
11:59:03 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
11:59:04 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
INFO:     192.168.178.2:56386 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:59:05 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:59:05 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:59:05 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
11:59:05 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:59:05 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
11:59:05 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
11:59:05 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
11:59:05 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
11:59:05 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
11:59:07 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
11:59:09 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
11:59:11 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
11:59:13 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
11:59:13 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
11:59:15 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
11:59:17 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
11:59:19 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
11:59:19 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
11:59:21 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
11:59:21 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
11:59:23 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
11:59:23 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
11:59:25 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
11:59:25 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
11:59:25 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
11:59:25 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
INFO:     192.168.178.2:56399 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:59:26 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:59:26 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:59:26 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
11:59:26 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
11:59:27 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
11:59:29 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
11:59:31 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
11:59:33 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
11:59:33 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
11:59:33 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
11:59:33 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
11:59:33 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
11:59:33 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
INFO:     192.168.178.2:56405 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
11:59:42 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
11:59:42 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
11:59:42 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
11:59:47 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
11:59:47 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
12:00:49 [INFO] __main__: Shutdown signal received — stopping …
12:00:50 [INFO] __main__: Shutting down …
12:00:50 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
12:00:50 [INFO] websockets.server: server closing
12:00:50 [INFO] websockets.server: server closed
12:00:50 [INFO] gameserver.network.server: WebSocket server stopped
12:00:50 [INFO] __main__:   WebSocket server stopped
12:00:50 [INFO] __main__:   REST API server stopped
12:00:50 [INFO] __main__:   debug dashboard stopped
12:00:50 [INFO] __main__:   database closed
12:00:50 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

12:00:52 [INFO] __main__: === Game Server starting ===
12:00:52 [INFO] __main__: Loading configuration …
12:00:53 [INFO] __main__:   items:        210 loaded from config
12:00:53 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
12:00:53 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
12:00:53 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
12:00:53 [INFO] __main__:   game_config:  loaded
12:00:53 [INFO] __main__: Initializing persistence …
12:00:53 [INFO] gameserver.persistence.database: Database connected: gameserver.db
12:00:53 [INFO] __main__:   database:     connected (gameserver.db)
12:00:53 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
12:00:53 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
12:00:53 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
12:00:53 [INFO] __main__: Creating services …
12:00:53 [INFO] __main__:   upgrade_provider: 210 items registered
12:00:53 [INFO] __main__:   all services created
12:00:53 [INFO] __main__: Wiring event handlers …
12:00:53 [INFO] __main__:   event handlers registered
12:00:53 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
12:00:53 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
12:00:53 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
12:00:53 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
12:00:53 [INFO] __main__: Restored 2 empires from saved state
12:00:53 [INFO] __main__: Restored 1 attacks from saved state
12:00:53 [INFO] __main__: Starting network servers …
12:00:53 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
12:00:53 [INFO] websockets.server: server listening on 0.0.0.0:8765
12:00:53 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
12:00:53 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
12:00:54 [INFO] gameserver.network.rest_api: REST API created with 20 routes
12:00:54 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [18131]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
12:00:54 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
12:00:54 [INFO] __main__: Starting game loop …
12:00:54 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
12:00:55 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
12:00:56 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
12:00:56 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
12:00:56 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
12:00:56 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
12:00:56 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
12:00:58 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
12:01:00 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
12:01:02 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
12:01:04 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
12:01:04 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
12:01:06 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
12:01:08 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
12:01:10 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
12:01:11 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
12:01:12 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
12:01:13 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
12:01:14 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
12:01:15 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
12:01:16 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
12:01:17 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
12:01:18 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
12:01:20 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
12:01:22 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
12:01:24 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
12:01:24 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
12:01:24 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
12:01:24 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
12:02:59 [INFO] gameserver.network.handlers: new_army success uid=2 aid=1 name=huhu
12:03:03 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 wave_id=1 with 5 SLAVE slots
12:03:06 [INFO] gameserver.network.handlers: change_wave: updated wave 0 critter type to SOLDIER
12:03:06 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=1 wave=0 critter_iid=SOLDIER slots=5
12:03:13 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 wave_id=2 with 5 SLAVE slots
12:03:18 [INFO] gameserver.engine.attack_service: Attack started: id=1  2→100  army=1  ETA=60s
12:03:18 [INFO] gameserver.network.handlers: [new_attack] SUCCESS uid=2 → defender=100 army=1 attack_id=1 ETA=60.0s total=60.0s
12:04:17 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=2, defender=100, army=1)
12:04:18 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=2, defender=100, army=1)
12:04:18 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=2 defender=100 army=1
12:04:18 [ERROR] gameserver.network.handlers: [battle:start_requested] FAIL: defender 100 map has no valid path
14:33:38 [INFO] __main__: Shutdown signal received — stopping …
14:33:38 [INFO] __main__: Shutting down …
14:33:38 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
14:33:38 [INFO] websockets.server: server closing
14:33:38 [INFO] websockets.server: server closed
14:33:38 [INFO] gameserver.network.server: WebSocket server stopped
14:33:38 [INFO] __main__:   WebSocket server stopped
14:33:38 [INFO] __main__:   REST API server stopped
14:33:38 [INFO] __main__:   debug dashboard stopped
14:33:38 [INFO] __main__:   database closed
14:33:38 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

14:33:40 [INFO] __main__: === Game Server starting ===
14:33:40 [INFO] __main__: Loading configuration …
14:33:41 [INFO] __main__:   items:        210 loaded from config
14:33:41 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
14:33:41 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
14:33:41 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
14:33:41 [INFO] __main__:   game_config:  loaded
14:33:41 [INFO] __main__: Initializing persistence …
14:33:41 [INFO] gameserver.persistence.database: Database connected: gameserver.db
14:33:41 [INFO] __main__:   database:     connected (gameserver.db)
14:33:41 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
14:33:41 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
14:33:41 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
14:33:41 [INFO] __main__: Creating services …
14:33:41 [INFO] __main__:   upgrade_provider: 210 items registered
14:33:41 [INFO] __main__:   all services created
14:33:41 [INFO] __main__: Wiring event handlers …
14:33:41 [INFO] __main__:   event handlers registered
14:33:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
14:33:41 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
14:33:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
14:33:41 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
14:33:41 [INFO] __main__: Restored 2 empires from saved state
14:33:41 [INFO] __main__: Restored 1 attacks from saved state
14:33:41 [INFO] __main__: Starting network servers …
14:33:41 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
14:33:41 [INFO] websockets.server: server listening on 0.0.0.0:8765
14:33:41 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
14:33:41 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
14:33:42 [INFO] gameserver.network.rest_api: REST API created with 20 routes
14:33:42 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [21614]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
14:33:42 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
14:33:42 [INFO] __main__: Starting game loop …
14:33:42 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
14:33:43 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
14:33:44 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
14:33:44 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
14:33:44 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
14:33:44 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
14:33:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
14:33:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
14:33:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
14:33:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
14:33:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
14:33:52 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
14:33:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
14:33:56 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
14:33:58 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
14:33:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
14:34:00 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
14:34:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
14:34:02 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
14:34:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
14:34:04 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
14:34:04 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
14:34:06 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
14:34:08 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
14:34:10 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
14:34:12 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
14:34:12 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
14:34:12 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
14:34:12 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
15:58:26 [INFO] gameserver.network.handlers: new_item failed uid=2 iid=STABLES: Not enough gold (need 9000, have 8903.3)
15:58:33 [INFO] gameserver.network.handlers: new_item failed uid=2 iid=STABLES: Not enough gold (need 9000, have 8905.2)
INFO:     192.168.178.25:51891 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MTc3NywiZXhwIjoxNzcxMjM4MTc3fQ.Txkk5oEDBx2Lou4npQ66AKAuTi_QYv-V-R7i_PGAfG0" [accepted]
16:05:04 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:05:04 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:05:04 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:07:25 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
16:07:25 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
16:11:07 [INFO] __main__: Shutdown signal received — stopping …
16:11:07 [INFO] __main__: Shutting down …
16:11:07 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:11:07 [INFO] websockets.server: server closing
16:11:07 [INFO] websockets.server: server closed
16:11:07 [INFO] gameserver.network.server: WebSocket server stopped
16:11:07 [INFO] __main__:   WebSocket server stopped
16:11:07 [INFO] __main__:   REST API server stopped
16:11:07 [INFO] __main__:   debug dashboard stopped
16:11:07 [INFO] __main__:   database closed
16:11:07 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

16:11:40 [INFO] __main__: === Game Server starting ===
16:11:40 [INFO] __main__: Loading configuration …
16:11:41 [INFO] __main__:   items:        210 loaded from config
16:11:41 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
16:11:41 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:11:41 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
16:11:41 [INFO] __main__:   game_config:  loaded
16:11:41 [INFO] __main__: Initializing persistence …
16:11:41 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:11:41 [INFO] __main__:   database:     connected (gameserver.db)
16:11:41 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
16:11:41 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
16:11:41 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
16:11:41 [INFO] __main__: Creating services …
16:11:41 [INFO] __main__:   upgrade_provider: 210 items registered
16:11:41 [INFO] __main__:   all services created
16:11:41 [INFO] __main__: Wiring event handlers …
16:11:41 [INFO] __main__:   event handlers registered
16:11:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:11:41 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:11:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:11:41 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
16:11:41 [INFO] __main__: Restored 2 empires from saved state
16:11:41 [INFO] __main__: Restored 1 attacks from saved state
16:11:41 [INFO] __main__: Starting network servers …
16:11:41 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:11:41 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:11:41 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:11:41 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:11:42 [INFO] gameserver.network.rest_api: REST API created with 21 routes
16:11:42 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [25256]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
16:11:42 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:11:42 [INFO] __main__: Starting game loop …
16:11:42 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
16:11:43 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
16:11:44 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
16:11:44 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
16:11:44 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
16:11:44 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
16:11:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
16:11:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
16:11:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
16:11:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
16:11:51 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:11:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
16:11:52 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
16:11:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
INFO:     192.168.178.25:51926 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
16:11:56 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:11:56 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:11:56 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
16:11:56 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
16:11:56 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
16:11:56 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
16:11:56 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
16:11:58 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
16:11:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
16:12:00 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
16:12:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
16:12:02 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
16:12:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
16:12:04 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
16:12:05 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
16:12:06 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
16:12:08 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.75
16:12:11 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
16:12:13 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.76
16:12:13 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
16:12:13 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
16:12:13 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
INFO:     192.168.178.25:51928 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
16:12:21 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:12:21 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:12:21 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:12:51 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
16:12:51 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
16:28:09 [INFO] __main__: Shutdown signal received — stopping …
16:28:10 [INFO] __main__: Shutting down …
16:28:10 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:28:10 [INFO] websockets.server: server closing
16:28:10 [INFO] websockets.server: server closed
16:28:10 [INFO] gameserver.network.server: WebSocket server stopped
16:28:10 [INFO] __main__:   WebSocket server stopped
16:28:10 [INFO] __main__:   REST API server stopped
16:28:10 [INFO] __main__:   debug dashboard stopped
16:28:10 [INFO] __main__:   database closed
16:28:10 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

16:28:11 [INFO] __main__: === Game Server starting ===
16:28:11 [INFO] __main__: Loading configuration …
16:28:12 [INFO] __main__:   items:        210 loaded from config
16:28:12 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
16:28:12 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:28:12 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
16:28:12 [INFO] __main__:   game_config:  loaded
16:28:12 [INFO] __main__: Initializing persistence …
16:28:12 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:28:12 [INFO] __main__:   database:     connected (gameserver.db)
16:28:12 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
16:28:12 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
16:28:12 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
16:28:12 [INFO] __main__: Creating services …
16:28:12 [INFO] __main__:   upgrade_provider: 210 items registered
16:28:12 [INFO] __main__:   all services created
16:28:12 [INFO] __main__: Wiring event handlers …
16:28:12 [INFO] __main__:   event handlers registered
16:28:12 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:28:12 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:28:12 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:28:12 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
16:28:12 [INFO] __main__: Restored 2 empires from saved state
16:28:12 [INFO] __main__: Restored 1 attacks from saved state
16:28:12 [INFO] __main__: Starting network servers …
16:28:12 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:28:12 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:28:12 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:28:12 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:28:13 [INFO] gameserver.network.rest_api: REST API created with 21 routes
16:28:13 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [25655]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
16:28:13 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:28:13 [INFO] __main__: Starting game loop …
16:28:13 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
16:28:14 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
16:28:15 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
16:28:15 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
16:28:15 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
16:28:15 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
16:28:15 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
16:28:17 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
INFO:     192.168.178.2:51388 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:28:18 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:28:18 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:28:18 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
16:28:18 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
16:28:19 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
16:28:21 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
16:28:21 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
16:28:21 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
16:28:23 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
16:28:23 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
16:28:25 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
16:28:27 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
16:28:29 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
16:28:30 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
16:28:31 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
16:28:32 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
16:28:33 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
16:28:34 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
16:28:35 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
16:28:36 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
16:28:37 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
16:28:39 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.75
16:28:41 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
16:28:43 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
16:28:43 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
16:28:43 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
16:28:43 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
16:29:46 [INFO] gameserver.network.handlers: Tile 2,-1 purchased by empire Empire1 (uid=2)
16:43:56 [INFO] gameserver.network.handlers: Tile 1,1 purchased by empire Empire1 (uid=2)
16:44:02 [INFO] gameserver.network.handlers: Tile 2,0 purchased by empire Empire1 (uid=2)
16:44:08 [INFO] gameserver.network.handlers: Tile -1,2 purchased by empire Empire1 (uid=2)
16:45:30 [INFO] gameserver.network.handlers: Tile -1,1 purchased by empire Empire1 (uid=2)
INFO:     192.168.178.2:51943 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:46:14 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:46:14 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:46:14 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:46:15 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
16:46:15 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:52092 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:48:18 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:48:18 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:48:18 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:48:19 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:52102 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:48:20 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:48:20 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:48:20 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:48:32 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
16:48:32 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:52106 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:48:37 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:48:37 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:48:37 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:50:51 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:52143 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:50:51 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:50:51 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:50:51 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:50:57 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
16:50:57 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:52144 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:50:59 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:50:59 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:50:59 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
INFO:     192.168.178.25:52006 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
16:51:24 [INFO] gameserver.network.server: Superseding existing session: uid=2
16:51:24 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:51:24 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:51:24 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
16:51:24 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
16:51:24 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:53025 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:51:26 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:51:26 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:51:26 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
INFO:     192.168.178.25:52016 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
16:51:34 [INFO] gameserver.network.server: Superseding existing session: uid=2
16:51:34 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:51:34 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:51:34 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:51:34 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
16:51:34 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
INFO:     192.168.178.2:53028 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:51:36 [INFO] gameserver.network.server: Superseding existing session: uid=2
16:51:36 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:51:36 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:51:36 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:51:36 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
16:51:36 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
16:52:10 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:53040 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:52:11 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:52:11 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:52:11 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:52:13 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
16:52:13 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:53042 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:52:16 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:52:16 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:52:16 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
INFO:     192.168.178.25:52030 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
16:52:25 [INFO] gameserver.network.server: Superseding existing session: uid=2
16:52:25 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:52:25 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:52:25 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:52:25 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
16:52:25 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
INFO:     192.168.178.2:53045 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
16:52:27 [INFO] gameserver.network.server: Superseding existing session: uid=2
16:52:27 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
16:52:27 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
16:52:27 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
16:52:27 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
16:52:27 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
16:52:31 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
16:52:31 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
16:59:17 [INFO] __main__: Shutdown signal received — stopping …
16:59:17 [INFO] __main__: Shutting down …
16:59:17 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
16:59:17 [INFO] websockets.server: server closing
16:59:17 [INFO] websockets.server: server closed
16:59:17 [INFO] gameserver.network.server: WebSocket server stopped
16:59:17 [INFO] __main__:   WebSocket server stopped
16:59:17 [INFO] __main__:   REST API server stopped
16:59:17 [INFO] __main__:   debug dashboard stopped
16:59:17 [INFO] __main__:   database closed
16:59:17 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

16:59:19 [INFO] __main__: === Game Server starting ===
16:59:19 [INFO] __main__: Loading configuration …
16:59:19 [INFO] __main__:   items:        210 loaded from config
16:59:19 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
16:59:19 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:59:19 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
16:59:19 [INFO] __main__:   game_config:  loaded
16:59:19 [INFO] __main__: Initializing persistence …
16:59:19 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:59:19 [INFO] __main__:   database:     connected (gameserver.db)
16:59:19 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
16:59:19 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
16:59:19 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
16:59:19 [INFO] __main__: Creating services …
16:59:19 [INFO] __main__:   upgrade_provider: 210 items registered
16:59:19 [INFO] __main__:   all services created
16:59:19 [INFO] __main__: Wiring event handlers …
16:59:19 [INFO] __main__:   event handlers registered
16:59:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:59:19 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:59:19 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:59:19 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
16:59:19 [INFO] __main__: Restored 2 empires from saved state
16:59:19 [INFO] __main__: Restored 1 attacks from saved state
16:59:19 [INFO] __main__: Starting network servers …
16:59:19 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:59:19 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:59:19 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:59:20 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:59:21 [INFO] gameserver.network.rest_api: REST API created with 21 routes
16:59:21 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [26714]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
16:59:21 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:59:21 [INFO] __main__: Starting game loop …
16:59:21 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
16:59:22 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
16:59:23 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
16:59:23 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
16:59:23 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
16:59:23 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
16:59:23 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
16:59:25 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
16:59:27 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
16:59:29 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
16:59:31 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
16:59:31 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
16:59:32 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
16:59:35 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
16:59:37 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
16:59:37 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
16:59:39 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
16:59:39 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
16:59:41 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
16:59:41 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
16:59:42 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
16:59:43 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
16:59:45 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
16:59:47 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
16:59:49 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
16:59:51 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
16:59:51 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
16:59:51 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
16:59:51 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
17:02:26 [INFO] __main__: Shutdown signal received — stopping …
17:02:27 [INFO] __main__: Shutting down …
17:02:27 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:02:27 [INFO] websockets.server: server closing
17:02:27 [INFO] websockets.server: server closed
17:02:27 [INFO] gameserver.network.server: WebSocket server stopped
17:02:27 [INFO] __main__:   WebSocket server stopped
17:02:27 [INFO] __main__:   REST API server stopped
17:02:27 [INFO] __main__:   debug dashboard stopped
17:02:27 [INFO] __main__:   database closed
17:02:27 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

17:02:29 [INFO] __main__: === Game Server starting ===
17:02:29 [INFO] __main__: Loading configuration …
17:02:30 [INFO] __main__:   items:        210 loaded from config
17:02:30 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
17:02:30 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:02:30 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
17:02:30 [INFO] __main__:   game_config:  loaded
17:02:30 [INFO] __main__: Initializing persistence …
17:02:30 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:02:30 [INFO] __main__:   database:     connected (gameserver.db)
17:02:30 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
17:02:30 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
17:02:30 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
17:02:30 [INFO] __main__: Creating services …
17:02:30 [INFO] __main__:   upgrade_provider: 210 items registered
17:02:30 [INFO] __main__:   all services created
17:02:30 [INFO] __main__: Wiring event handlers …
17:02:30 [INFO] __main__:   event handlers registered
17:02:30 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:02:30 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:02:30 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:02:30 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:02:30 [INFO] __main__: Restored 2 empires from saved state
17:02:30 [INFO] __main__: Restored 1 attacks from saved state
17:02:30 [INFO] __main__: Starting network servers …
17:02:30 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:02:30 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:02:30 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:02:30 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:02:31 [INFO] gameserver.network.rest_api: REST API created with 21 routes
17:02:31 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [26889]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
17:02:31 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:02:31 [INFO] __main__: Starting game loop …
17:02:31 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
17:02:31 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:02:32 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
17:02:33 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
17:02:33 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
17:02:33 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
17:02:33 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
17:02:33 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
17:02:35 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
17:02:35 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:02:37 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
17:02:39 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
17:02:40 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:02:41 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
17:02:41 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
17:02:43 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
17:02:45 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
17:02:45 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:02:47 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
17:02:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
17:02:49 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
17:02:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
17:02:50 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:02:51 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
17:02:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
17:02:53 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
17:02:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
17:02:55 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.76
17:02:55 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:02:57 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.77
17:02:59 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.77
17:03:00 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:01 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.78
17:03:01 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
17:03:01 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
17:03:01 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
17:03:05 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:11 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:16 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:21 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:26 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:31 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:37 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:42 [INFO] __main__: Shutdown signal received — stopping …
17:03:42 [INFO] gameserver.network.handlers: [Summary] Empire Empire1 (uid=2): total_tiles=4, void=0, purchased=4, next_tile_price=26425.10
17:03:42 [INFO] __main__: Shutting down …
17:03:42 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:03:42 [INFO] websockets.server: server closing
17:03:42 [INFO] websockets.server: server closed
17:03:42 [INFO] gameserver.network.server: WebSocket server stopped
17:03:42 [INFO] __main__:   WebSocket server stopped
17:03:42 [INFO] __main__:   REST API server stopped
17:03:42 [INFO] __main__:   debug dashboard stopped
17:03:42 [INFO] __main__:   database closed
17:03:42 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

17:03:44 [INFO] __main__: === Game Server starting ===
17:03:44 [INFO] __main__: Loading configuration …
17:03:45 [INFO] __main__:   items:        210 loaded from config
17:03:45 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
17:03:45 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:03:45 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
17:03:45 [INFO] __main__:   game_config:  loaded
17:03:45 [INFO] __main__: Initializing persistence …
17:03:45 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:03:45 [INFO] __main__:   database:     connected (gameserver.db)
17:03:45 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
17:03:45 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
17:03:45 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
17:03:45 [INFO] __main__: Creating services …
17:03:45 [INFO] __main__:   upgrade_provider: 210 items registered
17:03:45 [INFO] __main__:   all services created
17:03:45 [INFO] __main__: Wiring event handlers …
17:03:45 [INFO] __main__:   event handlers registered
17:03:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:03:45 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:03:45 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:03:45 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:03:45 [INFO] __main__: Restored 2 empires from saved state
17:03:45 [INFO] __main__: Restored 1 attacks from saved state
17:03:45 [INFO] __main__: Starting network servers …
17:03:45 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:03:45 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:03:45 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:03:45 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:03:46 [INFO] gameserver.network.rest_api: REST API created with 21 routes
17:03:46 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [27123]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
17:03:46 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:03:46 [INFO] __main__: Starting game loop …
17:03:46 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
17:03:47 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
17:03:48 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
17:03:48 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
17:03:48 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
17:03:48 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
17:03:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
17:03:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
17:03:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
17:03:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
17:03:56 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
17:03:56 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
17:03:58 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
17:04:00 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
17:04:02 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
17:04:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
17:04:04 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
17:04:05 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
17:04:06 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
17:04:07 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
17:04:08 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
17:04:08 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
17:04:10 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
17:04:12 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
17:04:14 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
17:04:16 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
17:04:16 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
17:04:16 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
17:04:16 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
17:10:48 [INFO] __main__: Shutdown signal received — stopping …
17:10:49 [INFO] __main__: Shutting down …
17:10:49 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:10:49 [INFO] websockets.server: server closing
17:10:49 [INFO] websockets.server: server closed
17:10:49 [INFO] gameserver.network.server: WebSocket server stopped
17:10:49 [INFO] __main__:   WebSocket server stopped
17:10:49 [INFO] __main__:   REST API server stopped
17:10:49 [INFO] __main__:   debug dashboard stopped
17:10:49 [INFO] __main__:   database closed
17:10:49 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

17:10:51 [INFO] __main__: === Game Server starting ===
17:10:51 [INFO] __main__: Loading configuration …
17:10:52 [INFO] __main__:   items:        210 loaded from config
17:10:52 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
17:10:52 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:10:52 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
17:10:52 [INFO] __main__:   game_config:  loaded
17:10:52 [INFO] __main__: Initializing persistence …
17:10:52 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:10:52 [INFO] __main__:   database:     connected (gameserver.db)
17:10:52 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-15T17:10:48, version 1)
17:10:52 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
17:10:52 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
17:10:52 [INFO] __main__: Creating services …
17:10:52 [INFO] __main__:   upgrade_provider: 210 items registered
17:10:52 [INFO] __main__:   all services created
17:10:52 [INFO] __main__: Wiring event handlers …
17:10:52 [INFO] __main__:   event handlers registered
17:10:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:10:52 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:10:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:10:52 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:10:52 [INFO] __main__: Restored 2 empires from saved state
17:10:52 [INFO] __main__: Starting network servers …
17:10:52 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:10:52 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:10:52 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:10:52 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:10:53 [INFO] gameserver.network.rest_api: REST API created with 21 routes
17:10:53 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [27603]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
17:10:53 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:10:53 [INFO] __main__: Starting game loop …
17:10:53 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
17:15:08 [INFO] __main__: Shutdown signal received — stopping …
17:15:09 [INFO] __main__: Shutting down …
17:15:09 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:15:09 [INFO] websockets.server: server closing
17:15:09 [INFO] websockets.server: server closed
17:15:09 [INFO] gameserver.network.server: WebSocket server stopped
17:15:09 [INFO] __main__:   WebSocket server stopped
17:15:09 [INFO] __main__:   REST API server stopped
17:15:09 [INFO] __main__:   debug dashboard stopped
17:15:09 [INFO] __main__:   database closed
17:15:09 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

17:15:11 [INFO] __main__: === Game Server starting ===
17:15:11 [INFO] __main__: Loading configuration …
17:15:11 [INFO] __main__:   items:        210 loaded from config
17:15:12 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
17:15:12 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:15:12 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
17:15:12 [INFO] __main__:   game_config:  loaded
17:15:12 [INFO] __main__: Initializing persistence …
17:15:12 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:15:12 [INFO] __main__:   database:     connected (gameserver.db)
17:15:12 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
17:15:12 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
17:15:12 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
17:15:12 [INFO] __main__: Creating services …
17:15:12 [INFO] __main__:   upgrade_provider: 210 items registered
17:15:12 [INFO] __main__:   all services created
17:15:12 [INFO] __main__: Wiring event handlers …
17:15:12 [INFO] __main__:   event handlers registered
17:15:12 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:15:12 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:15:12 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:15:12 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:15:12 [INFO] __main__: Restored 2 empires from saved state
17:15:12 [INFO] __main__: Restored 1 attacks from saved state
17:15:12 [INFO] __main__: Starting network servers …
17:15:12 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:15:12 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:15:12 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:15:12 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:15:13 [INFO] gameserver.network.rest_api: REST API created with 21 routes
17:15:13 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [27901]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
17:15:13 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:15:13 [INFO] __main__: Starting game loop …
17:15:13 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
17:15:14 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
17:15:15 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
17:15:15 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
17:15:15 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
17:15:15 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
17:15:15 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
17:15:17 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
17:15:19 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
17:15:21 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
17:15:23 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
17:15:23 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
17:15:25 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
17:15:27 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
17:15:27 [INFO] gameserver.network.handlers: Tile 2,0 purchased by empire Empire1 (uid=2) for 131.9 gold
17:15:29 [INFO] gameserver.network.handlers: Tile 1,1 purchased by empire Empire1 (uid=2) for 140.6 gold
17:15:29 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
17:15:29 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
17:15:30 [INFO] gameserver.network.handlers: Tile 2,1 purchased by empire Empire1 (uid=2) for 151.6 gold
17:15:31 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
17:15:31 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
17:15:31 [INFO] gameserver.network.handlers: Tile 3,0 purchased by empire Empire1 (uid=2) for 165.7 gold
17:15:33 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
17:15:33 [INFO] gameserver.network.handlers: Tile 1,2 purchased by empire Empire1 (uid=2) for 183.6 gold
17:15:33 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
17:15:34 [INFO] gameserver.network.handlers: Tile 3,-1 purchased by empire Empire1 (uid=2) for 206.4 gold
17:15:35 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
17:15:35 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
17:15:36 [INFO] gameserver.network.handlers: Tile 2,-1 purchased by empire Empire1 (uid=2) for 235.4 gold
17:15:37 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
17:15:37 [INFO] gameserver.network.handlers: Tile 1,-1 purchased by empire Empire1 (uid=2) for 272.2 gold
17:15:39 [INFO] gameserver.network.handlers: Tile 0,-1 purchased by empire Empire1 (uid=2) for 319.0 gold
17:15:39 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.75
17:15:40 [INFO] gameserver.network.handlers: Tile 0,-2 purchased by empire Empire1 (uid=2) for 378.4 gold
17:15:41 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
17:15:43 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
17:15:43 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
17:15:43 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
17:15:43 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
17:15:44 [INFO] gameserver.network.handlers: Tile -1,-1 purchased by empire Empire1 (uid=2) for 453.9 gold
17:15:49 [INFO] gameserver.network.handlers: Tile -1,0 purchased by empire Empire1 (uid=2) for 549.5 gold
17:15:51 [INFO] gameserver.network.handlers: Tile -1,1 purchased by empire Empire1 (uid=2) for 670.8 gold
17:15:53 [INFO] gameserver.network.handlers: Tile -1,2 purchased by empire Empire1 (uid=2) for 824.2 gold
17:15:58 [INFO] gameserver.network.handlers: Tile -2,2 purchased by empire Empire1 (uid=2) for 1018.0 gold
17:15:59 [INFO] gameserver.network.handlers: Tile -2,3 purchased by empire Empire1 (uid=2) for 1262.4 gold
17:22:31 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
17:22:31 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
17:22:31 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
17:22:31 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
17:22:31 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
17:22:31 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
17:22:32 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
17:22:32 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 9453.7, have 8737.0)
17:22:32 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
17:22:32 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 9453.7, have 8737.0)
17:22:32 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
17:22:32 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 9453.7, have 8737.0)
17:22:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:22:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 2, 'free': 6}
17:22:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:22:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 3, 'free': 5}
17:22:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:22:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 4, 'free': 4}
17:22:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:22:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 5, 'free': 3}
17:22:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:22:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 6, 'free': 2}
17:22:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:22:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 7, 'free': 1}
17:22:34 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:22:34 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 8, 'free': 0}
17:22:35 [INFO] gameserver.network.handlers: change_citizen request from uid=2
17:22:35 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 13, got 14)
17:23:11 [INFO] gameserver.network.handlers: new_army success uid=2 aid=1 name=TestArmee
17:23:14 [INFO] gameserver.network.handlers: new_wave success uid=2 aid=1 wave_id=1 with 5 SLAVE slots
17:23:34 [INFO] __main__: Shutdown signal received — stopping …
17:23:34 [INFO] __main__: Shutting down …
17:23:34 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:23:34 [INFO] websockets.server: server closing
17:23:34 [INFO] websockets.server: server closed
17:23:34 [INFO] gameserver.network.server: WebSocket server stopped
17:23:34 [INFO] __main__:   WebSocket server stopped
17:23:34 [INFO] __main__:   REST API server stopped
17:23:34 [INFO] __main__:   debug dashboard stopped
17:23:34 [INFO] __main__:   database closed
17:23:34 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

17:24:40 [INFO] __main__: === Game Server starting ===
17:24:40 [INFO] __main__: Loading configuration …
17:24:41 [INFO] __main__:   items:        210 loaded from config
17:24:41 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
17:24:41 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:24:41 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
17:24:41 [INFO] __main__:   game_config:  loaded
17:24:41 [INFO] __main__: Initializing persistence …
17:24:41 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:24:41 [INFO] __main__:   database:     connected (gameserver.db)
17:24:41 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
17:24:41 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
17:24:41 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
17:24:41 [INFO] __main__: Creating services …
17:24:41 [INFO] __main__:   upgrade_provider: 210 items registered
17:24:41 [INFO] __main__:   all services created
17:24:41 [INFO] __main__: Wiring event handlers …
17:24:41 [INFO] __main__:   event handlers registered
17:24:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:24:41 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:24:41 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:24:41 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:24:41 [INFO] __main__: Restored 2 empires from saved state
17:24:41 [INFO] __main__: Restored 1 attacks from saved state
17:24:41 [INFO] __main__: Starting network servers …
17:24:41 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:24:41 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:24:41 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:24:41 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:24:42 [INFO] gameserver.network.rest_api: REST API created with 21 routes
17:24:42 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [28288]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
17:24:42 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:24:42 [INFO] __main__: Starting game loop …
17:24:42 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
17:24:43 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
17:24:44 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
17:24:44 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
17:24:44 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
17:24:44 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
17:24:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
17:24:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
17:24:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
17:24:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
17:24:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
17:24:52 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
17:24:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
INFO:     192.168.178.2:53378 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
17:24:56 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
17:24:56 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
17:24:56 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
17:24:56 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
17:24:56 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
17:24:58 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
17:24:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
17:25:00 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
17:25:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
17:25:02 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
17:25:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
17:25:04 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
17:25:05 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
17:25:06 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
17:25:08 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
17:25:10 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.77
17:25:12 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.78
17:25:12 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
17:25:12 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
17:25:12 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
17:25:14 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
17:25:14 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
17:31:54 [INFO] gameserver.network.handlers: change_wave: updated wave 0 slots from 1 to 2
17:31:54 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=2 wave=0 critter_iid=SLAVE slots=2
18:14:24 [INFO] __main__: Shutdown signal received — stopping …
18:14:25 [INFO] __main__: Shutting down …
18:14:25 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:14:25 [INFO] websockets.server: server closing
18:14:25 [INFO] websockets.server: server closed
18:14:25 [INFO] gameserver.network.server: WebSocket server stopped
18:14:25 [INFO] __main__:   WebSocket server stopped
18:14:25 [INFO] __main__:   REST API server stopped
18:14:25 [INFO] __main__:   debug dashboard stopped
18:14:25 [INFO] __main__:   database closed
18:14:25 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

18:14:26 [INFO] __main__: === Game Server starting ===
18:14:26 [INFO] __main__: Loading configuration …
18:14:27 [INFO] __main__:   items:        210 loaded from config
18:14:27 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
18:14:27 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:14:27 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
18:14:27 [INFO] __main__:   game_config:  loaded
18:14:27 [INFO] __main__: Initializing persistence …
18:14:27 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:14:27 [INFO] __main__:   database:     connected (gameserver.db)
18:14:27 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
18:14:27 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:14:27 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:14:27 [INFO] __main__: Creating services …
18:14:27 [INFO] __main__:   upgrade_provider: 210 items registered
18:14:27 [INFO] __main__:   all services created
18:14:27 [INFO] __main__: Wiring event handlers …
18:14:27 [INFO] __main__:   event handlers registered
18:14:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:14:27 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:14:27 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:14:27 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:14:27 [INFO] __main__: Restored 2 empires from saved state
18:14:27 [INFO] __main__: Restored 1 attacks from saved state
18:14:27 [INFO] __main__: Starting network servers …
18:14:27 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:14:27 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:14:27 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:14:27 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:14:29 [INFO] gameserver.network.rest_api: REST API created with 23 routes
18:14:29 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [29508]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
18:14:29 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:14:29 [INFO] __main__: Starting game loop …
18:14:29 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
18:14:30 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:14:31 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:14:31 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:14:31 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
18:14:31 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
18:14:31 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
18:14:32 [INFO] __main__: Shutdown signal received — stopping …
18:14:33 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
18:14:33 [INFO] __main__: Shutting down …
18:14:33 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
18:14:33 [INFO] websockets.server: server closing
18:14:33 [INFO] websockets.server: server closed
18:14:33 [INFO] gameserver.network.server: WebSocket server stopped
18:14:33 [INFO] __main__:   WebSocket server stopped
18:14:33 [INFO] __main__:   REST API server stopped
18:14:33 [INFO] __main__:   debug dashboard stopped
18:14:33 [INFO] __main__:   database closed
18:14:33 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

18:14:34 [INFO] __main__: === Game Server starting ===
18:14:34 [INFO] __main__: Loading configuration …
18:14:35 [INFO] __main__:   items:        210 loaded from config
18:14:35 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
18:14:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:14:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
18:14:35 [INFO] __main__:   game_config:  loaded
18:14:35 [INFO] __main__: Initializing persistence …
18:14:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:14:35 [INFO] __main__:   database:     connected (gameserver.db)
18:14:35 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
18:14:35 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:14:35 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:14:35 [INFO] __main__: Creating services …
18:14:35 [INFO] __main__:   upgrade_provider: 210 items registered
18:14:35 [INFO] __main__:   all services created
18:14:35 [INFO] __main__: Wiring event handlers …
18:14:35 [INFO] __main__:   event handlers registered
18:14:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:14:35 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:14:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:14:35 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:14:35 [INFO] __main__: Restored 2 empires from saved state
18:14:35 [INFO] __main__: Restored 1 attacks from saved state
18:14:35 [INFO] __main__: Starting network servers …
18:14:35 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:14:35 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:14:35 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:14:35 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:14:36 [INFO] gameserver.network.rest_api: REST API created with 23 routes
18:14:36 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [29568]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
18:14:36 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:14:36 [INFO] __main__: Starting game loop …
18:14:36 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
18:14:37 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:14:38 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:14:38 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:14:38 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
18:14:38 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
18:14:38 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
18:14:40 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
18:14:42 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
18:14:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
18:14:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
18:14:46 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
18:14:46 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 38.7 gold (slots: 1 → 2)
18:14:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
18:14:50 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
18:14:52 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
18:14:53 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
18:14:54 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
18:14:55 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
18:14:56 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
18:14:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
18:14:58 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
18:14:58 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
18:15:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
18:15:02 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.75
18:15:04 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
18:15:06 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.76
18:15:06 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
18:15:06 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
18:15:06 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
18:15:13 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 49.7 gold (slots: 2 → 3)
18:15:13 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 67.0 gold (slots: 3 → 4)
18:15:13 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 94.3 gold (slots: 4 → 5)
18:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 136.7 gold (slots: 5 → 6)
18:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 201.9 gold (slots: 6 → 7)
18:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 299.9 gold (slots: 7 → 8)
18:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 442.7 gold (slots: 8 → 9)
18:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 641.7 gold (slots: 9 → 10)
18:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 901.9 gold (slots: 10 → 11)
18:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 1215.9 gold (slots: 11 → 12)
18:15:15 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 1559.6 gold (slots: 12 → 13)
18:15:15 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 1898.2 gold (slots: 13 → 14)
18:15:22 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 73.2 gold
18:15:23 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 91.5 gold
18:16:05 [INFO] __main__: Shutdown signal received — stopping …
18:16:05 [INFO] __main__: Shutting down …
18:16:05 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:16:05 [INFO] websockets.server: server closing
18:16:05 [INFO] websockets.server: server closed
18:16:05 [INFO] gameserver.network.server: WebSocket server stopped
18:16:05 [INFO] __main__:   WebSocket server stopped
18:16:05 [INFO] __main__:   REST API server stopped
18:16:05 [INFO] __main__:   debug dashboard stopped
18:16:05 [INFO] __main__:   database closed
18:16:05 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

18:16:07 [INFO] __main__: === Game Server starting ===
18:16:07 [INFO] __main__: Loading configuration …
18:16:08 [INFO] __main__:   items:        210 loaded from config
18:16:08 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
18:16:08 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:16:08 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
18:16:08 [INFO] __main__:   game_config:  loaded
18:16:08 [INFO] __main__: Initializing persistence …
18:16:08 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:16:08 [INFO] __main__:   database:     connected (gameserver.db)
18:16:08 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
18:16:08 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:16:08 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:16:08 [INFO] __main__: Creating services …
18:16:08 [INFO] __main__:   upgrade_provider: 210 items registered
18:16:08 [INFO] __main__:   all services created
18:16:08 [INFO] __main__: Wiring event handlers …
18:16:08 [INFO] __main__:   event handlers registered
18:16:08 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:16:08 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:16:08 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:16:08 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:16:08 [INFO] __main__: Restored 2 empires from saved state
18:16:08 [INFO] __main__: Restored 1 attacks from saved state
18:16:08 [INFO] __main__: Starting network servers …
18:16:08 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:16:08 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:16:08 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:16:08 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:16:09 [INFO] gameserver.network.rest_api: REST API created with 23 routes
18:16:09 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [29684]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
18:16:09 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:16:09 [INFO] __main__: Starting game loop …
18:16:09 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
18:16:10 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:16:11 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 101.3 gold (slots: 1 → 2)
18:16:11 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:16:11 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:16:11 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
18:16:11 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
18:16:11 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
18:16:12 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 149.2 gold (slots: 2 → 3)
18:16:12 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 224.8 gold (slots: 3 → 4)
18:16:13 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 343.5 gold (slots: 4 → 5)
18:16:13 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
18:16:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 528.4 gold (slots: 5 → 6)
18:16:15 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 812.2 gold (slots: 6 → 7)
18:16:15 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
18:16:16 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 1239.1 gold (slots: 7 → 8)
18:16:16 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 1861.2 gold (slots: 8 → 9)
18:16:17 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
18:16:18 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 131.6 gold
18:16:19 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 195.9 gold
18:16:19 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
18:16:19 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
18:16:20 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 310.4 gold
18:16:20 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 513.2 gold
18:16:21 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 869.3 gold
18:16:21 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
18:16:23 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
18:16:25 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
18:16:26 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
18:16:27 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
18:16:28 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
18:16:29 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
18:16:30 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
18:16:31 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
18:16:32 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
18:16:33 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
18:16:35 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
18:16:37 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
18:16:39 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
18:16:39 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
18:16:39 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
18:16:39 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
18:16:48 [INFO] __main__: Shutdown signal received — stopping …
18:16:48 [INFO] __main__: Shutting down …
18:16:48 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:16:48 [INFO] websockets.server: server closing
18:16:48 [INFO] websockets.server: server closed
18:16:48 [INFO] gameserver.network.server: WebSocket server stopped
18:16:48 [INFO] __main__:   WebSocket server stopped
18:16:48 [INFO] __main__:   REST API server stopped
18:16:48 [INFO] __main__:   debug dashboard stopped
18:16:48 [INFO] __main__:   database closed
18:16:48 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

18:16:51 [INFO] __main__: === Game Server starting ===
18:16:51 [INFO] __main__: Loading configuration …
18:16:52 [INFO] __main__:   items:        210 loaded from config
18:16:52 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
18:16:52 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:16:52 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
18:16:52 [INFO] __main__:   game_config:  loaded
18:16:52 [INFO] __main__: Initializing persistence …
18:16:52 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:16:52 [INFO] __main__:   database:     connected (gameserver.db)
18:16:52 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
18:16:52 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:16:52 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:16:52 [INFO] __main__: Creating services …
18:16:52 [INFO] __main__:   upgrade_provider: 210 items registered
18:16:52 [INFO] __main__:   all services created
18:16:52 [INFO] __main__: Wiring event handlers …
18:16:52 [INFO] __main__:   event handlers registered
18:16:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:16:52 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:16:52 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:16:52 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:16:52 [INFO] __main__: Restored 2 empires from saved state
18:16:52 [INFO] __main__: Restored 1 attacks from saved state
18:16:52 [INFO] __main__: Starting network servers …
18:16:52 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:16:52 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:16:52 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:16:52 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:16:53 [INFO] gameserver.network.rest_api: REST API created with 23 routes
18:16:53 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [29780]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
18:16:53 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:16:53 [INFO] __main__: Starting game loop …
18:16:53 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
18:16:54 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:16:55 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:16:55 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:16:55 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
18:16:55 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
18:16:55 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
18:16:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
18:16:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
18:17:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
18:17:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
18:17:03 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
18:17:05 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
18:17:07 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
18:17:09 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
18:17:10 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
18:17:11 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
18:17:12 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
18:17:13 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
18:17:14 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
18:17:15 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 181.5 gold
18:17:15 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
18:17:15 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
18:17:16 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 245.6 gold
18:17:17 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
18:17:17 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 359.9 gold
18:17:19 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.75
18:17:21 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
18:17:23 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
18:17:23 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
18:17:23 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
18:17:23 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
18:17:46 [INFO] __main__: Shutdown signal received — stopping …
18:17:46 [INFO] __main__: Shutting down …
18:17:46 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:17:46 [INFO] websockets.server: server closing
18:17:46 [INFO] websockets.server: server closed
18:17:46 [INFO] gameserver.network.server: WebSocket server stopped
18:17:46 [INFO] __main__:   WebSocket server stopped
18:17:46 [INFO] __main__:   REST API server stopped
18:17:46 [INFO] __main__:   debug dashboard stopped
18:17:46 [INFO] __main__:   database closed
18:17:46 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

18:17:48 [INFO] __main__: === Game Server starting ===
18:17:48 [INFO] __main__: Loading configuration …
18:17:49 [INFO] __main__:   items:        210 loaded from config
18:17:49 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
18:17:49 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:17:49 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
18:17:49 [INFO] __main__:   game_config:  loaded
18:17:49 [INFO] __main__: Initializing persistence …
18:17:49 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:17:49 [INFO] __main__:   database:     connected (gameserver.db)
18:17:49 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
18:17:49 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:17:49 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:17:49 [INFO] __main__: Creating services …
18:17:49 [INFO] __main__:   upgrade_provider: 210 items registered
18:17:49 [INFO] __main__:   all services created
18:17:49 [INFO] __main__: Wiring event handlers …
18:17:49 [INFO] __main__:   event handlers registered
18:17:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:17:49 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:17:49 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:17:49 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:17:49 [INFO] __main__: Restored 2 empires from saved state
18:17:49 [INFO] __main__: Restored 1 attacks from saved state
18:17:49 [INFO] __main__: Starting network servers …
18:17:49 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:17:49 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:17:49 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:17:49 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:17:50 [INFO] gameserver.network.rest_api: REST API created with 23 routes
18:17:50 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [29903]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
18:17:50 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:17:50 [INFO] __main__: Starting game loop …
18:17:50 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
18:17:51 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:17:52 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:17:52 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:17:52 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
18:17:52 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
18:17:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
18:17:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
18:17:56 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
18:17:58 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
18:18:00 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
18:18:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
18:18:02 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
18:18:04 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
18:18:06 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
18:18:07 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
18:18:08 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
18:18:09 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
18:18:10 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
18:18:11 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
18:18:12 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
18:18:12 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
18:18:14 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
18:18:16 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
18:18:18 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.77
18:18:20 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
18:18:20 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
18:18:20 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
18:18:20 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
18:20:44 [INFO] __main__: Shutdown signal received — stopping …
18:20:44 [INFO] __main__: Shutting down …
18:20:44 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:20:44 [INFO] websockets.server: server closing
18:20:44 [INFO] websockets.server: server closed
18:20:44 [INFO] gameserver.network.server: WebSocket server stopped
18:20:44 [INFO] __main__:   WebSocket server stopped
18:20:44 [INFO] __main__:   REST API server stopped
18:20:44 [INFO] __main__:   debug dashboard stopped
18:20:44 [INFO] __main__:   database closed
18:20:44 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

18:20:46 [INFO] __main__: === Game Server starting ===
18:20:46 [INFO] __main__: Loading configuration …
18:20:46 [INFO] __main__:   items:        210 loaded from config
18:20:46 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
18:20:46 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:20:46 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
18:20:46 [INFO] __main__:   game_config:  loaded
18:20:46 [INFO] __main__: Initializing persistence …
18:20:46 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:20:46 [INFO] __main__:   database:     connected (gameserver.db)
18:20:47 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
18:20:47 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:20:47 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:20:47 [INFO] __main__: Creating services …
18:20:47 [INFO] __main__:   upgrade_provider: 210 items registered
18:20:47 [INFO] __main__:   all services created
18:20:47 [INFO] __main__: Wiring event handlers …
18:20:47 [INFO] __main__:   event handlers registered
18:20:47 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:20:47 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:20:47 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:20:47 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:20:47 [INFO] __main__: Restored 2 empires from saved state
18:20:47 [INFO] __main__: Restored 1 attacks from saved state
18:20:47 [INFO] __main__: Starting network servers …
18:20:47 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:20:47 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:20:47 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:20:47 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:20:48 [INFO] gameserver.network.rest_api: REST API created with 23 routes
18:20:48 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [30081]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
18:20:48 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:20:48 [INFO] __main__: Starting game loop …
18:20:48 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
18:20:49 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:20:50 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:20:50 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:20:50 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
18:20:50 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
18:20:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
18:20:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
18:20:53 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 181.5 gold
18:20:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
18:20:55 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 106.3 gold (slots: 1 → 2)
18:20:56 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
18:20:56 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 154.1 gold (slots: 2 → 3)
18:20:57 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 229.7 gold (slots: 3 → 4)
18:20:58 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
18:20:58 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
18:20:58 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 106.3 gold (slots: 1 → 2)
18:20:59 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 154.1 gold (slots: 2 → 3)
18:20:59 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 229.7 gold (slots: 3 → 4)
18:21:00 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
18:21:02 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
18:21:04 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
18:21:04 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
18:21:06 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
18:21:06 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
18:21:07 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 348.4 gold (slots: 4 → 5)
18:21:08 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
18:21:08 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
18:21:10 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
18:21:10 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
18:21:12 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
18:21:14 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
18:21:16 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
18:21:18 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
18:21:18 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
18:21:18 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
18:21:18 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
18:25:29 [INFO] gameserver.network.handlers: Tile 1,1 purchased by empire Empire1 (uid=2) for 131.9 gold
18:25:35 [INFO] gameserver.network.handlers: Tile -1,2 purchased by empire Empire1 (uid=2) for 140.6 gold
18:25:37 [INFO] gameserver.network.handlers: Tile -1,1 purchased by empire Empire1 (uid=2) for 151.6 gold
18:25:43 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
18:25:45 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
18:25:46 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
18:25:50 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 7 tiles
18:25:53 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 7 tiles
18:25:53 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 7 tiles
18:27:24 [INFO] __main__: Shutdown signal received — stopping …
18:27:24 [INFO] __main__: Shutting down …
18:27:24 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:27:24 [INFO] websockets.server: server closing
18:27:24 [INFO] websockets.server: server closed
18:27:24 [INFO] gameserver.network.server: WebSocket server stopped
18:27:24 [INFO] __main__:   WebSocket server stopped
18:27:24 [INFO] __main__:   REST API server stopped
18:27:24 [INFO] __main__:   debug dashboard stopped
18:27:24 [INFO] __main__:   database closed
18:27:24 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

18:27:25 [INFO] __main__: === Game Server starting ===
18:27:25 [INFO] __main__: Loading configuration …
18:27:26 [INFO] __main__:   items:        210 loaded from config
18:27:26 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
18:27:26 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:27:26 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
18:27:26 [INFO] __main__:   game_config:  loaded
18:27:26 [INFO] __main__: Initializing persistence …
18:27:26 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:27:26 [INFO] __main__:   database:     connected (gameserver.db)
18:27:26 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
18:27:26 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:27:26 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:27:26 [INFO] __main__: Creating services …
18:27:26 [INFO] __main__:   upgrade_provider: 210 items registered
18:27:26 [INFO] __main__:   all services created
18:27:26 [INFO] __main__: Wiring event handlers …
18:27:26 [INFO] __main__:   event handlers registered
18:27:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:27:26 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:27:26 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:27:26 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:27:26 [INFO] __main__: Restored 2 empires from saved state
18:27:26 [INFO] __main__: Restored 1 attacks from saved state
18:27:26 [INFO] __main__: Starting network servers …
18:27:26 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:27:26 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:27:26 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:27:26 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:27:27 [INFO] gameserver.network.rest_api: REST API created with 23 routes
18:27:27 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [30309]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
18:27:28 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:27:28 [INFO] __main__: Starting game loop …
18:27:28 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
18:27:29 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:27:30 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:27:30 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:27:30 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
18:27:30 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
18:27:30 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
18:27:31 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
18:27:33 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
18:27:35 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
18:27:37 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
18:27:38 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
18:27:39 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
18:27:42 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
18:27:43 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
18:27:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
18:27:45 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
18:27:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
18:27:47 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
18:27:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
18:27:49 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
18:27:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
18:27:52 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
18:27:54 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
18:27:56 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.77
18:27:58 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
18:27:58 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
18:27:58 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
18:27:58 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
18:40:32 [INFO] __main__: Shutdown signal received — stopping …
18:40:32 [INFO] __main__: Shutting down …
18:40:32 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
18:40:32 [INFO] websockets.server: server closing
18:40:32 [INFO] websockets.server: server closed
18:40:32 [INFO] gameserver.network.server: WebSocket server stopped
18:40:32 [INFO] __main__:   WebSocket server stopped
18:40:32 [INFO] __main__:   REST API server stopped
18:40:32 [INFO] __main__:   debug dashboard stopped
18:40:32 [INFO] __main__:   database closed
18:40:32 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

18:40:34 [INFO] __main__: === Game Server starting ===
18:40:34 [INFO] __main__: Loading configuration …
18:40:35 [INFO] __main__:   items:        210 loaded from config
18:40:35 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
18:40:35 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
18:40:35 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
18:40:35 [INFO] __main__:   game_config:  loaded
18:40:35 [INFO] __main__: Initializing persistence …
18:40:35 [INFO] gameserver.persistence.database: Database connected: gameserver.db
18:40:35 [INFO] __main__:   database:     connected (gameserver.db)
18:40:35 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
18:40:35 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
18:40:35 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
18:40:35 [INFO] __main__: Creating services …
18:40:35 [INFO] __main__:   upgrade_provider: 210 items registered
18:40:35 [INFO] __main__:   all services created
18:40:35 [INFO] __main__: Wiring event handlers …
18:40:35 [INFO] __main__:   event handlers registered
18:40:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
18:40:35 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
18:40:35 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
18:40:35 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
18:40:35 [INFO] __main__: Restored 2 empires from saved state
18:40:35 [INFO] __main__: Restored 1 attacks from saved state
18:40:35 [INFO] __main__: Starting network servers …
18:40:35 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
18:40:35 [INFO] websockets.server: server listening on 0.0.0.0:8765
18:40:35 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
18:40:35 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
18:40:36 [INFO] gameserver.network.rest_api: REST API created with 23 routes
18:40:36 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [30718]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
18:40:36 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
18:40:36 [INFO] __main__: Starting game loop …
18:40:36 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
18:40:37 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
18:40:38 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
18:40:38 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
18:40:38 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
18:40:38 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
18:40:38 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
18:40:40 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
18:40:42 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
18:40:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
18:40:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
18:40:46 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
18:40:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
18:40:50 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
18:40:52 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
18:40:53 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
18:40:54 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
18:40:55 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
18:40:56 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
18:40:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
18:40:58 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
18:40:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
18:41:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
18:41:02 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
18:41:04 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.76
18:41:06 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
18:41:06 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
18:41:06 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
18:41:06 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
INFO:     192.168.178.25:52188 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
19:28:52 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
19:28:52 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
19:28:52 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
19:28:54 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
19:28:54 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.25:52191 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
19:29:02 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
19:29:02 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
19:29:02 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
19:29:04 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
19:29:04 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.25:52193 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
19:29:17 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
19:29:17 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
19:29:17 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
19:29:18 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
19:29:18 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.25:52199 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE2ODMxMSwiZXhwIjoxNzcxMjU0NzExfQ.L0ipAg-43TWfXrq4P98xDw0X1Si4GTbwVPb0s1VG2bo" [accepted]
19:29:37 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
19:29:37 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
19:29:37 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
19:29:37 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
19:29:37 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
20:30:27 [INFO] __main__: Shutdown signal received — stopping …
20:30:28 [INFO] __main__: Shutting down …
20:30:28 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
20:30:28 [INFO] websockets.server: server closing
20:30:28 [INFO] websockets.server: server closed
20:30:28 [INFO] gameserver.network.server: WebSocket server stopped
20:30:28 [INFO] __main__:   WebSocket server stopped
20:30:28 [INFO] __main__:   REST API server stopped
20:30:28 [INFO] __main__:   debug dashboard stopped
20:30:28 [INFO] __main__:   database closed
20:30:28 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

20:30:30 [INFO] __main__: === Game Server starting ===
20:30:30 [INFO] __main__: Loading configuration …
20:30:31 [INFO] __main__:   items:        210 loaded from config
20:30:31 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
20:30:31 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:30:31 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
20:30:31 [INFO] __main__:   game_config:  loaded
20:30:31 [INFO] __main__: Initializing persistence …
20:30:31 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:30:31 [INFO] __main__:   database:     connected (gameserver.db)
20:30:31 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
20:30:31 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:30:31 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:30:31 [INFO] __main__: Creating services …
20:30:31 [INFO] __main__:   upgrade_provider: 210 items registered
20:30:31 [INFO] __main__:   all services created
20:30:31 [INFO] __main__: Wiring event handlers …
20:30:31 [INFO] __main__:   event handlers registered
20:30:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:30:31 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:30:31 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:30:31 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:30:31 [INFO] __main__: Restored 2 empires from saved state
20:30:31 [INFO] __main__: Restored 1 attacks from saved state
20:30:31 [INFO] __main__: Starting network servers …
20:30:31 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
20:30:31 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:30:31 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:30:31 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:30:32 [INFO] gameserver.network.rest_api: REST API created with 23 routes
20:30:32 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [1717]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
20:30:32 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:30:32 [INFO] __main__: Starting game loop …
20:30:32 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
20:30:33 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
INFO:     192.168.178.2:54727 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
20:30:34 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
20:30:34 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
20:30:34 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
20:30:34 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:30:34 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:30:34 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:30:34 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:30:34 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
20:30:34 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
20:30:36 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
20:30:38 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
20:30:40 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
20:30:42 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
20:30:42 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
20:30:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
20:30:46 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
20:30:48 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
20:30:49 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
20:30:50 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
20:30:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
20:30:52 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
20:30:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
20:30:54 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
20:30:54 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
20:30:56 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.76
20:30:58 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
20:31:00 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.77
20:31:02 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.77
20:31:02 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
20:31:02 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
20:31:02 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
20:31:04 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
20:31:04 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
20:37:24 [INFO] gameserver.engine.empire_service: Empire 2: started research MATHMATICS (effort=11000.0)
20:37:24 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MATHMATICS
20:37:30 [INFO] gameserver.engine.empire_service: Empire 2: started research MUSIC (effort=4000.0)
20:37:30 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MUSIC
20:37:34 [INFO] gameserver.engine.empire_service: Empire 2: started research MATHMATICS (effort=11000.0)
20:37:34 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MATHMATICS
INFO:     192.168.178.2:55332 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE1MjQ2MiwiZXhwIjoxNzcxMjM4ODYyfQ.fosndqtgWBXiO2SuREuyyd7-oQLEg9_hjj5vyvay8i4" [accepted]
20:39:31 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
20:39:31 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
20:39:31 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
20:39:31 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
20:39:31 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
20:39:56 [INFO] gameserver.network.auth: Login success: eem (uid=2)
20:40:16 [INFO] gameserver.network.handlers: change_citizen request from uid=2
20:40:16 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 0, 'free': 5}
20:40:17 [INFO] gameserver.network.handlers: change_citizen request from uid=2
20:40:17 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 4, 'artist': 0, 'free': 4}
20:40:17 [INFO] gameserver.network.handlers: change_citizen request from uid=2
20:40:17 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 5, 'artist': 0, 'free': 3}
20:40:17 [INFO] gameserver.network.handlers: change_citizen request from uid=2
20:40:17 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 6, 'artist': 0, 'free': 2}
20:40:23 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
20:40:23 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
20:40:24 [INFO] gameserver.network.handlers: change_citizen request from uid=2
20:40:24 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 7, 'artist': 0, 'free': 2}
20:40:25 [INFO] gameserver.network.handlers: change_citizen request from uid=2
20:40:25 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 7, 'artist': 1, 'free': 1}
20:40:26 [INFO] gameserver.network.handlers: change_citizen request from uid=2
20:40:26 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 7, 'artist': 2, 'free': 0}
20:40:26 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
20:40:26 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
20:40:27 [INFO] gameserver.network.handlers: change_citizen request from uid=2
20:40:27 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 7, 'artist': 3, 'free': 0}
20:40:42 [INFO] gameserver.engine.empire_service: Empire 2: started building LIBRARY (effort=18000.0)
20:40:42 [INFO] gameserver.network.handlers: new_item success uid=2 iid=LIBRARY
20:41:32 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
20:41:33 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
20:41:35 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
20:41:37 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0); Map must contain at least 1 spawnpoint
20:41:38 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): Map must contain exactly 1 castle (found 0)
20:41:41 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
20:41:49 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
20:41:50 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
20:41:50 [WARNING] gameserver.network.handlers: Map validation failed for Empire1 (uid=2): No passable path found from spawnpoint to castle
20:41:53 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
20:42:00 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
20:42:00 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
20:42:00 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
20:42:00 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 4 tiles
20:42:05 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 181.5 gold
20:42:06 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 245.6 gold
20:42:07 [INFO] gameserver.network.handlers: change_wave: updated wave 0 critter type to SWORDMAN
20:42:07 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=2 wave=0 critter_iid=SWORDMAN slots=1
20:42:10 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 46.7 gold (slots: 1 → 2)
20:42:10 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 54.4 gold (slots: 2 → 3)
20:42:10 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 64.8 gold (slots: 3 → 4)
20:42:11 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 79.0 gold (slots: 4 → 5)
20:42:13 [INFO] gameserver.network.handlers: change_wave: updated wave 1 critter type to NINJA
20:42:13 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=2 wave=1 critter_iid=NINJA slots=1
20:42:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 46.7 gold (slots: 1 → 2)
20:42:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 54.4 gold (slots: 2 → 3)
20:42:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 64.8 gold (slots: 3 → 4)
20:42:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 79.0 gold (slots: 4 → 5)
20:42:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 98.1 gold (slots: 5 → 6)
20:42:15 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 123.8 gold (slots: 6 → 7)
20:42:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 2 by empire Empire1 (uid=2) for 46.7 gold (slots: 1 → 2)
20:42:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 2 by empire Empire1 (uid=2) for 54.4 gold (slots: 2 → 3)
20:42:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 2 by empire Empire1 (uid=2) for 64.8 gold (slots: 3 → 4)
20:42:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 2 by empire Empire1 (uid=2) for 79.0 gold (slots: 4 → 5)
20:42:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 2 by empire Empire1 (uid=2) for 98.1 gold (slots: 5 → 6)
20:42:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 2 by empire Empire1 (uid=2) for 123.8 gold (slots: 6 → 7)
20:42:18 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 2 by empire Empire1 (uid=2) for 158.6 gold (slots: 7 → 8)
20:42:18 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 2 by empire Empire1 (uid=2) for 205.5 gold (slots: 8 → 9)
20:42:24 [INFO] gameserver.engine.attack_service: Attack started: id=1  2→100  army=2  ETA=60s
20:42:24 [INFO] gameserver.network.handlers: [new_attack] SUCCESS uid=2 → defender=100 army=2 attack_id=1 ETA=60.0s total=60.0s
20:42:37 [INFO] __main__: Shutdown signal received — stopping …
20:42:37 [INFO] __main__: Shutting down …
20:42:37 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 1 attacks, 0 battles)
20:42:37 [INFO] websockets.server: server closing
20:42:37 [INFO] websockets.server: server closed
20:42:37 [INFO] gameserver.network.server: WebSocket server stopped
20:42:37 [INFO] __main__:   WebSocket server stopped
20:42:37 [INFO] __main__:   REST API server stopped
20:42:37 [INFO] __main__:   debug dashboard stopped
20:42:37 [INFO] __main__:   database closed
20:42:37 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

20:42:39 [INFO] __main__: === Game Server starting ===
20:42:39 [INFO] __main__: Loading configuration …
20:42:39 [INFO] __main__:   items:        210 loaded from config
20:42:39 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
20:42:39 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:42:39 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
20:42:39 [INFO] __main__:   game_config:  loaded
20:42:39 [INFO] __main__: Initializing persistence …
20:42:39 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:42:39 [INFO] __main__:   database:     connected (gameserver.db)
20:42:39 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
20:42:39 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
20:42:39 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
20:42:39 [INFO] __main__: Creating services …
20:42:39 [INFO] __main__:   upgrade_provider: 210 items registered
20:42:39 [INFO] __main__:   all services created
20:42:39 [INFO] __main__: Wiring event handlers …
20:42:39 [INFO] __main__:   event handlers registered
20:42:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:42:39 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:42:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:42:39 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:42:39 [INFO] __main__: Restored 2 empires from saved state
20:42:39 [INFO] __main__: Restored 1 attacks from saved state
20:42:39 [INFO] __main__: Starting network servers …
20:42:39 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
20:42:39 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:42:39 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:42:39 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:42:41 [INFO] gameserver.network.rest_api: REST API created with 23 routes
20:42:41 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [2040]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
20:42:41 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:42:41 [INFO] __main__: Starting game loop …
20:42:41 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
20:42:42 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
20:42:43 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
20:42:43 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
20:42:43 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
20:42:43 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
20:42:43 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
INFO:     192.168.178.2:65005 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTE4NDM5NiwiZXhwIjoxNzcxMjcwNzk2fQ.SkC1PU1CpyzEZ1jbVXkxd5TV8SJxQYgkEJMVEtPDXbQ" [accepted]
20:42:43 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
20:42:43 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
20:42:43 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_battle)
20:42:43 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
20:42:45 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
20:42:47 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
20:42:49 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
20:42:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
20:42:51 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=1 (SWORDMAN) killed at path_progress=0.80
20:42:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
20:42:55 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
20:42:57 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
20:42:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
20:42:59 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
20:42:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
20:43:00 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
20:43:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
20:43:02 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
20:43:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
20:43:05 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.76
20:43:07 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.76
20:43:09 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.77
20:43:09 [INFO] gameserver.network.handlers: battle_unregister: uid=2 unregistered from attack 1
20:43:09 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
20:43:11 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.78
20:43:11 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
20:43:11 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
20:43:11 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
20:43:28 [INFO] gameserver.debug.dashboard: Signal sent (handled): type=summary_request sender=100
21:18:14 [INFO] gameserver.engine.empire_service: Empire 2: started research MUSIC (effort=4000.0)
21:18:14 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MUSIC
21:18:18 [INFO] gameserver.engine.empire_service: Empire 2: started research MATHMATICS (effort=11000.0)
21:18:18 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MATHMATICS
21:18:20 [INFO] gameserver.engine.empire_service: Empire 2: started research MUSIC (effort=4000.0)
21:18:20 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MUSIC
21:20:31 [INFO] gameserver.engine.empire_service: Empire 2: started research MATHMATICS (effort=11000.0)
21:20:31 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MATHMATICS
21:20:32 [INFO] gameserver.engine.empire_service: Empire 2: started research MUSIC (effort=4000.0)
21:20:32 [INFO] gameserver.network.handlers: new_item success uid=2 iid=MUSIC
22:19:20 [INFO] gameserver.engine.empire_service: Empire 2: knowledge MUSIC completed
04:01:01 [INFO] __main__: Shutdown signal received — stopping …
04:01:02 [INFO] __main__: Shutting down …
04:01:02 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
04:01:02 [INFO] websockets.server: server closing
04:01:02 [INFO] websockets.server: server closed
04:01:02 [INFO] gameserver.network.server: WebSocket server stopped
04:01:02 [INFO] __main__:   WebSocket server stopped
04:01:02 [INFO] __main__:   REST API server stopped
04:01:02 [INFO] __main__:   debug dashboard stopped
04:01:02 [INFO] __main__:   database closed
04:01:02 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

16:22:36 [INFO] __main__: === Game Server starting ===
16:22:36 [INFO] __main__: Loading configuration …
16:22:38 [INFO] __main__:   items:        210 loaded from config
16:22:38 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
16:22:38 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
16:22:38 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
16:22:38 [INFO] __main__:   game_config:  loaded
16:22:38 [INFO] __main__: Initializing persistence …
16:22:38 [INFO] gameserver.persistence.database: Database connected: gameserver.db
16:22:38 [INFO] __main__:   database:     connected (gameserver.db)
16:22:38 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-16T04:01:02, version 1)
16:22:38 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
16:22:38 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
16:22:38 [INFO] __main__: Creating services …
16:22:38 [INFO] __main__:   upgrade_provider: 210 items registered
16:22:38 [INFO] __main__:   all services created
16:22:38 [INFO] __main__: Wiring event handlers …
16:22:38 [INFO] __main__:   event handlers registered
16:22:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
16:22:38 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
16:22:38 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
16:22:38 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
16:22:38 [INFO] __main__: Restored 2 empires from saved state
16:22:38 [INFO] __main__: Starting network servers …
16:22:38 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
16:22:38 [INFO] websockets.server: server listening on 0.0.0.0:8765
16:22:38 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
16:22:38 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
16:22:40 [INFO] gameserver.network.rest_api: REST API created with 23 routes
16:22:40 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [14743]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
16:22:40 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
16:22:40 [INFO] __main__: Starting game loop …
16:22:40 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
16:22:46 [INFO] gameserver.network.auth: Login success: eem (uid=2)
16:39:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 46.7 gold (slots: 1 → 2)
16:39:15 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 54.4 gold (slots: 2 → 3)
16:39:17 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 181.5 gold
16:39:19 [INFO] gameserver.network.handlers: change_wave: updated wave 1 critter type to SAMURAI
16:39:19 [INFO] gameserver.network.handlers: change_wave success uid=2 aid=2 wave=1 critter_iid=SAMURAI slots=1
17:10:53 [INFO] __main__: Shutdown signal received — stopping …
17:10:54 [INFO] __main__: Shutting down …
17:10:54 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:10:54 [INFO] websockets.server: server closing
17:10:54 [INFO] websockets.server: server closed
17:10:54 [INFO] gameserver.network.server: WebSocket server stopped
17:10:54 [INFO] __main__:   WebSocket server stopped
17:10:54 [INFO] __main__:   REST API server stopped
17:10:54 [INFO] __main__:   debug dashboard stopped
17:10:54 [INFO] __main__:   database closed
17:10:54 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

17:10:55 [INFO] __main__: === Game Server starting ===
17:10:55 [INFO] __main__: Loading configuration …
17:10:56 [INFO] __main__:   items:        210 loaded from config
17:10:56 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
17:10:56 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:10:56 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
17:10:56 [INFO] __main__:   game_config:  loaded
17:10:56 [INFO] __main__: Initializing persistence …
17:10:56 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:10:56 [INFO] __main__:   database:     connected (gameserver.db)
17:10:56 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
17:10:56 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
17:10:56 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
17:10:56 [INFO] __main__: Creating services …
17:10:56 [INFO] __main__:   upgrade_provider: 210 items registered
17:10:56 [INFO] __main__:   all services created
17:10:56 [INFO] __main__: Wiring event handlers …
17:10:56 [INFO] __main__:   event handlers registered
17:10:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:10:56 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:10:56 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:10:56 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:10:56 [INFO] __main__: Restored 2 empires from saved state
17:10:56 [INFO] __main__: Restored 1 attacks from saved state
17:10:56 [INFO] __main__: Starting network servers …
17:10:56 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:10:56 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:10:56 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:10:56 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:10:57 [INFO] gameserver.network.rest_api: REST API created with 23 routes
17:10:57 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [16792]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
17:10:57 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:10:57 [INFO] __main__: Starting game loop …
17:10:57 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
17:10:58 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
17:10:59 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
17:10:59 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
17:10:59 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
17:10:59 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
17:10:59 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
17:11:01 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
17:11:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
17:11:05 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
17:11:07 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
17:11:09 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
17:11:09 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=1 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
17:11:11 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
17:11:13 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
17:11:14 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
17:11:15 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
17:11:17 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
17:11:17 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
17:11:19 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 5.0 -> 4.0 (damage: 1.0)
17:11:20 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
17:11:21 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.75
17:11:23 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
17:11:23 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.66
17:11:26 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.60
17:11:29 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.60
17:11:29 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
17:11:29 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
17:11:29 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
17:13:00 [INFO] gameserver.network.handlers: Tile 1,1 purchased by empire Empire1 (uid=2) for 131.9 gold
17:13:06 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 5 tiles
17:13:08 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 5 tiles
17:15:07 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 181.5 gold
17:15:10 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 46.7 gold (slots: 1 → 2)
17:15:11 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 54.4 gold (slots: 2 → 3)
17:15:11 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 64.8 gold (slots: 3 → 4)
17:15:13 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 79.0 gold (slots: 4 → 5)
17:15:13 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 98.1 gold (slots: 5 → 6)
17:15:13 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 123.8 gold (slots: 6 → 7)
17:15:13 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 158.6 gold (slots: 7 → 8)
17:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 205.5 gold (slots: 8 → 9)
17:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 268.5 gold (slots: 9 → 10)
17:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 353.0 gold (slots: 10 → 11)
17:15:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 465.7 gold (slots: 11 → 12)
17:15:25 [INFO] gameserver.network.handlers: new_army success uid=2 aid=3 name=sdfasdf for 2331.0 gold
17:15:34 [INFO] gameserver.network.handlers: Wave purchased for army 3 by empire Empire1 (uid=2) for 245.6 gold
17:15:36 [INFO] gameserver.network.handlers: Critter slot purchased for army 3 wave 0 by empire Empire1 (uid=2) for 46.7 gold (slots: 1 → 2)
17:28:36 [INFO] __main__: Shutdown signal received — stopping …
17:28:37 [INFO] __main__: Shutting down …
17:28:37 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
17:28:37 [INFO] websockets.server: server closing
17:28:37 [INFO] websockets.server: server closed
17:28:37 [INFO] gameserver.network.server: WebSocket server stopped
17:28:37 [INFO] __main__:   WebSocket server stopped
17:28:37 [INFO] __main__:   REST API server stopped
17:28:37 [INFO] __main__:   debug dashboard stopped
17:28:37 [INFO] __main__:   database closed
17:28:37 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

17:28:38 [INFO] __main__: === Game Server starting ===
17:28:38 [INFO] __main__: Loading configuration …
17:28:39 [INFO] __main__:   items:        235 loaded from config
17:28:39 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
17:28:39 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
17:28:39 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
17:28:39 [INFO] __main__:   game_config:  loaded
17:28:39 [INFO] __main__: Initializing persistence …
17:28:39 [INFO] gameserver.persistence.database: Database connected: gameserver.db
17:28:39 [INFO] __main__:   database:     connected (gameserver.db)
17:28:39 [INFO] gameserver.persistence.state_load: Restoring state from state2.yaml (saved at 2026-02-11T04:57:57, version 1)
17:28:39 [INFO] gameserver.persistence.state_load: Restored 2 empires, 1 attacks, 0 battles
17:28:39 [INFO] __main__:   state:        restored from disk (2 empires, 1 attacks)
17:28:39 [INFO] __main__: Creating services …
17:28:39 [INFO] __main__:   upgrade_provider: 235 items registered
17:28:39 [INFO] __main__:   all services created
17:28:39 [INFO] __main__: Wiring event handlers …
17:28:39 [INFO] __main__:   event handlers registered
17:28:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
17:28:39 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
17:28:39 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
17:28:39 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
17:28:39 [INFO] __main__: Restored 2 empires from saved state
17:28:39 [INFO] __main__: Restored 1 attacks from saved state
17:28:39 [INFO] __main__: Starting network servers …
17:28:39 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
17:28:39 [INFO] websockets.server: server listening on 0.0.0.0:8765
17:28:39 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
17:28:39 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
17:28:40 [INFO] gameserver.network.rest_api: REST API created with 23 routes
17:28:40 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [18221]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
17:28:40 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
17:28:40 [INFO] __main__: Starting game loop …
17:28:40 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
17:28:41 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: TRAVELLING → IN_SIEGE (attacker=100, defender=2, army=1)
INFO:     192.168.178.2:60770 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
17:28:42 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
17:28:42 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
17:28:42 [INFO] gameserver.network.handlers: battle_register: uid=2 registered for attack 1 (phase=in_siege)
17:28:42 [INFO] gameserver.network.handlers: _send_battle_setup: sent to uid=2 (attack_id=1)
17:28:42 [INFO] gameserver.engine.attack_service: [STATE] Attack 1: IN_SIEGE → IN_BATTLE (attacker=100, defender=2, army=1)
17:28:42 [INFO] gameserver.network.handlers: [battle:start_requested] attack_id=1 attacker=100 defender=2 army=1
17:28:42 [INFO] gameserver.network.handlers: [battle:start_requested] SUCCESS: battle 1 created (attacker=100, defender=2)
17:28:42 [INFO] gameserver.engine.battle_service: [battle_loop] Starting battle (bid=1, defender=2, attackers=100)
17:28:42 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=1 (SWORDMAN) spawned from wave 1 (progress=1/6, path_length=3)
17:28:44 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=2 (SWORDMAN) spawned from wave 1 (progress=2/6, path_length=3)
17:28:46 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=3 (SWORDMAN) spawned from wave 1 (progress=3/6, path_length=3)
17:28:48 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=4 (SWORDMAN) spawned from wave 1 (progress=4/6, path_length=3)
17:28:50 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=5 (SWORDMAN) spawned from wave 1 (progress=5/6, path_length=3)
17:28:52 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=6 (SWORDMAN) spawned from wave 1 (progress=6/6, path_length=3)
17:28:53 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=1 (SWORDMAN) reached goal, defender life: 10.0 -> 9.0 (damage: 1.0)
17:28:54 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=2 (SWORDMAN) reached goal, defender life: 9.0 -> 8.0 (damage: 1.0)
17:28:56 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=3 (SWORDMAN) reached goal, defender life: 8.0 -> 7.0 (damage: 1.0)
17:28:57 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=7 (SLAVE) spawned from wave 2 (progress=1/4, path_length=3)
17:28:58 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=4 (SWORDMAN) reached goal, defender life: 7.0 -> 6.0 (damage: 1.0)
17:29:00 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=8 (SLAVE) spawned from wave 2 (progress=2/4, path_length=3)
17:29:00 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=5 (SWORDMAN) reached goal, defender life: 6.0 -> 5.0 (damage: 1.0)
17:29:02 [INFO] gameserver.engine.battle_service: [FINISHED] Critter cid=6 (SWORDMAN) reached goal, defender life: 5.0 -> 4.0 (damage: 1.0)
17:29:03 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=9 (SLAVE) spawned from wave 2 (progress=3/4, path_length=3)
17:29:05 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=7 (SLAVE) killed at path_progress=0.76
17:29:06 [INFO] gameserver.engine.battle_service: [SPAWN] Critter cid=10 (SLAVE) spawned from wave 2 (progress=4/4, path_length=3)
17:29:07 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=8 (SLAVE) killed at path_progress=0.67
17:29:09 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=9 (SLAVE) killed at path_progress=0.60
17:29:12 [INFO] gameserver.engine.battle_service: [KILLED] Critter cid=10 (SLAVE) killed at path_progress=0.60
17:29:12 [INFO] gameserver.engine.battle_service: [FINISH] Battle bid=1 finished (defender won)
17:29:12 [INFO] gameserver.network.handlers: [battle] bid=1 complete: attacker_wins=False
17:29:12 [INFO] gameserver.network.handlers: [battle] Attack 1 marked as FINISHED
17:29:14 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
17:29:14 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
17:53:14 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 46.7 gold (slots: 1 → 2)
17:53:15 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 54.4 gold (slots: 2 → 3)
17:53:15 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 64.8 gold (slots: 3 → 4)
17:53:15 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 0 by empire Empire1 (uid=2) for 79.0 gold (slots: 4 → 5)
17:53:15 [INFO] gameserver.network.handlers: Wave purchased for army 2 by empire Empire1 (uid=2) for 181.5 gold
17:53:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 46.7 gold (slots: 1 → 2)
17:53:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 54.4 gold (slots: 2 → 3)
17:53:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 64.8 gold (slots: 3 → 4)
17:53:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 79.0 gold (slots: 4 → 5)
17:53:17 [INFO] gameserver.network.handlers: Critter slot purchased for army 2 wave 1 by empire Empire1 (uid=2) for 98.1 gold (slots: 5 → 6)
17:55:57 [INFO] gameserver.network.handlers: Tile 1,1 purchased by empire Empire1 (uid=2) for 131.9 gold
17:55:58 [INFO] gameserver.network.handlers: Tile 2,0 purchased by empire Empire1 (uid=2) for 140.6 gold
17:56:01 [INFO] gameserver.network.handlers: Tile 3,0 purchased by empire Empire1 (uid=2) for 151.6 gold
17:56:02 [INFO] gameserver.network.handlers: Tile 4,-1 purchased by empire Empire1 (uid=2) for 165.7 gold
17:56:06 [INFO] gameserver.network.handlers: Tile 5,-2 purchased by empire Empire1 (uid=2) for 183.6 gold
17:57:55 [INFO] gameserver.network.auth: Login success: eem (uid=2)
INFO:     192.168.178.25:57583 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQzMzg3NSwiZXhwIjoxNzcxNTIwMjc1fQ.Y4S9lbalq59qiCYkcsazhu3ECdN3uKTGOpG97Wd_tAE" [accepted]
17:58:00 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
17:58:00 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
17:58:00 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
17:58:19 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
17:58:19 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.25:57588 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQzMzg3NSwiZXhwIjoxNzcxNTIwMjc1fQ.Y4S9lbalq59qiCYkcsazhu3ECdN3uKTGOpG97Wd_tAE" [accepted]
17:59:00 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
17:59:00 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
17:59:00 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
17:59:06 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
17:59:06 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:52485 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
17:59:12 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
17:59:12 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
17:59:12 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
17:59:18 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
17:59:18 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:52490 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
17:59:23 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
17:59:23 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
17:59:23 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
17:59:31 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
17:59:31 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:52493 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
17:59:38 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
17:59:38 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
17:59:38 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:00:51 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:00:51 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49326 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:02:49 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:02:49 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:02:49 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:02:49 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49337 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:02:50 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:02:50 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:02:50 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
INFO:     192.168.178.25:57597 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQzMzg3NSwiZXhwIjoxNzcxNTIwMjc1fQ.Y4S9lbalq59qiCYkcsazhu3ECdN3uKTGOpG97Wd_tAE" [accepted]
18:03:17 [INFO] gameserver.network.server: Superseding existing session: uid=2
18:03:17 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:03:17 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:03:17 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:03:17 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
18:03:17 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
INFO:     192.168.178.2:49358 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:03:19 [INFO] gameserver.network.server: Superseding existing session: uid=2
18:03:19 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:03:19 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:03:19 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:03:19 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
18:03:19 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
18:03:22 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.25:57599 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQzMzg3NSwiZXhwIjoxNzcxNTIwMjc1fQ.Y4S9lbalq59qiCYkcsazhu3ECdN3uKTGOpG97Wd_tAE" [accepted]
18:03:22 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:03:22 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:03:22 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
INFO:     192.168.178.2:49365 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:03:22 [INFO] gameserver.network.server: Superseding existing session: uid=2
18:03:22 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:03:22 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:03:22 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:03:22 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
18:03:22 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
18:03:23 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49375 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:03:24 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:03:24 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:03:24 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:03:39 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:03:39 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49381 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:03:40 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:03:40 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:03:40 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:04:17 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:04:17 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49388 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:04:19 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:04:19 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:04:19 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
INFO:     192.168.178.25:57601 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQzMzg3NSwiZXhwIjoxNzcxNTIwMjc1fQ.Y4S9lbalq59qiCYkcsazhu3ECdN3uKTGOpG97Wd_tAE" [accepted]
18:04:46 [INFO] gameserver.network.server: Superseding existing session: uid=2
18:04:46 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:04:46 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:04:46 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:04:46 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
18:04:46 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
INFO:     192.168.178.2:53577 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:04:48 [INFO] gameserver.network.server: Superseding existing session: uid=2
18:04:48 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:04:48 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:04:48 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:04:48 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
18:04:48 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
INFO:     192.168.178.25:57604 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQzMzg3NSwiZXhwIjoxNzcxNTIwMjc1fQ.Y4S9lbalq59qiCYkcsazhu3ECdN3uKTGOpG97Wd_tAE" [accepted]
18:04:51 [INFO] gameserver.network.server: Superseding existing session: uid=2
18:04:51 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:04:51 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:04:51 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:04:51 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
18:04:51 [INFO] gameserver.network.server: Session unregister: uid=2 already taken over by new connection — keeping
INFO:     connection closed
18:04:53 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:04:53 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:53618 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:04:53 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:04:53 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:04:53 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:05:48 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49274 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:05:49 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:05:49 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:05:49 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:05:57 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:05:57 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49276 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:06:02 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:06:02 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:06:02 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:06:06 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:06:06 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49281 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:06:07 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:06:07 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:06:07 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:06:09 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:06:09 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49282 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:06:12 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:06:12 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:06:12 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:06:15 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:06:15 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49283 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:06:16 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:06:16 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:06:16 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:06:19 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
18:06:19 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49284 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:06:25 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:06:25 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:06:25 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:06:26 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49294 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTQyODE2NiwiZXhwIjoxNzcxNTE0NTY2fQ.NQpnEajD1Au3j4hISFULfkmIwJw9MySE5xgrjNyG1x4" [accepted]
18:06:26 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
18:06:26 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
18:06:26 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
18:08:28 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
18:08:28 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
18:08:32 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
18:08:32 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
18:08:34 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
18:08:34 [INFO] gameserver.network.handlers: citizen_upgrade success uid=2
18:08:34 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
18:08:34 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 9453.7, have 9178.8)
18:08:36 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
18:08:36 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 9453.7, have 9179.1)
18:08:40 [INFO] gameserver.network.handlers: citizen_upgrade request from uid=2
18:08:40 [INFO] gameserver.network.handlers: citizen_upgrade failed uid=2: Not enough culture (need 9453.7, have 9180.0)
18:08:44 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:44 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 2, 'free': 6}
18:08:45 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:45 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 3, 'free': 5}
18:08:46 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:46 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 4, 'free': 4}
18:08:47 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:47 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 2, 'scientist': 3, 'artist': 5, 'free': 3}
18:08:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 3, 'scientist': 3, 'artist': 5, 'free': 2}
18:08:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 4, 'scientist': 3, 'artist': 5, 'free': 1}
18:08:48 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:48 [INFO] gameserver.network.handlers: change_citizen success uid=2: {'merchant': 5, 'scientist': 3, 'artist': 5, 'free': 0}
18:08:50 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:50 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 13, got 14)
18:08:51 [INFO] gameserver.network.handlers: change_citizen request from uid=2
18:08:51 [INFO] gameserver.network.handlers: change_citizen failed uid=2: Too many citizens assigned (max 13, got 14)
18:09:25 [INFO] gameserver.network.handlers: new_army success uid=2 aid=3 name=Huhu for 2331.0 gold
19:22:27 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
04:01:01 [INFO] __main__: Shutdown signal received — stopping …
04:01:02 [INFO] __main__: Shutting down …
04:01:02 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
04:01:02 [INFO] websockets.server: server closing
04:01:02 [INFO] websockets.server: server closed
04:01:02 [INFO] gameserver.network.server: WebSocket server stopped
04:01:02 [INFO] __main__:   WebSocket server stopped
04:01:02 [INFO] __main__:   REST API server stopped
04:01:02 [INFO] __main__:   debug dashboard stopped
04:01:02 [INFO] __main__:   database closed
04:01:02 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

20:18:13 [INFO] __main__: === Game Server starting ===
20:18:13 [INFO] __main__: Loading configuration …
20:18:14 [INFO] __main__:   items:        235 loaded from config
20:18:14 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
20:18:14 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
20:18:14 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
20:18:14 [INFO] __main__:   game_config:  loaded
20:18:14 [INFO] __main__: Initializing persistence …
20:18:14 [INFO] gameserver.persistence.database: Database connected: gameserver.db
20:18:14 [INFO] __main__:   database:     connected (gameserver.db)
20:18:14 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-19T04:01:02, version 1)
20:18:14 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
20:18:14 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
20:18:14 [INFO] __main__: Creating services …
20:18:14 [INFO] __main__:   upgrade_provider: 235 items registered
20:18:14 [INFO] __main__:   all services created
20:18:14 [INFO] __main__: Wiring event handlers …
20:18:14 [INFO] __main__:   event handlers registered
20:18:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
20:18:14 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
20:18:14 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
20:18:14 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
20:18:14 [INFO] __main__: Restored 2 empires from saved state
20:18:14 [INFO] __main__: Starting network servers …
20:18:14 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
20:18:14 [INFO] websockets.server: server listening on 0.0.0.0:8765
20:18:14 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
20:18:14 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
20:18:15 [INFO] gameserver.network.rest_api: REST API created with 23 routes
20:18:15 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [22309]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
20:18:15 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
20:18:15 [INFO] __main__: Starting game loop …
20:18:15 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
04:01:01 [INFO] __main__: Shutdown signal received — stopping …
04:01:02 [INFO] __main__: Shutting down …
04:01:02 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
04:01:02 [INFO] websockets.server: server closing
04:01:02 [INFO] websockets.server: server closed
04:01:02 [INFO] gameserver.network.server: WebSocket server stopped
04:01:02 [INFO] __main__:   WebSocket server stopped
04:01:02 [INFO] __main__:   REST API server stopped
04:01:02 [INFO] __main__:   debug dashboard stopped
04:01:02 [INFO] __main__:   database closed
04:01:02 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

12:56:27 [INFO] __main__: === Game Server starting ===
12:56:27 [INFO] __main__: Loading configuration …
12:56:29 [INFO] __main__:   items:        235 loaded from config
12:56:29 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
12:56:29 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
12:56:29 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
12:56:29 [INFO] __main__:   game_config:  loaded
12:56:29 [INFO] __main__: Initializing persistence …
12:56:29 [INFO] gameserver.persistence.database: Database connected: gameserver.db
12:56:29 [INFO] __main__:   database:     connected (gameserver.db)
12:56:29 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-20T04:01:02, version 1)
12:56:29 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
12:56:29 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
12:56:29 [INFO] __main__: Creating services …
12:56:29 [INFO] __main__:   upgrade_provider: 235 items registered
12:56:29 [INFO] __main__:   all services created
12:56:29 [INFO] __main__: Wiring event handlers …
12:56:29 [INFO] __main__:   event handlers registered
12:56:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
12:56:29 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
12:56:29 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
12:56:29 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
12:56:29 [INFO] __main__: Restored 2 empires from saved state
12:56:29 [INFO] __main__: Starting network servers …
12:56:29 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
12:56:29 [INFO] websockets.server: server listening on 0.0.0.0:8765
12:56:29 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
12:56:29 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
12:56:30 [INFO] gameserver.network.rest_api: REST API created with 23 routes
12:56:30 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [10963]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
12:56:30 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
12:56:30 [INFO] __main__: Starting game loop …
12:56:30 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
04:01:01 [INFO] __main__: Shutdown signal received — stopping …
04:01:02 [INFO] __main__: Shutting down …
04:01:02 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
04:01:02 [INFO] websockets.server: server closing
04:01:02 [INFO] websockets.server: server closed
04:01:02 [INFO] gameserver.network.server: WebSocket server stopped
04:01:02 [INFO] __main__:   WebSocket server stopped
04:01:02 [INFO] __main__:   REST API server stopped
04:01:02 [INFO] __main__:   debug dashboard stopped
04:01:02 [INFO] __main__:   database closed
04:01:02 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

08:20:23 [INFO] __main__: === Game Server starting ===
08:20:23 [INFO] __main__: Loading configuration …
08:20:24 [INFO] __main__:   items:        235 loaded from config
08:20:24 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
08:20:24 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
08:20:24 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
08:20:24 [INFO] __main__:   game_config:  loaded
08:20:24 [INFO] __main__: Initializing persistence …
08:20:24 [INFO] gameserver.persistence.database: Database connected: gameserver.db
08:20:24 [INFO] __main__:   database:     connected (gameserver.db)
08:20:24 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-21T04:01:02, version 1)
08:20:24 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
08:20:24 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
08:20:24 [INFO] __main__: Creating services …
08:20:24 [INFO] __main__:   upgrade_provider: 235 items registered
08:20:24 [INFO] __main__:   all services created
08:20:24 [INFO] __main__: Wiring event handlers …
08:20:24 [INFO] __main__:   event handlers registered
08:20:24 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
08:20:24 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
08:20:24 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
08:20:24 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
08:20:24 [INFO] __main__: Restored 2 empires from saved state
08:20:24 [INFO] __main__: Starting network servers …
08:20:24 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
08:20:24 [INFO] websockets.server: server listening on 0.0.0.0:8765
08:20:24 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
08:20:24 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
08:20:26 [INFO] gameserver.network.rest_api: REST API created with 23 routes
08:20:26 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [7199]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
08:20:26 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
08:20:26 [INFO] __main__: Starting game loop …
08:20:26 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
08:22:05 [INFO] __main__: Shutdown signal received — stopping …
08:22:06 [INFO] __main__: Shutting down …
08:22:06 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
08:22:06 [INFO] websockets.server: server closing
08:22:06 [INFO] websockets.server: server closed
08:22:06 [INFO] gameserver.network.server: WebSocket server stopped
08:22:06 [INFO] __main__:   WebSocket server stopped
08:22:06 [INFO] __main__:   REST API server stopped
08:22:06 [INFO] __main__:   debug dashboard stopped
08:22:06 [INFO] __main__:   database closed
08:22:06 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

08:22:07 [INFO] __main__: === Game Server starting ===
08:22:07 [INFO] __main__: Loading configuration …
08:22:08 [INFO] __main__:   items:        235 loaded from config
08:22:08 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
08:22:08 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
08:22:08 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
08:22:08 [INFO] __main__:   game_config:  loaded
08:22:08 [INFO] __main__: Initializing persistence …
08:22:08 [INFO] gameserver.persistence.database: Database connected: gameserver.db
08:22:08 [INFO] __main__:   database:     connected (gameserver.db)
08:22:08 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-21T08:22:06, version 1)
08:22:08 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
08:22:08 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
08:22:08 [INFO] __main__: Creating services …
08:22:08 [INFO] __main__:   upgrade_provider: 235 items registered
08:22:08 [INFO] __main__:   all services created
08:22:08 [INFO] __main__: Wiring event handlers …
08:22:08 [INFO] __main__:   event handlers registered
08:22:08 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
08:22:08 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
08:22:08 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
08:22:08 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
08:22:08 [INFO] __main__: Restored 2 empires from saved state
08:22:08 [INFO] __main__: Starting network servers …
08:22:08 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
08:22:08 [INFO] websockets.server: server listening on 0.0.0.0:8765
08:22:08 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
08:22:08 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
08:22:09 [INFO] gameserver.network.rest_api: REST API created with 23 routes
08:22:09 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [7378]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
08:22:09 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
08:22:09 [INFO] __main__: Starting game loop …
08:22:09 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
09:17:39 [INFO] __main__: Shutdown signal received — stopping …
09:17:39 [INFO] __main__: Shutting down …
09:17:39 [INFO] gameserver.persistence.state_save: Game state saved to state.yaml (2 empires, 0 attacks, 0 battles)
09:17:39 [INFO] websockets.server: server closing
09:17:39 [INFO] websockets.server: server closed
09:17:39 [INFO] gameserver.network.server: WebSocket server stopped
09:17:39 [INFO] __main__:   WebSocket server stopped
09:17:39 [INFO] __main__:   REST API server stopped
09:17:39 [INFO] __main__:   debug dashboard stopped
09:17:39 [INFO] __main__:   database closed
09:17:39 [INFO] __main__:   goodbye
ERROR:    Traceback (most recent call last):
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/home/pi/e3/.venv/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

09:17:42 [INFO] __main__: === Game Server starting ===
09:17:42 [INFO] __main__: Loading configuration …
09:17:43 [INFO] __main__:   items:        235 loaded from config
09:17:43 [INFO] __main__:   map:          0 path tiles, 23 build tiles from config/maps/default.yaml
09:17:43 [INFO] __main__:   ai_templates: 2 entries from config/ai_templates.yaml
09:17:43 [INFO] gameserver.loaders.game_config_loader: Loaded game config from config/game.yaml (31 keys)
09:17:43 [INFO] __main__:   game_config:  loaded
09:17:43 [INFO] __main__: Initializing persistence …
09:17:43 [INFO] gameserver.persistence.database: Database connected: gameserver.db
09:17:43 [INFO] __main__:   database:     connected (gameserver.db)
09:17:43 [INFO] gameserver.persistence.state_load: Restoring state from state.yaml (saved at 2026-02-21T09:17:39, version 1)
09:17:43 [INFO] gameserver.persistence.state_load: Restored 2 empires, 0 attacks, 0 battles
09:17:43 [INFO] __main__:   state:        restored from disk (2 empires, 0 attacks)
09:17:43 [INFO] __main__: Creating services …
09:17:43 [INFO] __main__:   upgrade_provider: 235 items registered
09:17:43 [INFO] __main__:   all services created
09:17:43 [INFO] __main__: Wiring event handlers …
09:17:43 [INFO] __main__:   event handlers registered
09:17:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=100 name='TestImperium'
09:17:43 [INFO] gameserver.engine.empire_service: Empire 100: recalculated effects → {}
09:17:43 [INFO] gameserver.engine.empire_service: Empire registered: uid=2 name='Empire1'
09:17:43 [INFO] gameserver.engine.empire_service: Empire 2: recalculated effects → {'life_offset': 0.001, 'gold_offset': 0.2, 'culture_offset': 0.2, 'culture_modifier': 0.1, 'gold_modifier': 0.1, 'build_speed_modifier': 0.1}
09:17:43 [INFO] __main__: Restored 2 empires from saved state
09:17:43 [INFO] __main__: Starting network servers …
09:17:43 [INFO] gameserver.network.handlers: Registered 32 message handlers: ping, summary_request, item_request, military_request, map_load_request, map_save_request, new_item, new_structure, delete_structure, upgrade_structure, citizen_upgrade, change_citizen, increase_life, new_army, new_attack_request, change_army, new_wave, change_wave, end_siege, battle_register, battle_unregister, battle_next_wave_request, notification_request, user_message, timeline_request, userinfo_request, hall_of_fame_request, preferences_request, change_preferences, auth_request, signup, create_empire
09:17:43 [INFO] websockets.server: server listening on 0.0.0.0:8765
09:17:43 [INFO] gameserver.network.server: WebSocket server listening on ws://0.0.0.0:8765
09:17:43 [INFO] __main__:   WebSocket server listening on 0.0.0.0:8765
09:17:44 [INFO] gameserver.network.rest_api: REST API created with 23 routes
09:17:44 [INFO] __main__:   REST API listening on http://0.0.0.0:8080
INFO:     Started server process [8873]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
09:17:44 [INFO] gameserver.debug.dashboard: Debug dashboard running at http://0.0.0.0:9000/
09:17:44 [INFO] __main__: Starting game loop …
09:17:44 [INFO] __main__:   game loop running (1 s tick)
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
09:22:07 [INFO] gameserver.network.auth: Login success: eem (uid=2)
09:24:24 [INFO] gameserver.network.handlers: Tile 6,-2 purchased by empire Empire1 (uid=2) for 206.4 gold
09:24:28 [INFO] gameserver.network.handlers: Tile 5,-1 purchased by empire Empire1 (uid=2) for 235.4 gold
09:24:29 [INFO] gameserver.network.handlers: Tile 4,0 purchased by empire Empire1 (uid=2) for 272.2 gold
09:24:31 [INFO] gameserver.network.handlers: Tile 4,1 purchased by empire Empire1 (uid=2) for 319.0 gold
09:24:33 [INFO] gameserver.network.handlers: Tile 5,0 purchased by empire Empire1 (uid=2) for 378.4 gold
09:24:42 [INFO] gameserver.network.handlers: Tile 5,1 purchased by empire Empire1 (uid=2) for 453.9 gold
09:25:46 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 15 tiles
09:47:23 [INFO] gameserver.network.handlers: Tile 1,-1 purchased by empire Empire1 (uid=2) for 549.5 gold
09:47:24 [INFO] gameserver.network.handlers: Tile 1,-2 purchased by empire Empire1 (uid=2) for 670.8 gold
INFO:     192.168.178.2:55906 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTY2MjEyNywiZXhwIjoxNzcxNzQ4NTI3fQ.NstySyuAhVt-pb1HR7zZXuVAWlJdHd3u5jKeiEWyPV0" [accepted]
09:53:03 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
09:53:03 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
09:53:03 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
09:55:30 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:49898 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTY2MjEyNywiZXhwIjoxNzcxNzQ4NTI3fQ.NstySyuAhVt-pb1HR7zZXuVAWlJdHd3u5jKeiEWyPV0" [accepted]
09:55:31 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
09:55:31 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
09:55:31 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
09:58:34 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:50010 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTY2MjEyNywiZXhwIjoxNzcxNzQ4NTI3fQ.NstySyuAhVt-pb1HR7zZXuVAWlJdHd3u5jKeiEWyPV0" [accepted]
09:58:34 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
09:58:34 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
09:58:34 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
09:58:51 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:50036 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTY2MjEyNywiZXhwIjoxNzcxNzQ4NTI3fQ.NstySyuAhVt-pb1HR7zZXuVAWlJdHd3u5jKeiEWyPV0" [accepted]
09:58:52 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
09:58:52 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
09:58:52 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
09:58:54 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
09:58:54 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
09:58:57 [INFO] gameserver.network.handlers: Tile 2,-1 purchased by empire Empire1 (uid=2) for 824.2 gold
09:58:59 [INFO] gameserver.network.handlers: Tile 3,-1 purchased by empire Empire1 (uid=2) for 1018.0 gold
09:59:01 [INFO] gameserver.network.handlers: Tile 4,-2 purchased by empire Empire1 (uid=2) for 1262.4 gold
09:59:08 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 20 tiles
09:59:10 [INFO] gameserver.network.handlers: Map saved for empire Empire1 (uid=2): 20 tiles
INFO:     192.168.178.2:50051 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTY2MjEyNywiZXhwIjoxNzcxNzQ4NTI3fQ.NstySyuAhVt-pb1HR7zZXuVAWlJdHd3u5jKeiEWyPV0" [accepted]
09:59:12 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
09:59:12 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
09:59:12 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
09:59:14 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
09:59:14 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
INFO:     192.168.178.2:50052 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIsImlhdCI6MTc3MTY2MjEyNywiZXhwIjoxNzcxNzQ4NTI3fQ.NstySyuAhVt-pb1HR7zZXuVAWlJdHd3u5jKeiEWyPV0" [accepted]
09:59:17 [INFO] gameserver.network.server: Session registered: uid=2
INFO:     connection open
09:59:17 [INFO] gameserver.network.rest_api: REST-WS client connected: uid=2
09:59:17 [WARNING] gameserver.network.handlers: battle_register: no attack found for uid=2 target=2
10:00:10 [WARNING] gameserver.network.handlers: battle_unregister: uid=2 not registered for any attack
10:00:10 [INFO] gameserver.network.rest_api: REST-WS client disconnected: uid=2
INFO:     connection closed
